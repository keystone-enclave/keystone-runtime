cscope 15 $HOME/KEYSTONE/keystone/sdk/rts/eyrie               0000276754
	@aess.c

39 
	~<¡dšt.h
>

40 
	~<¡ršg.h
>

41 
	~"«ss.h
"

42 
	~"´štf.h
"

43 
	~"¹_ut.h
"

49 
	#Nb
 4

	)

52 
	#Nk
 4

53 
	#Nr
 10

54 

	)

59 
	#MULTIPLY_AS_A_FUNCTION
 0

	)

69 
ušt8_t
 
	t¡©e_t
[4][4];

76 cÚ¡ 
ušt8_t
 
	gsbox
[256] = {

95 cÚ¡ 
ušt8_t
 
	grsbox
[256] = {

115 cÚ¡ 
ušt8_t
 
	gRcÚ
[11] = {

140 
	#g‘SBoxV®ue
(
num
è(
sbox
[Òum)])

	)

147 
	#g‘SBoxInv”t
(
num
è(
rsbox
[Òum)])

	)

150 
	$KeyEx·nsiÚ
(
ušt8_t
* 
RoundKey
, cÚ¡ ušt8_t* 
Key
)

152 
i
, 
j
, 
k
;

153 
ušt8_t
 
‹m·
[4];

156 
i
 = 0; i < 
Nk
; ++i)

158 
RoundKey
[(
i
 * 4è+ 0] = 
Key
[(i * 4) + 0];

159 
RoundKey
[(
i
 * 4è+ 1] = 
Key
[(i * 4) + 1];

160 
RoundKey
[(
i
 * 4è+ 2] = 
Key
[(i * 4) + 2];

161 
RoundKey
[(
i
 * 4è+ 3] = 
Key
[(i * 4) + 3];

165 
i
 = 
Nk
; i < 
Nb
 * (
Nr
 + 1); ++i)

168 
k
 = (
i
 - 1) * 4;

169 
‹m·
[0]=
RoundKey
[
k
 + 0];

170 
‹m·
[1]=
RoundKey
[
k
 + 1];

171 
‹m·
[2]=
RoundKey
[
k
 + 2];

172 
‹m·
[3]=
RoundKey
[
k
 + 3];

176 ià(
i
 % 
Nk
 == 0)

183 
k
 = 
‹m·
[0];

184 
‹m·
[0] =empa[1];

185 
‹m·
[1] =empa[2];

186 
‹m·
[2] =empa[3];

187 
‹m·
[3] = 
k
;

195 
‹m·
[0] = 
	`g‘SBoxV®ue
(tempa[0]);

196 
‹m·
[1] = 
	`g‘SBoxV®ue
(tempa[1]);

197 
‹m·
[2] = 
	`g‘SBoxV®ue
(tempa[2]);

198 
‹m·
[3] = 
	`g‘SBoxV®ue
(tempa[3]);

201 
‹m·
[0] =em·[0] ^ 
RcÚ
[
i
/
Nk
];

204 
j
 = 
i
 * 4; 
k
=(˜- 
Nk
) * 4;

205 
RoundKey
[
j
 + 0] = RoundKey[
k
 + 0] ^ 
‹m·
[0];

206 
RoundKey
[
j
 + 1] = RoundKey[
k
 + 1] ^ 
‹m·
[1];

207 
RoundKey
[
j
 + 2] = RoundKey[
k
 + 2] ^ 
‹m·
[2];

208 
RoundKey
[
j
 + 3] = RoundKey[
k
 + 3] ^ 
‹m·
[3];

210 
	}
}

219 
	$AddRoundKey
(
ušt8_t
 
round
,
¡©e_t
* 
¡©e
,ušt8_t* 
RoundKey
)

221 
ušt8_t
 
i
,
j
;

222 
i
 = 0; i < 4; ++i)

224 
j
 = 0; j < 4; ++j)

226 (*
¡©e
)[
i
][
j
] ^ğ
RoundKey
[(
round
 * 
Nb
 * 4) + (i * Nb) + j];

229 
	}
}

233 
	$SubBy‹s
(
¡©e_t
* 
¡©e
)

235 
ušt8_t
 
i
, 
j
;

236 
i
 = 0; i < 4; ++i)

238 
j
 = 0; j < 4; ++j)

240 (*
¡©e
)[
j
][
i
] = 
	`g‘SBoxV®ue
((*state)[j][i]);

243 
	}
}

248 
	$ShiáRows
(
¡©e_t
* 
¡©e
)

250 
ušt8_t
 
‹mp
;

253 
‹mp
 = (*
¡©e
)[0][1];

254 (*
¡©e
)[0][1] = (*state)[1][1];

255 (*
¡©e
)[1][1] = (*state)[2][1];

256 (*
¡©e
)[2][1] = (*state)[3][1];

257 (*
¡©e
)[3][1] = 
‹mp
;

260 
‹mp
 = (*
¡©e
)[0][2];

261 (*
¡©e
)[0][2] = (*state)[2][2];

262 (*
¡©e
)[2][2] = 
‹mp
;

264 
‹mp
 = (*
¡©e
)[1][2];

265 (*
¡©e
)[1][2] = (*state)[3][2];

266 (*
¡©e
)[3][2] = 
‹mp
;

269 
‹mp
 = (*
¡©e
)[0][3];

270 (*
¡©e
)[0][3] = (*state)[3][3];

271 (*
¡©e
)[3][3] = (*state)[2][3];

272 (*
¡©e
)[2][3] = (*state)[1][3];

273 (*
¡©e
)[1][3] = 
‹mp
;

274 
	}
}

276 
ušt8_t
 
	$xtime
(
ušt8_t
 
x
)

278  ((
x
<<1) ^ (((x>>7) & 1) * 0x1b));

279 
	}
}

282 
	$MixCŞumns
(
¡©e_t
* 
¡©e
)

284 
ušt8_t
 
i
;

285 
ušt8_t
 
Tmp
, 
Tm
, 
t
;

286 
i
 = 0; i < 4; ++i)

288 
t
 = (*
¡©e
)[
i
][0];

289 
Tmp
 = (*
¡©e
)[
i
][0] ^ (*state)[i][1] ^ (*state)[i][2] ^ (*state)[i][3] ;

290 
Tm
 = (*
¡©e
)[
i
][0] ^ (*¡©e)[i][1] ; Tm = 
	`xtime
(Tm); (*¡©e)[i][0] ^ğTm ^ 
Tmp
 ;

291 
Tm
 = (*
¡©e
)[
i
][1] ^ (*¡©e)[i][2] ; Tm = 
	`xtime
(Tm); (*¡©e)[i][1] ^ğTm ^ 
Tmp
 ;

292 
Tm
 = (*
¡©e
)[
i
][2] ^ (*¡©e)[i][3] ; Tm = 
	`xtime
(Tm); (*¡©e)[i][2] ^ğTm ^ 
Tmp
 ;

293 
Tm
 = (*
¡©e
)[
i
][3] ^ 
t
 ; Tm = 
	`xtime
(Tm); (*¡©e)[i][3] ^ğTm ^ 
Tmp
 ;

295 
	}
}

302 
	#MuÉly
(
x
, 
y
) \

303 Ğ((
y
 & 1è* 
x
) ^ \

304 ((
y
>>1 & 1è* 
	`xtime
(
x
)) ^ \

305 ((
y
>>2 & 1è* 
	`xtime
(xtime(
x
))) ^ \

306 ((
y
>>3 & 1è* 
	`xtime
(xtime(xtime(
x
)))) ^ \

307 ((
y
>>4 & 1è* 
	`xtime
(xtime(xtime(xtime(
x
)))))) \

308 

	)

313 
	$InvMixCŞumns
(
¡©e_t
* 
¡©e
)

315 
i
;

316 
ušt8_t
 
a
, 
b
, 
c
, 
d
;

317 
i
 = 0; i < 4; ++i)

319 
a
 = (*
¡©e
)[
i
][0];

320 
b
 = (*
¡©e
)[
i
][1];

321 
c
 = (*
¡©e
)[
i
][2];

322 
d
 = (*
¡©e
)[
i
][3];

324 (*
¡©e
)[
i
][0] = 
	`MuÉly
(
a
, 0x0eè^ MuÉly(
b
, 0x0bè^ MuÉly(
c
, 0x0dè^ MuÉly(
d
, 0x09);

325 (*
¡©e
)[
i
][1] = 
	`MuÉly
(
a
, 0x09è^ MuÉly(
b
, 0x0eè^ MuÉly(
c
, 0x0bè^ MuÉly(
d
, 0x0d);

326 (*
¡©e
)[
i
][2] = 
	`MuÉly
(
a
, 0x0dè^ MuÉly(
b
, 0x09è^ MuÉly(
c
, 0x0eè^ MuÉly(
d
, 0x0b);

327 (*
¡©e
)[
i
][3] = 
	`MuÉly
(
a
, 0x0bè^ MuÉly(
b
, 0x0dè^ MuÉly(
c
, 0x09è^ MuÉly(
d
, 0x0e);

329 
	}
}

334 
	$InvSubBy‹s
(
¡©e_t
* 
¡©e
)

336 
ušt8_t
 
i
, 
j
;

337 
i
 = 0; i < 4; ++i)

339 
j
 = 0; j < 4; ++j)

341 (*
¡©e
)[
j
][
i
] = 
	`g‘SBoxInv”t
((*state)[j][i]);

344 
	}
}

346 
	$InvShiáRows
(
¡©e_t
* 
¡©e
)

348 
ušt8_t
 
‹mp
;

351 
‹mp
 = (*
¡©e
)[3][1];

352 (*
¡©e
)[3][1] = (*state)[2][1];

353 (*
¡©e
)[2][1] = (*state)[1][1];

354 (*
¡©e
)[1][1] = (*state)[0][1];

355 (*
¡©e
)[0][1] = 
‹mp
;

358 
‹mp
 = (*
¡©e
)[0][2];

359 (*
¡©e
)[0][2] = (*state)[2][2];

360 (*
¡©e
)[2][2] = 
‹mp
;

362 
‹mp
 = (*
¡©e
)[1][2];

363 (*
¡©e
)[1][2] = (*state)[3][2];

364 (*
¡©e
)[3][2] = 
‹mp
;

367 
‹mp
 = (*
¡©e
)[0][3];

368 (*
¡©e
)[0][3] = (*state)[1][3];

369 (*
¡©e
)[1][3] = (*state)[2][3];

370 (*
¡©e
)[2][3] = (*state)[3][3];

371 (*
¡©e
)[3][3] = 
‹mp
;

372 
	}
}

376 
	$Ch”
(
¡©e_t
* 
¡©e
, 
ušt8_t
* 
RoundKey
)

378 
ušt8_t
 
round
 = 0;

381 
	`AddRoundKey
(0, 
¡©e
, 
RoundKey
);

386 
round
 = 1;„ound < 
Nr
; ++round)

388 
	`SubBy‹s
(
¡©e
);

389 
	`ShiáRows
(
¡©e
);

390 
	`MixCŞumns
(
¡©e
);

391 
	`AddRoundKey
(
round
, 
¡©e
, 
RoundKey
);

396 
	`SubBy‹s
(
¡©e
);

397 
	`ShiáRows
(
¡©e
);

398 
	`AddRoundKey
(
Nr
, 
¡©e
, 
RoundKey
);

399 
	}
}

401 
	$InvCh”
(
¡©e_t
* 
¡©e
,
ušt8_t
* 
RoundKey
)

403 
ušt8_t
 
round
 = 0;

406 
	`AddRoundKey
(
Nr
, 
¡©e
, 
RoundKey
);

411 
round
 = (
Nr
 - 1);„ound > 0; --round)

413 
	`InvShiáRows
(
¡©e
);

414 
	`InvSubBy‹s
(
¡©e
);

415 
	`AddRoundKey
(
round
, 
¡©e
, 
RoundKey
);

416 
	`InvMixCŞumns
(
¡©e
);

421 
	`InvShiáRows
(
¡©e
);

422 
	`InvSubBy‹s
(
¡©e
);

423 
	`AddRoundKey
(0, 
¡©e
, 
RoundKey
);

424 
	}
}

439 
	$AES_š™_ùx_ivs
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
key
, cÚ¡ ušt8_t* 
iv
)

441 
	`KeyEx·nsiÚ
(
ùx
->
RoundKey
, 
key
);

442 
	`memıy
 (
ùx
->
Iv
, 
iv
, 
AES_BLOCKLEN
);

443 
	}
}

447 
	$XÜW™hIv
(
ušt8_t
* 
buf
, ušt8_t* 
Iv
)

449 
ušt8_t
 
i
;

450 
i
 = 0; i < 
AES_BLOCKLEN
; ++i)

452 
buf
[
i
] ^ğ
Iv
[i];

454 
	}
}

456 
	$AES_CBC_’üy±_bufãrs
(
AES_ùx
 *
ùx
,
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
)

458 
ušŒ_t
 
i
;

459 
ušt8_t
 *
Iv
 = 
ùx
->Iv;

460 
i
 = 0; i < 
Ëngth
; i +ğ
AES_BLOCKLEN
)

462 
	`XÜW™hIv
(
buf
, 
Iv
);

463 
	`Ch”
((
¡©e_t
*)
buf
, 
ùx
->
RoundKey
);

464 
Iv
 = 
buf
;

465 
buf
 +ğ
AES_BLOCKLEN
;

469 
	`memıy
(
ùx
->
Iv
, Iv, 
AES_BLOCKLEN
);

470 
	}
}

472 
	$AES_CBC_deüy±_bufãrs
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
)

474 
ušŒ_t
 
i
;

475 
ušt8_t
 
¡ÜeNextIv
[
AES_BLOCKLEN
];

476 
i
 = 0; i < 
Ëngth
; i +ğ
AES_BLOCKLEN
)

478 
	`memıy
(
¡ÜeNextIv
, 
buf
, 
AES_BLOCKLEN
);

479 
	`InvCh”
((
¡©e_t
*)
buf
, 
ùx
->
RoundKey
);

480 
	`XÜW™hIv
(
buf
, 
ùx
->
Iv
);

481 
	`memıy
(
ùx
->
Iv
, 
¡ÜeNextIv
, 
AES_BLOCKLEN
);

482 
buf
 +ğ
AES_BLOCKLEN
;

485 
	}
}

492 
AES_ùx
 
	gùx_e2
;

494 
	$’üy±_·ge
(
ušt8_t
* 
š
, 
ušŒ_t
 
š_size
,ušt8_ˆ*
key
,ušt8_ˆ*
iv
)

513 
	`chacha20
(
š
, in, 
š_size
, 
key_chacha
, 
iv
, 1);

518 
	`AES_š™_ùx_ivs
(&
ùx_e2
, 
key
, 
iv
);

519 
	`AES_CBC_’üy±_bufãrs
(&
ùx_e2
, 
š
, 
š_size
);

524 
	}
}

528 
AES_ùx
 
	gùx_d2
;

530 
	$deüy±_·ge
(
ušt8_t
* 
š
, 
ušŒ_t
 
š_size
,ušt8_ˆ*
key
,ušt8_ˆ*
iv
)

536 
	`’üy±_·ge
(
š
,
š_size
,
key
,
iv
);

539 
	`AES_š™_ùx_ivs
(&
ùx_d2
, 
key
, 
iv
);

540 
	`AES_CBC_deüy±_bufãrs
(&
ùx_d2
, 
š
, 
š_size
);

542 
	}
}

	@aess.h

2 
	#CBC
 1

	)

6 
	#AES128
 1

	)

10 
	#AES_BLOCKLEN
 16

11 

	)

13 
	#AES_KEYLEN
 16

14 
	#AES_keyExpSize
 176

	)

17 
	sAES_ùx


19 
ušt8_t
 
	mRoundKey
[
AES_keyExpSize
];

21 
ušt8_t
 
	mIv
[
AES_BLOCKLEN
];

27 
AES_š™_ùx_ivs
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
key
, cÚ¡ ušt8_t* 
iv
);

28 
AES_CBC_deüy±_bufãrs
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
);

29 
AES_CBC_’üy±_bufãrs
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
);

30 
’üy±_·ge
(
ušt8_t
* 
š
, 
ušŒ_t
 
š_size
,ušt8_ˆ*
key
,ušt8_ˆ*
iv
);

31 
deüy±_·ge
(
ušt8_t
* 
š
, 
ušŒ_t
 
š_size
,ušt8_ˆ*
key
,ušt8_ˆ*
iv
);

32 
ušt8_t
 
key
[16];

33 
ušt8_t
 
key_chacha
[32];

	@boot.c

1 
	~<asm/c¤.h
>

3 
	~"´štf.h
"

4 
	~"š‹¼u±.h
"

5 
	~"sysÿÎ.h
"

6 
	~"vm.h
"

7 
	~"¡ršg.h
"

8 
	~"sbi.h
"

9 
	~"ä“mem.h
"

10 
	~"mm.h
"

11 
	~"’v.h
"

12 
	~"·ge_»¶aûm’t.h
"

13 
	~"m®loc.h
"

14 
	~"¹_ut.h
"

19 
ušŒ_t
 
sh¬ed_bufãr
;

20 
ušŒ_t
 
sh¬ed_bufãr_size
;

22 
ušŒ_t
 *
»¶aûm’t_®go_queue
;

24 
ušŒ_t
 
poš‹r
;

25 
ušŒ_t
 
äame_size
;

27 
ušŒ_t
 
is_¹
;

28 
ušŒ_t
 
şock_couÁ”
;

34 
ušŒ_t
 *
pos™iÚ
;

36 
ušŒ_t
 *
knocked_·ge_addr
;

37 
N
;

38 
L
;

39 
Z
;

41 
ušŒ_t
 
	gutm_ba£
;

42 
size_t
 
	gutm_size
;

45 * 
’ş_Œ­_hªdËr
;

47 #ifdeà
USE_FREEMEM


50 
	$m­_physiÿl_memÜy_w™h_meg­ages
(
ušŒ_t
 
d¿m_ba£
,

51 
ušŒ_t
 
d¿m_size
,

52 
ušŒ_t
 
±r
)

54 
ušŒ_t
 
off£t
 = 0;

58 
	`as£¹
(
d¿m_size
 <ğ
	`RISCV_GET_LVL_PGSIZE
(1));

62 
	`as£¹
(
	`IS_ALIGNED
(
d¿m_ba£
, 
	`RISCV_GET_LVL_PGSIZE_BITS
(2)));

66 
	`as£¹
(
	`IS_ALIGNED
(
±r
, 
	`RISCV_GET_LVL_PGSIZE_BITS
(1)));

69 
roÙ_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
±r
, 1)] =

70 
	`±d_ü—‹
(
	`µn
(
	`k”Ãl_va_to_·
(
lßd_l2_·ge_bË
)));

73 
off£t
 = 0;

74 
off£t
 < 
d¿m_size
;

75 
off£t
 +ğ
	`RISCV_GET_LVL_PGSIZE
(2))

77 
lßd_l2_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
±r
 + 
off£t
, 2)] =

78 
	`±e_ü—‹
(
	`µn
(
d¿m_ba£
 + 
off£t
),

79 
PTE_R
 | 
PTE_W
 | 
PTE_X
 | 
PTE_A
 | 
PTE_D
);

81 
	}
}

84 
	$m­_physiÿl_memÜy_w™h_kİages
(
ušŒ_t
 
d¿m_ba£
,

85 
ušŒ_t
 
d¿m_size
,

86 
ušŒ_t
 
±r
)

88 
ušŒ_t
 
off£t
 = 0;

90 
	`as£¹
(
d¿m_size
 <ğ
	`RISCV_GET_LVL_PGSIZE
(2));

93 
	`as£¹
(
	`IS_ALIGNED
(
d¿m_ba£
, 
	`RISCV_GET_LVL_PGSIZE_BITS
(3)));

97 
	`as£¹
(
	`IS_ALIGNED
(
±r
, 
	`RISCV_GET_LVL_PGSIZE_BITS
(2)));

100 
roÙ_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
±r
, 1)] =

101 
	`±d_ü—‹
(
	`µn
(
	`k”Ãl_va_to_·
(
lßd_l2_·ge_bË
)));

104 
lßd_l2_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
±r
, 2)] =

105 
	`±d_ü—‹
(
	`µn
(
	`k”Ãl_va_to_·
(
lßd_l3_·ge_bË
)));

108 
off£t
 = 0;

109 
off£t
 < 
d¿m_size
;

110 
off£t
 +ğ
	`RISCV_GET_LVL_PGSIZE
(3))

112 
lßd_l3_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
±r
 + 
off£t
, 3)] =

113 
	`±e_ü—‹
(
	`µn
(
d¿m_ba£
 + 
off£t
),

114 
PTE_R
 | 
PTE_W
 | 
PTE_X
 | 
PTE_A
 | 
PTE_D
);

116 
	}
}

122 
	$m­_physiÿl_memÜy
(
ušŒ_t
 
d¿m_ba£
,

123 
ušŒ_t
 
d¿m_size
)

125 
ušŒ_t
 
±r
 = 
EYRIE_LOAD_START
;

127 
	`as£¹
(
	`RISCV_GET_PT_INDEX
(
±r
, 1è!ğRISCV_GET_PT_INDEX(
ruÁime_va_¡¬t
, 1));

129 ià(
d¿m_size
 > 
	`RISCV_GET_LVL_PGSIZE
(2))

130 
	`m­_physiÿl_memÜy_w™h_meg­ages
(
d¿m_ba£
, 
d¿m_size
, 
±r
);

132 
	`m­_physiÿl_memÜy_w™h_kİages
(
d¿m_ba£
, 
d¿m_size
, 
±r
);

133 
	}
}

136 
	$»m­_k”Ãl_¥aû
(
ušŒ_t
 
ruÁime_ba£
,

137 
ušŒ_t
 
ruÁime_size
)

139 
ušŒ_t
 
off£t
;

142 
	`as£¹
(
ruÁime_size
 <ğ
	`RISCV_GET_LVL_PGSIZE
(2));

145 
roÙ_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
ruÁime_va_¡¬t
, 1)] =

146 
	`±d_ü—‹
(
	`µn
(
	`k”Ãl_va_to_·
(
k”Ãl_l2_·ge_bË
)));

149 
k”Ãl_l2_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
ruÁime_va_¡¬t
, 2)] =

150 
	`±d_ü—‹
(
	`µn
(
	`k”Ãl_va_to_·
(
k”Ãl_l3_·ge_bË
)));

152 
off£t
 = 0;

153 
off£t
 < 
ruÁime_size
;

154 
off£t
 +ğ
	`RISCV_GET_LVL_PGSIZE
(3))

156 
k”Ãl_l3_·ge_bË
[
	`RISCV_GET_PT_INDEX
(
ruÁime_va_¡¬t
 + 
off£t
, 3)] =

157 
	`±e_ü—‹
(
	`µn
(
ruÁime_ba£
 + 
off£t
),

158 
PTE_R
 | 
PTE_W
 | 
PTE_X
 | 
PTE_A
 | 
PTE_D
|
PTE_L
);

160 
	}
}

163 
	$cİy_roÙ_·ge_bË
()

166 
±e_t
* 
Şd_roÙ_·ge_bË
 = (±e_t*è
EYRIE_LOAD_START
;

167 
i
;

170 
i
 = 0; i < 
	`BIT
(
RISCV_PT_INDEX_BITS
); i++) {

171 iàĞ
Şd_roÙ_·ge_bË
[
i
] & 
PTE_V
 &&

172 !(
roÙ_·ge_bË
[
i
] & 
PTE_V
)) {

173 
roÙ_·ge_bË
[
i
] = 
Şd_roÙ_·ge_bË
[i];

176 
	}
}

180 
	$š™_ä“mem
()

182 
	`¥a_š™
(
ä“mem_va_¡¬t
, 
ä“mem_size
);

183 
	}
}

189 
	$š™_u£r_¡ack_ªd_’v
()

191 * 
u£r_¥
 = (*è
EYRIE_USER_STACK_START
;

193 #ifdeà
USE_FREEMEM


194 
size_t
 
couÁ
;

195 
ušŒ_t
 
¡ack_’d
 = 
EYRIE_USER_STACK_END
;

196 
size_t
 
¡ack_couÁ
 = 
EYRIE_USER_STACK_SIZE
 >> 
RISCV_PAGE_BITS
;

199 
couÁ
 = 
	`®loc_·ges
(
	`v²
(
¡ack_’d
), 
¡ack_couÁ
,

200 
PTE_R
 | 
PTE_W
 | 
PTE_D
 | 
PTE_A
 | 
PTE_U
 | 
PTE_X
|
PTE_L
);

202 
	`as£¹
(
couÁ
 =ğ
¡ack_couÁ
);

207 
u£r_¥
 = 
	`£tup_¡¬t
(user_sp);

210 
	`c¤_wr™e
(
ssü©ch
, 
u£r_¥
);

211 
	}
}

214 
	$š™_·ge_»¶aûm’t_queue
(
ušŒ_t
 
d¿m_ba£
)

217 
ušŒ_t
 
šs_út_¡
=0;

218 
asm
 vŞ©("rdš¡»ˆ%0" : "ô" (
šs_út_¡
));

222 
	`m®loc
(
MALLOC_SIZE
);

223 
»¶aûm’t_®go_queue
=(
ušŒ_t
*)
	`m®loc
(
MALLOC_SIZE2
*(uintptr_t));

224 
»¶aûm’t_®go_queue_m­
=(
ušŒ_t
*)
	`m®loc
(
MALLOC_SIZE2
*(uintptr_t));

241 
ušŒ_t
 
šs_út_’
=0;

242 
asm
 vŞ©("rdš¡»ˆ%0" : "ô" (
šs_út_’
));

248 
´ev_addr
=0;

249 
ušŒ_t
 
num_of_®loÿ‹d_·ges
=0;num_of_allocated_pages=num_of_allocated_pages;

250 
ušŒ_t
 *
roÙ_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

251 
q_äÚt
=
q_»¬
=-1;

252 
poš‹r
=0;

253 
şock_couÁ”
=0;

254 
äame_size
=
MALLOC_SIZE2
;

255 
ušŒ_t
 
Ï¡_addr
 = 
	`g‘_´og¿m_b»ak
();

256 
ušŒ_t
 
i
=
MIN_ENCLAVE_VADDR
;i<
Ï¡_addr
;i+=
RISCV_PAGE_SIZE
)

258 
ušŒ_t
 * 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_bË_addr
,
i
);

259 
ušŒ_t
 
·_µn
=(*
¡©us_fšd_add»ss
)>>
PTE_PPN_SHIFT
;

260 
ušŒ_t
 
va_Üg
ğ
	`__va
(
·_µn
<<
RISCV_PAGE_BITS
);

261 
	`¶aû_Ãw_·ge
(
va_Üg
,
i
);

266 if(
	`v²
(
i
)>=1 )

269 *
¡©us_fšd_add»ss
=(*¡©us_fšd_add»ssè| 
PTE_L
 |
PTE_E
;

278 
	}
}

281 
ušŒ_t
 
	$g‘_Ï¡_addr
()

283 
ušŒ_t
 *
roÙ_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

284 
ušŒ_t
 
i
=
MIN_ENCLAVE_VADDR
;;i+=
RISCV_PAGE_SIZE
)

286 
ušŒ_t
 * 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_bË_addr
,
i
);

287 ifĞ! ( (*
¡©us_fšd_add»ss
è& 
PTE_L
 ) )

289  
i
;

292 
	}
}

294 
ušŒ_t
 
	$g‘_Ï¡_addr_¹
()

296 
ušŒ_t
 *
roÙ_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

297 
ušŒ_t
 
i
=
ruÁime_va_¡¬t
;;i+=
RISCV_PAGE_SIZE
)

299 
ušŒ_t
 * 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_bË_addr
,
i
);

300 ifĞ! ( (*
¡©us_fšd_add»ss
è& 
PTE_L
 ) )

302  
i
;

305 
	}
}

317 
	$eyr›_boÙ
(
ušŒ_t
 
dummy
,

318 
ušŒ_t
 
d¿m_ba£
,

319 
ušŒ_t
 
d¿m_size
,

320 
ušŒ_t
 
ruÁime_·ddr
,

321 
ušŒ_t
 
u£r_·ddr
,

322 
ušŒ_t
 
ä“_·ddr
,

323 
ušŒ_t
 
utm_vaddr
,

324 
ušŒ_t
 
utm_size
)

326 
is_¹
=1;

330 
lßd_·_¡¬t
 = 
d¿m_ba£
;

331 
sh¬ed_bufãr
 = 
utm_vaddr
;

332 
sh¬ed_bufãr_size
 = 
utm_size
;

333 
no_of_edge_ÿÎs
=0;

334 
ruÁime_va_¡¬t
 = (
ušŒ_t
è&
¹_ba£
;

335 
k”Ãl_off£t
 = 
ruÁime_va_¡¬t
 - 
ruÁime_·ddr
;

336 #ifdeà
USE_FREEMEM


337 
ä“mem_va_¡¬t
 = 
	`__va
(
ä“_·ddr
);

338 
ä“mem_size
 = 
d¿m_ba£
 + 
d¿m_size
 - 
ä“_·ddr
;

341 
	`»m­_k”Ãl_¥aû
(
ruÁime_·ddr
, 
u£r_·ddr
 -„untime_paddr);

343 
	`m­_physiÿl_memÜy
(
d¿m_ba£
, 
d¿m_size
);

346 
	`c¤_wr™e
(
§
, 
	`§_Ãw
(
	`k”Ãl_va_to_·
(
roÙ_·ge_bË
)));

349 
	`cİy_roÙ_·ge_bË
();

352 
	`š™_ä“mem
();

356 
	`£t_´og¿m_b»ak
(
	`g‘_Ï¡_addr
());

358 
	`£t_´og¿m_b»ak_¹
(
	`g‘_Ï¡_addr_¹
());

364 
	`š™_u£r_¡ack_ªd_’v
();

367 
	`c¤_wr™e
(
¡vec
, &
’ş_Œ­_hªdËr
);

370 
	`š™_edge_š‹º®s
();

389 
ušŒ_t
 
ä“mem_va_¡¬t_Şd
=
ä“mem_va_¡¬t
;

390 
	`´štf
("PRINTING FROM BOOT.c\n");

397 
	`c¤_wr™e
(
s¡©us
, 
	`c¤_»ad
(sstatus) | 0x6000);

398 
	`š™_·ge_»¶aûm’t_queue
(
d¿m_ba£
);

401 
ušŒ_t
 * 
¡©us_fšd_add»ss
=
	`__w®k
(
	`g‘_roÙ_·ge_bË_addr
(),
»¶aûm’t_®go_queue_m­
[0]);

402 
ušŒ_t
 
·_µn
=(*
¡©us_fšd_add»ss
)>>
PTE_PPN_SHIFT
;

403 
ušŒ_t
 
va_Üg
ğ
	`__va
(
·_µn
<<
RISCV_PAGE_BITS
);

406 
ä“mem_va_¡¬t
 = 
va_Üg
;

407 
ä“mem_size
 +ğ
ä“mem_va_¡¬t_Şd
-
ä“mem_va_¡¬t
;

410 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

421 
is_¹
=0;

423 
	}
}

	@common.h

1 #iâdeà
__COMMON_H__


2 
	#__COMMON_H__


	)

4 
	~"sbi.h
"

5 
	~"´štf.h
"

7 
	#as£¹
(
x
) \

8 if(!(
x
)è{ 
	`´štf
("as£¹iÚ faed‡ˆ%s:%d\n", 
__FILE__
, 
__LINE__
);\

9 
	`sbi_ex™_’şave
(-1); \

10 }

	)

	@elf.h

2 #iâdeà
_ELF_H_


3 
	#_ELF_H_


	)

5 
	#AT_NULL
 0

	)

6 
	#AT_IGNORE
 1

	)

7 
	#AT_EXECFD
 2

	)

8 
	#AT_PHDR
 3

	)

9 
	#AT_PHENT
 4

	)

10 
	#AT_PHNUM
 5

	)

11 
	#AT_PAGESZ
 6

	)

12 
	#AT_BASE
 7

	)

13 
	#AT_FLAGS
 8

	)

14 
	#AT_ENTRY
 9

	)

15 
	#AT_NOTELF
 10

	)

16 
	#AT_UID
 11

	)

17 
	#AT_EUID
 12

	)

18 
	#AT_GID
 13

	)

19 
	#AT_EGID
 14

	)

20 
	#AT_CLKTCK
 17

	)

23 
	#AT_PLATFORM
 15

	)

24 
	#AT_HWCAP
 16

	)

29 
	#AT_FPUCW
 18

	)

32 
	#AT_DCACHEBSIZE
 19

	)

33 
	#AT_ICACHEBSIZE
 20

	)

34 
	#AT_UCACHEBSIZE
 21

	)

38 
	#AT_IGNOREPPC
 22

	)

40 
	#AT_SECURE
 23

	)

42 
	#AT_BASE_PLATFORM
 24

	)

44 
	#AT_RANDOM
 25

	)

46 
	#AT_HWCAP2
 26

	)

48 
	#AT_EXECFN
 31

	)

52 
	#AT_SYSINFO
 32

	)

53 
	#AT_SYSINFO_EHDR
 33

	)

	@env.c

1 
	~"–f.h
"

2 
	~"tm¶ib/uacûss.h
"

3 
	~"¹_ut.h
"

4 
	~"¡ršg.h
"

5 
	~"´štf.h
"

27 
	#AUXV_COUNT
 11

	)

30 
	#SIZE_OF_SETUP
 (1+1+1+(2*
AUXV_COUNT
è+ 2)

	)

33 * 
	$£tup_¡¬t
(* 
_¥
){

36 * 
¡agšg
[
SIZE_OF_SETUP
];

38 ** 
¥
 = (**)
_¥
;

39 
¥
 = s°- 
SIZE_OF_SETUP
;

42 
¡agšg
[0] = (*)0;

45 
¡agšg
[1] = (*)0;

49 
¡agšg
[2] = (*)0;

52 
i
 = 0;

53 ** 
©_¿ndom_±r
 = 0;

54 * 
auxv
 = (*)&(
¡agšg
[3]);

58 
auxv
[
i
++] = 
AT_HWCAP
;

59 
auxv
[
i
++] = 0x112d;

60 
auxv
[
i
++] = 
AT_SYSINFO
;

61 
auxv
[
i
++] = 0x0;

62 
auxv
[
i
++] = 
AT_PAGESZ
;

63 
auxv
[
i
++] = 0x1000;

65 
auxv
[
i
++] = 
AT_EXECFN
;

66 
auxv
[
i
++] = 0;

67 
auxv
[
i
++] = 
AT_SECURE
;

68 
auxv
[
i
++] = 0;

69 
auxv
[
i
++] = 
AT_RANDOM
;

70 
©_¿ndom_±r
 = (**)&(
auxv
[
i
]);

71 
auxv
[
i
++] = 0;

75 
auxv
[
i
++] = 
AT_GID
;

76 
auxv
[
i
++] = 1;

77 
auxv
[
i
++] = 
AT_EGID
;

78 
auxv
[
i
++] = 1;

79 
auxv
[
i
++] = 
AT_UID
;

80 
auxv
[
i
++] = 1;

81 
auxv
[
i
++] = 
AT_EUID
;

82 
auxv
[
i
++] = 1;

83 
auxv
[
i
++] = 
AT_NULL
;

84 
auxv
[
i
++] = 0;

88 
»t
 = 
	`¹_ut_g‘¿ndom
((*)&
auxv
[
i
], 16);

90 ifĞ
»t
 != 16 )

91 
	`¹_ut_misc_çl
();

95 *
©_¿ndom_±r
 = &
¥
[
i
+3];

96 
i
+=2;

102 
	`cİy_to_u£r
(
¥
, 
¡agšg
, 
SIZE_OF_SETUP
*(*));

106  
¥
;

108 
	}
}

	@env.h

1 #iâdeà
__ENV_H__


2 
	#__ENV_H__


	)

4 * 
£tup_¡¬t
(* 
_¥
);

	@freemem.c

1 #ifdeà
USE_FREEMEM


2 
	~"commÚ.h
"

3 
	~"vm.h
"

4 
	~"ä“mem.h
"

17 
pg_li¡_t
 
	g¥a_ä“_·ges
;

19 
ušŒ_t


20 
	$¥a_g‘
()

22 
ušŒ_t
 
ä“_·ge
;

24 ià(
	`LIST_EMPTY
(
¥a_ä“_·ges
)) {

25 
	`´štf
("eyr› sim¶·g®loÿtÜ„un ouˆoàä“…age %Îd %s",
	`¥a_avaabË
(),"\n");

29 
ä“_·ge
 = 
¥a_ä“_·ges
.
h—d
;

30 
	`as£¹
(
ä“_·ge
);

33 
ušŒ_t
 
Ãxt
 = 
	`NEXT_PAGE
(
¥a_ä“_·ges
.
h—d
);

34 
¥a_ä“_·ges
.
h—d
 = 
Ãxt
;

35 
¥a_ä“_·ges
.
couÁ
--;

37  
ä“_·ge
;

38 
	}
}

42 
	$¥a_put
(
ušŒ_t
 
·ge_addr
)

44 
ušŒ_t
 
´ev
;

45 
	`as£¹
(
	`IS_ALIGNED
(
·ge_addr
, 
RISCV_PAGE_BITS
));

46 
	`as£¹
(
·ge_addr
 >ğ
ä“mem_va_¡¬t
 &&…age_add¸< (ä“mem_va_¡¬ˆ+ 
ä“mem_size
));

48 ià(!
	`LIST_EMPTY
(
¥a_ä“_·ges
)) {

49 
´ev
 = 
¥a_ä“_·ges
.

;

50 
	`as£¹
(
´ev
);

51 
	`NEXT_PAGE
(
´ev
èğ
·ge_addr
;

53 
¥a_ä“_·ges
.
h—d
 = 
·ge_addr
;

56 
	`NEXT_PAGE
(
·ge_addr
) = 0;

57 
¥a_ä“_·ges
.

 = 
·ge_addr
;

59 
¥a_ä“_·ges
.
couÁ
++;

61 
	}
}

64 
	$¥a_avaabË
(){

65  
¥a_ä“_·ges
.
couÁ
;

66 
	}
}

69 
	$¥a_š™
(
ušŒ_t
 
ba£
, 
size_t
 
size
)

71 
ušŒ_t
 
cur
;

73 
	`LIST_INIT
(
¥a_ä“_·ges
);

76 
	`as£¹
(
	`IS_ALIGNED
(
ba£
, 
RISCV_PAGE_BITS
));

77 
	`as£¹
(
	`IS_ALIGNED
(
size
, 
RISCV_PAGE_BITS
));

80 
cur
 = 
ba£
;

81 
cur
 < 
ba£
 + 
size
;

82 
cur
 +ğ
RISCV_PAGE_SIZE
) {

83 
	`¥a_put
(
cur
);

85 
	}
}

	@freemem.h

1 #ifdeà
USE_FREEMEM


3 #iâdeà
__FREEMEM_H__


4 
	#__FREEMEM_H__


	)

6 
	#NEXT_PAGE
(
·ge
è*((
ušŒ_t
*íage)

	)

7 
	#LIST_EMPTY
(
li¡
è(Öi¡).
couÁ
 =ğ0 || (li¡).
h—d
 =ğ0)

	)

8 
	#LIST_INIT
(
li¡
è{ (li¡).
couÁ
 = 0; (li¡).
h—d
 = 0; (li¡).

 = 0; }

	)

10 
	spg_li¡_t


12 
ušŒ_t
 
	mh—d
;

13 
ušŒ_t
 
	m
;

14 
	mcouÁ
;

15 } 
	tpg_li¡_t
;

17 
¥a_š™
(
ušŒ_t
 
ba£
, 
size_t
 
size
);

18 
ušŒ_t
 
¥a_g‘
();

19 
¥a_put
(
ušŒ_t
 
·ge
);

20 
¥a_avaabË
();

	@index_q.c

1 
	~"vm.h
"

2 
	~"·ge_»¶aûm’t.h
"

3 
	~"´štf.h
"

4 
	~"rÜam.h
"

5 
	~"šdex_q.h
"

9 
ušŒ_t
 
	$g‘_q_size2
()

17  (
äÚt
+1);

18 
	}
}

24 
šŒ_t
 
	$is_Em±y_queue2
()

26  
äÚt
==-1;

27 
	}
}

29 
ušŒ_t
 
	$is_FuÎ_queue2
()

33  
äÚt
==
STASH_SIZE_RORAM
;

34 
	}
}

36 
ušŒ_t
 
	$’que2
(
ušŒ_t
 
™em_’c_va
)

38 if(!Ğ
™em_’c_va
>=0 && i‹m_’c_v¨< 
STASH_SIZE_RORAM
 ))

40 
	`´štf
("©†š’qu%d",
™em_’c_va
);

44 if(
	`is_FuÎ_queue2
())

46  
QUEUE_FULL
;

68 
ä“_šdiûs
[++
äÚt
]=
™em_’c_va
;

69  
ENQUE_SUCCESS
;

75 
	}
}

77 
ušŒ_t
 
	$deque2
()

79 if(
	`is_Em±y_queue2
())

81  
QUEUE_EMPTY
;

86 
ušŒ_t
 
ä“_pos
ğ
ä“_šdiûs
[
äÚt
];

100 
äÚt
--;

101  
ä“_pos
;

103 
	}
}

	@index_q.h

1 
ušŒ_t
 
	gäÚt
;

2 
ušŒ_t
 
	g»¬
;

5 
ušŒ_t
 
’que2
(ušŒ_ˆ
™em_’c_va
);

6 
ušŒ_t
 
deque2
();

7 
ušŒ_t
 
g‘_q_size2
();

	@interrupt.c

5 
	~"»gs.h
"

6 
	~"sbi.h
"

7 
	~"timex.h
"

8 
	~"š‹¼u±.h
"

9 
	~"´štf.h
"

10 
	~<asm/c¤.h
>

11 
	~"·ge_»¶aûm’t.h
"

12 
	~"¹_ut.h
"

13 
	~"vm.h
"

15 
	#DEFAULT_CLOCK_DELAY
 3500

16 

	)

17 
	$š™_tim”
()

19 
	`sbi_£t_tim”
(
	`g‘_cyşes64
(è+ 
DEFAULT_CLOCK_DELAY
);

20 
	`c¤_£t
(
s¡©us
, 
SR_SPIE
);

21 
	`c¤_£t
(
s›
, 
SIE_STIE
 | 
SIE_SSIE
);

22 
	}
}

24 
	$hªdË_tim”_š‹¼u±
()

26 
	`sbi_¡İ_’şave
(0);

27 
Ãxt_cyşe
 = 
	`g‘_cyşes64
(è+ 
DEFAULT_CLOCK_DELAY
;

28 
	`sbi_£t_tim”
(
Ãxt_cyşe
);

29 
	`c¤_£t
(
s¡©us
, 
SR_SPIE
);

30 
	`c¤_£t
(
s›
, 
SIE_STIE
 | 
SIE_SSIE
);

35 
	}
}

37 
	$hªdË_š‹¼u±s
(
’ş_ùx_t
* 
»gs
)

40 
ÿu£
 = 
»gs
->
sÿu£
;

42 
ÿu£
) {

43 
INTERRUPT_CAUSE_TIMER
:

44 
	`hªdË_tim”_š‹¼u±
();

48 
INTERRUPT_CAUSE_SOFTWARE
:

49 
INTERRUPT_CAUSE_EXTERNAL
:

51 
	`sbi_¡İ_’şave
(0);

54 
is_¹
=0;

55 
	}
}

	@interrupt.h

5 #iâdeà
_INTERRUPT_H_


6 
	#_INTERRUPT_H_


	)

8 
	#INTERRUPT_CAUSE_SOFTWARE
 1

	)

9 
	#INTERRUPT_CAUSE_TIMER
 5

	)

10 
	#INTERRUPT_CAUSE_EXTERNAL
 9

	)

12 
š™_tim”
();

	@io_wrap.c

1 
	~<¡dšt.h
>

2 
	~"io_w¿p.h
"

3 
	~<®loÿ.h
>

4 
	~"uacûss.h
"

5 
	~"sysÿÎ.h
"

6 
	~"¡ršg.h
"

7 
	~"edge_sysÿÎ.h
"

20 
	#MAX_STRACE_PRINT
 20

	)

22 
ušŒ_t
 
	$io_sysÿÎ_sync
(){

23 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

25 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_sync
;

27 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
));

29 
ušŒ_t
 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

30 
	`´št_¡¿û
("[runtime]…roxied sync\r\n");

31  
»t
;

32 
	}
}

34 
ušŒ_t
 
	$io_sysÿÎ_árunÿ‹
(
fd
, 
off_t
 
off£t
){

35 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

36 
§rgs_SYS_árunÿ‹
* 
¬gs
 = (§rgs_SYS_árunÿ‹*)
edge_sysÿÎ
->
d©a
;

37 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_árunÿ‹
;

39 
¬gs
->
fd
 = fd;

40 
¬gs
->
off£t
 = offset;

42 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
)+

43 (
§rgs_SYS_árunÿ‹
));

45 
ušŒ_t
 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

46 
	`´št_¡¿û
("[ruÁime]…rox›d fŒunÿ‹ (%ièğ%li\r\n", 
fd
, 
»t
);

47  
»t
;

48 
	}
}

49 
ušŒ_t
 
	$io_sysÿÎ_fsync
(
fd
){

50 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

51 
§rgs_SYS_fsync
* 
¬gs
 = (§rgs_SYS_fsync*)
edge_sysÿÎ
->
d©a
;

52 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_fsync
;

54 
¬gs
->
fd
 = fd;

56 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
)+

57 (
§rgs_SYS_fsync
));

59 
ušŒ_t
 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

60 
	`´št_¡¿û
("[ruÁime]…rox›d fsynø(%ièğ%li\r\n", 
fd
, 
»t
);

61  
»t
;

62 
	}
}

64 
ušŒ_t
 
	$io_sysÿÎ_l£ek
(
fd
, 
off_t
 
off£t
, 
wh’û
){

65 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

66 
§rgs_SYS_l£ek
* 
¬gs
 = (§rgs_SYS_l£ek*)
edge_sysÿÎ
->
d©a
;

67 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_l£ek
;

69 
¬gs
->
fd
 = fd;

70 
¬gs
->
off£t
 = offset;

71 
¬gs
->
wh’û
 = whence;

73 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
)+

74 (
§rgs_SYS_l£ek
));

76 
ušŒ_t
 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

77 
	`´št_¡¿û
("[runtime]…roxied†seek (on fd:%io %li from %i) = %li\r\n",

78 
fd
, 
off£t
, 
wh’û
, 
»t
);

79  
»t
;

80 
	}
}

82 
ušŒ_t
 
	$io_sysÿÎ_şo£
(
fd
){

83 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

84 
§rgs_SYS_şo£
* 
¬gs
 = (§rgs_SYS_şo£*)
edge_sysÿÎ
->
d©a
;

85 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_şo£
;

87 
¬gs
->
fd
 = fd;

89 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
)+

90 (
§rgs_SYS_şo£
));

92 
ušŒ_t
 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

93 
	`´št_¡¿û
("[ruÁime]…rox›d clo£ (%ièğ%li\r\n", 
fd
, 
»t
);

94  
»t
;

95 
	}
}

97 
ušŒ_t
 
	$io_sysÿÎ_»ad
(
fd
, * 
buf
, 
size_t
 
Ën
){

98 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

99 
§rgs_SYS_»ad
* 
¬gs
 = (§rgs_SYS_»ad*)
edge_sysÿÎ
->
d©a
;

100 
ušŒ_t
 
»t
 = -1;

101 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_»ad
;

102 
¬gs
->
fd
 =fd;

103 
¬gs
->
Ën
 =†en;

106 if(
	`edge_ÿÎ_check_±r_v®id
((
ušŒ_t
)
¬gs
->
buf
, 
Ën
) != 0){

107 
dÚe
;

110 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
) +

111 (
§rgs_SYS_»ad
) +

112 
Ën
);

114 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

116 if(()
»t
 < 0){

117 
dÚe
;

121 
	`cİy_to_u£r
(
buf
, 
¬gs
->buf, 
»t
 > 
Ën
?†en:„et);

123 
dÚe
:

124 
	`´št_¡¿û
("[ruÁime]…rox›d„—d (size: %luèğ%li\r\n",
Ën
, 
»t
);

125  
»t
;

126 
	}
}

129 
ušŒ_t
 
	$io_sysÿÎ_wr™e
(
fd
, * 
buf
, 
size_t
 
Ën
){

139 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

140 
§rgs_SYS_wr™e
* 
¬gs
 = (§rgs_SYS_wr™e*)
edge_sysÿÎ
->
d©a
;

141 
ušŒ_t
 
»t
 = -1;

143 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_wr™e
;

144 
¬gs
->
fd
 =fd;

145 
¬gs
->
Ën
 =†en;

148 if(
	`edge_ÿÎ_check_±r_v®id
((
ušŒ_t
)
¬gs
->
buf
, 
Ën
) != 0){

149 
dÚe
;

152 
	`cİy_äom_u£r
(
¬gs
->
buf
, buf, 
Ën
);

154 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
) +

155 (
§rgs_SYS_wr™e
) +

156 
Ën
);

158 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

160 
dÚe
:

161 
	`´št_¡¿û
("[ruÁime]…rox›d wr™(size: %luèğ%li\r\n",
Ën
, 
»t
);

162  
»t
;

163 
	}
}

165 
ušŒ_t
 
	$io_sysÿÎ_İ’©
(
dœfd
, * 
·th
,

166 
æags
, 
mode_t
 
mode
){

167 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

168 
§rgs_SYS_İ’©
* 
¬gs
 = (§rgs_SYS_İ’©*)
edge_sysÿÎ
->
d©a
;

170 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_İ’©
;

171 
¬gs
->
dœfd
 = dirfd;

172 
¬gs
->
æags
 = flags;

173 
¬gs
->
mode
 = mode;

174 
ušŒ_t
 
»t
 = -1;

176 
size_t
 
·thËn
;

177 
	`ALLOW_USER_ACCESS
(
·thËn
 = 
	`_¡¾’
(
·th
)+1);

179 if(
	`edge_ÿÎ_check_±r_v®id
((
ušŒ_t
)
¬gs
->
·th
, 
·thËn
) != 0){

180 
dÚe
;

182 
	`cİy_äom_u£r
(
¬gs
->
·th
,…©h, 
·thËn
);

184 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
) +

185 (
§rgs_SYS_İ’©
) +

186 
·thËn
);

188 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

191 
dÚe
:

193 
	`´št_¡¿û
("[runtime]…roxied openat(path: %.*s) = %li\r\n",

194 
·thËn
>
MAX_STRACE_PRINT
?MAX_STRACE_PRINT:·thËn,
¬gs
->
·th
, 
»t
);

196  
»t
;

197 
	}
}

199 
ušŒ_t
 
	$io_sysÿÎ_uÆšk©
(
dœfd
, * 
·th
,

200 
æags
){

201 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

202 
§rgs_SYS_uÆšk©
* 
¬gs
 = (§rgs_SYS_uÆšk©*)
edge_sysÿÎ
->
d©a
;

203 
ušŒ_t
 
»t
 = -1;

205 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_uÆšk©
;

206 
¬gs
->
dœfd
 = dirfd;

207 
¬gs
->
æags
 = flags;

208 
size_t
 
·thËn
;

209 
	`ALLOW_USER_ACCESS
(
·thËn
 = 
	`_¡¾’
(
·th
)+1);

211 if(
	`edge_ÿÎ_check_±r_v®id
((
ušŒ_t
)
¬gs
->
·th
, 
·thËn
) != 0){

212 
dÚe
;

214 
	`cİy_äom_u£r
(
¬gs
->
·th
,…©h, 
·thËn
);

216 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
) +

217 (
§rgs_SYS_uÆšk©
) +

218 
·thËn
);

220 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

223 
dÚe
:

225 
	`´št_¡¿û
("[runtime]…roxied unlinkat(path: %.*s) = %li\r\n",

226 
·thËn
>
MAX_STRACE_PRINT
?MAX_STRACE_PRINT:·thËn,
¬gs
->
·th
, 
»t
);

227  
»t
;

228 
	}
}

230 
ušŒ_t
 
	$io_sysÿÎ_wr™ev
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
){

231 
i
=0;

232 
ušŒ_t
 
»t
 = 0;

233 
size_t
 
tÙ®
 = 0;

234 
	`´št_¡¿û
("[ruÁime] SimuÏtšg wr™ev (úˆ%ièw™h wr™ÿÎs\r\n",
iovút
);

235 
i
=0; i<
iovút
 && 
»t
 >= 0;i++){

236 
iovec
 
iov_loÿl
;

237 
	`cİy_äom_u£r
(&
iov_loÿl
, &(
iov
[
i
]), (
iovec
));

238 
»t
 = 
	`io_sysÿÎ_wr™e
(
fd
,
iov_loÿl
.
iov_ba£
, iov_loÿl.
iov_Ën
);

239 
tÙ®
 +ğ
»t
;

241 
»t
 = 
tÙ®
;

242 
	`´št_¡¿û
("[ruÁime] SimuÏ‹d wr™ev = %li\r\n",
»t
);

243  
»t
;

244 
	}
}

246 
ušŒ_t
 
	$io_sysÿÎ_»adv
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
){

247 
i
=0;

248 
ušŒ_t
 
»t
 = 0;

249 
size_t
 
tÙ®
 = 0;

250 
	`´št_¡¿û
("[ruÁime] SimuÏtšg„—dv (úˆ%ièw™h„—d c®ls\r\n",
iovút
);

251 
i
=0; i<
iovút
 && 
»t
 >= 0;i++){

252 
iovec
 
iov_loÿl
;

253 
	`cİy_äom_u£r
(&
iov_loÿl
, &(
iov
[
i
]), (
iovec
));

254 
»t
 = 
	`io_sysÿÎ_»ad
(
fd
, 
iov_loÿl
.
iov_ba£
, iov_loÿl.
iov_Ën
);

255 
tÙ®
 +ğ
»t
;

258 
»t
 = 
tÙ®
;

259 
	`´št_¡¿û
("[ruÁime] SimuÏ‹d„—dv = %li\r\n",
»t
);

260  
»t
;

261 
	}
}

263 
ušŒ_t
 
	$io_sysÿÎ_f¡©©
(
dœfd
, *
·thÇme
, 
¡©
 *
¡©buf
,

264 
æags
){

265 
edge_sysÿÎ_t
* 
edge_sysÿÎ
 = (edge_sysÿÎ_t*)
	`edge_ÿÎ_d©a_±r
();

266 
§rgs_SYS_f¡©©
* 
¬gs
 = (§rgs_SYS_f¡©©*)
edge_sysÿÎ
->
d©a
;

267 
ušŒ_t
 
»t
 = -1;

269 
edge_sysÿÎ
->
sysÿÎ_num
 = 
SYS_f¡©©
;

270 
¬gs
->
dœfd
 = dirfd;

271 
¬gs
->
æags
 = flags;

273 
size_t
 
·thËn
;

274 
	`ALLOW_USER_ACCESS
(
·thËn
 = 
	`_¡¾’
(
·thÇme
)+1);

276 if(
	`edge_ÿÎ_check_±r_v®id
((
ušŒ_t
)
¬gs
->
·thÇme
, 
·thËn
) != 0){

277 
dÚe
;

279 
	`cİy_äom_u£r
(
¬gs
->
·thÇme
,…©hÇme, 
·thËn
);

281 
size_t
 
tÙ®size
 = ((
edge_sysÿÎ_t
) +

282 (
§rgs_SYS_f¡©©
) +

283 
·thËn
);

285 
»t
 = 
	`di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ
, 
tÙ®size
);

287 if(
»t
 == 0){

288 
	`cİy_to_u£r
(
¡©buf
, &
¬gs
->
¡©s
, (
¡©
));

291 
dÚe
:

292 
	`´št_¡¿û
("[runtime]…roxied fstatat (path %.*s) = %li\r\n",

293 
·thËn
>
MAX_STRACE_PRINT
?MAX_STRACE_PRINT:·thËn,
¬gs
->
·thÇme
, 
»t
);

294  
»t
;

296 
	}
}

	@io_wrap.h

1 #iâdeà
_IO_WRAP_H_


2 
	#_IO_WRAP_H_


	)

4 
	~<sys/uio.h
>

5 
	~<sys/ty³s.h
>

6 
	~"edge_sysÿÎ.h
"

8 
ušŒ_t
 
io_sysÿÎ_»ad
(
fd
, * 
buf
, 
size_t
 
Ën
);

9 
ušŒ_t
 
io_sysÿÎ_wr™e
(
fd
, * 
buf
, 
size_t
 
Ën
);

10 
ušŒ_t
 
io_sysÿÎ_wr™ev
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
);

11 
ušŒ_t
 
io_sysÿÎ_»adv
(
fd
, cÚ¡ 
iovec
 *
iov
, 
iovút
);

12 
ušŒ_t
 
io_sysÿÎ_İ’©
(
dœfd
, * 
·th
,

13 
æags
, 
mode_t
 
mode
);

14 
ušŒ_t
 
io_sysÿÎ_f¡©©
(
dœfd
, *
·thÇme
, 
¡©
 *
¡©buf
,

15 
æags
);

16 
ušŒ_t
 
io_sysÿÎ_uÆšk©
(
dœfd
, * 
·th
,

17 
æags
);

18 
ušŒ_t
 
io_sysÿÎ_fsync
(
fd
);

19 
ušŒ_t
 
io_sysÿÎ_şo£
(
fd
);

20 
ušŒ_t
 
io_sysÿÎ_sync
();

21 
ušŒ_t
 
io_sysÿÎ_l£ek
(
fd
, 
off_t
 
off£t
, 
wh’û
);

22 
ušŒ_t
 
io_sysÿÎ_árunÿ‹
(
fd
, 
off_t
 
Ëngth
);

	@linux_wrap.c

1 
	~"uacûss.h
"

2 
	~"lšux_w¿p.h
"

3 
	~"sysÿÎ.h
"

4 
	~<sys/mmª.h
>

5 
	~"ä“mem.h
"

6 
	~"mm.h
"

7 
	~"¹_ut.h
"

8 
	~<sys/ut¢ame.h
>

10 
	#CLOCK_FREQ
 1000000000

	)

13 
ušŒ_t
 
	$lšux_şock_g‘time
(
__şockid_t
 
şock
, 
time¥ec
 *

){

14 
	`´št_¡¿û
("[ruÁime] clock_g‘timnÙ fuÎy suµÜ‹d (şock %x,‡ssumšg)\r\n", 
şock
);

15 
cyşes
;

16 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes
));

18 
£c
 = 
cyşes
 / 
CLOCK_FREQ
;

19 
n£c
 = (
cyşes
 % 
CLOCK_FREQ
);

21 
	`cİy_to_u£r
(&(

->
tv_£c
), &
£c
, ());

22 
	`cİy_to_u£r
(&(

->
tv_n£c
), &
n£c
, ());

25 
	}
}

27 
ušŒ_t
 
	$lšux_£t_tid_add»ss
(* 
tid±r_t
){

29 
	`´št_¡¿û
("[ruÁime] s‘_tid_add»ss,‚Ù s‘tšg‡dd»s (%p), IGNORING\r\n",
tid±r_t
);

31 
	}
}

33 
ušŒ_t
 
	$lšux_¹_sig´ocmask
(
how
, cÚ¡ 
sig£t_t
 *
£t
, sig£t_ˆ*
Şd£t
){

34 
	`´št_¡¿û
("[ruÁime]„t_sig´ocmask‚Ù suµÜ‹d (how %x), IGNORING\r\n", 
how
);

36 
	}
}

38 
ušŒ_t
 
	$lšux_RET_ZERO_w¿p
(
which
){

39 
	`´št_¡¿û
("[ruÁime] CªnÙ hªdË sysÿÎ %lu, IGNORING = 0\r\n", 
which
);

41 
	}
}

43 
ušŒ_t
 
	$lšux_RET_BAD_w¿p
(
which
){

44 
	`´št_¡¿û
("[ruÁime] CªnÙ hªdË sysÿÎ %lu, FAILING = -1\r\n", 
which
);

46 
	}
}

48 
ušŒ_t
 
	$lšux_g‘pid
(){

49 
ušŒ_t
 
çk•id
 = 2;

50 
	`´št_¡¿û
("[ruÁime] Fakšg g‘pid w™h %lx\r\n",
çk•id
);

51  
çk•id
;

52 
	}
}

54 
ušŒ_t
 
	$lšux_g‘¿ndom
(*
buf
, 
size_t
 
buæ’
, 
æags
){

56 
ušŒ_t
 
»t
 = 
	`¹_ut_g‘¿ndom
(
buf
, 
buæ’
) == 0?buflen:-1;

57 
	`´št_¡¿û
("[ruÁime] g‘¿ndom IGNORES FLAGS (siz%lx), PLATFORM DEPENDENT IF SAFE =„‘ %lu\r\n", 
buæ’
, 
»t
);

58  
»t
;

59 
	}
}

61 
	#UNAME_SYSNAME
 "Lšux\0"

	)

62 
	#UNAME_NODENAME
 "Enş\0"

	)

63 
	#UNAME_RELEASE
 "4.15.0\0"

	)

64 
	#UNAME_VERSION
 "Eyr›\0"

	)

65 
	#UNAME_MACHINE
 "NA\0"

	)

67 
ušŒ_t
 
	$lšux_uÇme
(* 
buf
){

70 
ut¢ame
 *
u£r_uÇme
 = (ut¢am*)
buf
;

71 
ušŒ_t
 
»t
;

73 
»t
 = 
	`cİy_to_u£r
(&
u£r_uÇme
->
sy¢ame
, 
UNAME_SYSNAME
, (UNAME_SYSNAME));

74 if(
»t
 !ğ0è
uÇme_dÚe
;

76 
»t
 = 
	`cİy_to_u£r
(&
u£r_uÇme
->
nod’ame
, 
UNAME_NODENAME
, (UNAME_NODENAME));

77 if(
»t
 !ğ0è
uÇme_dÚe
;

79 
»t
 = 
	`cİy_to_u£r
(&
u£r_uÇme
->
»Ëa£
, 
UNAME_RELEASE
, (UNAME_RELEASE));

80 if(
»t
 !ğ0è
uÇme_dÚe
;

82 
»t
 = 
	`cİy_to_u£r
(&
u£r_uÇme
->
v”siÚ
, 
UNAME_VERSION
, (UNAME_VERSION));

83 if(
»t
 !ğ0è
uÇme_dÚe
;

85 
»t
 = 
	`cİy_to_u£r
(&
u£r_uÇme
->
machše
, 
UNAME_MACHINE
, (UNAME_MACHINE));

86 if(
»t
 !ğ0è
uÇme_dÚe
;

90 
uÇme_dÚe
:

91 
	`´št_¡¿û
("[ruÁime] uÇmğ%x\n",
»t
);

92  
»t
;

93 
	}
}

95 
ušŒ_t
 
	$sysÿÎ_munm­
(*
addr
, 
size_t
 
Ëngth
){

96 
ušŒ_t
 
»t
 = (uintptr_t)((*)-1);

98 
	`ä“_·ges
(
	`v²
((
ušŒ_t
)
addr
), 
Ëngth
/
RISCV_PAGE_SIZE
);

99 
»t
 = 0;

100  
»t
;

101 
	}
}

103 
ušŒ_t
 
	$sysÿÎ_mm­
(*
addr
, 
size_t
 
Ëngth
, 
´Ù
, 
æags
,

104 
fd
, 
__off_t
 
off£t
){

105 
ušŒ_t
 
»t
 = (uintptr_t)((*)-1);

107 
±e_æags
 = 
PTE_U
 | 
PTE_A
;

109 if(
æags
 !ğ(
MAP_ANONYMOUS
 | 
MAP_PRIVATE
è|| 
fd
 != -1){

111 
dÚe
;

115 if(
´Ù
 & 
PROT_READ
)

116 
±e_æags
 |ğ
PTE_R
;

117 if(
´Ù
 & 
PROT_WRITE
)

118 
±e_æags
 |ğ
PTE_W
 | 
PTE_D
;

119 if(
´Ù
 & 
PROT_EXEC
)

120 
±e_æags
 |ğ
PTE_X
;

125 
»q_·ges
 = 
	`v²
(
	`PAGE_UP
(
Ëngth
));

128 ifĞ
»q_·ges
 > 
	`¥a_avaabË
()){

129 
dÚe
;

133 
ušŒ_t
 
¡¬tšg_v²
 = 
	`v²
(
EYRIE_ANON_REGION_START
);

134 
ušŒ_t
 
v®id_·ges
;

135 (
¡¬tšg_v²
 + 
»q_·ges
è<ğ
EYRIE_ANON_REGION_END
){

136 
v®id_·ges
 = 
	`‹¡_va_¿nge
(
¡¬tšg_v²
, 
»q_·ges
);

138 if(
»q_·ges
 =ğ
v®id_·ges
){

141 if(
	`®loc_·ges
(
¡¬tšg_v²
, 
»q_·ges
, 
±e_æags
) ==„eq_pages){

142 
»t
 = 
¡¬tšg_v²
 << 
RISCV_PAGE_BITS
;

147 
¡¬tšg_v²
 +ğ
v®id_·ges
 + 1;

150 
dÚe
:

151 
	`´št_¡¿û
("[ruÁime] [mm­]:‡ddr: 0x%p,†’gth %lu,…rÙ 0x%x, fÏg 0x%x, fd %i, off£ˆ%lu (%l˜·ge %xèğ0x%p\r\n", 
addr
, 
Ëngth
, 
´Ù
, 
æags
, 
fd
, 
off£t
, 
»q_·ges
, 
±e_æags
, 
»t
);

154  
»t
;

155 
	}
}

158 
ušŒ_t
 
	$sysÿÎ_brk
(* 
addr
){

163 
ušŒ_t
 
»q_b»ak
 = (ušŒ_t)
addr
;

165 
ušŒ_t
 
cu¼’t_b»ak
 = 
	`g‘_´og¿m_b»ak
();

166 
ušŒ_t
 
»t
 = 
cu¼’t_b»ak
;

167 
»q_·ge_couÁ
 = 0;

170 ifĞ
»q_b»ak
 =ğ0 ||„eq_b»ak <ğ
cu¼’t_b»ak
){

171 
dÚe
;

177 
»q_·ge_couÁ
 = (
	`PAGE_UP
(
»q_b»ak
è- 
cu¼’t_b»ak
è/ 
RISCV_PAGE_SIZE
;

178 ifĞ
	`¥a_avaabË
(è< 
»q_·ge_couÁ
){

179 
dÚe
;

184 ifĞ
	`®loc_·ges
(
	`v²
(
cu¼’t_b»ak
),

185 
»q_·ge_couÁ
,

186 
PTE_W
 | 
PTE_R
 | 
PTE_D
 | 
PTE_U
 | 
PTE_A
)

187 !ğ
»q_·ge_couÁ
){

188 
dÚe
;

192 
	`£t_´og¿m_b»ak
(
»q_b»ak
);

193 
»t
 = 
»q_b»ak
;

196 
dÚe
:

197 
	`´št_¡¿û
("[ruÁime] brk (0x%pèÔeq…age %ièğ0x%p\r\n",
»q_b»ak
, 
»q_·ge_couÁ
, 
»t
);

198  
»t
;

200 
	}
}

	@linux_wrap.h

1 #iâdeà
_LINUX_WRAP_H_


2 
	#_LINUX_WRAP_H_


	)

4 
	~<¡ddef.h
>

5 
	~<¡dšt.h
>

6 
	~<sys/time.h
>

8 
ušŒ_t
 
lšux_uÇme
(* 
buf
);

9 
ušŒ_t
 
lšux_şock_g‘time
(
__şockid_t
 
şock
, 
time¥ec
 *

);

10 
ušŒ_t
 
lšux_¹_sig´ocmask
(
how
, cÚ¡ 
sig£t_t
 *
£t
, sig£t_ˆ*
Şd£t
);

11 
ušŒ_t
 
lšux_g‘¿ndom
(*
buf
, 
size_t
 
buæ’
, 
æags
);

12 
ušŒ_t
 
lšux_g‘pid
();

13 
ušŒ_t
 
lšux_£t_tid_add»ss
(* 
tid±r
);

14 
ušŒ_t
 
lšux_RET_ZERO_w¿p
(
which
);

15 
ušŒ_t
 
lšux_RET_BAD_w¿p
(
which
);

16 
ušŒ_t
 
sysÿÎ_munm­
(*
addr
, 
size_t
 
Ëngth
);

17 
ušŒ_t
 
sysÿÎ_mm­
(*
addr
, 
size_t
 
Ëngth
, 
´Ù
, 
æags
,

18 
fd
, 
__off_t
 
off£t
);

19 
ušŒ_t
 
sysÿÎ_brk
(* 
addr
);

	@malloc.h

1 #iâdeà
__MALLOC_H__


2 
	#__MALLOC_H__


	)

4 
	~<¡ddef.h
>

6 * 
m®loc
(
size_t
);

7 
ä“
(*);

8 * 
»®loc
(*, 
size_t
);

9 * 
mem®ign
(
size_t
, size_t);

10 * 
v®loc
(
size_t
);

11 * 
pv®loc
(
size_t
);

12 * 
ÿÎoc
(
size_t
, size_t);

13 
cä“
(*);

14 
m®loc_Œim
(
size_t
);

15 
size_t
 
m®loc_u§bË_size
(*);

16 
m®loc_¡©s
();

17 
m®lİt
(, );

18 
m®lšfo
 mallinfo();

20 
	sä“li¡_’Œy
 {

21 
size_t
 
	msize
;

22 
ä“li¡_’Œy
 *
	mÃxt
;

23 } *
	tæe
;

	@mm.c

1 
	~"commÚ.h
"

2 
	~"sysÿÎ.h
"

3 
	~"mm.h
"

4 
	~"ä“mem.h
"

5 
	~"vm.h
"

6 
	gff
=1;

12 
ušŒ_t
 
	gcu¼’t_´og¿m_b»ak
;

13 
ušŒ_t
 
	gcu¼’t_´og¿m_b»ak_¹
;

15 
ušŒ_t
 
	$g‘_´og¿m_b»ak
(){

16  
cu¼’t_´og¿m_b»ak
;

17 
	}
}

19 
	$£t_´og¿m_b»ak
(
ušŒ_t
 
Ãw_b»ak
){

20 
cu¼’t_´og¿m_b»ak
 = 
Ãw_b»ak
;

21 
	}
}

23 
ušŒ_t
 
	$g‘_´og¿m_b»ak_¹
(){

24  
cu¼’t_´og¿m_b»ak_¹
;

25 
	}
}

27 
	$£t_´og¿m_b»ak_¹
(
ušŒ_t
 
Ãw_b»ak
){

28 
cu¼’t_´og¿m_b»ak_¹
 = 
Ãw_b»ak
;

29 
	}
}

31 
±e_t
*

32 
	$__cÚtšue_w®k_ü—‹
(
±e_t
* 
roÙ
, 
ušŒ_t
 
addr
,…‹_t* 
±e
)

34 
ušŒ_t
 
Ãw_·ge
 = 
	`¥a_g‘
();

35 
ä“_µn
 = 
	`µn
(
	`__·
(
Ãw_·ge
));

36 *
±e
 = 
	`±d_ü—‹
(
ä“_µn
);

37  
	`__w®k_ü—‹
(
roÙ
, 
addr
);

38 
	}
}

40 
±e_t
*

41 
	$__w®k_š‹º®
(
±e_t
* 
roÙ
, 
ušŒ_t
 
addr
, 
ü—‹
)

43 
±e_t
* 
t
 = 
roÙ
;

44 
i
;

46 
i
 = 1; i < 
RISCV_PT_LEVELS
; i++)

48 
size_t
 
idx
 = 
	`RISCV_GET_PT_INDEX
(
addr
, 
i
);

50 ià(!(
t
[
idx
] & 
PTE_V
))

51  
ü—‹
 ? 
	`__cÚtšue_w®k_ü—‹
(
roÙ
, 
addr
, &
t
[
idx
]) : 0;

53 
t
 = (
±e_t
*è
	`__va
(
	`±e_µn
Ñ[
idx
]è<< 
RISCV_PAGE_BITS
);

57  &
t
[
	`RISCV_GET_PT_INDEX
(
addr
, 3)];

58 
	}
}

62 
±e_t
*

63 
	$__w®k
(
±e_t
* 
roÙ
, 
ušŒ_t
 
addr
)

66  
	`__w®k_š‹º®
(
roÙ
, 
addr
, 0);

67 
	}
}

71 
±e_t
*

72 
	$__w®k_ü—‹
(
±e_t
* 
roÙ
, 
ušŒ_t
 
addr
)

74  
	`__w®k_š‹º®
(
roÙ
, 
addr
, 1);

75 
	}
}

80 
ušŒ_t


81 
	$»m­_physiÿl_·ge
(
ušŒ_t
 
v²
, ušŒ_ˆ
µn
, 
æags
)

83 
±e_t
* 
±e
 = 
	`__w®k_ü—‹
(
roÙ_·ge_bË
, 
v²
 << 
RISCV_PAGE_BITS
);

85 ià(!
±e
)

88 *
±e
 = 
	`±e_ü—‹
(
µn
, 
æags
);

90  (
v²
 << 
RISCV_PAGE_BITS
);

91 
	}
}

96 
size_t


97 
	$»m­_physiÿl_·ges
(
ušŒ_t
 
v²
, ušŒ_ˆ
µn
, 
size_t
 
couÁ
, 
æags
)

99 
i
;

101 
i
 = 0; i < 
couÁ
; i++) {

102 if(!
	`»m­_physiÿl_·ge
(
v²
 + 
i
, 
µn
 + i, 
æags
))

106  
i
;

107 
	}
}

110 
ušŒ_t


111 
	$Œª¦©e
(
ušŒ_t
 
va
)

126 
±e_t
* 
±e
 = 
	`__w®k
(
roÙ_·ge_bË
, 
va
);

128 if(*
±e
 & 
PTE_V
)

129  (
	`±e_µn
(*
±e
è<< 
RISCV_PAGE_BITS
è| (
	`RISCV_PAGE_OFFSET
(
va
));

132 
	}
}

136 
ušŒ_t


137 
	$®loc_·ge
(
ušŒ_t
 
v²
, 
æags
)

139 
ušŒ_t
 
·ge
;

140 
±e_t
* 
±e
 = 
	`__w®k_ü—‹
(
roÙ_·ge_bË
, 
v²
 << 
RISCV_PAGE_BITS
);

142 ià(!
±e
)

146 if(*
±e
 & 
PTE_V
) {

148  
	`__va
(*
±e
 << 
RISCV_PAGE_BITS
);

152 
·ge
 = 
	`¥a_g‘
();

153 *
±e
 = 
	`±e_ü—‹
(
	`µn
(
	`__·
(
·ge
)), 
æags
 | 
PTE_V
 | 
PTE_L
 );

155  
·ge
;

156 
	}
}

159 
	$ä“_·ge
(
ušŒ_t
 
v²
){

161 
±e_t
* 
±e
 = 
	`__w®k
(
roÙ_·ge_bË
, 
v²
 << 
RISCV_PAGE_BITS
);

165 if(!
±e
 || !(*±& 
PTE_V
))

168 
ušŒ_t
 
µn
 = 
	`±e_µn
(*
±e
);

171 *
±e
 = (*±& (~
PTE_V
));

174 
	`¥a_put
(
	`__va
(
µn
 << 
RISCV_PAGE_BITS
));

178 
	}
}

182 
size_t


183 
	$®loc_·ges
(
ušŒ_t
 
v²
, 
size_t
 
couÁ
, 
æags
)

185 
i
;

186 
i
 = 0; i < 
couÁ
; i++) {

187 if(!
	`®loc_·ge
(
v²
 + 
i
, 
æags
))

191  
i
;

192 
	}
}

195 
	$ä“_·ges
(
ušŒ_t
 
v²
, 
size_t
 
couÁ
){

196 
i
;

197 
i
 = 0; i < 
couÁ
; i++) {

198 
	`ä“_·ge
(
v²
 + 
i
);

201 
	}
}

208 
size_t


209 
	$‹¡_va_¿nge
(
ušŒ_t
 
v²
, 
size_t
 
couÁ
){

211 
i
;

213 
i
 = 0; i < 
couÁ
; i++) {

214 
±e_t
* 
±e
 = 
	`__w®k_š‹º®
(
roÙ_·ge_bË
, (
v²
+
i
è<< 
RISCV_PAGE_BITS
, 0);

216 if(
±e
 && (*±& 
PTE_V
)){

220  
i
;

221 
	}
}

224 
±e_t
* 
	$g‘_roÙ_·ge_bË_addr
()

226  
roÙ_·ge_bË
;

227 
	}
}

229 
±e_t
*

230 
	$__w®k_duršg_·ge_çuÉ
(
±e_t
* 
roÙ
, 
ušŒ_t
 
addr
)

233  
	`__w®k_š‹º®
(
roÙ
, 
addr
, 0);

234 
	}
}

	@mm.h

1 #iâdeà
_MM_H_


2 
	#_MM_H_


	)

3 
	~<¡dšt.h
>

4 
	~<¡ddef.h
>

6 
ušŒ_t
 
»m­_physiÿl_·ge
(ušŒ_ˆ
v²
, ušŒ_ˆ
µn
, 
æags
);

7 
size_t
 
»m­_physiÿl_·ges
(
ušŒ_t
 
v²
, ušŒ_ˆ
µn
, size_ˆ
couÁ
, 
æags
);

8 
ušŒ_t
 
Œª¦©e
(ušŒ_ˆ
va
);

10 
ušŒ_t
 
®loc_·ge
(ušŒ_ˆ
v²
, 
æags
);

11 
ä“_·ge
(
ušŒ_t
 
v²
);

12 
size_t
 
®loc_·ges
(
ušŒ_t
 
v²
, size_ˆ
couÁ
, 
æags
);

13 
ä“_·ges
(
ušŒ_t
 
v²
, 
size_t
 
couÁ
);

14 
size_t
 
‹¡_va_¿nge
(
ušŒ_t
 
v²
, size_ˆ
couÁ
);

16 
ušŒ_t
 
g‘_´og¿m_b»ak
();

17 
£t_´og¿m_b»ak
(
ušŒ_t
 
Ãw_b»ak
);

18 
ušŒ_t
 
g‘_´og¿m_b»ak_¹
();

19 
£t_´og¿m_b»ak_¹
(
ušŒ_t
 
Ãw_b»ak
);

21 
ušŒ_t
* 
__w®k_ü—‹
(ušŒ_t* 
roÙ
, ušŒ_ˆ
addr
);

24 
ušŒ_t
* 
g‘_roÙ_·ge_bË_addr
();

26 
ušŒ_t
* 
__w®k
(ušŒ_t* 
roÙ
, ušŒ_ˆ
addr
);

	@opam.c

1 
	~"mm.h
"

2 
	~"¹_ut.h
"

3 
	~"´štf.h
"

4 
	~"¡ršg.h
"

5 
	~"sysÿÎ.h
"

6 
	~"m®loc.h
"

7 
	~"edge_ÿÎ.h
"

8 
	~"«ss.h
"

9 
	~"ssha3.h
"

10 
	~"ä“mem.h
"

11 
	~"vm.h
"

12 
	~"·ge_»¶aûm’t.h
"

13 
	~"İam.h
"

15 
Block_O·m_md
 *
	gS_İam_md
;

17 
	gS_İam_md_Ën
=0;

19 
	gŒ“¬¿y_İam_md_Ën
=0;

21 
Buck‘_İam_md
 
	gbuc_i_md
;

24 
	gŒ“¬¿y_İam_Ën
;

26 
Buck‘_İam
 
	gbuc_i_d
;

29 
	$´št_·ge
(*
a
)

33 
i
=0;i<32;i++)

35 
	`´štf
("0x%lx ",
a
[
i
] );

37 
	`´štf
("\n" );

38 
	}
}

41 
	$İam_»adbuck‘_d
(
šdexoá»e
,*
»t_buf
)

43 
edge_d©a_t
 
»td©a
;

44 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

45 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_OPAM_READ_BUCKETS_D
, &
_šdexoá»e
, (_šdexoá»e), &
»td©a
, (
edge_d©a_t
),0);

49 
	`hªdË_cİy_äom_sh¬ed
((*)&
buc_i_d
,
»td©a
.
off£t
,»td©a.
size
);

54 
hash_ÿlc
[
HASH_SIZE
];

55 
sha3_ùx_t
 
sha3
;

56 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

57 
c
[16];

58 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

59 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

60 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_d
.
blocks
[0].
d©a
, 
RISCV_PAGE_SIZE
);

62 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

63 
c2
[16];

64 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

65 
hash_ÿlc2
[
HASH_SIZE
];

66 
sha3_ùx_t
 
sha32
;

67 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

68 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

69 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

70 
	`sha3_fš®
((*)
hash_ÿlc2
, &
sha32
);

103 if(!
	`check_hashes
Ğ(*)
hash_ÿlc2
 ,
HASH_SIZE
, (*)
buc_i_md
.
blocks
[0].
p_hash_d
 ,HASH_SIZE ))

105 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed(data). Fatalƒrror\n");

106 
	`sbi_ex™_’şave
(-1);

109 if(
cÚfid’tŸl™y
)

111 
	`deüy±_·ge
((
ušt8_t
 *è(
buc_i_d
.
blocks
[0].
d©a
),
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)
buc_i_md
.blocks[0].
ivd
);

114 
·ges_»ad
+=
Z
;

115 
»®_·ges_»ad
+=
Z
;

116 
	}
}

120 
	$İam_»adbuck‘_md
(
šdexoá»e
)

122 
edge_d©a_t
 
»td©a
;

123 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

124 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_OPAM_READ_BUCKETS_MD
, &
_šdexoá»e
, (_šdexoá»e), &
»td©a
, (
edge_d©a_t
),0);

125 
	`hªdË_cİy_äom_sh¬ed
((*)&
buc_i_md
,
»td©a
.
off£t
,»td©a.
size
);

127 
hash_ÿlc
[
HASH_SIZE
];

128 
sha3_ùx_t
 
sha3
;

129 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

130 
c
[16];

131 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

132 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

133 
	`sha3_upd©e
(&
sha3
, (*)&(
buc_i_md
.
blocks
[0].
add»ss
), (
ušŒ_t
)*2);

134 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_md
.
blocks
[0].
iv
, 
AES_KEYLEN
);

135 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_md
.
blocks
[0].
ivd
, 
AES_KEYLEN
);

136 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

137 
c2
[16];

138 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

139 
hash_ÿlc2
[
HASH_SIZE
];

140 
sha3_ùx_t
 
sha32
;

141 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

142 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

143 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

144 
	`sha3_fš®
((*)
hash_ÿlc2
, &
sha32
);

145 if(!
	`check_hashes
Ğ(*)
hash_ÿlc2
 ,
HASH_SIZE
, (*)
buc_i_md
.
blocks
[0].
p_hash
 ,HASH_SIZE ) )

147 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed(metadata). Fatalƒrror\n");

148 
	`sbi_ex™_’şave
(-1);

151 
	`deüy±_·ge
((
ušt8_t
 *è&(
buc_i_md
.
blocks
[0].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)buc_i_md.blocks[0].
iv
);

153 ifĞ
buc_i_md
.
blocks
[0].
add»ss
!=
DUMMY_BLOCK_ADDR
)

156 if(
v”siÚ_numb”s
[
	`v²
(
buc_i_md
.
blocks
[0].
add»ss
)] !ğbuc_i_md.blocks[0].
v”siÚ
)

158 
	`´štf
("[runtime] Page corrupted(Possibly‡„eplay‡ttack). Fatalƒrror\n");

162 
	}
}

166 
	$İam_wr™e_buck‘_md
(
šdexoá»e
)

168 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

169 
	`¹_ut_g‘¿ndom
((*è
buc_i_md
.
blocks
[0].
iv
, 
AES_KEYLEN
);

170 if(
buc_i_md
.
blocks
[0].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

172 
v”siÚ_numb”s
[ 
	`v²
(
buc_i_md
.
blocks
[0].
add»ss
)]++;

173 
buc_i_md
.
blocks
[0].
v”siÚ
=
v”siÚ_numb”s
[ 
	`v²
(buc_i_md.blocks[0].
add»ss
)];

176 
	`’üy±_·ge
Ğ(
ušt8_t
 *è&(
buc_i_md
.
blocks
[0].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)buc_i_md.blocks[0].
iv
);

179 
hash_ÿlc
[
HASH_SIZE
];

180 
sha3_ùx_t
 
sha3
;

181 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

182 
c
[16];

183 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

184 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

185 
	`sha3_upd©e
(&
sha3
, (*)&(
buc_i_md
.
blocks
[0].
add»ss
), (
ušŒ_t
)*2);

186 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_md
.
blocks
[0].
iv
, 
AES_KEYLEN
);

187 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_md
.
blocks
[0].
ivd
, 
AES_KEYLEN
);

188 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

189 
c2
[16];

190 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

191 
sha3_ùx_t
 
sha32
;

192 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

193 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

194 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

195 
	`sha3_fš®
((*)
buc_i_md
.
blocks
[0].
p_hash
, &
sha32
);

199 
	`memıy
((*)
buff
, (*)&
_šdexoá»e
,(
ušŒ_t
));

200 
	`memıy
((*)(
buff
+(
ušŒ_t
)), (*)&
buc_i_md
,(
Buck‘_İam_md
));

201 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_OPAM_WRITE_BUCKETS_MD
,(*)
buff
, (
ušŒ_t
)+ (
Buck‘_İam_md
),
NULL
, 0,0);

202 
	}
}

204 
	$İam_wr™e_buck‘_d
(
šdexoá»e
)

206 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

207 
	`memıy
((*)
buff
, (*)&
_šdexoá»e
,(
ušŒ_t
));

208 
	`memıy
((*)(
buff
+(
ušŒ_t
)), (*)&
buc_i_d
,(
Buck‘_İam
));

209 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_OPAM_WRITE_BUCKETS_D
,(*)
buff
, (
ušŒ_t
)+ (
Buck‘_İam
),
NULL
, 0,0);

210 
·ges_wr™‹n
+=
Z
;

211 
»®_·ges_wr™‹n
+=
Z
;

212 
	}
}

214 
	$İam_wr™ebuck‘
(
šdexoá»e
)

216 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

217 
	`¹_ut_g‘¿ndom
((*è
buc_i_md
.
blocks
[0].
iv
, 
AES_KEYLEN
);

221 
buc_i_md
.
blocks
[0].
Œ“_šdex
=
_šdexoá»e
;

222 if(
buc_i_md
.
blocks
[0].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

224 
v”siÚ_numb”s
[ 
	`v²
(
buc_i_md
.
blocks
[0].
add»ss
)]++;

225 
buc_i_md
.
blocks
[0].
v”siÚ
=
v”siÚ_numb”s
[ 
	`v²
(buc_i_md.blocks[0].
add»ss
)];

227 
	`’üy±_·ge
((
ušt8_t
 *)&(
buc_i_md
.
blocks
[0].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)buc_i_md.blocks[0].
iv
);

230 
hash_ÿlc
[
HASH_SIZE
];

231 
sha3_ùx_t
 
sha3
;

232 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

233 
c
[16];

234 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

235 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

236 
	`sha3_upd©e
(&
sha3
, (*)&(
buc_i_md
.
blocks
[0].
add»ss
), (
ušŒ_t
)*2);

237 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_md
.
blocks
[0].
iv
, 
AES_KEYLEN
);

238 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_md
.
blocks
[0].
ivd
, 
AES_KEYLEN
);

239 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

240 
c2
[16];

241 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

242 
sha3_ùx_t
 
sha32
;

243 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

244 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

245 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

246 
	`sha3_fš®
((*)
buc_i_md
.
blocks
[0].
p_hash
, &
sha32
);

250 
	`memıy
((*)
buff
, (*)&
_šdexoá»e
,(
ušŒ_t
));

251 
	`memıy
((*)(
buff
+(
ušŒ_t
)), (*)&
buc_i_md
,(
Buck‘_İam_md
));

256 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_OPAM_WRITE_BUCKETS
,(*)
buff
, (
ušŒ_t
)+ (
Buck‘_İam_md
),
NULL
, 0,0);

259 
	}
}

261 
	$´št_¡ash
()

263 
	`´štf
("[ORAM] STASH CONTENTS\n" );

264 
i
=0;i<
S_İam_md_Ën
;i++)

266 
	`´štf
("0x%lx ",
S_İam_md
[
i
].
add»ss
 );

268 
	`´štf
("\n" );

269 
	}
}

272 
	$acûss_İam
(
İ
, 
a
, *
d©a¡¬
, *
»t_buf
,
ex‹nsiÚ
)

274 
S_İam_md_Ën
=0;

275 
ušŒ_t
 
çed_couÁ
=0;

276 if(
ex‹nsiÚ
==1 || 
fœ¡im—cûss
[
a
]=='y')

278 
pos™iÚ
[
a
]=
	`UnifÜmRªdom
();

281 
x
ğ
pos™iÚ
[
a
];

282 
px
[50]={0,};

283 
px_Ën
=0;px_len=px_len;

284 if(
İ
=='r')

286 
pos™iÚ
[
a
]ğ
	`UnifÜmRªdom
();

287 if(
İ
=='w')

289 
x
ğ
pos™iÚ
[
a
];

293 
	`pxg‘
(
x
, 
px
);

294 
ušŒ_t
 
¯a
=
a
<<
RISCV_PAGE_BITS
;

296 if(
debug
 && 0)

298 
	`´štf
("[ruÁime] OPAM.0x%lx T¿û fÜ‡dd»s 0x%lx(%cèex‹nsiÚ = %d : Zkğ%d ",
¯a
,
a
<<
RISCV_PAGE_BITS
 ,
İ
,
ex‹nsiÚ
,
Z
);

299 
i
=
L
;i>=0;i--)

300 
	`´štf
("%d ",
px
[
i
]);

301 
	`´štf
("\n" );

304 
dmp
=0;

305 
S_İam_md_Ën
=0;

306 
l
=
L
;l>=0;l--)

308 
	`İam_»adbuck‘_md
(
px
[
l
]);

309 
j
=0;j<
Z
;j++)

311 if(
buc_i_md
.
blocks
[
j
].
add»ss
!=0 )

312 
S_İam_md
[
S_İam_md_Ën
++]ğ
buc_i_md
.
blocks
[
j
];

316 if(
İ
=='w')

318 
l
=0;l<=
L
;l++)

320 
	`İam_»adbuck‘_md
(
px
[
l
]);

321 
j
=0;j<
Z
;j++)

323 if(
buc_i_md
.
blocks
[
j
].
add»ss
==
DUMMY_BLOCK_ADDR
 )

325 
S_İam_md
[
S_İam_md_Ën
++]ğ
buc_i_md
.
blocks
[
j
];

326 
dmp
=1;

327 
outside
;

333 
outside
:if(
İ
=='w' && 
dmp
==0)

335 
çed_couÁ
++;

342 
d©­os
=-1;

343 
j
=0;j< 
S_İam_md_Ën
;j++)

345 ifĞ(
S_İam_md
[
j
].
add»ss
=ğ(
a
<<
RISCV_PAGE_BITS
èè|| ( (
fœ¡im—cûss
[a]=='y' || 
İ
=='w'è&& S_İam_md[j].add»ss==
DUMMY_BLOCK_ADDR
 ) )

348 if(
»t_buf
!=
NULL
)

350 
buc_i_md
.
blocks
[0]=
S_İam_md
[
j
];

351 
	`İam_»adbuck‘_d
(
S_İam_md
[
j
].
Œ“_šdex
,
»t_buf
);

353 
cyşes1
,
cyşes2
;

354 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes1
));

356 
	`memıy
((*)
»t_buf
,(*)
buc_i_d
.
blocks
[0].
d©a
,
BLOCK_SIZE
);

358 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes2
));

359 
cİy_wa¡e
+=(
cyşes2
-
cyşes1
);

364 
S_İam_md
[
j
].
add»ss
=0;

365 
buc_i_md
.
blocks
[0]=
S_İam_md
[
j
];

367 
	`İam_wr™e_buck‘_md
(
S_İam_md
[
j
].
Œ“_šdex
);

368 
p1
;

370 
d©­os
=
j
;

371 
S_İam_md
[
j
].
add»ss
ğ(
a
<<
RISCV_PAGE_BITS
);

372 
p1
: 
fœ¡im—cûss
[
a
]='n';

377 
wr™e_pos
=-1;

379 
l
=
L
;l>=0;l--)

381 
Sb¬_Ën
=0;

382 
i
=0;i<
S_İam_md_Ën
 && 
Sb¬_Ën
<
Z
 ;i++)

384 
ab¬
ğ(
S_İam_md
[
i
].
add»ss
)>> 
RISCV_PAGE_BITS
;

385 if(
S_İam_md
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

387 
µos™iÚab¬
[
ARRAY_SIZE
];

388 
	`pxg‘
(
pos™iÚ
[
ab¬
],
µos™iÚab¬
);

389 ià(
px
[
l
] =ğ
µos™iÚab¬
[l])

391 
buc_i_md
.
blocks
[
Sb¬_Ën
] = 
S_İam_md
[
i
];

392 if(
S_İam_md
[
i
].
add»ss
=ğ(
a
<<
RISCV_PAGE_BITS
è&& 
İ
=='w')

394 
	`¹_ut_g‘¿ndom
((*è
buc_i_md
.
blocks
[
Sb¬_Ën
].
iv
, 
AES_KEYLEN
);

395 
	`memıy
((*)
S_İam_md
[
i
].
iv
,(*)
buc_i_md
.
blocks
[
Sb¬_Ën
].iv, 
AES_KEYLEN
 );

396 
wr™e_pos
=
px
[
l
];

398 
S_İam_md
[
i
].
add»ss
=
DUMMY_BLOCK_ADDR
;

399 
Sb¬_Ën
++;

403 
Sb¬_Ën
 = 
Z
<=Sbar_len ? Z:Sbar_len;

404 
noofdummyblocks
 = 
Z
 - 
Sb¬_Ën
;

406 
db
=0;db <
noofdummyblocks
;db++)

408 
buc_i_md
.
blocks
[
Sb¬_Ën
].
add»ss
=
DUMMY_BLOCK_ADDR
;

409 
buc_i_md
.
blocks
[
Sb¬_Ën
].
Œ“_šdex
ğ
px
[
l
];

410 
	`¹_ut_g‘¿ndom
((*è
buc_i_md
.
blocks
[
Sb¬_Ën
].
iv
, 
AES_KEYLEN
);

411 
Sb¬_Ën
++;

414 
	`İam_wr™e_buck‘_md
(
px
[
l
]);

417 if(
İ
=='w' && 
wr™e_pos
!=-1)

419 
buc_i_md
.
blocks
[0] = 
S_İam_md
[
d©­os
];

421 
cyşes1
,
cyşes2
;

422 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes1
));

424 
	`memıy
((*)
buc_i_d
.
blocks
[0].
d©a
,(*)
d©a¡¬
,
BLOCK_SIZE
);

425 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes2
));

426 
cİy_wa¡e
+=(
cyşes2
-
cyşes1
);

428 
buc_i_md
.
blocks
[0].
add»ss
=
a
<<
RISCV_PAGE_BITS
;

429 
buc_i_md
.
blocks
[0].
Œ“_šdex
=
wr™e_pos
;

430 
	`¹_ut_g‘¿ndom
((*è
buc_i_md
.
blocks
[0].
ivd
, 
AES_KEYLEN
);

432 if(
cÚfid’tŸl™y
)

434 
	`’üy±_·ge
((
ušt8_t
 *)(
buc_i_d
.
blocks
[0].
d©a
),
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)
buc_i_md
.blocks[0].
ivd
);

437 
hash_ÿlc
[
HASH_SIZE
];

438 
sha3_ùx_t
 
sha3
;

439 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

440 
c
[16];

441 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

442 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

443 
	`sha3_upd©e
(&
sha3
, (*)
buc_i_d
.
blocks
[0].
d©a
, 
RISCV_PAGE_SIZE
);

444 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

445 
c2
[16];

446 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

447 
sha3_ùx_t
 
sha32
;

448 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

449 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

450 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

451 
	`sha3_fš®
((*)
buc_i_md
.
blocks
[0].
p_hash_d
, &
sha32
);

453 
	`İam_wr™e_buck‘_md
(
wr™e_pos
);

454 
	`İam_wr™e_buck‘_d
(
wr™e_pos
);

456 if(
çed_couÁ
>0)

460 
S_İam_md
[
d©­os
].
add»ss
=0;

464 
Üam_acc
++;

465 if(
Üam_acc
%500==0)

467 
	`´štf
("[OPAM]Üam_accğ%lu ",
Üam_acc
 );

471 
	}
}

474 
	$š™Ÿlize_İam
()

476 
N
=
OPAM_TREE_SIZE
;

477 
Z
=1;

478 
L
=17;

479 
	`¹_ut_g‘¿ndom
((*è
key
, 
AES_KEYLEN
);

480 
	`¹_ut_g‘¿ndom
((*è
key_hmac
, 
AES_KEYLEN
);

481 
	`¹_ut_g‘¿ndom
((*è
z1
, 
AES_KEYLEN
);

482 
	`¹_ut_g‘¿ndom
((*è
z2
, 
AES_KEYLEN
);

483 
	`´štf
("[OPAM] Initializtion started\r\n" );

484 
i
=0;i<
MALLOC_SIZE
;i++)

486 
fœ¡im—cûss
[
i
]='y';

487 
v”siÚ_numb”s
[
i
]=0;

491 
j
=0;j<
Z
;j++)

493 
buc_i_md
.
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

494 
buc_i_md
.
blocks
[
j
].
v”siÚ
=0;

497 
i
=0;i<
N
;i++)

499 
j
=0;j<
Z
;j++)

501 
buc_i_md
.
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

502 
buc_i_md
.
blocks
[
j
].
v”siÚ
=0;

503 
buc_i_md
.
blocks
[
j
].
Œ“_šdex
=
i
;

504 
buc_i_d
.
blocks
[
j
].
d©a
[0]=0;

506 
	`İam_wr™ebuck‘
(
i
);

508 
	`´štf
("[OPAM] init done\r\n" );

510 
	}
}

512 
	$»m­_®l
()

515 
ušŒ_t
 
i
=
q_äÚt
;1==1;i=(i+1)%
MALLOC_SIZE2
)

517 
pos™iÚ
[ 
	`v²
(
»¶aûm’t_®go_queue_m­
[
i
]è]=
	`UnifÜmRªdom
();

518 if(
i
==
q_»¬
)

523 
	}
}

	@opam.h

1 
	~"¹_ut.h
"

4 
	#OCALL_OPAM_READ_BUCKETS
 11

	)

5 
	#OCALL_OPAM_WRITE_BUCKETS
 12

	)

6 
	#OCALL_OPAM_READ_BUCKETS_MD
 13

	)

7 
	#OCALL_OPAM_WRITE_BUCKETS_MD
 14

	)

8 
	#OCALL_OPAM_READ_BUCKETS_D
 15

	)

9 
	#OCALL_OPAM_WRITE_BUCKETS_D
 16

	)

11 
	#OPAM_STASH_SIZE
 9500

	)

12 
	#OPAM_TREE_SIZE
 262144

13 

	)

14 
	sBlock_O·m_md


16 
ušŒ_t
 
	madd»ss
;

17 
ušŒ_t
 
	mv”siÚ
;

18 
ušŒ_t
 
	mŒ“_šdex
;

19 
ušŒ_t
 
	m¡ash_šdex
;

20 
ušt8_t
 
	miv
[16];

21 
	mp_hash
[32];

22 
ušt8_t
 
	mivd
[16];

23 
	mp_hash_d
[32];

24 } 
	tBlock_O·m_md
;

26 
	sBuck‘_İam_md


28 
Block_O·m_md
 
	mblocks
[1];

30 }
	tBuck‘_İam_md
;

33 
Block_O·m_md
 *
S_İam_md
;

36 
S_İam_md_Ën
;

38 
Œ“¬¿y_İam_md_Ën
;

40 
Buck‘_İam_md
 
buc_i_md
;

44 
	sBlock_O·m


46 
	md©a
[
BLOCK_SIZE
];

47 } 
	tBlock_O·m
;

49 
	sBuck‘_İam


51 
Block_O·m
 
	mblocks
[1];

52 }
	tBuck‘_İam
;

54 
Œ“¬¿y_İam_Ën
;

56 
Buck‘_İam
 
buc_i_d
;

59 
acûss_İam
(
İ
, 
a
, 
d©a¡¬
[
BLOCK_SIZE
+1], 
»t_buf
[
ARRAY_SIZE
],
ex‹nsiÚ
);

60 
š™Ÿlize_İam
();

61 
»m­_®l
();

	@oram.c

1 
	~"mm.h
"

2 
	~"¹_ut.h
"

3 
	~"´štf.h
"

4 
	~"¡ršg.h
"

5 
	~"sysÿÎ.h
"

6 
	~"m®loc.h
"

7 
	~"edge_ÿÎ.h
"

8 
	~"«ss.h
"

9 
	~"ssha3.h
"

10 
	~"Üam.h
"

11 
	~"ä“mem.h
"

12 
	~"vm.h
"

13 
	~"·ge_»¶aûm’t.h
"

14 
	~"šdex_q.h
"

19 
Block
 *
	gS
;

20 
Block
 *
	gSg
;

22 
	gS_Ën
=0;

23 
	gSg_Ën
=0;

24 
	gŒ“¬¿y_Ën
=0;

25 
Buck‘
 
	gbuc_i
;

28 
Buck‘_md
 
	gbuc_i_po_md
;

29 
Buck‘_md
 *
	gŒ“_po_md
;

35 
	$»adbuck‘
(
šdexoá»e
)

37 
edge_d©a_t
 
»td©a
;

38 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

39 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_READ_BUCKETS
, &
_šdexoá»e
, (_šdexoá»e), &
»td©a
, (
edge_d©a_t
),0);

40 
	`hªdË_cİy_äom_sh¬ed
((*)&
buc_i
,
»td©a
.
off£t
,»td©a.
size
);

41 
buc_i_po_md
ğ
Œ“_po_md
[
_šdexoá»e
];

42 
·ges_»ad
+=
Z
;

44 
i
=0;i<
Z
;i++)

48 ifĞ
buc_i_po_md
.
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

50 
hash_ÿlc
[
HASH_SIZE
];

51 
sha3_ùx_t
 
sha3
;

52 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

53 
c
[16];

54 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

55 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

56 
	`sha3_upd©e
(&
sha3
, (*)&(
buc_i
.
blocks
[
i
].
add»ss
), (
ušŒ_t
)*2);

57 
	`sha3_upd©e
(&
sha3
, (*)
buc_i
.
blocks
[
i
].
d©a
, 
RISCV_PAGE_SIZE
);

58 
	`sha3_upd©e
(&
sha3
, (*)
buc_i
.
blocks
[
i
].
iv
, 
AES_KEYLEN
);

60 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

61 
c2
[16];

62 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

63 
hash_ÿlc2
[
HASH_SIZE
];

64 
sha3_ùx_t
 
sha32
;

65 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

66 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

67 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

68 
	`sha3_fš®
((*)
hash_ÿlc2
, &
sha32
);

69 ifĞ
buc_i_po_md
.
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
 && !
	`check_hashes
Ğ(*)
hash_ÿlc2
 ,
HASH_SIZE
, (*)
buc_i
.blocks[i].
p_hash
 ,HASH_SIZE ) )

71 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed. Fatalƒrror\n");

72 
	`sbi_ex™_’şave
(-1);

77 if(
Œ“_po_md
[
šdexoá»e
].
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

78 
	`deüy±_·ge
((
ušt8_t
 *è&(
buc_i
.
blocks
[
i
].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)buc_i.blocks[i].
iv
);

81 if(
Œ“_po_md
[
šdexoá»e
].
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

83 if(
cÚfid’tŸl™y
)

85 
	`deüy±_·ge
((
ušt8_t
 *è
buc_i
.
blocks
[
i
].
d©a
,
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)buc_i.blocks[i].
iv
);

92 if(
Œ“_po_md
[
šdexoá»e
].
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

94 
»®_·ges_»ad
++;

95 if(
v”siÚ_numb”s
[
	`v²
(
buc_i
.
blocks
[
i
].
add»ss
)] !ğbuc_i.blocks[i].
v”siÚ
)

97 
	`´štf
("[runtime] Page corrupted(Possibly‡„eplay‡ttack). Fatalƒrror\n");

98 
	`sbi_ex™_’şave
(-1);

107 
	}
}

109 
	$wr™ebuck‘
(
šdexoá»e
)

114 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

115 
·ges_wr™‹n
+=
Z
;

117 
i
=0;i<
Z
;i++)

119 
	`¹_ut_g‘¿ndom
((*è
buc_i
.
blocks
[
i
].
iv
, 
AES_KEYLEN
);

123 if(
buc_i
.
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

125 
»®_·ges_wr™‹n
++;

126 
v”siÚ_numb”s
[ 
	`v²
(
buc_i
.
blocks
[
i
].
add»ss
)]++;

127 
buc_i
.
blocks
[
i
].
v”siÚ
=
v”siÚ_numb”s
[ 
	`v²
(buc_i.blocks[i].
add»ss
)];

130 if(
buc_i
.
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

132 if(
cÚfid’tŸl™y
)

134 
	`’üy±_·ge
Ğ(
ušt8_t
 *è
buc_i
.
blocks
[
i
].
d©a
,
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)buc_i.blocks[i].
iv
);

139 if(
cÚfid’tŸl™y
)

142 
	`fl_·ge_w™h_z”Ûs
((*)
buc_i
.
blocks
[
i
].
d©a
);

145 
	`’üy±_·ge
Ğ(
ušt8_t
 *è&(
buc_i
.
blocks
[
i
].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)buc_i.blocks[i].
iv
);

149 
hash_ÿlc
[
HASH_SIZE
];

150 
sha3_ùx_t
 
sha3
;

151 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

152 
c
[16];

153 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

154 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

155 
	`sha3_upd©e
(&
sha3
, (*)&(
buc_i
.
blocks
[
i
].
add»ss
), (
ušŒ_t
)*2);

156 
	`sha3_upd©e
(&
sha3
, (*)
buc_i
.
blocks
[
i
].
d©a
, 
RISCV_PAGE_SIZE
);

157 
	`sha3_upd©e
(&
sha3
, (*)
buc_i
.
blocks
[
i
].
iv
, 
AES_KEYLEN
);

159 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

160 
c2
[16];

161 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

162 
sha3_ùx_t
 
sha32
;

163 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

164 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

165 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

166 
	`sha3_fš®
((*)
buc_i
.
blocks
[
i
].
p_hash
, &
sha32
);

172 
	`memıy
((*)
buff
, (*)&
_šdexoá»e
,(
ušŒ_t
));

173 
	`memıy
((*)(
buff
+(
ušŒ_t
)), (*)&
buc_i
,(
Buck‘
));

174 
ss
=9;ss=ss;

175 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_WRITE_BUCKETS
,(*)
buff
, (
ušŒ_t
)+(
Buck‘
),
NULL
, 0,0);

177 
Œ“_po_md
[
_šdexoá»e
]=
buc_i_po_md
;

182 
	}
}

184 
	$CÚšs
(
S‹mp
[
ARRAY_SIZE
], 
S‹mp_Ën
, 
ušŒ_t
 
add»ss
)

186 ià(
S‹mp
==
NULL
 || 
S‹mp_Ën
==0)

190 
i
=0;i< 
S‹mp_Ën
;i++)

192 if(
add»ss
=ğ
S‹mp
[
i
])

196 
	}
}

198 
	$acûss
(
İ
, 
a
, *
d©a¡¬
, *
»t_buf
,
ex‹nsiÚ
)

200 
S_Ën
=0;

203 
	`as£¹
(
a
>=1 &&‡ < 
MALLOC_SIZE
);

204 
i
ğ
¡ash_loc
[
a
];

206 if(
i
!=-1)

208 
	`as£¹
((
ušŒ_t
)
i
>=0 && (ušŒ_t)˜< 
ORAM_STASH_SIZE
);

209 if(
»t_buf
!=
NULL
)

211 
	`memıy
((*)
»t_buf
, (*)(
S
[
i
].
d©a
),
BLOCK_SIZE
);

215 if(
exc
==1)

217 
¡ash_loc
[
	`v²
(
S
[
i
].
add»ss
)]=-1;

219 if(
	`’que2
((
ušŒ_t
)
i
)!=
ENQUE_SUCCESS
)

221 
	`´štf
("[path oram] free index insertion failed\n");

224 
S
[
i
].
add»ss
=
DUMMY_BLOCK_ADDR
;

229 if(
İ
=='w')

231 
	`memıy
(
S
[
i
].
d©a
,
d©a¡¬
,
BLOCK_SIZE
);

232 
S
[
i
].
add»ss
=
a
<<
RISCV_PAGE_BITS
;

237 if(
Üam_acc
%500==0)

239 
	`´štf
("Ü_acğ%lu MSO=%lu…f_couÁ = %d ",
Üam_acc
,
max_¡ash_occ
,
couÁpf
 );

242 if(
fœ¡im—cûss
[
a
]=='y')

244 
pos™iÚ
[
a
]=
	`UnifÜmRªdom
();

248 
x
ğ
pos™iÚ
[
a
];

249 
px
[50]={0,};

250 
px_Ën
=0;px_len=px_len;

252 
pos™iÚ
[
a
]ğ
	`UnifÜmRªdom
();

253 
	`pxg‘
(
x
, 
px
);

255 if(
debug
)

257 
	`´štf
("[ruÁime] ORAM T¿û fÜ‡dd»s 0x%lx(%cèex‹nsiÚ = %d : Zkğ%d ",
a
<<
RISCV_PAGE_BITS
 ,
İ
,
ex‹nsiÚ
,
Z
);

258 
i
=
L
;i>=0;i--)

259 
	`´štf
("%d ",
px
[
i
]);

260 
	`´štf
("\n" );

264 
l
=0;l<=
L
;l++)

266 
	`»adbuck‘
(
px
[
l
]);

269 
j
=0;j<
Z
;j++)

272 if(
buc_i_po_md
.
blocks
[
j
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

275 
i
ğ()
	`deque2
();i=i;

276 
	`as£¹
(
i
>=0 && i < 
ORAM_STASH_SIZE
);

277 
S
[
i
]ğ
buc_i
.
blocks
[
j
];

278 
¡ash_loc
[
	`v²
(
buc_i
.
blocks
[
j
].
add»ss
)]=
i
;

290 
d©­os
=-1;

293 
i
ğ
¡ash_loc
[
a
];

294 
d©­os
=
i
;

295 
fœ¡im—cûss
[
a
]='n';

297 if(
i
!=-1)

299 
	`as£¹
((
ušŒ_t
)
i
>=0 && (ušŒ_t)˜< 
ORAM_STASH_SIZE
);

300 if(
»t_buf
!=
NULL
)

302 
	`memıy
((*)
»t_buf
, (*)(
S
[
i
].
d©a
),
BLOCK_SIZE
);

306 if(
exc
==1)

308 
¡ash_loc
[
	`v²
(
S
[
i
].
add»ss
)]=-1;

310 if(
	`’que2
((
ušŒ_t
)
i
)!=
ENQUE_SUCCESS
)

312 
	`´štf
("[path oram] free index insertion failed\n");

315 
S
[
i
].
add»ss
=
DUMMY_BLOCK_ADDR
;

323 if(
İ
=='w')

326 
d©­os
=
¡ash_loc
[
a
];

327 if(
d©­os
==-1)

329 
i
ğ()
	`deque2
();i=i;

330 
	`as£¹
(
i
>=0 && i < 
ORAM_STASH_SIZE
);

331 
¡ash_loc
[
a
]=
i
;

332 
d©­os
=
i
;

337 
	`memıy
(
S
[
d©­os
].
d©a
,
d©a¡¬
,
BLOCK_SIZE
);

338 
S
[
d©­os
].
add»ss
=
a
<<
RISCV_PAGE_BITS
;

343 
ušŒ_t
 
qs
=
	`g‘_q_size2
();

344 
ušŒ_t
 
c
=
ORAM_STASH_SIZE
-
qs
;

346 
S‹mp_Ën
=0;Stemp_len=Stemp_len;

347 
l
=
L
;l>=0;l--)

350 
Sb¬_Ën
=0;

351 
ušŒ_t
 
»®_blocks_sÿÂed
=0;

353 
ušŒ_t
 
qs_cur
=
	`g‘_q_size2
();

354 
ušŒ_t
 
»®_Ëá_š_¡ash
=
ORAM_STASH_SIZE
-
qs_cur
;

355 
i
=0;i<
ORAM_STASH_SIZE
 && 
Sb¬_Ën
<
Z
 && 
»®_blocks_sÿÂed
 < 
»®_Ëá_š_¡ash
;i++)

358 
ab¬
ğ(
S
[
i
].
add»ss
)>> 
RISCV_PAGE_BITS
;

359 if(
S
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

361 
»®_blocks_sÿÂed
++;

362 
µos™iÚab¬
[50];

363 
	`pxg‘
(
pos™iÚ
[
ab¬
],
µos™iÚab¬
);

364 ià(
px
[
l
] =ğ
µos™iÚab¬
[l] ) {

365 
buc_i
.
blocks
[
Sb¬_Ën
] = 
S
[
i
];

367 
buc_i_po_md
.
blocks
[
Sb¬_Ën
++].
add»ss
 = 
S
[
i
].address;

369 
¡ash_loc
[
	`v²
(
S
[
i
].
add»ss
)]=-1;

371 if(
	`’que2
((
ušŒ_t
)
i
)!=
ENQUE_SUCCESS
)

373 
	`´štf
("[path oram] free index insertion failed\n");

376 
S
[
i
].
add»ss
=
DUMMY_BLOCK_ADDR
;

383 
Sb¬_Ën
 = 
Z
<=Sbar_len ? Z:Sbar_len;

385 
noofdummyblocks
 = 
Z
 - 
Sb¬_Ën
;

386 
db
=0;db <
noofdummyblocks
;db++)

388 
buc_i
.
blocks
[
Sb¬_Ën
].
add»ss
=
DUMMY_BLOCK_ADDR
;

389 
buc_i_po_md
.
blocks
[
Sb¬_Ën
].
add»ss
=
DUMMY_BLOCK_ADDR
;

391 
Sb¬_Ën
++;

394 
	`wr™ebuck‘
(
px
[
l
]);

400 if(
c
>
max_¡ash_occ
)

401 
max_¡ash_occ
=
c
;

403 
sum_¡ash_occ
 = sum_¡ash_occ+
c
;

404 
Üam_acc
 = oram_acc+1;

405 
	}
}

407 
	$š™®ize_Üam
()

409 
N
=
ORAM_TREE_SIZE
;

410 
Z
=4;

411 
L
=4;

412 
	`´štf
("ORAM INIT started\r\n" );

414 
max_¡ash_occ
=0;

415 
sum_¡ash_occ
=0;

416 
Üam_acc
=0;

417 
»®_·ges_»ad
=0;

418 
»®_·ges_wr™‹n
=0;

419 
	`¹_ut_g‘¿ndom
((*è
key
, 
AES_KEYLEN
);

420 
	`¹_ut_g‘¿ndom
((*è
key_hmac
, 
AES_KEYLEN
);

421 
	`¹_ut_g‘¿ndom
((*è
z1
, 
AES_KEYLEN
);

422 
	`¹_ut_g‘¿ndom
((*è
z2
, 
AES_KEYLEN
);

423 if(
debug
)

424 
	`´štf
("V35\n" );

426 
i
=0;i<
MALLOC_SIZE
;i++)

428 
fœ¡im—cûss
[
i
]='y';

429 
v”siÚ_numb”s
[
i
]=0;

430 
¡ash_loc
[
i
]=-1;

433 
j
=0;j<
Z
;j++)

435 
buc_i
.
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

436 
buc_i
.
blocks
[
j
].
v”siÚ
=0;

437 
buc_i_po_md
.
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

444 
i
=0;i<
N
;i++)

446 
j
=0;j<
Z
;j++)

448 
buc_i
.
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

449 
buc_i
.
blocks
[
j
].
v”siÚ
=0;

450 
buc_i_po_md
.
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

453 
Œ“_po_md
[
i
]=
buc_i_po_md
;

458 
äÚt
=
»¬
=-1;

459 
i
=0;i<
ORAM_STASH_SIZE
;i++)

461 if(
	`’que2
((
ušŒ_t
)
i
)!=
ENQUE_SUCCESS
)

463 
	`´štf
("çed fÜ %d\n",
i
 );

468 
	`´štf
("ORAM INIT DONE\r\n" );

469 
	}
}

	@oram.h

2 
	~"¹_ut.h
"

5 
	#OCALL_READ_BUCKETS
 10

	)

6 
	#OCALL_WRITE_BUCKETS
 0

	)

10 
	#ORAM_STASH_SIZE
 9500

11 
	#ORAM_TREE_SIZE
 70000

12 

	)

13 
	sBlock


15 
ušŒ_t
 
	madd»ss
;

16 
ušŒ_t
 
	mv”siÚ
;

17 
	md©a
[
BLOCK_SIZE
];

18 
ušt8_t
 
	miv
[16];

19 
	mp_hash
[32];

20 } 
	tBlock
;

22 
	sBuck‘


24 
Block
 
	mblocks
[4];

25 }
	tBuck‘
;

30 
Block
 *
S
;

31 
Block
 *
Sg
;

32 
S_Ën
;

33 
Sg_Ën
;

34 
Œ“¬¿y_Ën
;

38 
	sBlock_md


40 
ušŒ_t
 
	madd»ss
;

44 } 
	tBlock_md
;

46 
	sBuck‘_md


48 
Block_md
 
	mblocks
[4];

49 }
	tBuck‘_md
;

52 
Buck‘_md
 
buc_i_po_md
;

53 
Buck‘_md
 *
Œ“_po_md
;

67 
Buck‘
 
buc_i
;

69 
acûss
(
İ
, 
a
, 
d©a¡¬
[
BLOCK_SIZE
+1], 
»t_buf
[
ARRAY_SIZE
],
ex‹nsiÚ
);

70 
š™®ize_Üam
();

	@page_fault.c

5 
	~"»gs.h
"

6 
	~"´štf.h
"

8 
	$¹_·ge_çuÉ
(
’ş_ùx_t
* 
ùx
)

10 
addr
, 
ÿu£
;

13 
addr
 = 
ùx
->
sbadaddr
;

14 
ÿu£
 = 
ùx
->
sÿu£
;

16 
	`´štf
("[ruÁime]…agçuÉ‡ˆ0x%lx (sÿu£: 0x%lx)\n", 
addr
, 
ÿu£
);

17 
	`SBI_CALL_1
(
SBI_SM_EXIT_ENCLAVE
,-1);

19 
	}
}

	@page_replacement.c

1 
	~"vm.h
"

2 
	~"·ge_»¶aûm’t.h
"

3 
	~"´štf.h
"

4 
	~"mm.h
"

7 
ušŒ_t
 
	$şock_š£¹
(
ušŒ_t
 
™em_Üg_va
, ušŒ_ˆ
™em_’c_va
)

10 if(
şock_couÁ”
>=
äame_size
)

11  
QUEUE_FULL
;

12 
»¶aûm’t_®go_queue_m­
[
poš‹r
]=
™em_’c_va
;

15 
şock_couÁ”
++;

16 
poš‹r
=Õoš‹r+1)%
äame_size
;

18  
ENQUE_SUCCESS
;

20 
	}
}

22 
ušŒ_t
 
	$g‘_şock_queue_size
()

24  
şock_couÁ”
;

25 
	}
}

27 
ušŒ_t
 
	$şock_»move
()

31 if(
şock_couÁ”
==0)

33  
QUEUE_EMPTY
;

41 
ušŒ_t
* 
cur_±adr
=0;

43 if(
»¶aûm’t_®go_queue_m­
[
poš‹r
]!=0)

44 
cur_±adr
ğ
	`__w®k
(
	`g‘_roÙ_·ge_bË_addr
(),
»¶aûm’t_®go_queue_m­
[
poš‹r
]);

46 if(
»¶aûm’t_®go_queue_m­
[
poš‹r
]!=0 && ((*
cur_±adr
 & 
PTE_V
)==0) )

51 
pİ_™em
[1]=
»¶aûm’t_®go_queue_m­
[
poš‹r
];

52 
»¶aûm’t_®go_queue_m­
[
poš‹r
]=0;

53 
şock_couÁ”
--;

54  
pİ_™em
[0];

62 if(
»¶aûm’t_®go_queue_m­
[
poš‹r
]!=0)

63 *
cur_±adr
ğ(*cur_±adrè& (~
PTE_V
);

65 
poš‹r
 = (poš‹¸+ 1è% 
äame_size
;

69 
	}
}

74 
	$ş—r_b™s
()

77 if(
is_¹
==0)

80 
is_¹
=1;

81 
ušŒ_t
 
i
=0;i<
şock_couÁ”
;i++)

83 if(
»¶aûm’t_®go_queue_m­
[
i
]!=0)

85 
ušŒ_t
 *
roÙ_·ge_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();root_page_table_addr=root_page_table_addr;

87 
ušŒ_t
 *
sç
=
	`__w®k
(
roÙ_·ge_bË_addr
,
»¶aûm’t_®go_queue_m­
[
i
]);sfa=sfa;

88 *
sç
ğ*sç & (~
PTE_V
);

95 
	}
}

105 
ušŒ_t
 
	$g‘_q_size
()

107 if(
q_äÚt
==-1)

109  (
q_»¬
>=
q_äÚt
)? q_»¬-q_äÚt+1 : ((
MALLOC_SIZE2
)-(q_front-q_rear-1));

110 
	}
}

112 
ušŒ_t
 
	$g‘_¡ack_size
()

114  
q_äÚt
+1;

115 
	}
}

117 
šŒ_t
 
	$is_Em±y_queue
()

119  
q_äÚt
==-1;

120 
	}
}

122 
ušŒ_t
 
	$is_FuÎ_queue
()

124  (
q_»¬
+1)%(
MALLOC_SIZE2
)==
q_äÚt
;

125 
	}
}

127 
ušŒ_t
 
	$’que
(
ušŒ_t
 
™em_Üg_va
, ušŒ_ˆ
™em_’c_va
)

129 if(
	`is_FuÎ_queue
())

131  
QUEUE_FULL
;

133 if(
q_äÚt
==
q_»¬
 && 
	`is_Em±y_queue
() ){

134 
q_äÚt
=
q_»¬
=0;

136 
»¶aûm’t_®go_queue_m­
[
q_»¬
]=
™em_’c_va
;

139  
ENQUE_SUCCESS
;

141 
q_»¬
=(q_»¬+1)%
MALLOC_SIZE2
;

144 
»¶aûm’t_®go_queue_m­
[
q_»¬
]=
™em_’c_va
;

147  
ENQUE_SUCCESS
;

148 
	}
}

150 
ušŒ_t
 
	$deque
()

152 if(
	`is_Em±y_queue
())

154  
QUEUE_EMPTY
;

157 
pİ_™em
[1]ğ
»¶aûm’t_®go_queue_m­
[
q_äÚt
];

158 if(
q_äÚt
==
q_»¬
)

160 
q_äÚt
=
q_»¬
=-1;

164 
q_äÚt
=(q_äÚt+1)%(
MALLOC_SIZE2
);

166  
pİ_™em
[0];

167 
	}
}

169 
ušŒ_t
 
	$is_Em±y_¡ack
()

171  
q_äÚt
==-1;

172 
	}
}

174 
ušŒ_t
 
	$is_FuÎ_¡ack
()

176  (
q_äÚt
)=ğ(
MALLOC_SIZE2
-1);

177 
	}
}

179 
ušŒ_t
 
	$push
(
ušŒ_t
 
™em_Üg_va
, ušŒ_ˆ
™em_’c_va
)

181 if(
	`is_FuÎ_¡ack
())

183  
QUEUE_FULL
;

185 
»¶aûm’t_®go_queue
[++
q_äÚt
]=
™em_Üg_va
;

186 
»¶aûm’t_®go_queue_m­
[
q_äÚt
]=
™em_’c_va
;

187  
ENQUE_SUCCESS
;

188 
	}
}

190 
ušŒ_t
 
	$pİ
()

192 if(
	`is_Em±y_¡ack
())

194  
QUEUE_EMPTY
;

196 
pİ_™em
[0]ğ
»¶aûm’t_®go_queue
[
q_äÚt
];

197 
pİ_™em
[1]ğ
»¶aûm’t_®go_queue_m­
[
q_äÚt
--];

198  
pİ_™em
[0];

199 
	}
}

207 
	$‹¡šg_que
()

209 
	`´štf
("TESTING QUEUE\n");

210 
	}
}

212 
ušŒ_t
 
	$¶aû_Ãw_·ge
(
ušŒ_t
 
™em_Üg_va
, ušŒ_ˆ
™em_’c_va
)

215  
	`’que
Ğ
™em_Üg_va
, 
™em_’c_va
);

218 
	}
}

220 
ušŒ_t
 
	$»move_viùim_·ge
()

223  
	`deque
();

225 
	}
}

227 
ušŒ_t
 
	$g‘_queue_size
()

230  
	`g‘_q_size
();

232 
	}
}

235 
	$show_queue_cÚ‹Ás
()

237 
i
=
q_äÚt
;i<=14000;i++)

240 
	`´štf
("0x%lx(0x%lxè\n",
»¶aûm’t_®go_queue_m­
[
i
],0 );

243 
	}
}

	@page_replacement.h

1 
	#QUEUE_FULL
 1

	)

2 
	#QUEUE_EMPTY
 2

	)

3 
	#ENQUE_SUCCESS
 3

	)

4 
	#DEQUE_SUCCESS
 4

	)

7 
ušŒ_t
 
¶aû_Ãw_·ge
(ušŒ_ˆ
™em_Üg_va
, ušŒ_ˆ
™em_’c_va
);

8 
ušŒ_t
 
»move_viùim_·ge
();

9 
ušŒ_t
 
g‘_queue_size
();

10 
ş—r_b™s
();

12 
show_queue_cÚ‹Ás
();

13 
‹¡šg_que
();

	@printf.c

33 
	~<¡dboŞ.h
>

34 
	~<¡dšt.h
>

35 
	~"´štf.h
"

36 
	~"sbi.h
"

41 
	#PRINTF_NTOA_BUFFER_SIZE
 32U

	)

46 
	#PRINTF_FTOA_BUFFER_SIZE
 32U

	)

49 
	#PRINTF_SUPPORT_FLOAT


	)

52 
	#PRINTF_SUPPORT_LONG_LONG


	)

56 
	#PRINTF_SUPPORT_PTRDIFF_T


	)

62 
	#FLAGS_ZEROPAD
 (1U << 0U)

	)

63 
	#FLAGS_LEFT
 (1U << 1U)

	)

64 
	#FLAGS_PLUS
 (1U << 2U)

	)

65 
	#FLAGS_SPACE
 (1U << 3U)

	)

66 
	#FLAGS_HASH
 (1U << 4U)

	)

67 
	#FLAGS_UPPERCASE
 (1U << 5U)

	)

68 
	#FLAGS_CHAR
 (1U << 6U)

	)

69 
	#FLAGS_SHORT
 (1U << 7U)

	)

70 
	#FLAGS_LONG
 (1U << 8U)

	)

71 
	#FLAGS_LONG_LONG
 (1U << 9U)

	)

72 
	#FLAGS_PRECISION
 (1U << 10U)

	)

74 
	$_putch¬
(
ch¬aù”
)

76 
	`SBI_CALL_1
(
SBI_CONSOLE_PUTCHAR
, 
ch¬aù”
);

77 
	}
}

80 (*
	tout_fù_ty³
)(
	tch¬aù”
, * 
	tbufãr
, 
	tsize_t
 
	tidx
, size_ˆ
	tmaxËn
);

85 (*
fù
)(
ch¬aù”
, * 
¬g
);

86 * 
¬g
;

87 } 
	tout_fù_w¿p_ty³
;

91 
šlše
 
	$_out_bufãr
(
ch¬aù”
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
)

93 ià(
idx
 < 
maxËn
) {

94 ((*)
bufãr
)[
idx
] = 
ch¬aù”
;

96 
	}
}

100 
šlše
 
	$_out_nuÎ
(
ch¬aù”
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
)

102 ()
ch¬aù”
; ()
bufãr
; ()
idx
; ()
maxËn
;

103 
	}
}

107 
šlše
 
	$_out_ch¬
(
ch¬aù”
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
)

109 ()
bufãr
; ()
idx
; ()
maxËn
;

110 ià(
ch¬aù”
) {

111 
	`_putch¬
(
ch¬aù”
);

113 
	}
}

117 
šlše
 
	$_out_fù
(
ch¬aù”
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
)

119 ()
idx
; ()
maxËn
;

121 ((
out_fù_w¿p_ty³
*)
bufãr
)->
	`fù
(
ch¬aù”
, ((out_fù_w¿p_ty³*)bufãr)->
¬g
);

122 
	}
}

127 
šlše
 
boŞ
 
	$_is_dig™
(
ch
)

129  (
ch
 >= '0') && (ch <= '9');

130 
	}
}

134 
	$_©oi
(cÚ¡ ** 
¡r
)

136 
i
 = 0U;

137 
	`_is_dig™
(**
¡r
)) {

138 
i
 = i * 10U + ()(*((*
¡r
)++) - '0');

140  
i
;

141 
	}
}

145 
size_t
 
	$_Áß_fÜm©
(
out_fù_ty³
 
out
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
, * 
buf
, size_ˆ
Ën
, 
boŞ
 
Ãg©ive
, 
ba£
, 
´ec
, 
width
, 
æags
)

147 cÚ¡ 
size_t
 
¡¬t_idx
 = 
idx
;

150 !(
æags
 & 
FLAGS_LEFT
è&& (
Ën
 < 
´ec
è&& (ËÀ< 
PRINTF_NTOA_BUFFER_SIZE
)) {

151 
buf
[
Ën
++] = '0';

153 !(
æags
 & 
FLAGS_LEFT
è&& (æag & 
FLAGS_ZEROPAD
è&& (
Ën
 < 
width
è&& (ËÀ< 
PRINTF_NTOA_BUFFER_SIZE
)) {

154 
buf
[
Ën
++] = '0';

158 ià(
æags
 & 
FLAGS_HASH
) {

159 ià(!(
æags
 & 
FLAGS_PRECISION
è&& 
Ën
 && (Ö’ =ğ
´ec
è|| (ËÀ=ğ
width
))) {

160 
Ën
--;

161 ià(
Ën
 && (
ba£
 == 16U)) {

162 
Ën
--;

165 ià((
ba£
 =ğ16Uè&& !(
æags
 & 
FLAGS_UPPERCASE
è&& (
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
)) {

166 
buf
[
Ën
++] = 'x';

168 ià((
ba£
 =ğ16Uè&& (
æags
 & 
FLAGS_UPPERCASE
è&& (
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
)) {

169 
buf
[
Ën
++] = 'X';

171 ià((
ba£
 =ğ2Uè&& (
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
)) {

172 
buf
[
Ën
++] = 'b';

174 ià(
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
) {

175 
buf
[
Ën
++] = '0';

180 ià(
Ën
 && (ËÀ=ğ
width
è&& (
Ãg©ive
 || (
æags
 & 
FLAGS_PLUS
è|| (æag & 
FLAGS_SPACE
))) {

181 
Ën
--;

183 ià(
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
) {

184 ià(
Ãg©ive
) {

185 
buf
[
Ën
++] = '-';

187 ià(
æags
 & 
FLAGS_PLUS
) {

188 
buf
[
Ën
++] = '+';

190 ià(
æags
 & 
FLAGS_SPACE
) {

191 
buf
[
Ën
++] = ' ';

196 ià(!(
æags
 & 
FLAGS_LEFT
è&& !(æag & 
FLAGS_ZEROPAD
)) {

197 
size_t
 
i
 = 
Ën
; i < 
width
; i++) {

198 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

203 
size_t
 
i
 = 0U; i < 
Ën
; i++) {

204 
	`out
(
buf
[
Ën
 - 
i
 - 1U], 
bufãr
, 
idx
++, 
maxËn
);

208 ià(
æags
 & 
FLAGS_LEFT
) {

209 
idx
 - 
¡¬t_idx
 < 
width
) {

210 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

214  
idx
;

215 
	}
}

219 
size_t
 
	$_Áß_lÚg
(
out_fù_ty³
 
out
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
, 
v®ue
, 
boŞ
 
Ãg©ive
, 
ba£
, 
´ec
, 
width
, 
æags
)

221 
buf
[
PRINTF_NTOA_BUFFER_SIZE
];

222 
size_t
 
Ën
 = 0U;

225 ià(!
v®ue
) {

226 
æags
 &ğ~
FLAGS_HASH
;

230 ià(!(
æags
 & 
FLAGS_PRECISION
è|| 
v®ue
) {

232 cÚ¡ 
dig™
 = ()(
v®ue
 % 
ba£
);

233 
buf
[
Ën
++] = 
dig™
 < 10 ? '0' + dig™ : (
æags
 & 
FLAGS_UPPERCASE
 ? 'A' : 'a') + digit - 10;

234 
v®ue
 /ğ
ba£
;

235 } 
v®ue
 && (
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
));

238  
	`_Áß_fÜm©
(
out
, 
bufãr
, 
idx
, 
maxËn
, 
buf
, 
Ën
, 
Ãg©ive
, ()
ba£
, 
´ec
, 
width
, 
æags
);

239 
	}
}

243 #ià
defšed
(
PRINTF_SUPPORT_LONG_LONG
)

244 
size_t
 
	$_Áß_lÚg_lÚg
(
out_fù_ty³
 
out
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
, 
v®ue
, 
boŞ
 
Ãg©ive
, 
ba£
, 
´ec
, 
width
, 
æags
)

246 
buf
[
PRINTF_NTOA_BUFFER_SIZE
];

247 
size_t
 
Ën
 = 0U;

250 ià(!
v®ue
) {

251 
æags
 &ğ~
FLAGS_HASH
;

255 ià(!(
æags
 & 
FLAGS_PRECISION
è|| 
v®ue
) {

257 cÚ¡ 
dig™
 = ()(
v®ue
 % 
ba£
);

258 
buf
[
Ën
++] = 
dig™
 < 10 ? '0' + dig™ : (
æags
 & 
FLAGS_UPPERCASE
 ? 'A' : 'a') + digit - 10;

259 
v®ue
 /ğ
ba£
;

260 } 
v®ue
 && (
Ën
 < 
PRINTF_NTOA_BUFFER_SIZE
));

263  
	`_Áß_fÜm©
(
out
, 
bufãr
, 
idx
, 
maxËn
, 
buf
, 
Ën
, 
Ãg©ive
, ()
ba£
, 
´ec
, 
width
, 
æags
);

264 
	}
}

268 #ià
defšed
(
PRINTF_SUPPORT_FLOAT
)

269 
size_t
 
	$_áß
(
out_fù_ty³
 
out
, * 
bufãr
, 
size_t
 
idx
, size_ˆ
maxËn
, 
v®ue
, 
´ec
, 
width
, 
æags
)

271 cÚ¡ 
size_t
 
¡¬t_idx
 = 
idx
;

273 
buf
[
PRINTF_FTOA_BUFFER_SIZE
];

274 
size_t
 
Ën
 = 0U;

275 
diff
 = 0.0;

278 cÚ¡ 
th»s_max
 = ()0x7FFFFFFF;

281 cÚ¡ 
pow10
[] = { 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000, 1000000000 };

284 
boŞ
 
Ãg©ive
 = 
çl£
;

285 ià(
v®ue
 < 0) {

286 
Ãg©ive
 = 
Œue
;

287 
v®ue
 = 0 - value;

291 ià(!(
æags
 & 
FLAGS_PRECISION
)) {

292 
´ec
 = 6U;

295 (
Ën
 < 
PRINTF_FTOA_BUFFER_SIZE
è&& (
´ec
 > 9U)) {

296 
buf
[
Ën
++] = '0';

297 
´ec
--;

300 
whŞe
 = ()
v®ue
;

301 
tmp
 = (
v®ue
 - 
whŞe
è* 
pow10
[
´ec
];

302 
äac
 = ()
tmp
;

303 
diff
 = 
tmp
 - 
äac
;

305 ià(
diff
 > 0.5) {

306 ++
äac
;

308 ià(
äac
 >ğ
pow10
[
´ec
]) {

309 
äac
 = 0;

310 ++
whŞe
;

313 ià((
diff
 =ğ0.5è&& ((
äac
 == 0U) || (frac & 1U))) {

315 ++
äac
;

320 ià(
v®ue
 > 
th»s_max
) {

324 ià(
´ec
 == 0U) {

325 
diff
 = 
v®ue
 - ()
whŞe
;

326 ià(
diff
 > 0.5) {

328 ++
whŞe
;

330 ià((
diff
 =ğ0.5è&& (
whŞe
 & 1)) {

333 ++
whŞe
;

337 
couÁ
 = 
´ec
;

339 
Ën
 < 
PRINTF_FTOA_BUFFER_SIZE
) {

340 --
couÁ
;

341 
buf
[
Ën
++] = ()(48U + (
äac
 % 10U));

342 ià(!(
äac
 /= 10U)) {

347 (
Ën
 < 
PRINTF_FTOA_BUFFER_SIZE
è&& (
couÁ
-- > 0U)) {

348 
buf
[
Ën
++] = '0';

350 ià(
Ën
 < 
PRINTF_FTOA_BUFFER_SIZE
) {

352 
buf
[
Ën
++] = '.';

357 
Ën
 < 
PRINTF_FTOA_BUFFER_SIZE
) {

358 
buf
[
Ën
++] = ()(48 + (
whŞe
 % 10));

359 ià(!(
whŞe
 /= 10)) {

365 !(
æags
 & 
FLAGS_LEFT
è&& (æag & 
FLAGS_ZEROPAD
è&& (
Ën
 < 
width
è&& (ËÀ< 
PRINTF_FTOA_BUFFER_SIZE
)) {

366 
buf
[
Ën
++] = '0';

370 ià((
Ën
 =ğ
width
è&& (
Ãg©ive
 || (
æags
 & 
FLAGS_PLUS
è|| (æag & 
FLAGS_SPACE
))) {

371 
Ën
--;

373 ià(
Ën
 < 
PRINTF_FTOA_BUFFER_SIZE
) {

374 ià(
Ãg©ive
) {

375 
buf
[
Ën
++] = '-';

377 ià(
æags
 & 
FLAGS_PLUS
) {

378 
buf
[
Ën
++] = '+';

380 ià(
æags
 & 
FLAGS_SPACE
) {

381 
buf
[
Ën
++] = ' ';

386 ià(!(
æags
 & 
FLAGS_LEFT
è&& !(æag & 
FLAGS_ZEROPAD
)) {

387 
size_t
 
i
 = 
Ën
; i < 
width
; i++) {

388 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

393 
size_t
 
i
 = 0U; i < 
Ën
; i++) {

394 
	`out
(
buf
[
Ën
 - 
i
 - 1U], 
bufãr
, 
idx
++, 
maxËn
);

398 ià(
æags
 & 
FLAGS_LEFT
) {

399 
idx
 - 
¡¬t_idx
 < 
width
) {

400 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

404  
idx
;

405 
	}
}

410 
	$_v¢´štf
(
out_fù_ty³
 
out
, * 
bufãr
, cÚ¡ 
size_t
 
maxËn
, cÚ¡ * 
fÜm©
, 
va_li¡
 
va
)

412 
æags
, 
width
, 
´ecisiÚ
, 
n
;

413 
size_t
 
idx
 = 0U;

415 ià(!
bufãr
) {

417 
out
 = 
_out_nuÎ
;

420 *
fÜm©
)

423 ià(*
fÜm©
 != '%') {

425 
	`out
(*
fÜm©
, 
bufãr
, 
idx
++, 
maxËn
);

426 
fÜm©
++;

431 
fÜm©
++;

435 
æags
 = 0U;

437 *
fÜm©
) {

438 '0': 
æags
 |ğ
FLAGS_ZEROPAD
; 
fÜm©
++; 
n
 = 1U; ;

439 '-': 
æags
 |ğ
FLAGS_LEFT
; 
fÜm©
++; 
n
 = 1U; ;

440 '+': 
æags
 |ğ
FLAGS_PLUS
; 
fÜm©
++; 
n
 = 1U; ;

441 ' ': 
æags
 |ğ
FLAGS_SPACE
; 
fÜm©
++; 
n
 = 1U; ;

442 '#': 
æags
 |ğ
FLAGS_HASH
; 
fÜm©
++; 
n
 = 1U; ;

443  : 
n
 = 0U; ;

445 } 
n
);

448 
width
 = 0U;

449 ià(
	`_is_dig™
(*
fÜm©
)) {

450 
width
 = 
	`_©oi
(&
fÜm©
);

452 ià(*
fÜm©
 == '*') {

453 cÚ¡ 
w
 = 
	`va_¬g
(
va
, );

454 ià(
w
 < 0) {

455 
æags
 |ğ
FLAGS_LEFT
;

456 
width
 = ()-
w
;

459 
width
 = ()
w
;

461 
fÜm©
++;

465 
´ecisiÚ
 = 0U;

466 ià(*
fÜm©
 == '.') {

467 
æags
 |ğ
FLAGS_PRECISION
;

468 
fÜm©
++;

469 ià(
	`_is_dig™
(*
fÜm©
)) {

470 
´ecisiÚ
 = 
	`_©oi
(&
fÜm©
);

472 ià(*
fÜm©
 == '*') {

473 cÚ¡ 
´ec
 = ()
	`va_¬g
(
va
, );

474 
´ecisiÚ
 = 
´ec
 > 0 ? ()prec : 0U;

475 
fÜm©
++;

480 *
fÜm©
) {

482 
æags
 |ğ
FLAGS_LONG
;

483 
fÜm©
++;

484 ià(*
fÜm©
 == 'l') {

485 
æags
 |ğ
FLAGS_LONG_LONG
;

486 
fÜm©
++;

490 
æags
 |ğ
FLAGS_SHORT
;

491 
fÜm©
++;

492 ià(*
fÜm©
 == 'h') {

493 
æags
 |ğ
FLAGS_CHAR
;

494 
fÜm©
++;

497 #ià
	`defšed
(
PRINTF_SUPPORT_PTRDIFF_T
)

499 
æags
 |ğ((
±rdiff_t
è=ğ(è? 
FLAGS_LONG
 : 
FLAGS_LONG_LONG
);

500 
fÜm©
++;

504 
æags
 |ğ((
štmax_t
è=ğ(è? 
FLAGS_LONG
 : 
FLAGS_LONG_LONG
);

505 
fÜm©
++;

508 
æags
 |ğ((
size_t
è=ğ(è? 
FLAGS_LONG
 : 
FLAGS_LONG_LONG
);

509 
fÜm©
++;

516 *
fÜm©
) {

525 
ba£
;

526 ià(*
fÜm©
 == 'x' || *format == 'X') {

527 
ba£
 = 16U;

529 ià(*
fÜm©
 == 'o') {

530 
ba£
 = 8U;

532 ià(*
fÜm©
 == 'b') {

533 
ba£
 = 2U;

536 
ba£
 = 10U;

537 
æags
 &ğ~
FLAGS_HASH
;

540 ià(*
fÜm©
 == 'X') {

541 
æags
 |ğ
FLAGS_UPPERCASE
;

545 ià((*
fÜm©
 != 'i') && (*format != 'd')) {

546 
æags
 &ğ~(
FLAGS_PLUS
 | 
FLAGS_SPACE
);

550 ià(
æags
 & 
FLAGS_PRECISION
) {

551 
æags
 &ğ~
FLAGS_ZEROPAD
;

555 ià((*
fÜm©
 == 'i') || (*format == 'd')) {

557 ià(
æags
 & 
FLAGS_LONG_LONG
) {

558 #ià
	`defšed
(
PRINTF_SUPPORT_LONG_LONG
)

559 cÚ¡ 
v®ue
 = 
	`va_¬g
(
va
, );

560 
idx
 = 
	`_Áß_lÚg_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, ()(
v®ue
 > 0 ? v®u: 0 - v®ue), v®u< 0, 
ba£
, 
´ecisiÚ
, 
width
, 
æags
);

563 ià(
æags
 & 
FLAGS_LONG
) {

564 cÚ¡ 
v®ue
 = 
	`va_¬g
(
va
, );

565 
idx
 = 
	`_Áß_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, ()(
v®ue
 > 0 ? v®u: 0 - v®ue), v®u< 0, 
ba£
, 
´ecisiÚ
, 
width
, 
æags
);

568 cÚ¡ 
v®ue
 = (
æags
 & 
FLAGS_CHAR
è? ()
	`va_¬g
(
va
, è: (æag & 
FLAGS_SHORT
) ? ()va_arg(va, ) : va_arg(va, );

569 
idx
 = 
	`_Áß_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, ()(
v®ue
 > 0 ? v®u: 0 - v®ue), v®u< 0, 
ba£
, 
´ecisiÚ
, 
width
, 
æags
);

574 ià(
æags
 & 
FLAGS_LONG_LONG
) {

575 #ià
	`defšed
(
PRINTF_SUPPORT_LONG_LONG
)

576 
idx
 = 
	`_Áß_lÚg_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, 
	`va_¬g
(
va
, ), 
çl£
, 
ba£
, 
´ecisiÚ
, 
width
, 
æags
);

579 ià(
æags
 & 
FLAGS_LONG
) {

580 
idx
 = 
	`_Áß_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, 
	`va_¬g
(
va
, ), 
çl£
, 
ba£
, 
´ecisiÚ
, 
width
, 
æags
);

583 cÚ¡ 
v®ue
 = (
æags
 & 
FLAGS_CHAR
è? ()
	`va_¬g
(
va
, è: (æag & 
FLAGS_SHORT
) ? ()va_arg(va, ) : va_arg(va, );

584 
idx
 = 
	`_Áß_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, 
v®ue
, 
çl£
, 
ba£
, 
´ecisiÚ
, 
width
, 
æags
);

587 
fÜm©
++;

590 #ià
	`defšed
(
PRINTF_SUPPORT_FLOAT
)

593 
idx
 = 
	`_áß
(
out
, 
bufãr
, idx, 
maxËn
, 
	`va_¬g
(
va
, ), 
´ecisiÚ
, 
width
, 
æags
);

594 
fÜm©
++;

598 
l
 = 1U;

600 ià(!(
æags
 & 
FLAGS_LEFT
)) {

601 
l
++ < 
width
) {

602 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

606 
	`out
(()
	`va_¬g
(
va
, ), 
bufãr
, 
idx
++, 
maxËn
);

608 ià(
æags
 & 
FLAGS_LEFT
) {

609 
l
++ < 
width
) {

610 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

613 
fÜm©
++;

618 * 
p
 = 
	`va_¬g
(
va
, *);

619 
l
 = 
	`_¡¾’
(
p
);

621 ià(
æags
 & 
FLAGS_PRECISION
) {

622 
l
 = (È< 
´ecisiÚ
 ?† :…recision);

624 ià(!(
æags
 & 
FLAGS_LEFT
)) {

625 
l
++ < 
width
) {

626 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

630 (*
p
 !ğ0è&& (!(
æags
 & 
FLAGS_PRECISION
è|| 
´ecisiÚ
--)) {

631 
	`out
(*(
p
++), 
bufãr
, 
idx
++, 
maxËn
);

634 ià(
æags
 & 
FLAGS_LEFT
) {

635 
l
++ < 
width
) {

636 
	`out
(' ', 
bufãr
, 
idx
++, 
maxËn
);

639 
fÜm©
++;

644 
width
 = (*) * 2U;

645 
æags
 |ğ
FLAGS_ZEROPAD
 | 
FLAGS_UPPERCASE
;

646 #ià
	`defšed
(
PRINTF_SUPPORT_LONG_LONG
)

647 cÚ¡ 
boŞ
 
is_Î
 = (
ušŒ_t
) == ();

648 ià(
is_Î
) {

649 
idx
 = 
	`_Áß_lÚg_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, (
ušŒ_t
)
	`va_¬g
(
va
, *), 
çl£
, 16U, 
´ecisiÚ
, 
width
, 
æags
);

653 
idx
 = 
	`_Áß_lÚg
(
out
, 
bufãr
, idx, 
maxËn
, ()((
ušŒ_t
)
	`va_¬g
(
va
, *)), 
çl£
, 16U, 
´ecisiÚ
, 
width
, 
æags
);

654 #ià
	`defšed
(
PRINTF_SUPPORT_LONG_LONG
)

657 
fÜm©
++;

662 
	`out
('%', 
bufãr
, 
idx
++, 
maxËn
);

663 
fÜm©
++;

667 
	`out
(*
fÜm©
, 
bufãr
, 
idx
++, 
maxËn
);

668 
fÜm©
++;

674 
	`out
(()0, 
bufãr
, 
idx
 < 
maxËn
 ? idx : maxlen - 1U, maxlen);

677  ()
idx
;

678 
	}
}

684 
	$´štf
(cÚ¡ * 
fÜm©
, ...)

686 
va_li¡
 
va
;

687 
	`va_¡¬t
(
va
, 
fÜm©
);

688 
bufãr
[1];

689 cÚ¡ 
»t
 = 
	`_v¢´štf
(
_out_ch¬
, 
bufãr
, (
size_t
)-1, 
fÜm©
, 
va
);

690 
	`va_’d
(
va
);

691  
»t
;

692 
	}
}

695 
	$¥rštf
(* 
bufãr
, cÚ¡ * 
fÜm©
, ...)

697 
va_li¡
 
va
;

698 
	`va_¡¬t
(
va
, 
fÜm©
);

699 cÚ¡ 
»t
 = 
	`_v¢´štf
(
_out_bufãr
, 
bufãr
, (
size_t
)-1, 
fÜm©
, 
va
);

700 
	`va_’d
(
va
);

701  
»t
;

702 
	}
}

705 
	$¢´štf
(* 
bufãr
, 
size_t
 
couÁ
, cÚ¡ * 
fÜm©
, ...)

707 
va_li¡
 
va
;

708 
	`va_¡¬t
(
va
, 
fÜm©
);

709 cÚ¡ 
»t
 = 
	`_v¢´štf
(
_out_bufãr
, 
bufãr
, 
couÁ
, 
fÜm©
, 
va
);

710 
	`va_’d
(
va
);

711  
»t
;

712 
	}
}

715 
	$v¢´štf
(* 
bufãr
, 
size_t
 
couÁ
, cÚ¡ * 
fÜm©
, 
va_li¡
 
va
)

717  
	`_v¢´štf
(
_out_bufãr
, 
bufãr
, 
couÁ
, 
fÜm©
, 
va
);

718 
	}
}

721 
	$fù´štf
((*
out
)(
ch¬aù”
, * 
¬g
), *‡rg, cÚ¡ * 
fÜm©
, ...)

723 
va_li¡
 
va
;

724 
	`va_¡¬t
(
va
, 
fÜm©
);

725 cÚ¡ 
out_fù_w¿p_ty³
 
out_fù_w¿p
 = { 
out
, 
¬g
 };

726 cÚ¡ 
»t
 = 
	`_v¢´štf
(
_out_fù
, (*)&
out_fù_w¿p
, (
size_t
)-1, 
fÜm©
, 
va
);

727 
	`va_’d
(
va
);

728  
»t
;

729 
	}
}

	@printf.h

32 #iâdeà
_PRINTF_H_


33 
	#_PRINTF_H_


	)

35 
	~<¡d¬g.h
>

36 
	~<¡ddef.h
>

37 
	~"sbi.h
"

39 #ifdeà
__ılu¥lus


45 
šlše
 
_¡¾’
(cÚ¡ * 
¡r
)

47 cÚ¡ * 
s
;

48 
s
 = 
¡r
; *s; ++s);

49  ()(
s
 - 
¡r
);

58 
_putch¬
(
ch
);

66 
´štf
(cÚ¡ * 
fÜm©
, ...);

76 
¥rštf
(* 
bufãr
, cÚ¡ * 
fÜm©
, ...);

87 
¢´štf
(* 
bufãr
, 
size_t
 
couÁ
, cÚ¡ * 
fÜm©
, ...);

88 
v¢´štf
(* 
bufãr
, 
size_t
 
couÁ
, cÚ¡ * 
fÜm©
, 
va_li¡
 
va
);

99 
fù´štf
((*
out
)(
ch¬aù”
, * 
¬g
), *‡rg, cÚ¡ * 
fÜm©
, ...);

102 #ifdeà
__ılu¥lus


	@regs.h

6 #iâdeà
_REGS_H_


7 
	#_REGS_H_


	)

8 
	~<¡dšt.h
>

10 
	s»gs_t
 {

11 
ušŒ_t
 
	m£pc
;

12 
ušŒ_t
 
	m¿
;

13 
ušŒ_t
 
	m¥
;

14 
ušŒ_t
 
	mgp
;

15 
ušŒ_t
 
	m
;

16 
ušŒ_t
 
	mt0
;

17 
ušŒ_t
 
	mt1
;

18 
ušŒ_t
 
	mt2
;

19 
ušŒ_t
 
	ms0
;

20 
ušŒ_t
 
	ms1
;

21 
ušŒ_t
 
	ma0
;

22 
ušŒ_t
 
	ma1
;

23 
ušŒ_t
 
	ma2
;

24 
ušŒ_t
 
	ma3
;

25 
ušŒ_t
 
	ma4
;

26 
ušŒ_t
 
	ma5
;

27 
ušŒ_t
 
	ma6
;

28 
ušŒ_t
 
	ma7
;

29 
ušŒ_t
 
	ms2
;

30 
ušŒ_t
 
	ms3
;

31 
ušŒ_t
 
	ms4
;

32 
ušŒ_t
 
	ms5
;

33 
ušŒ_t
 
	ms6
;

34 
ušŒ_t
 
	ms7
;

35 
ušŒ_t
 
	ms8
;

36 
ušŒ_t
 
	ms9
;

37 
ušŒ_t
 
	ms10
;

38 
ušŒ_t
 
	ms11
;

39 
ušŒ_t
 
	mt3
;

40 
ušŒ_t
 
	mt4
;

41 
ušŒ_t
 
	mt5
;

42 
ušŒ_t
 
	mt6
;

45 
	s’ş_ùx_t
 {

46 
»gs_t
 
	m»gs
;

48 
ušŒ_t
 
	ms¡©us
;

49 
ušŒ_t
 
	msbadaddr
;

50 
ušŒ_t
 
	msÿu£
;

	@roram.c

1 
	~"mm.h
"

2 
	~"¹_ut.h
"

3 
	~"´štf.h
"

4 
	~"¡ršg.h
"

5 
	~"sysÿÎ.h
"

6 
	~"m®loc.h
"

7 
	~"edge_ÿÎ.h
"

8 
	~"«ss.h
"

9 
	~"ssha3.h
"

10 
	~"ä“mem.h
"

11 
	~"vm.h
"

12 
	~"·ge_»¶aûm’t.h
"

13 
	~"rÜam.h
"

14 
	~"šdex_q.h
"

24 
Block_rÜam
 *
	gS_rÜam
;

25 
Buck‘_rÜam_md
 *
	gS_rÜam_md
;

26 
Buck‘_rÜam_md
 *
	gŒ“_rÜam_md
;

28 
	grd
[
RISCV_PAGE_SIZE
];

30 
	gglob®_j
;

32 
	gS_rÜam_Ën
=0;

33 
	gSg_rÜam_Ën
=0;

34 
	ground
 =0;

35 
Block_rÜam
 
	gblk_i_d_ro
;

36 
Buck‘_rÜam_md
 
	gbuc_i_md_ro
;

38 
Buck‘_rÜam
 *
	gbuc_i_d_ro
;

40 
	gS_o
=0;

41 
	gG
=0;

43 
	gdum
;

44 
	ggdum
;

45 
	gA
=0;

46 
Buck‘_rÜam
 *
	gtmp_buc_d
;

48 
	$upd©e_max_¡ash_occ
()

59 
ušŒ_t
 
c
=
STASH_SIZE_RORAM
-
	`g‘_q_size2
();

61 if(
c
>
max_¡ash_occ
)

62 
max_¡ash_occ
=
c
;

64 
	}
}

66 
ušt8_t
 
	$g‘_block_off£t
(
ušŒ_t
 
a
)

68 
ušt8_t
 
±r
=0;

69 
f
='n';

70 
glob®_j
=-1;

71 
j
=0;j<
Z
+
S_o
;j++)

73 if((
a
<<
RISCV_PAGE_BITS
)==
buc_i_md_ro
.
addr
[
j
] && buc_i_md_ro.
v®ids
[buc_i_md_ro.
±rs
[j]]=='y')

75 
f
='y';

76 
±r
=
buc_i_md_ro
.
±rs
[
j
];

77 
dum
='n';

78 
glob®_j
=
j
;

82 if(
f
=='y')

83  
±r
;

84 
j
=0;j<
Z
+
S_o
;j++)

86 if(
buc_i_md_ro
.
addr
[
j
]==
DUMMY_BLOCK_ADDR
 && buc_i_md_ro.
v®ids
[buc_i_md_ro.
±rs
[j]]=='y')

88 
±r
=
buc_i_md_ro
.
±rs
[
j
];

89 
dum
='y';

90 
glob®_j
=
j
;

94  
±r
;

95 
	}
}

97 
	$di¥Ïy_·ge_cÚ‹Ás_¬r
(*
a
)

99 
i
=0;i<
RISCV_PAGE_SIZE
;i++)

101 
	`´štf
("0x%lx ",
a
[
i
] );

103 
	}
}

105 
	$»ad_·th
(* 
¶
,
ušŒ_t
 
a
,*
»td©as
)

110 if(
block_m­
[
a
]!=-1)

112 
buc_i_md_ro
ğ
Œ“_rÜam_md
[
block_m­
[
a
]];

113 
dum
='y';

114 
ušt8_t
 
off£t
=
	`g‘_block_off£t
(
a
);

115 
ušŒ_t
 
·¿ms
[2];

116 
·¿ms
[0]=(
ušŒ_t
)
block_m­
[
a
];

117 
·¿ms
[1]=(
ušŒ_t
)
off£t
;

118 
	`memıy
Ğ(*)(&
blk_i_d_ro
è,(*)&(
Œ“_rÜam_Œ“_tİ
[
·¿ms
[0]].
blocks
[·¿ms[1]]), (
Block_rÜam
) );

120 
buc_i_md_ro
.
v®ids
[
off£t
]='n';

121 
	`memıy
((*)
»td©as
, (*)(
blk_i_d_ro
.
d©a
), 
RISCV_PAGE_SIZE
);

122 
gdum
='n';

123 
Œ“_rÜam_md
[
block_m­
[
a
]]=
buc_i_md_ro
;

125 
block_m­
[
a
]=-1;

132 
i
=
CACHING_LEVEL
;i<=
L
;i++)

134 
buc_i_md_ro
ğ
Œ“_rÜam_md
[
¶
[
i
]];

135 
dum
='y';

136 
ušt8_t
 
off£t
=
	`g‘_block_off£t
(
a
);

137 
ušŒ_t
 
·¿ms
[2];

138 
·¿ms
[0]=(
ušŒ_t
)
¶
[
i
];

139 
·¿ms
[1]=(
ušŒ_t
)
off£t
;

140 
ušŒ_t
 
time_»ad_beg
=0,
time_»ad_’d
=0;

143 if(
CACHING_LEVEL
==0 || 
i
>(CACHING_LEVEL-1))

146 
edge_d©a_t
 
»td©a
;

148 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_beg
));

150 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_RORAM_READ_BLOCK
,(*)
·¿ms
,(
ušŒ_t
)*2, &
»td©a
,(retdata),0);

151 
	`hªdË_cİy_äom_sh¬ed
((*)&
blk_i_d_ro
,
»td©a
.
off£t
,»td©a.
size
);

152 
·ges_»ad
++;

155 ifĞ
Œ“_rÜam_md
[
¶
[
i
]].
addr
[
glob®_j
]!=
DUMMY_BLOCK_ADDR
 ||»e_rÜam_md[¶[i]].
is_hash
[global_j]=='y')

157 
hash_ÿlc
[
HASH_SIZE
];

158 
sha3_ùx_t
 
sha3
;

159 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

160 
c
[16];

161 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

162 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

163 
	`sha3_upd©e
(&
sha3
, (*)&(
blk_i_d_ro
.
add»ss
), (
ušŒ_t
)*2);

164 
	`sha3_upd©e
(&
sha3
, (*)
blk_i_d_ro
.
d©a
, 
RISCV_PAGE_SIZE
);

165 
	`sha3_upd©e
(&
sha3
, (*)
blk_i_d_ro
.
iv
, 
AES_KEYLEN
);

167 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

168 
c2
[16];

169 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

170 
hash_ÿlc2
[
HASH_SIZE
];

171 
sha3_ùx_t
 
sha32
;

172 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

173 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

174 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

175 
	`sha3_fš®
((*)
hash_ÿlc2
, &
sha32
);

177 ifĞ(
Œ“_rÜam_md
[
¶
[
i
]].
addr
[
glob®_j
]!=
DUMMY_BLOCK_ADDR
 ||»e_rÜam_md[¶[i]].
is_hash
[glob®_j]=='y'è&& !
	`check_hashes
Ğ(*)
hash_ÿlc2
 ,
HASH_SIZE
, (*)
blk_i_d_ro
.
p_hash
 ,HASH_SIZE ) )

179 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed. Fatalƒrror\n");

180 
	`sbi_ex™_’şave
(-1);

216 ifĞ
Œ“_rÜam_md
[
¶
[
i
]].
addr
[
glob®_j
]!=
DUMMY_BLOCK_ADDR
)

217 
	`deüy±_·ge
((
ušt8_t
 *è&(
blk_i_d_ro
.
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)blk_i_d_ro.
iv
);

221 ifĞ
Œ“_rÜam_md
[
¶
[
i
]].
addr
[
glob®_j
]!=
DUMMY_BLOCK_ADDR
)

224 if(
cÚfid’tŸl™y
)

226 
	`deüy±_·ge
((
ušt8_t
 *è
blk_i_d_ro
.
d©a
,
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)blk_i_d_ro.
iv
);

230 ifĞ
Œ“_rÜam_md
[
¶
[
i
]].
addr
[
glob®_j
]!=
DUMMY_BLOCK_ADDR
)

233 
»®_·ges_»ad
++;

234 if(
v”siÚ_numb”s
[
	`v²
(
blk_i_d_ro
.
add»ss
)] !ğblk_i_d_ro.
v”siÚ
)

236 
	`´štf
("[runtime] Page corrupted(Possibly‡„eplay‡ttack). Fatalƒrror\n");

237 
	`sbi_ex™_’şave
(-1);

242 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_’d
));

243 
ušŒ_t
 
time_»ad
=
time_»ad_’d
-
time_»ad_beg
;

244 ifĞ
Œ“_rÜam_md
[
¶
[
i
]].
addr
[
glob®_j
]!=
DUMMY_BLOCK_ADDR
)

247 if(
»®_·ges_»ad
<=
BLOCKS_FOR_TIME_COUNTING
)

248 
time_rblocks_´oûss_r
+=
time_»ad
;

252 if((
·ges_»ad
-
»®_·ges_»ad
)<=
BLOCKS_FOR_TIME_COUNTING
)

253 
time_dblocks_´oûss_r
+=
time_»ad
;

260 if(
dum
=='n')

263 
	`memıy
Ğ(*)(&
blk_i_d_ro
è,(*)&(
Œ“_rÜam_Œ“_tİ
[
·¿ms
[0]].
blocks
[·¿ms[1]]), (
Block_rÜam
) );

266 
buc_i_md_ro
.
v®ids
[
off£t
]='n';

267 
	`memıy
((*)
»td©as
, (*)(
blk_i_d_ro
.
d©a
), 
RISCV_PAGE_SIZE
);

268 
gdum
='n';

269 
Œ“_rÜam_md
[
¶
[
i
]]=
buc_i_md_ro
;

283 if(
CACHING_LEVEL
==0 || 
i
>(CACHING_LEVEL-1) )

285 
buc_i_md_ro
.
v®ids
[
off£t
]='n';

288 if(
dum
=='n')

290 
	`memıy
((*)
»td©as
, (*)(
blk_i_d_ro
.
d©a
), 
RISCV_PAGE_SIZE
);

291 
gdum
='n';

294 if(
CACHING_LEVEL
==0 || 
i
>(CACHING_LEVEL-1))

296 
buc_i_md_ro
.
couÁ
++;

299 
Œ“_rÜam_md
[
¶
[
i
]]=
buc_i_md_ro
;

301 
	}
}

303 
	$rÜam_wr™ebuck‘
(
šdexoá»e
)

305 
ušŒ_t
 
_šdexoá»e
=(ušŒ_t)
šdexoá»e
;

306 
i
=0;i<
Z
+
S_o
;i++)

310 
time_»ad_beg
=0,
time_»ad_’d
=0;

311 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_beg
));

312 
cc
='d';

315 
	`¹_ut_g‘¿ndom
((*è(*
buc_i_d_ro
).
blocks
[
i
].
iv
, 
AES_KEYLEN
);

317 if((*
buc_i_d_ro
).
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

319 
v”siÚ_numb”s
[ 
	`v²
((*
buc_i_d_ro
).
blocks
[
i
].
add»ss
)]++;

320 (*
buc_i_d_ro
).
blocks
[
i
].
v”siÚ
=
v”siÚ_numb”s
[ 
	`v²
((*buc_i_d_ro).blocks[i].
add»ss
)];

321 
cc
='r';

323 if((*
buc_i_d_ro
).
blocks
[
i
].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

325 if(
cÚfid’tŸl™y
)

327 
	`’üy±_·ge
Ğ(
ušt8_t
 *è(*
buc_i_d_ro
).
blocks
[
i
].
d©a
,
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)(*buc_i_d_ro).blocks[i].
iv
);

332 
cc
='d';

334 if(
cÚfid’tŸl™y
)

336 
	`fl_·ge_w™h_z”Ûs
((*
buc_i_d_ro
).
blocks
[
i
].
d©a
);

346 
	`’üy±_·ge
Ğ(
ušt8_t
 *è&((*
buc_i_d_ro
).
blocks
[
i
].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)(*buc_i_d_ro).blocks[i].
iv
);

356 if(
cc
=='r')

358 
hash_ÿlc
[
HASH_SIZE
];

359 
sha3_ùx_t
 
sha3
;

360 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

361 
c
[16];

362 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

363 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

364 
	`sha3_upd©e
(&
sha3
, (*)&((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
i
]].
add»ss
), (
ušŒ_t
)*2);

365 
	`sha3_upd©e
(&
sha3
, (*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
i
]].
d©a
, 
RISCV_PAGE_SIZE
);

366 
	`sha3_upd©e
(&
sha3
, (*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
i
]].
iv
, 
AES_KEYLEN
);

368 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

369 
c2
[16];

370 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

371 
sha3_ùx_t
 
sha32
;

372 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

373 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

374 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

375 
	`sha3_fš®
((*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
i
]].
p_hash
, &
sha32
);

379 
chachªÚûs
[16];

380 
	`¹_ut_g‘¿ndom
((*è
chachªÚûs
, 16);

381 
	`chacha20
((
ušt8_t
*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
i
]].
p_hash
, (ušt8_t*)(*buc_i_d_ro).blocks[buc_i_md_ro.±rs[i]].p_hash, 
HASH_SIZE
, (ušt8_t*)
key_chacha
, (ušt8_t*)
chachªÚûs
, 1);

386 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_’d
));

387 
ušŒ_t
 
time_»ad
=
time_»ad_’d
-
time_»ad_beg
;

388 ifĞ
cc
=='r')

390 if(
»®_·ges_wr™‹n
<=
BLOCKS_FOR_TIME_COUNTING
)

391 
time_rblocks_´oûss_w
+=
time_»ad
;

395 if((
·ges_wr™‹n
-
»®_·ges_wr™‹n
)<=
BLOCKS_FOR_TIME_COUNTING
)

396 
time_dblocks_´oûss_w
+=
time_»ad
;

401 
time_»ad_beg
=0,
time_»ad_’d
=0;

403 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_beg
));

404 
	`memıy
((*)
buff
, (*)&
_šdexoá»e
,(
ušŒ_t
));

407 
	`memıy
((*)(
buff
+(
ušŒ_t
)), (*)
buc_i_d_ro
,(
Buck‘_rÜam
));

410 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_RORAM_WRITE_BUCKET
,(*)
buff
, (
ušŒ_t
)+ (
Buck‘_rÜam
),
NULL
, 0,0);

413 
·ges_wr™‹n
+=(
Z
+
S_o
);

414 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_’d
));

416 
time_block_cİy_w
ğ((
time_»ad_’d
-
time_»ad_beg
)>>6);

418 
	}
}

420 
	$£¬ch_š_¡ash
(
a
,* 
»td©a
)

441 
	`as£¹
(
a
>=1 &&‡ < 
MALLOC_SIZE
);

442 
i
ğ
¡ash_loc
[
a
];

443 
	`as£¹
((
ušŒ_t
)
i
>=0 && (ušŒ_t)˜< 
STASH_SIZE_RORAM
);

444 if(
i
==-1)

446 
	`memıy
((*)
»td©a
,(*)
S_rÜam
[
i
].
d©a
,
RISCV_PAGE_SIZE
);

447 
S_rÜam
[
i
].
add»ss
=
DUMMY_BLOCK_ADDR
;

449 
	`as£¹
((
ušŒ_t
)
i
>=0 && (ušŒ_t)˜< 
STASH_SIZE_RORAM
);

450 if(
	`’que2
((
ušŒ_t
)
i
)!=
ENQUE_SUCCESS
)

452 
	`´štf
("[roram] free index insertion failed\n");

455 
	`as£¹
(
a
>=1 &&‡ < 
MALLOC_SIZE
);

456 
¡ash_loc
[
a
]=-1;

462 
	}
}

464 
	$add_to_¡ash
(
a
,* 
»td©a
)

485 
i
ğ()
	`deque2
();i=i;

489 
	`as£¹
(
i
>=0 && i < 
STASH_SIZE_RORAM
);

490 
	`memıy
((*)
S_rÜam
[
i
].
d©a
,(*)
»td©a
,
RISCV_PAGE_SIZE
);

491 
S_rÜam
[
i
].
add»ss
=(
a
<<
RISCV_PAGE_BITS
);

492 
	`as£¹
(
a
>=1 &&‡ < 
MALLOC_SIZE
);

493 
¡ash_loc
[
a
]=
i
;

494 
sum_¡ash_occ
++;

497 
	}
}

499 
	$»ad_buck‘_rÜam
(
buc_šdex
)

501 
cz
=0;

502 
j
=0;j<
Z
+
S_o
 && 
cz
<Z;j++)

504 if(
buc_i_md_ro
.
v®ids
[buc_i_md_ro.
±rs
[
j
]]=='y' && buc_i_md_ro.
addr
[j]!=
DUMMY_BLOCK_ADDR
)

506 
ušŒ_t
 
·¿ms
[2];

507 
·¿ms
[0]=(
ušŒ_t
)
buc_šdex
;

508 
·¿ms
[1]=(
ušŒ_t
)
buc_i_md_ro
.
±rs
[
j
];

509 
edge_d©a_t
 
»td©a
;

512 
ušŒ_t
 
time_»ad_beg
=0,
time_»ad_’d
=0;

513 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_beg
));

517 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_RORAM_READ_BLOCK
,(*)
·¿ms
,(
ušŒ_t
)*2, &
»td©a
,(retdata),0);

518 
	`hªdË_cİy_äom_sh¬ed
((*)&
blk_i_d_ro
,
»td©a
.
off£t
,»td©a.
size
);

519 
·ges_»ad
++;

521 
hash_ÿlc
[
HASH_SIZE
];

522 
sha3_ùx_t
 
sha3
;

523 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

524 
c
[16];

525 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

526 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

527 
	`sha3_upd©e
(&
sha3
, (*)&(
blk_i_d_ro
.
add»ss
), (
ušŒ_t
)*2);

528 
	`sha3_upd©e
(&
sha3
, (*)
blk_i_d_ro
.
d©a
, 
RISCV_PAGE_SIZE
);

529 
	`sha3_upd©e
(&
sha3
, (*)
blk_i_d_ro
.
iv
, 
AES_KEYLEN
);

531 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

532 
c2
[16];

533 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

534 
hash_ÿlc2
[
HASH_SIZE
];

535 
sha3_ùx_t
 
sha32
;

536 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

537 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

538 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

539 
	`sha3_fš®
((*)
hash_ÿlc2
, &
sha32
);

540 if(!
	`check_hashes
Ğ(*)
hash_ÿlc2
 ,
HASH_SIZE
, (*)
blk_i_d_ro
.
p_hash
 ,HASH_SIZE ) )

542 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed. Fatalƒrror\n");

543 
	`sbi_ex™_’şave
(-1);

546 
	`deüy±_·ge
((
ušt8_t
 *è&(
blk_i_d_ro
.
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)blk_i_d_ro.
iv
);

548 if(
blk_i_d_ro
.
add»ss
!=
DUMMY_BLOCK_ADDR
)

550 if(
cÚfid’tŸl™y
)

552 
	`deüy±_·ge
((
ušt8_t
 *è
blk_i_d_ro
.
d©a
,
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)blk_i_d_ro.
iv
);

556 ifĞ
blk_i_d_ro
.
add»ss
!=
DUMMY_BLOCK_ADDR
)

558 
»®_·ges_»ad
++;

559 if(
v”siÚ_numb”s
[
	`v²
(
blk_i_d_ro
.
add»ss
)] !ğblk_i_d_ro.
v”siÚ
)

561 
	`´štf
("[runtime] Page corrupted(Possibly‡„eplay‡ttack). Fatalƒrror\n");

562 
	`sbi_ex™_’şave
(-1);

567 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_’d
));

568 
ušŒ_t
 
time_»ad
=
time_»ad_’d
-
time_»ad_beg
;

569 ifĞ
blk_i_d_ro
.
add»ss
!=
DUMMY_BLOCK_ADDR
)

571 if(
»®_·ges_»ad
<=
BLOCKS_FOR_TIME_COUNTING
)

572 
time_rblocks_´oûss_r
+=
time_»ad
;

576 if((
·ges_»ad
-
»®_·ges_»ad
)<=
BLOCKS_FOR_TIME_COUNTING
)

577 
time_dblocks_´oûss_r
+=
time_»ad
;

582 
	`add_to_¡ash
(
	`v²
(
buc_i_md_ro
.
addr
[
j
]),
blk_i_d_ro
.
d©a
);

583 
cz
++;

586 
j
=0;j<
Z
+
S_o
 && 
cz
<Z;j++)

588 if(
buc_i_md_ro
.
v®ids
[buc_i_md_ro.
±rs
[
j
]]=='y' && buc_i_md_ro.
addr
[j]==
DUMMY_BLOCK_ADDR
)

590 
ušŒ_t
 
·¿ms
[2];

591 
·¿ms
[0]=(
ušŒ_t
)
buc_šdex
;

592 
·¿ms
[1]=(
ušŒ_t
)
buc_i_md_ro
.
±rs
[
j
];

593 
edge_d©a_t
 
»td©a
;

594 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_RORAM_READ_BLOCK
,(*)
·¿ms
,(
ušŒ_t
)*2, &
»td©a
,(retdata),0);

595 
	`hªdË_cİy_äom_sh¬ed
((*)&
blk_i_d_ro
,
»td©a
.
off£t
,»td©a.
size
);

596 
·ges_»ad
++;

597 
cz
++;

600 if(
buc_i_md_ro
.
is_hash
[
j
]=='y')

602 
hash_ÿlc
[
HASH_SIZE
];

603 
sha3_ùx_t
 
sha3
;

604 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

605 
c
[16];

606 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

607 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

608 
	`sha3_upd©e
(&
sha3
, (*)&(
blk_i_d_ro
.
add»ss
), (
ušŒ_t
)*2);

609 
	`sha3_upd©e
(&
sha3
, (*)
blk_i_d_ro
.
d©a
, 
RISCV_PAGE_SIZE
);

610 
	`sha3_upd©e
(&
sha3
, (*)
blk_i_d_ro
.
iv
, 
AES_KEYLEN
);

612 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

613 
c2
[16];

614 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

615 
hash_ÿlc2
[
HASH_SIZE
];

616 
sha3_ùx_t
 
sha32
;

617 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

618 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

619 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

620 
	`sha3_fš®
((*)
hash_ÿlc2
, &
sha32
);

621 if(!
	`check_hashes
Ğ(*)
hash_ÿlc2
 ,
HASH_SIZE
, (*)
blk_i_d_ro
.
p_hash
 ,HASH_SIZE ) )

623 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed. Fatalƒrror\n");

624 
	`sbi_ex™_’şave
(-1);

630 
	}
}

632 
	$PRP
(
ušt8_t
* 
¬r
, 
n
)

636 
i
=0;i<
n
;i++)

641 
¿nd_num
=0;

644 
r
: 
	`¹_ut_g‘¿ndom
(&
¿nd_num
,());

647 if(
¿nd_num
<0)

648 
¿nd_num
=rand_num*-1;

653 
¿nd_num
=
i
+„ªd_num%(
n
-i);

657 if(
¿nd_num
 < 
i
)

659 
	`´štf
("[ruÁime]†š%d\n",
__LINE__
 );

660 
r
;

662 
ušt8_t
 
‹mp
 =
¬r
[
i
];

665 
¬r
[
i
]÷¼[
¿nd_num
];

668 
¬r
[
¿nd_num
]=
‹mp
;

675 
	}
}

677 
	$wr™e_buck‘_rÜam
(
buc_šdex
,
Ëv–
)

679 
cz
=0;

680 
¶j
[50];

681 
S_rÜam
[3].
add»ss
=S_roram[3].address;

682 
ušŒ_t
 
»®_blocks_sÿÂed
=0;

685 
ušŒ_t
 
qs_cur
=
	`g‘_q_size2
();

688 
num_·ges_hashed
=0;

689 
ušŒ_t
 
»®_Ëá_š_¡ash
=
STASH_SIZE_RORAM
-
qs_cur
;

690 
j
=0;j<
STASH_SIZE_RORAM
 && 
cz
<
Z
 && 
»®_blocks_sÿÂed
 < 
»®_Ëá_š_¡ash
;j++)

694 if(
S_rÜam
[
j
].
add»ss
!=
DUMMY_BLOCK_ADDR
)

698 
»®_blocks_sÿÂed
++;

701 
	`pxg‘
(
pos™iÚ
[
	`v²
(
S_rÜam
[
j
].
add»ss
)],
¶j
);

704 if(
¶j
[
Ëv–
]==
buc_šdex
)

706 (*
tmp_buc_d
).
blocks
[
cz
]=
S_rÜam
[
j
];

709 
buc_i_md_ro
.
addr
[
cz
]=
S_rÜam
[
j
].
add»ss
;

710 
¡ash_loc
[
	`v²
(
S_rÜam
[
j
].
add»ss
)]=-1;

712 
buc_i_md_ro
.
is_hash
[
cz
]='y';

713 
num_·ges_hashed
++;

719 if(
CACHING_LEVEL
!=0 && 
Ëv–
<=(CACHING_LEVEL-1))

723 
block_m­
[
	`v²
(
S_rÜam
[
j
].
add»ss
)]=
buc_šdex
;

728 
S_rÜam
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

732 
	`as£¹
((
ušŒ_t
)
j
>=0 && (ušŒ_t)j < 
STASH_SIZE_RORAM
);

733 if(
	`’que2
((
ušŒ_t
)
j
)!=
ENQUE_SUCCESS
)

735 
	`´štf
("[roram] free index insertion failed\n");

739 
cz
++;

743 
cz
<
Z
+
S_o
)

747 (*
tmp_buc_d
).
blocks
[
cz
].
add»ss
=
DUMMY_BLOCK_ADDR
;

750 
buc_i_md_ro
.
addr
[
cz
]=
DUMMY_BLOCK_ADDR
;

752 if(
num_·ges_hashed
<
MIN_HASH_NUM
)

754 
buc_i_md_ro
.
is_hash
[
cz
]='y';

755 
num_·ges_hashed
++;

759 
buc_i_md_ro
.
is_hash
[
cz
]='n';

764 
cz
++;

766 
k
=0;k<
Z
+
S_o
;k++)

770 
buc_i_md_ro
.
±rs
[
k
]=k;

778 
	`PRP
(
buc_i_md_ro
.
±rs
,
Z
+
S_o
);

783 if(
CACHING_LEVEL
==0 || 
Ëv–
>(CACHING_LEVEL-1))

786 
j
=0;j<
Z
+
S_o
;j++)

790 (*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]]ğ(*
tmp_buc_d
).blocks[j];

794 
ušŒ_t
 
time_»ad_beg
=0,
time_»ad_’d
=0;

797 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_beg
));

800 
cc
='d';

803 
	`¹_ut_g‘¿ndom
((*è(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
iv
, 
AES_KEYLEN
);

808 if((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

812 
»®_·ges_wr™‹n
++;

814 
v”siÚ_numb”s
[ 
	`v²
((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
add»ss
)]++;

817 (*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
v”siÚ
=
v”siÚ_numb”s
[ 
	`v²
((*buc_i_d_ro).blocks[buc_i_md_ro.±rs[j]].
add»ss
)];

822 if((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
add»ss
!=
DUMMY_BLOCK_ADDR
 )

824 
cc
='r';

825 if(
cÚfid’tŸl™y
)

827 
	`’üy±_·ge
Ğ(
ušt8_t
 *è(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
d©a
,
RISCV_PAGE_SIZE
,
key
,(ušt8_ˆ*)(*buc_i_d_ro).blocks[buc_i_md_ro.±rs[j]].
iv
);

832 
cc
='d';

836 if(
cÚfid’tŸl™y
)

838 
	`fl_·ge_w™h_z”Ûs
((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
d©a
);

848 
	`’üy±_·ge
Ğ(
ušt8_t
 *è&((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
add»ss
),(
ušŒ_t
)*2,
key
,(ušt8_ˆ*)(*buc_i_d_ro).blocks[buc_i_md_ro.±rs[j]].
iv
);

850 if(
cc
=='r' || 
buc_i_md_ro
.
is_hash
[
j
]=='y')

852 
hash_ÿlc
[
HASH_SIZE
];

853 
sha3_ùx_t
 
sha3
;

854 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

855 
c
[16];

856 
	`xÜ_İ
((*)
key_hmac
,(*)
z2
,
c
,
AES_KEYLEN
);

857 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

858 
	`sha3_upd©e
(&
sha3
, (*)&((*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
add»ss
), (
ušŒ_t
)*2);

859 
	`sha3_upd©e
(&
sha3
, (*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
d©a
, 
RISCV_PAGE_SIZE
);

860 
	`sha3_upd©e
(&
sha3
, (*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
iv
, 
AES_KEYLEN
);

862 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

863 
c2
[16];

864 
	`xÜ_İ
((*)
key_hmac
,(*)
z1
,
c2
,
AES_KEYLEN
);

865 
sha3_ùx_t
 
sha32
;

866 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

867 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

868 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

869 
	`sha3_fš®
((*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
p_hash
, &
sha32
);

873 
chachªÚûs
[16];

874 
	`¹_ut_g‘¿ndom
((*è
chachªÚûs
, 16);

875 
	`chacha20
((
ušt8_t
*)(*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]].
p_hash
, (ušt8_t*)(*buc_i_d_ro).blocks[buc_i_md_ro.±rs[j]].p_hash, 
HASH_SIZE
, (ušt8_t*)
key_chacha
, (ušt8_t*)
chachªÚûs
, 1);

881 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_’d
));

884 
ušŒ_t
 
time_»ad
=
time_»ad_’d
-
time_»ad_beg
;

885 ifĞ
cc
=='r')

887 if(
»®_·ges_wr™‹n
<=
BLOCKS_FOR_TIME_COUNTING
)

888 
time_rblocks_´oûss_w
+=
time_»ad
;

894 if((
·ges_wr™‹n
-
»®_·ges_wr™‹n
)<=
BLOCKS_FOR_TIME_COUNTING
)

895 
time_dblocks_´oûss_w
+=
time_»ad
;

905 
buc_i_md_ro
.
couÁ
=0;

906 
k
=0;k<
Z
+
S_o
;k++)

910 
buc_i_md_ro
.
v®ids
[
k
]='y';

916 
Œ“_rÜam_md
[
buc_šdex
]=
buc_i_md_ro
;

919 
ušŒ_t
 
_šdexoá»e
 = (ušŒ_t)
buc_šdex
;

923 if(
CACHING_LEVEL
==0 || 
Ëv–
>(CACHING_LEVEL-1))

925 
time_»ad_beg
=0,
time_»ad_’d
=0;

926 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_beg
));

929 
	`memıy
((*)
buff
, (*)&
_šdexoá»e
,(
ušŒ_t
));

932 
	`memıy
((*)(
buff
+(
ušŒ_t
)), (*)(
buc_i_d_ro
),(
Buck‘_rÜam
));

935 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_RORAM_WRITE_BUCKET
,(*)
buff
, (
ušŒ_t
)+ (
Buck‘_rÜam
),
NULL
, 0,0);

938 
·ges_wr™‹n
+=(
Z
+
S_o
);

940 
asm
 vŞ©("rdcyş%0" : "ô" (
time_»ad_’d
));

943 
time_block_cİy_w
ğ((
time_»ad_’d
-
time_»ad_beg
)>>6);

950 
j
=0;j<
Z
+
S_o
;j++)

954 (*
buc_i_d_ro
).
blocks
[
buc_i_md_ro
.
±rs
[
j
]]ğ(*
tmp_buc_d
).blocks[j];

961 
	`memıy
Ğ(*)(
Œ“_rÜam_Œ“_tİ
+
_šdexoá»e
),(*)(
buc_i_d_ro
),(
Buck‘_rÜam
) );

969 
	}
}

971 
	$»ad_buck‘_rÜam_äom_š‹º®
(
buc_šdex
)

973 
cz
=0;

974 
j
=0;j<
Z
+
S_o
 && 
cz
<Z;j++)

976 if(
buc_i_md_ro
.
v®ids
[buc_i_md_ro.
±rs
[
j
]]=='y' && buc_i_md_ro.
addr
[j]!=
DUMMY_BLOCK_ADDR
)

978 
ušŒ_t
 
·¿ms
[2];

979 
·¿ms
[0]=(
ušŒ_t
)
buc_šdex
;

980 
·¿ms
[1]=(
ušŒ_t
)
buc_i_md_ro
.
±rs
[
j
];

982 
	`memıy
Ğ(*)(&
blk_i_d_ro
è,(*)&(
Œ“_rÜam_Œ“_tİ
[
·¿ms
[0]].
blocks
[·¿ms[1]]), (
Block_rÜam
) );

983 
	`add_to_¡ash
(
	`v²
(
buc_i_md_ro
.
addr
[
j
]),
blk_i_d_ro
.
d©a
);

985 
block_m­
[
	`v²
(
buc_i_md_ro
.
addr
[
j
])]=-1;

986 
cz
++;

1005 
	}
}

1007 
	$—¾y_»shufæe
(* 
¶
)

1009 
i
=0;i<=
L
;i++)

1011 if(
Œ“_rÜam_md
[
¶
[
i
]].
couÁ
>=
S_o
)

1013 
buc_i_md_ro
ğ
Œ“_rÜam_md
[
¶
[
i
]];

1014 if(
CACHING_LEVEL
==0 || 
i
>(CACHING_LEVEL-1))

1016 
	`»ad_buck‘_rÜam
(
¶
[
i
]);

1020 
	`»ad_buck‘_rÜam_äom_š‹º®
(
¶
[
i
]);

1023 
	`upd©e_max_¡ash_occ
();

1024 
	`wr™e_buck‘_rÜam
(
¶
[
i
],i);

1025 
buc_i_md_ro
.
couÁ
=0;

1026 
Œ“_rÜam_md
[
¶
[
i
]].
couÁ
=0;

1029 
	}
}

1031 
	$eviù_·th
()

1033 
¶
[50];

1036 
l
ğ
G
%(()
	`pow
(
ARITY
,
L
));

1038 
G
=G+1;

1041 
	`pxg‘
(
l
,
¶
);

1044 
i
=0;i<=
L
;i++)

1048 
buc_i_md_ro
ğ
Œ“_rÜam_md
[
¶
[
i
]];

1051 if(
CACHING_LEVEL
==0 || 
i
>(CACHING_LEVEL-1))

1055 
	`»ad_buck‘_rÜam
(
¶
[
i
]);

1063 
	`»ad_buck‘_rÜam_äom_š‹º®
(
¶
[
i
]);

1070 
	`upd©e_max_¡ash_occ
();

1074 
i
=
L
;i>=0;i--)

1076 
buc_i_md_ro
ğ
Œ“_rÜam_md
[
¶
[
i
]];

1079 
	`wr™e_buck‘_rÜam
(
¶
[
i
],i);

1082 
buc_i_md_ro
.
couÁ
=0;

1085 
Œ“_rÜam_md
[
¶
[
i
]]=
buc_i_md_ro
;

1090 
	}
}

1092 
ušŒ_t
 
	$g‘_¡ash_couÁ
()

1103  (
STASH_SIZE_RORAM
-
	`g‘_q_size2
());

1104 
	}
}

1107 
	$acûss_rÜam
(
İ
, 
a
, *
d©a¡¬
, *
»t_·g
,
ex‹nsiÚ
)

1109 
Üam_acc
++;

1112 if(
Üam_acc
%100==0)

1114 
	`´štf
("[RO]Ü_acğ%lu MSO=%lu cur_Soğ%lu ",
Üam_acc
,
max_¡ash_occ
,
	`g‘_¡ash_couÁ
());

1117 if(
max_¡ash_occ
>=
STASH_SIZE_RORAM
-200)

1119 
	`´štf
("[RORAM] STASH OVERFLOW WITH VALUE OF STASH %lu\n",
max_¡ash_occ
 );

1120 
	`sbi_ex™_’şave
(-1);

1121 
	`g‘_¡ash_couÁ
()>600)

1123 
	`eviù_·th
();

1127 if(
fœ¡im—cûss
[
a
]=='y' || (
exc
==1 && 
İ
=='w'))

1129 if(
fœ¡im—cûss
[
a
]=='y')

1131 
pos™iÚ
[
a
]=
	`UnifÜmRªdom
();

1132 
fœ¡im—cûss
[
a
]='n';

1135 
	`add_to_¡ash
(
a
,
d©a¡¬
);

1138 
ušŒ_t
 
l
=
pos™iÚ
[
a
];

1140 
pos™iÚ
[
a
]ğ
	`UnifÜmRªdom
();

1147 *
»td©a
;

1148 if(
»t_·g
==
NULL
)

1150 
»td©a
=
rd
;

1154 
»td©a
=
»t_·g
;

1158 
¶
[50];

1160 
	`pxg‘
(
l
,
¶
);

1163 
gdum
='y';

1165 
	`»ad_·th
(
¶
,
a
,(*)
»td©a
);

1168 
	`upd©e_max_¡ash_occ
();

1171 if(
gdum
=='y')

1173 
	`£¬ch_š_¡ash
(
a
,
»td©a
);

1177 if(
İ
=='r')

1182 if(
exc
==0)

1186 
	`add_to_¡ash
(
a
,
»td©a
);

1189 
	`upd©e_max_¡ash_occ
();

1194 if(
İ
=='w')

1198 
	`memıy
((*)
»td©a
,(*)
d©a¡¬
,
RISCV_PAGE_SIZE
);

1201 
	`add_to_¡ash
(
a
,
»td©a
);

1204 
	`upd©e_max_¡ash_occ
();

1212 
round
 = (round +1 )%
A
;

1213 if(
round
==0)

1217 
	`eviù_·th
();

1223 
	`—¾y_»shufæe
(
¶
);

1226 
	}
}

1229 
	$š™Ÿlize_rÜam
()

1232 
N
=
RORAM_TREE_SIZE
;

1233 
Z
=33;

1234 
L
=3;

1235 
S_o
=31;

1236 
A
=31;

1256 
round
=0;

1257 
buc_i_d_ro
=(
Buck‘_rÜam
 *)
	`m®loc
((Bucket_roram));

1258 
tmp_buc_d
=(
Buck‘_rÜam
 *)
	`m®loc
((Bucket_roram));

1260 
	`¹_ut_g‘¿ndom
((*è
key
, 
AES_KEYLEN
);

1261 
	`¹_ut_g‘¿ndom
((*è
key_hmac
, 
AES_KEYLEN
);

1262 
	`¹_ut_g‘¿ndom
((*è
z1
, 
AES_KEYLEN
);

1263 
	`¹_ut_g‘¿ndom
((*è
z2
, 
AES_KEYLEN
);

1264 
	`´štf
("[RING_ORAM] INIT STARTED\r\n" );

1266 
i
=0;i<
MALLOC_SIZE
;i++)

1268 
fœ¡im—cûss
[
i
]='y';

1269 
v”siÚ_numb”s
[
i
]=0;

1270 
¡ash_loc
[
i
]=-1;

1271 
block_m­
[
i
]=-1;

1275 
buc_i_md_ro
.
couÁ
=0;

1276 
j
=0;j<
Z
+
S_o
;j++)

1278 (*
buc_i_d_ro
).
blocks
[
j
].
add»ss
=0;

1282 
i
=0;i<
N
;i++)

1284 
buc_i_md_ro
.
couÁ
=0;

1285 
Œ“_rÜam_md
[
i
]=
buc_i_md_ro
;

1286 
j
=0;j<
Z
+
S_o
;j++)

1288 (*
buc_i_d_ro
).
blocks
[
j
].
add»ss
=
DUMMY_BLOCK_ADDR
;

1289 (*
buc_i_d_ro
).
blocks
[
j
].
v”siÚ
=0;

1290 (*
buc_i_d_ro
).
blocks
[
j
].
d©a
[0]=0;

1291 
buc_i_md_ro
.
±rs
[
j
]=j;

1292 
buc_i_md_ro
.
v®ids
[
j
]='y';

1294 
Œ“_rÜam_md
[
i
]=
buc_i_md_ro
;

1296 if(
i
<
RORAM_TREE_TOP_SIZE
)

1308 
äÚt
=
»¬
=-1;

1309 
i
=0;i<
STASH_SIZE_RORAM
;i++)

1311 if(
	`’que2
((
ušŒ_t
)
i
)!=
ENQUE_SUCCESS
)

1313 
	`´štf
("çed fÜ %d\n",
i
 );

1328 
	`´štf
("[RING_ORAM] INIT DONE\r\n" );

1331 
	}
}

	@roram.h

1 
	~"¹_ut.h
"

4 
	#OCALL_RORAM_READ_BUCKET_METADATA
 19

	)

5 
	#OCALL_RORAM_READ_BLOCK
 20

	)

6 
	#OCALL_RORAM_READ_BUCKET
 21

	)

7 
	#OCALL_RORAM_WRITE_BUCKET_METADATA
 22

	)

8 
	#OCALL_RORAM_WRITE_BLOCK
 23

	)

9 
	#OCALL_RORAM_WRITE_BUCKET
 24

	)

11 
	#STASH_SIZE_RORAM
 9500

12 
	#RORAM_BUCKET_SIZE
 64

14 
	#RORAM_TREE_SIZE
 4400

15 

	)

16 
	#RORAM_TREE_TOP_SIZE
 20

17 

	)

18 
	#CACHING_LEVEL
 2

19 

	)

20 
	#MIN_HASH_NUM
 8

21 

	)

23 
	sBlock_rÜam


25 
ušŒ_t
 
	madd»ss
;

26 
ušŒ_t
 
	mv”siÚ
;

27 
	md©a
[
RISCV_PAGE_SIZE
];

28 
ušt8_t
 
	miv
[16];

29 
	mp_hash
[32];

30 } 
	tBlock_rÜam
;

33 
	sBuck‘_rÜam


35 
Block_rÜam
 
	mblocks
[
RORAM_BUCKET_SIZE
];

36 } 
	tBuck‘_rÜam
;

39 
	sBuck‘_rÜam_md


41 
ušŒ_t
 
	mcouÁ
;

42 
	mv®ids
[
RORAM_BUCKET_SIZE
];

43 
ušŒ_t
 
	maddr
[
RORAM_BUCKET_SIZE
];

45 
ušt8_t
 
	m±rs
[
RORAM_BUCKET_SIZE
];

48 
	mis_hash
[
RORAM_BUCKET_SIZE
];

49 } 
	tBuck‘_rÜam_md
;

51 
Buck‘_rÜam_md
 
buc_i_md_ro
;

54 
Block_rÜam
 
blk_i_d_ro
;

56 
Buck‘_rÜam
 *
buc_i_d_ro
;

60 
Block_rÜam
 *
	gS_rÜam
;

63 
S_rÜam_Ën
;

64 
Sg_rÜam_Ën
;

67 
Buck‘_rÜam_md
 *
	gS_rÜam_md
;

69 
A
;

70 
S_o
;

71 
G
;

72 
round
;

75 
Buck‘_rÜam_md
 *
	gŒ“_rÜam_md
;

77 
Buck‘_rÜam
 *
	gŒ“_rÜam_Œ“_tİ
;

79 
š™Ÿlize_rÜam
();

80 
acûss_rÜam
(
İ
, 
a
, *
d©a¡¬
, *
»t_buf
,
ex‹nsiÚ
);

	@rt_util.c

5 
	~"mm.h
"

6 
	~"¹_ut.h
"

7 
	~"´štf.h
"

8 
	~"¡ršg.h
"

9 
	~"sysÿÎ.h
"

10 
	~"m®loc.h
"

11 
	~"edge_ÿÎ.h
"

12 
	~"«ss.h
"

13 
	~"ssha3.h
"

14 
	~"Üam.h
"

15 
	~"İam.h
"

16 
	~"rÜam.h
"

17 
	~"ä“mem.h
"

18 
	~"vm.h
"

19 
	~"·ge_»¶aûm’t.h
"

20 
	~"m®loc.h
"

21 
	~"šdex_q.h
"

22 
	~"uacûss.h
"

23 
	~"š‹¼u±.h
"

24 
	~"wÜam.h
"

25 
	~"viùim_ÿche.h
"

27 
ušŒ_t
 
	g´ev_addr
=0;

28 
ušŒ_t
 *
	g´ev_addr_¡©us
=
NULL
;

29 
	g¥a
, 
	gä•
;

30 
	gfcc
=0;

33 
	#OCALL_GET_CONTENT_FROM_UTM
 8

	)

34 
	#OCALL_STORE_CONTENT_TO_UTM
 9

	)

35 
	#OCALL_GET_TESTING_PARAMS
 5

	)

36 
	#OCALL_STORE_CONTENT_TO_UTM_ENC_PFH
 18

	)

37 
	#OCALL_GET_CONTENT_FROM_UTM_ENC_PFH
 17

	)

38 
	#OCALL_PRINT_COUNTERS
 6

	)

40 
	#THRESHOLD_PAGES
 120000

	)

41 
	#INTERVAL
 40

	)

42 
ušŒ_t
 
	g®loc
=0;

43 
	#FULL_TRACE
 34

	)

46 
	#FULL_TRACE_CHUNK
 50

	)

48 
’şave_İtiÚs
 
	g¬gs_u£r
;

49 
ušŒ_t
 
	gbuff_size
;

50 
	gçuÉ_lim
;

52 
ušŒ_t
 
	gçuÉ_mode
;

53 
ušŒ_t
* 
	gŒaû_buff
;

54 
ušŒ_t
 
	gŒaû_buff_út
=0;

55 
ušŒ_t
 
	gtÙ®_Œaû_buff_út
=0;

56 
ušŒ_t
 
	gÜam_š™_time
=0;

57 
ušŒ_t
 
	gcİy_wa¡e
=0;

60 
	gfœ¡_çuÉ
=1;

61 
	gfœ¡_·ge_»¶aûm’t
 = 1;

62 
	g’abË_Üam
=1;

63 
	gcouÁ_ext
=0;

64 
	gcÚfid’tŸl™y
=1;

65 
	gauth’tiÿtiÚ
 =1;

66 
	gv_ÿche
=0;

67 
	gŒacšg
 =0;

68 
	gdebug
 =0;

69 
	gexc
=0;

70 
couÁ”
 
	gcouÁ”s
[
NO_OF_COUNTERS
];

71 
·ges_©
 
	gvic_·ge_©
;

72 
·ges_©
 
	gbrought_·ge_©
;

73 
·ges
 
	gvic_·ge
;

74 
·ges
 
	gbrought_·ge
;

75 *
	gbuff
;

76 *
	gbackup_sh¬ed_memÜy
;

78 
ušŒ_t
 
	g·ges_»ad
=0;

79 
ušŒ_t
 
	g»®_·ges_»ad
=0;

80 
ušŒ_t
 
	g·ges_wr™‹n
=0;

81 
ušŒ_t
 
	g»®_·ges_wr™‹n
=0;

82 
ušŒ_t
 
	gmax_¡ash_occ
=0;

83 
ušŒ_t
 
	gsum_¡ash_occ
=0;

84 
ušŒ_t
 
	gÜam_acc
=0;

85 
ušŒ_t
 
	gä“_·ges_ä
=0;

86 
ušŒ_t
 
	gš™_num_·ges
=0;

87 
	gcouÁpf
=0;

89 
ušŒ_t
 
	gtime_rblocks_´oûss_r
=0;

90 
ušŒ_t
 
	gtime_rblocks_´oûss_w
=0;

91 
ušŒ_t
 
	gtime_dblocks_´oûss_r
=0;

92 
ušŒ_t
 
	gtime_dblocks_´oûss_w
=0;

94 
ušŒ_t
 
	gtime_block_cİy_r
=0;

95 
ušŒ_t
 
	gtime_block_cİy_w
=0;

102 
ušt8_t
 
	gkey_chacha
[]={0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c,0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c};

104 
ušt8_t
 
	gkey_«s
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

105 
ušt8_t
 
	giv_«s
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

106 
ušt8_t
 
	gKey_hmac
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

107 
ušt8_t
 
	gz_1
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

108 
ušt8_t
 
	gz_2
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

109 
ušt8_t
 
	gkey
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

110 
ušt8_t
 
	gkey_hmac
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

111 
ušt8_t
 
	gz1
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

112 
ušt8_t
 
	gz2
[] = { 0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6, 0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c };

114 
	gsss
[30];

118 
	#THRESHOLD_OPS
 120000

	)

120 
ušŒ_t
 
	guÅÏûd_·ges_couÁ
=0;

125 
	g’cz”0
[
RISCV_PAGE_SIZE
]={0,};

126 
	gchachakey
[32];

127 
	gchachªÚû
[16];

129 
	g‹¡_Üg
[4096];

130 
	g‹¡_’c
[4096];

131 
	g‹¡_dec
[4096];

134 
	$fl_·ge_w™h_z”Ûs
(* 
·ge_addrs
)

142 
	`¹_ut_g‘¿ndom
((*è
chachªÚû
, 16);

144 
	`chacha20
((
ušt8_t
*)
·ge_addrs
, (ušt8_t*)
’cz”0
, 
RISCV_PAGE_SIZE
, (ušt8_t*)
key_chacha
, (ušt8_t*)
chachªÚû
, 1);

255 
	}
}

260 
	$pow
(
ušŒ_t
 
a
, ušŒ_ˆ
b
)

262 
»s
=1;

264 
i
=1;i<=
b
;i++)

266 
»s
ôes*()
a
;

269  
»s
;

270 
	}
}

274 
	$pxg‘
(
Ëafšdex
 , 
Px
[
ARRAY_SIZE
])

276 
Œ“šdex
 = 
Ëafšdex
 + (Ğ()Ğ
	`pow
(
ARITY
,
L
) )-1)/(ARITY-1));

277 
i
=0;

278 
Œ“šdex
>=0)

280 
Px
[
L
-
i
]=
Œ“šdex
;

282 
i
++;

283 
Œ“šdex
 = ()Ğ
	`û
ĞŒ“šdex/
ARITY
 ) -1 );

286 
	}
}

289 
	$UnifÜmRªdom
()

291 
lim™
ğ()Ğ
	`pow
(
ARITY
,
L
) );

292 
º
=0;

295 
	`¹_ut_g‘¿ndom
(&
º
,());

306  
º
%
lim™
;

307 
	}
}

310 
	$g‘_Œ“_šdex
(
x
)

313  
x
+ (Ğ()Ğ
	`pow
(
ARITY
,
L
) )-1)/(ARITY-1));

314 
	}
}

316 
	$log2
(
x
)

318 
couÁ
 =0;

319 
x
!=1)

321 
couÁ
++;

322 
x
=x/2;

324  
couÁ
;

325 
	}
}

327 
	$û
(
x
)

329 
t
 = ()Ğ()
x
);

330 if(
t
==
x
)

331  
t
;

333  
t
+1;

334 
	}
}

338 *
	gfœ¡im—cûss
;

351 
size_t
 
	$¹_ut_g‘¿ndom
(* 
vaddr
, 
size_t
 
buæ’
){

352 
size_t
 
»maššg
 = 
buæ’
;

353 
ušŒ_t
 
ºd
;

354 
ušŒ_t
* 
Ãxt
 = (ušŒ_t*)
vaddr
;

356 
»maššg
 > (
ušŒ_t
)){

357 
ºd
 = 
	`sbi_¿ndom
();

358 
	`ALLOW_USER_ACCESS
Ğ*
Ãxt
 = 
ºd
 );

359 
»maššg
 -ğ(
ušŒ_t
);

360 
Ãxt
++;

363 ifĞ
»maššg
 > 0 ){

364 
ºd
 = 
	`sbi_¿ndom
();

365 
	`cİy_to_u£r
(
Ãxt
, &
ºd
, 
»maššg
);

367 
size_t
 
»t
 = 
buæ’
;

368  
»t
;

369 
	}
}

375 
	$¹_ut_misc_çl
(){

377 
	`sbi_ex™_’şave
(-1);

378 
	}
}

380 
	$nÙ_im¶em’‹d_çl
(
’ş_ùx_t
* 
ùx
){

381 #ifdeà
FATAL_DEBUG


382 
addr
, 
ÿu£
, 
pc
;

383 
pc
 = 
ùx
->
»gs
.
£pc
;

384 
addr
 = 
ùx
->
sbadaddr
;

385 
ÿu£
 = 
ùx
->
sÿu£
;

386 
	`c¤_wr™e
(
s¡©us
, 
	`c¤_»ad
(sstatus) | 0x6000);

391 
	`´štf
("[ruÁime]‚Ú-hªdÏbË iÁ”ru±/exû±iÚ‡ˆ0x%lx oÀ0x%lx (sÿu£: 0x%lx)\r\n", 
pc
, 
addr
, 
ÿu£
);

392 
	`´štf
("[RUNITME] QUEUE CONTETNS\n" );

397 
asm
 volatile ("csrr‡0, scause\r\nli‡7, 1111\r\nƒcall");

399 
	}
}

402 
	$oÿÎ_g‘_·ge_cÚ‹Ás_äom_utm
(
edge_d©a_t
* 
»td©a
,
ušŒ_t
 
¬gs
){

403 
ušŒ_t
 
¬gs_
ğ
¬gs
;

404 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_GET_CONTENT_FROM_UTM
, &
¬gs_
, ×rgs_), 
»td©a
, (
edge_d©a_t
),0);

406 
	}
}

408 
	$oÿÎ_g‘_·ge_cÚ‹Ás_äom_utm_’c_pfh
(
edge_d©a_t
* 
»td©a
,
ušŒ_t
 
¬gs
){

409 
ušŒ_t
 
¬gs_
ğ
¬gs
;

410 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_GET_CONTENT_FROM_UTM_ENC_PFH
, &
¬gs_
, ×rgs_), 
»td©a
, (
edge_d©a_t
),0);

412 
	}
}

416 
	$oÿÎ_¡Üe_·ge_cÚ‹Ás_to_utm
(
edge_d©a_t
* 
»td©a
,
ušŒ_t
 
¬gs
){

419 
	`´štf
("[dispatch ocall]…kgstr =„etdata‡nd‡rgs = vic_page\n");

420 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_STORE_CONTENT_TO_UTM
, (*)
¬gs
, (
·ges
), 
»td©a
, (
edge_d©a_t
),0);

422 
	}
}

425 
	$oÿÎ_¡Üe_·ge_cÚ‹Ás_to_utm_’c_pfh
(
edge_d©a_t
* 
»td©a
,
ušŒ_t
 
¬gs
){

428 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_STORE_CONTENT_TO_UTM_ENC_PFH
, (*)
¬gs
, (
·ges_©
), 
NULL
, 0,0);

430 
	}
}

433 
	$di¥Ïy_·ge_cÚ‹Ás
(
ušŒ_t
 
¡¬t
)

435 
size_t
 
i
 = 0; i < (
RISCV_PAGE_SIZE
); i++) {

436 
	`´štf
("0x%lx ", (
ušŒ_t
è*(*)(
¡¬t
+
i
) );

438 
	`´štf
("\n" );

439 
	}
}

441 
	$ÿlcuÏ‹_hmac
(
·ges
* 
p
, * 
hm
, 
ušŒ_t
 
hm_Ën
)

443 
hash_ÿlc
[
HASH_SIZE
];

444 
sha3_ùx_t
 
sha3
;

445 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

446 
c
[16];

447 
	`xÜ_İ
((*)
Key_hmac
,(*)
z_2
,
c
,
AES_KEYLEN
);

448 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

449 
	`sha3_upd©e
(&
sha3
, (*)(*
p
).
d©a
, 
RISCV_PAGE_SIZE
);

450 
	`sha3_upd©e
(&
sha3
, (*)&((*
p
).
v”_num
), 2*(
ušŒ_t
));

452 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

453 
c2
[16];

454 
	`xÜ_İ
((*)
Key_hmac
,(*)
z_1
,
c2
,
AES_KEYLEN
);

455 
sha3_ùx_t
 
sha32
;

456 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

457 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

458 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

459 
	`sha3_fš®
((*)
hm
, &
sha32
);

460 
	}
}

462 
	$ÿlcuÏ‹_hmac_fÜ_’c_pfh
(
·ges_©
* 
p
, * 
hm
, 
ušŒ_t
 
hm_Ën
)

464 
hash_ÿlc
[
HASH_SIZE
];

465 
sha3_ùx_t
 
sha3
;

466 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

467 
c
[16];

468 
	`xÜ_İ
((*)
Key_hmac
,(*)
z_2
,
c
,
AES_KEYLEN
);

469 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

470 
	`sha3_upd©e
(&
sha3
, (*)(*
p
).
d©a
, 
RISCV_PAGE_SIZE
);

471 
	`sha3_upd©e
(&
sha3
, (*)&((*
p
).
add»ss
), 2*(
ušŒ_t
));

473 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

474 
c2
[16];

475 
	`xÜ_İ
((*)
Key_hmac
,(*)
z_1
,
c2
,
AES_KEYLEN
);

476 
sha3_ùx_t
 
sha32
;

477 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

478 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

479 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

480 
	`sha3_fš®
((*)
hm
, &
sha32
);

481 
	}
}

485 
	$´št_d‘as
()

489 
couÁ”s
[
PAGES_READ
].
couÁ
=
·ges_»ad
;

490 
couÁ”s
[
PAGES_WRITTEN
].
couÁ
=
·ges_wr™‹n
;

491 
couÁ”s
[
INIT_NUM_PAGES
].
couÁ
=
š™_num_·ges
;

492 
couÁ”s
[
PAGE_FAULT_COUNT
].
couÁ
=
couÁpf
;

493 
couÁ”s
[
FREE_PAGES_FR
].
couÁ
=
ä“_·ges_ä
;

494 
couÁ”s
[
EXTENSIONS
].
couÁ
=
couÁ_ext
;

495 
couÁ”s
[
TOTAL_PAGES
].
couÁ
=couÁ”s[
INIT_NUM_PAGES
].couÁ+couÁ”s[
EXTENSIONS
].count;

496 
couÁ”s
[
REAL_PAGES_READ
].
couÁ
=
·ges_»ad
;

497 
couÁ”s
[
REAL_PAGES_WRITTEN
].
couÁ
=
·ges_wr™‹n
;

498 
couÁ”s
[
ORAM_INIT
].
couÁ
=
Üam_š™_time
;

499 
couÁ”s
[
COPY_WASTE
].
couÁ
=
cİy_wa¡e
;

501 if(
’abË_Üam
==
OPAM
 ||’abË_Üam==
PATH_ORAM
 ||ƒÇbË_Üam==
RORAM
)

503 
couÁ”s
[
REAL_PAGES_READ
].
couÁ
=
»®_·ges_»ad
;

504 
couÁ”s
[
REAL_PAGES_WRITTEN
].
couÁ
=
»®_·ges_wr™‹n
;

505 
couÁ”s
[
DUMMY_PAGES_READ
].
couÁ
=couÁ”s[
PAGES_READ
].couÁ-couÁ”s[
REAL_PAGES_READ
].count;

506 
couÁ”s
[
DUMMY_PAGES_WRITTEN
].
couÁ
=couÁ”s[
PAGES_WRITTEN
].couÁ-couÁ”s[
REAL_PAGES_WRITTEN
].count;

507 
couÁ”s
[
MAX_STASH_OCC
].
couÁ
=
max_¡ash_occ
;

508 
couÁ”s
[
SUM_STASH_OCC
].
couÁ
=
sum_¡ash_occ
;

509 
couÁ”s
[
ORAM_ACC
].
couÁ
=
Üam_acc
;

515 
	`´štf
("\n----------------------------\n");

555 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_PRINT_COUNTERS
,
couÁ”s
,
NO_OF_COUNTERS
*(
couÁ”
),
NULL
,0,0);

558 
	}
}

560 
	$di¥Ïy_‹¡_·¿ms
()

562 if(
’abË_Üam
==
PATH_ORAM
)

563 
	`´štf
("[runtime] Oram Enabled " );

564 if(
cÚfid’tŸl™y
)

565 
	`´štf
("[runtime] Confidentiality Enabled " );

566 if(
auth’tiÿtiÚ
)

567 
	`´štf
("[runtime]‡uthentication Enabled " );

568 if(
Œacšg
)

569 
	`´štf
("[runtime]racing Enabled " );

571 
	}
}

573 
	$d•Ë‹_ä“_·ges_fÜ_‹¡šg
(
ušŒ_t
 
Ëá
)

575 
ušŒ_t
 
tÙ®_Ëá
=
	`¥a_avaabË
();

576 if(
Ëá
> 
tÙ®_Ëá
)

578 
i
=0;i<
tÙ®_Ëá
-
Ëá
;i++)

580 
ušŒ_t
 
da
=
	`¥a_g‘
();da=da;

581 
	`as£¹
(
da
 >ğ
ä“mem_va_¡¬t
 && d¨< (ä“mem_va_¡¬ˆ+ 
ä“mem_size
));

584 
	}
}

588 
	gsourût
[4096];

589 
	gde¡t
[4096];

590 
	gkey_‹¡šg
[
AES_KEYLEN
];

591 
	giv_‹¡šg
[16];

594 
	$do_som‘hšg_exŒa
()

596 
	`´štf
("startedƒxtra\r\n");

597 
	`¹_ut_g‘¿ndom
((*è
key_‹¡šg
, 
AES_KEYLEN
);

598 
	`¹_ut_g‘¿ndom
((*è
iv_‹¡šg
, 
AES_KEYLEN
);

599 
	`¹_ut_g‘¿ndom
((*è
key_hmac
, 
AES_KEYLEN
);

600 
	`¹_ut_g‘¿ndom
((*è
z_1
, 
AES_KEYLEN
);

601 
	`¹_ut_g‘¿ndom
((*è
z_2
, 
AES_KEYLEN
);

603 
	`¹_ut_g‘¿ndom
((*è
sourût
, 4096);

604 
	`¹_ut_g‘¿ndom
((*è
de¡t
, 4096);

606 
times
=1024;

609 
«s_’c_s
,
«s_’c_e
;

611 
asm
 vŞ©("rdcyş%0" : "ô" (
«s_’c_s
));

612 
i
=0;i< 
times
;i++)

614 
	`’üy±_·ge
((
ušt8_t
*)
sourût
,
RISCV_PAGE_SIZE
,(ušt8_t*)
key_‹¡šg
,(ušt8_t*)
iv_‹¡šg
);

617 
asm
 vŞ©("rdcyş%0" : "ô" (
«s_’c_e
));

618 
	`´štf
("encryppting‡es done\r\n");

623 
«s_dec_s
,
«s_dec_e
;

625 
asm
 vŞ©("rdcyş%0" : "ô" (
«s_dec_s
));

626 
i
=0;i< 
times
;i++)

628 
	`deüy±_·ge
((
ušt8_t
*)
sourût
,
RISCV_PAGE_SIZE
,(ušt8_t*)
key_‹¡šg
,(ušt8_t*)
iv_‹¡šg
);

631 
asm
 vŞ©("rdcyş%0" : "ô" (
«s_dec_e
));

632 
	`´štf
("decrypting‡es done\r\n");

639 
chacha_s
,
chacha_e
;

641 
asm
 vŞ©("rdcyş%0" : "ô" (
chacha_s
));

642 
i
=0;i< 
times
;i++)

644 
	`fl_·ge_w™h_z”Ûs
(
sourût
);

646 
asm
 vŞ©("rdcyş%0" : "ô" (
chacha_e
));

647 
	`´štf
("chacha done\r\n");

653 
cİy_s
,
cİy_e
;

655 
asm
 vŞ©("rdcyş%0" : "ô" (
cİy_s
));

656 
i
=0;i< 
times
;i++)

658 
	`memıy
((*)
sourût
,(*)
de¡t
,4096);

660 
asm
 vŞ©("rdcyş%0" : "ô" (
cİy_e
));

661 
	`´štf
("copying done\r\n");

668 
hmac_s
,
hmac_e
;

670 
asm
 vŞ©("rdcyş%0" : "ô" (
hmac_s
));

671 
i
=0;i< 
times
;i++)

673 
hash_ÿlc
[
HASH_SIZE
];

674 
sha3_ùx_t
 
sha3
;

675 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

676 
c
[16];

677 
	`xÜ_İ
((*)
key_hmac
,(*)
z_2
,
c
,
AES_KEYLEN
);

678 
	`sha3_upd©e
(&
sha3
, (*)
sourût
, 4096);

680 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

681 
c2
[16];

682 
	`xÜ_İ
((*)
key_hmac
,(*)
z_1
,
c2
,
AES_KEYLEN
);

683 
sha3_ùx_t
 
sha32
;

684 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

685 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

686 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

687 
	`sha3_fš®
((*)
de¡t
, &
sha32
);

690 
asm
 vŞ©("rdcyş%0" : "ô" (
hmac_e
));

691 
	`´štf
("hmac done\r\n");

697 
b™s
=10;

698 
«s_’c
ğ(
«s_’c_e
-
«s_’c_s
)>>
b™s
;

699 
«s_dec
=(
«s_dec_e
-
«s_dec_s
)>>
b™s
;

700 
chacha
=(
chacha_e
-
chacha_s
)>>
b™s
;

701 
cİy
=(
cİy_e
-
cİy_s
)>>
b™s
;

702 
hmac
=(
hmac_e
-
hmac_s
)>>
b™s
;

703 
	`´štf
("AFTER %dimes\n",
times
);

704 
	`´štf
("«s_’øğ%lu\n",
«s_’c
 );

705 
	`´štf
("«s_deøğ%lu\n", 
«s_dec
);

706 
	`´štf
("chach¨ğ%lu\n",
chacha
 );

707 
	`´štf
("cİy = %lu\n", 
cİy
);

708 
	`´štf
("hmaøğ%lu\n",
hmac
 );

709 
	`´štf
("PRINTED ALL STATS\n");

710 
	`sbi_ex™_’şave
(-1);

712 
	}
}

715 
ušŒ_t
 
	$g‘_ruÁime_addr
(
ušŒ_t
 
viùim_·ge_’c
)

717 
ušŒ_t
 *
roÙ_·ge_bË_addr
 = 
	`g‘_roÙ_·ge_bË_addr
();

718 
ušŒ_t
 *
±e
 = 
	`__w®k
(
roÙ_·ge_bË_addr
,
viùim_·ge_’c
);

719 
ušŒ_t
 
va_ruÁime
 = 
	`__va
ĞĞ(*
±e
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
);

720  
va_ruÁime
;

721 
	}
}

723 
wr™e_·ge_©_add»ss
(
ušŒ_t
,uintptr_t);

726 
	$wr™e_to_viùim_ÿche_hªdË_fuÎ
(
ušŒ_t
 
addr
, ušŒ_ˆ
»q_addr
)

730 
ušŒ_t
 
·ge_out
 = 
	`g‘_Ìu_viùim_äom_ÿche
();

731 if(
·ge_out
 >> 
RISCV_PAGE_BITS
 =ğ
»q_addr
 >> RISCV_PAGE_BITS)

734 
	`move_Ìu_to_mru_š_ÿche
();

735 
·ge_out
 = 
	`g‘_Ìu_viùim_äom_ÿche
();

737 
ušŒ_t
 
·ge_out_va
 = 
	`g‘_ruÁime_addr
(
·ge_out
);

746 
	`¡Üe_viùim_·ge_to_wÜam
(
·ge_out
, 
·ge_out_va
, 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
);

748 
·ges_wr™‹n
++;

753 
	`»move_Ìu_·ge_äom_ÿche
();

757 
	`ä“_·ge
(
	`v²
(
·ge_out
));

759 
	`´štf
("AVAILABLE IS %d\n",
	`¥a_avaabË
());

761 
	`move_·ge_to_ÿche_äom_’şave
(
addr
);

762 
	}
}

764 
	$£tup_keys_ªd_bufãr
()

766 
	`¹_ut_g‘¿ndom
((*è
key_«s
, 
AES_KEYLEN
);

767 
	`¹_ut_g‘¿ndom
((*è
iv_«s
, 
AES_KEYLEN
);

768 
	`¹_ut_g‘¿ndom
((*è
key_hmac
, 
AES_KEYLEN
);

769 
	`¹_ut_g‘¿ndom
((*è
z_1
, 
AES_KEYLEN
);

770 
	`¹_ut_g‘¿ndom
((*è
z_2
, 
AES_KEYLEN
);

772 
buff_size
=
BACKUP_BUFFER_SIZE_OTHERS
;

773 
buff
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_OTHERS
*());

775 if(
buff
==
NULL
)

777 
	`´štf
("[runtime] buff‡llocation failed\n" );

778 
	`sbi_ex™_’şave
(-1);

780 
backup_sh¬ed_memÜy
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_OTHERS
*());

782 if(
backup_sh¬ed_memÜy
==
NULL
)

784 
	`´štf
("[runtime] backup_shared_memory‡llocation failed\n" );

785 
	`sbi_ex™_’şave
(-1);

787 
	}
}

789 
	$®loÿ‹_äesh_·ge
(
ušŒ_t
 
Ãw_®loc_·ge
, ušŒ_ˆ*
¡©us_fšd_add»ss
)

792 
	`mem£t
((*)
Ãw_®loc_·ge
, 0, 
RISCV_PAGE_SIZE
);

794 
æags
 = 
PTE_D
|
PTE_A
 | 
PTE_V
| 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_L
 ;

795 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
((
ušŒ_t
)
Ãw_®loc_·ge
è), 
æags
 );

797 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

798 
	}
}

800 
	$£tup_·ge_çuÉ_hªdËr
(
ušŒ_t
 
addr
, ušŒ_ˆ*
¡©us_fšd_add»ss
)

802 
cyşes1
,
cyşes2
;

804 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes1
));

805 
	`¡rıy
(
sss
,"firstimeaccess");

806 
	`¹_ut_g‘¿ndom
((*è
key_chacha
, 32);

807 
	`¡rıy
(
sss
,"version_numbers");

809 
v”siÚ_numb”s
=(
ušŒ_t
*)
	`m®loc
(
MALLOC_SIZE
*(uintptr_t));

810 
Œaû_buff
=(
ušŒ_t
*)
	`m®loc
(
FULL_TRACE_CHUNK
*(uintptr_t));

812 if(
v”siÚ_numb”s
==
NULL
)

814 
	`´štf
("[runtime] version_numbers‡llocation failed\n" );

815 
	`sbi_ex™_’şave
(-1);

818 
i
=0;i<
NO_OF_COUNTERS
;i++)

819 
couÁ”s
[
i
].
couÁ
=0;

820 
·ges_»ad
=0;

821 
·ges_wr™‹n
=0;

822 
š™_num_·ges
=(
ušŒ_t
)
	`g‘_queue_size
();

823 
®loc
=
š™_num_·ges
;

825 
edge_d©a_t
 
pkg¡r
;

826 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_GET_TESTING_PARAMS
,
NULL
,0,&
pkg¡r
,(
edge_d©a_t
),(
ušŒ_t
)&
¬gs_u£r
);

828 
’abË_Üam
=
¬gs_u£r
.
·ge_çuÉ_hªdËr
;

829 
auth’tiÿtiÚ
=
¬gs_u£r
.
š‹gr™y_´ÙeùiÚ
;

830 
cÚfid’tŸl™y
=
¬gs_u£r
.confidentiality;

831 
ä“_·ges_ä
=
¬gs_u£r
.
num_ä“_·ges
;

832 
v_ÿche
=
¬gs_u£r
.
viùim_ÿche
;

833 
Œacšg
=
¬gs_u£r
.
·ge_addr_Œacšg
;

834 
debug
=
¬gs_u£r
.
debug_mode
;

835 
exc
=
¬gs_u£r
.
Œ“_exc
;

836 
çuÉ_lim
ğ
¬gs_u£r
.
çuÉ_lim™
;

837 
äame_size
=
ä“_·ges_ä
;

842 
	`¡rıy
(
couÁ”s
[
PAGES_READ
].
Çme
,"PAGES_READ");

843 
	`¡rıy
(
couÁ”s
[
PAGES_WRITTEN
].
Çme
,"PAGES_WRITTEN");

844 
	`¡rıy
(
couÁ”s
[
INIT_NUM_PAGES
].
Çme
,"INIT_NUM_PAGES");

845 
	`¡rıy
(
couÁ”s
[
PAGE_FAULT_COUNT
].
Çme
,"PAGE_FAULT_COUNT");

846 
	`¡rıy
(
couÁ”s
[
FREE_PAGES_FR
].
Çme
,"FREE_PAGES_FR");

847 
	`¡rıy
(
couÁ”s
[
EXTENSIONS
].
Çme
,"EXTENSIONS");

848 
	`¡rıy
(
couÁ”s
[
TOTAL_PAGES
].
Çme
,"TOTAL_PAGES");

849 
	`¡rıy
(
couÁ”s
[
REAL_PAGES_READ
].
Çme
,"REAL_PAGES_READ");

850 
	`¡rıy
(
couÁ”s
[
REAL_PAGES_WRITTEN
].
Çme
,"REAL_PAGES_WRITTEN");

851 
	`¡rıy
(
couÁ”s
[
DUMMY_PAGES_READ
].
Çme
,"DUMMY_PAGES_READ");

852 
	`¡rıy
(
couÁ”s
[
DUMMY_PAGES_WRITTEN
].
Çme
,"DUMMY_PAGES_WRITTEN");

853 
	`¡rıy
(
couÁ”s
[
MAX_STASH_OCC
].
Çme
,"MAX_STASH_OCC");

854 
	`¡rıy
(
couÁ”s
[
SUM_STASH_OCC
].
Çme
,"SUM_STASH_OCC");

855 
	`¡rıy
(
couÁ”s
[
ORAM_ACC
].
Çme
,"ORAM_ACC");

856 
	`¡rıy
(
couÁ”s
[
ORAM_INIT
].
Çme
,"ORAM_INIT");

858 if(
debug
)

859 
	`di¥Ïy_‹¡_·¿ms
();

860 
ušŒ_t
 
Ëá
 =
ä“_·ges_ä
-
š™_num_·ges
;†eft=left;

862 if(
debug
)

863 
	`´štf
("[ruÁime] f»·ge Ëá %lu\n",
	`¥a_avaabË
() );

864 if(
’abË_Üam
==
PATH_ORAM
)

870 
S
=(
Block
*)
	`m®loc
(
ORAM_STASH_SIZE
*(Block));

871 
Sg
=(
Block
*)
	`m®loc
(
ORAM_STASH_SIZE
*(Block));

873 
fœ¡im—cûss
=(*)
	`m®loc
(
MALLOC_SIZE
);

874 if(
fœ¡im—cûss
==
NULL
)

876 
	`´štf
("[runtime] firstimeaccess‡llocation failed\n" );

877 
	`sbi_ex™_’şave
(-1);

880 
pos™iÚ
=(
ušŒ_t
*)
	`m®loc
(
MALLOC_SIZE
*(uintptr_t));

881 if(
pos™iÚ
==
NULL
)

883 
	`´štf
("[runtime]…osition map‡llocation failed\n" );

884 
	`sbi_ex™_’şave
(-1);

886 
Œ“_po_md
=(
Buck‘_md
 *)
	`m®loc
(
ORAM_TREE_SIZE
*(Bucket_md));

887 if(
Œ“_po_md
==
NULL
)

889 
	`´štf
("[runtime]ree_po_md‡llocation failed\n" );

890 
	`sbi_ex™_’şave
(-1);

893 
buff_size
=
BACKUP_BUFFER_SIZE_ORAM
;

894 
buff
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_ORAM
*());

896 if(
buff
==
NULL
)

898 
	`´štf
("[runtime] buff‡llocation failed\n" );

899 
	`sbi_ex™_’şave
(-1);

901 
backup_sh¬ed_memÜy
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_ORAM
*());

903 if(
backup_sh¬ed_memÜy
==
NULL
)

905 
	`´štf
("[runtime] backup_shared_memory‡llocation failed\n" );

906 
	`sbi_ex™_’şave
(-1);

909 
ä“_šdiûs
=(
ušŒ_t
*)
	`m®loc
(
ORAM_STASH_SIZE
*(uintptr_t));

910 if(
ä“_šdiûs
==
NULL
)

912 
	`´štf
("[runtime] free_indices‡llocation failed\n" );

913 
	`sbi_ex™_’şave
(-1);

917 
¡ash_loc
=(*)
	`m®loc
(
MALLOC_SIZE
*(
ušŒ_t
));

918 if(
¡ash_loc
==
NULL
)

920 
	`´štf
("[runtime] stash_loc‡llocation failed\n" );

921 
	`sbi_ex™_’şave
(-1);

924 
	`š™®ize_Üam
();

927 if(
’abË_Üam
==
NO_ORAM
)

929 
	`´štf
("[runtime] First fault No ORAM. Allocating Buffer stuff\n");

931 
	`£tup_keys_ªd_bufãr
();

933 if(
’abË_Üam
==
ENC_PFH
)

935 
p_ivs
=(
iv_·ge
*)
	`m®loc
(
MALLOC_SIZE
*(iv_page));

936 if(
p_ivs
==
NULL
)

938 
	`´štf
("[runtime] knocked_page_addr‡llocation failed\n" );

939 
	`sbi_ex™_’şave
(-1);

941 
	`£tup_keys_ªd_bufãr
();

943 if(
’abË_Üam
==
OPAM
)

948 
S_İam_md
=(
Block_O·m_md
*)
	`m®loc
(
OPAM_STASH_SIZE
*(Block_Opam_md));

949 
fœ¡im—cûss
=(*)
	`m®loc
(
MALLOC_SIZE
);

950 if(
fœ¡im—cûss
==
NULL
)

952 
	`´štf
("[runtime] firstimeaccess‡llocation failed\n" );

953 
	`sbi_ex™_’şave
(-1);

956 
pos™iÚ
=(
ušŒ_t
*)
	`m®loc
(
MALLOC_SIZE
*(uintptr_t));

957 if(
pos™iÚ
==
NULL
)

959 
	`´štf
("[runtime]…osition map‡llocation failed\n" );

960 
	`sbi_ex™_’şave
(-1);

963 
buff_size
=
BACKUP_BUFFER_SIZE_OTHERS
;

965 
buff
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_OTHERS
*());

967 if(
buff
==
NULL
)

969 
	`´štf
("[runtime] buff‡llocation failed\n" );

970 
	`sbi_ex™_’şave
(-1);

972 
backup_sh¬ed_memÜy
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_OTHERS
*());

974 if(
backup_sh¬ed_memÜy
==
NULL
)

976 
	`´štf
("[runtime] backup_shared_memory‡llocation failed\n" );

977 
	`sbi_ex™_’şave
(-1);

981 
	`š™Ÿlize_İam
();

989 if(
’abË_Üam
==
RORAM
)

994 
S_rÜam
=(
Block_rÜam
*)
	`m®loc
(
STASH_SIZE_RORAM
*(Block_roram));

995 if(
S_rÜam
==
NULL
)

997 
	`´štf
("[runtime] S_roram‡llocation failed\n" );

998 
	`sbi_ex™_’şave
(-1);

1002 
S_rÜam_md
=(
Buck‘_rÜam_md
*)
	`m®loc
(
STASH_SIZE_RORAM
*(Bucket_roram_md));

1003 if(
S_rÜam_md
==
NULL
)

1005 
	`´štf
("[runtime] S_roram_md‡llocation failed\n" );

1006 
	`sbi_ex™_’şave
(-1);

1010 
Œ“_rÜam_md
=(
Buck‘_rÜam_md
*)
	`m®loc
(
RORAM_TREE_SIZE
*(Bucket_roram_md));

1011 if(
Œ“_rÜam_md
==
NULL
)

1013 
	`´štf
("[runtime]ree_roram_md‡llocation failed\n" );

1014 
	`sbi_ex™_’şave
(-1);

1018 
Œ“_rÜam_Œ“_tİ
=(
Buck‘_rÜam
*)
	`m®loc
(
RORAM_TREE_TOP_SIZE
*(Bucket_roram));

1019 if(
Œ“_rÜam_Œ“_tİ
==
NULL
)

1021 
	`´štf
("[runtime]ree_roram_tree_top‡llocation failed\n" );

1022 
	`sbi_ex™_’şave
(-1);

1027 
fœ¡im—cûss
=(*)
	`m®loc
(
MALLOC_SIZE
);

1028 if(
fœ¡im—cûss
==
NULL
)

1030 
	`´štf
("[runtime] firstimeaccess‡llocation failed\n" );

1031 
	`sbi_ex™_’şave
(-1);

1034 
pos™iÚ
=(
ušŒ_t
*)
	`m®loc
(
MALLOC_SIZE
*(uintptr_t));

1035 if(
pos™iÚ
==
NULL
)

1037 
	`´štf
("[runtime]…osition map‡llocation failed\n" );

1038 
	`sbi_ex™_’şave
(-1);

1041 
ä“_šdiûs
=(
ušŒ_t
*)
	`m®loc
(
STASH_SIZE_RORAM
*(uintptr_t));

1042 if(
ä“_šdiûs
==
NULL
)

1044 
	`´štf
("[runtime] free_indices‡llocation failed\n" );

1045 
	`sbi_ex™_’şave
(-1);

1050 
¡ash_loc
=(*)
	`m®loc
(
MALLOC_SIZE
*(
ušŒ_t
));

1051 if(
¡ash_loc
==
NULL
)

1053 
	`´štf
("[runtime] stash_loc‡llocation failed\n" );

1054 
	`sbi_ex™_’şave
(-1);

1057 
block_m­
=(*)
	`m®loc
(
MALLOC_SIZE
*());

1058 if(
block_m­
==
NULL
)

1060 
	`´štf
("[runtime] block_map‡llocation failed\n" );

1061 
	`sbi_ex™_’şave
(-1);

1065 
buff_size
=
BACKUP_BUFFER_SIZE_RORAM
;

1067 
buff
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_RORAM
*());

1069 if(
buff
==
NULL
)

1071 
	`´štf
("[runtime] buff‡llocation failed\n" );

1072 
	`sbi_ex™_’şave
(-1);

1074 
backup_sh¬ed_memÜy
=(*)
	`m®loc
(
BACKUP_BUFFER_SIZE_RORAM
*());

1076 if(
backup_sh¬ed_memÜy
==
NULL
)

1078 
	`´štf
("[runtime] backup_shared_memory‡llocation failed\n" );

1079 
	`sbi_ex™_’şave
(-1);

1081 
	`š™Ÿlize_rÜam
();

1084 if(
’abË_Üam
 =ğ
WORAM
)

1086 
	`´štf
("[runtime] First fault WORAM. Allocating buffer stuff\n");

1087 
	`£tup_keys_ªd_bufãr
();

1088 
	`š™Ÿlize_wÜam_¬¿y
();

1089 
	`£tup_key_ut™›s
(
key_chacha
,
key_«s
,
iv_«s
,
Key_hmac
,
z_1
,
z_2
,
key
,
key_hmac
,
z1
,
z2
);

1090 
	`´štf
("[ruÁime] viùim cachÚ/ofà%zd\n", 
v_ÿche
);

1093 
fœ¡_çuÉ
=0;

1094 
asm
 vŞ©("rdcyş%0" : "ô" (
cyşes2
));

1095 
Üam_š™_time
=
cyşes2
-
cyşes1
;

1096 
	}
}

1101 
	$wr™e_·ge_©_add»ss
(
ušŒ_t
 
addr
, ušŒ_ˆ
äom
){

1102 
ušŒ_t
 
utm
 = 
sh¬ed_bufãr
 + 1048*1048;

1104 
	`memıy
((*)(
utm
+
addr
), (*)
äom
, 
RISCV_PAGE_SIZE
);

1105 
	}
}

1110 
	$»ad_·ge_äom
(
ušŒ_t
 
addr
, ušŒ_ˆ
to
)

1112 
ušŒ_t
 
utm
 = 
sh¬ed_bufãr
 + 1048*1048;

1114 
	`memıy
((*)
to
, (*)(
utm
 + 
addr
), 
RISCV_PAGE_SIZE
);

1115 
	}
}

1118 
	$kick_viùim
(
ušŒ_t
 
addr
, ušŒ_ˆ*
çuÉšgPagePTE
){

1119 
ušŒ_t
 
viùim
 = 
	`»move_viùim_·ge
();

1121 
ušŒ_t
 
vicPageEnc
 = 
pİ_™em
[1];

1122 
ušŒ_t
 
vicPageVA
=0;

1123 if(
viùim
 !ğ
QUEUE_EMPTY
)

1125 
ušŒ_t
 *
viùimPTE
 = 
	`__w®k
(
	`g‘_roÙ_·ge_bË_addr
(),
vicPageEnc
);

1128 if(
v_ÿche
){

1130 if(
fœ¡_·ge_»¶aûm’t
){

1131 
	`š™Ÿlize_viùim_ÿche
();

1132 
fœ¡_·ge_»¶aûm’t
=0;

1134 if(
	`is_viùim_ÿche_fuÎ
()){

1136 
	`wr™e_to_viùim_ÿche_hªdË_fuÎ
(
vicPageEnc
, 
addr
);

1140 
	`move_·ge_to_ÿche_äom_’şave
(
vicPageEnc
);

1143 *
viùimPTE
 = (*viùimPTEè& ~
PTE_V
;

1144 
	`´štf
("AVAILABLE IS %d\n",
	`¥a_avaabË
());

1150 
vicPageVA
 = 
	`g‘_ruÁime_addr
(
vicPageEnc
);

1152 
	`¡Üe_viùim_·ge_to_wÜam
(
vicPageEnc
, 
vicPageVA
, 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
);

1154 
	`ä“_·ge
(
	`v²
(
vicPageEnc
));

1156 
	`´štf
("AVAILABLE IS %d\n",
	`¥a_avaabË
());

1157 *
viùimPTE
 = (*viùimPTEè& ~
PTE_V
;

1160 
	`´štf
("[RUNTIME]: Could‚ot find‡ victim. Exiting");

1161 
	`sbi_ex™_’şave
(-1);

1164 
	}
}

1166 
	$sim¶•agšg
(
ušŒ_t
 
addr
, ušŒ_ˆ*
çuÉšgPagePTE
){

1167 
ušŒ_t
 
cu¼’t_q_size
=0;

1168 
cu¼’t_q_size
=(
ušŒ_t
)
	`g‘_queue_size
();

1169 if(
fœ¡_çuÉ
)

1172 
	`£tup_·ge_çuÉ_hªdËr
(
addr
, 
çuÉšgPagePTE
);

1173 
	`´štf
("[RUNTIME]: SETUP PAGE FAULT DONE!\n");

1175 if(
çuÉšgPagePTE
==0)

1176 
çuÉšgPagePTE
=
	`__w®k
(
	`g‘_roÙ_·ge_bË_addr
(),
addr
);

1178 ià(
çuÉšgPagePTE
== 0){

1179 
	`´štf
("[RUNTIME]: Could‚ot„esolve…te. Exitingƒnclave.");

1180 
	`sbi_ex™_’şave
(-1);

1182 if(!((*
çuÉšgPagePTE
è& 
PTE_L
)){

1183 
	`´štf
("[RUNTIME]: Illegal Access. Exiting");

1184 
	`sbi_ex™_’şave
(-1);

1191 
viùim_·ge_»£rved
 =0;

1192 ià(
v_ÿche
)

1193 
viùim_·ge_»£rved
=
MAX_VICTIM_CACHE_PAGES
;

1196 ià(
cu¼’t_q_size
 + 
š™_num_·ges
 + 
viùim_·ge_»£rved
>ğ
ä“_·ges_ä
){

1199 
	`kick_viùim
(
addr
,
çuÉšgPagePTE
);

1202 if(
v_ÿche
 && !
fœ¡_·ge_»¶aûm’t
 && 
	`is_š_viùim_ÿche
(
addr
)){

1203 
	`move_·ge_to_’şave_äom_ÿche
(
addr
);

1204 *
çuÉšgPagePTE
 = *çuÉšgPagePTE | 
PTE_V
;

1205 
ušŒ_t
 
luckyPageVA
 = 
	`__va
(((*
çuÉšgPagePTE
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
);

1206 if(
	`¶aû_Ãw_·ge
(
luckyPageVA
, 
	`v²
(
addr
)<<
RISCV_PAGE_BITS
)!=
ENQUE_SUCCESS
){

1207 
	`´štf
("[runtime] Page„eplacement queue full. Can't handle. \n" );

1208 
	`sbi_ex™_’şave
(-1);

1213 
	`´štf
("AVAILABLE IS %d\n",
	`¥a_avaabË
());

1214 
ušŒ_t
 
Ãw·ge
 = 
	`¥a_g‘
();

1215 if(
	`¶aû_Ãw_·ge
Ğ
Ãw·ge
,
	`v²
(
addr
)<<
RISCV_PAGE_BITS
 )!=
ENQUE_SUCCESS
){

1216 
	`´štf
("[runtime] Page„eplacement queue full. Can't handle. \n" );

1217 
	`sbi_ex™_’şave
(-1);

1221 if(((*
çuÉšgPagePTE
)>>
PTE_PPN_SHIFT
)==0){

1222 
	`®loÿ‹_äesh_·ge
(
Ãw·ge
, 
çuÉšgPagePTE
);

1225 
	`g‘_·ge_äom_wÜam
(
addr
, 
Ãw·ge
, 
çuÉšgPagePTE
, 
çuÉ_mode
, 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
);

1227 
	}
}

1235 
	$hªdË_·ge_çuÉ
(
ušŒ_t
 
addr
, ušŒ_ˆ*
¡©us_fšd_add»ss
)

1237 
	`´štf
("[ruÂtimeX] HªdË PagFauÉ c®Ëd fÜ‡dd¸0x%zx\n", 
addr
);

1239 
	`sim¶•agšg
(
addr
,
¡©us_fšd_add»ss
);

1244 
	`´štf
("[RUNTIME] HªdË PagFauÉ c®Ëd fÜ‡dd¸0x%zx\n", 
addr
);

1245 if(
fœ¡_çuÉ
)

1247 
	`£tup_·ge_çuÉ_hªdËr
(
addr
, 
¡©us_fšd_add»ss
);

1250 
ušŒ_t
 *
roÙ_·ge_bË_addr
 = 
	`g‘_roÙ_·ge_bË_addr
();

1251 if(
¡©us_fšd_add»ss
==0)

1252 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
addr
);

1254 if(
¡©us_fšd_add»ss
==0)

1256 
	`´štf
("[runtime] Unmapped‡ddress. Fatalƒrror. Exiting.\n");

1257 
	`sbi_ex™_’şave
(-1);

1260 ifĞ(*
¡©us_fšd_add»ss
è& 
PTE_L
 )

1262 
couÁpf
++;

1263 
ušŒ_t
 
sourû_·ge_VA
=(*
¡©us_fšd_add»ss
)>>
PTE_PPN_SHIFT
;

1264 
’abË_sw­_out
 = 1;enable_swap_out=enable_swap_out;

1265 
th»shŞd_numb”_of_·ges
=650000;threshold_number_of_pages=threshold_number_of_pages;

1266 
ušŒ_t
 
cu¼’t_q_size
=0;

1267 
cu¼’t_q_size
=(
ušŒ_t
)
	`g‘_queue_size
();

1271 
ušŒ_t
 
®loÿ‹d_·ges_couÁ
ğ130560+300 - 
	`¥a_avaabË
()+6500-
š™_num_·ges
-6000;allocated_pages_count=allocated_pages_count;

1273 
viùim_ÿche_assigÃd_·ges
 = 0;

1274 if(
v_ÿche
è
viùim_ÿche_assigÃd_·ges
 = 
MAX_VICTIM_CACHE_PAGES
;

1275 if(
cu¼’t_q_size
 + 
š™_num_·ges
 + 
viùim_ÿche_assigÃd_·ges
 >=
ä“_·ges_ä
)

1278 if(
fœ¡_·ge_»¶aûm’t
 == 1)

1281 
fœ¡_·ge_»¶aûm’t
 = 0;

1282 if(
v_ÿche
)

1283 
	`š™Ÿlize_viùim_ÿche
();

1285 
ušŒ_t
 
viùim
 = 
	`»move_viùim_·ge
();

1287 
ušŒ_t
 
viùim_·ge_’c
=
pİ_™em
[1];

1288 
ušŒ_t
 
viùim_·ge_Üg
=0;

1289 if(
viùim
 !ğ
QUEUE_EMPTY
)

1292 
ušŒ_t
 
¡Üed_viùim_·ge_addr
=1;

1293 
ušŒ_t
 *
¡©us_fšd_±e_viùim
 = 
	`__w®k
(
roÙ_·ge_bË_addr
,
viùim_·ge_’c
);

1294 
viùim_·ge_Üg
=
	`__va
ĞĞ(*
¡©us_fšd_±e_viùim
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
);

1295 
viùim_·ge_dœty
 = 1;

1296 ifĞĞ(*
¡©us_fšd_±e_viùim
è& 
PTE_D
 ) || 
’abË_Üam
==
OPAM
 ||ƒÇbË_Üam==
ENC_PFH
 || ( (
exc
==1è&& (’abË_Üam==
PATH_ORAM
 ||ƒÇbË_Üam==
RORAM
 ) ) )

1301 if(
debug
)

1302 
	`´štf
("[ruÁime]‡dd¸ğ0x%lx dœty\n",
viùim_·ge_’c
 );

1303 if(
’abË_Üam
==
NO_ORAM
)

1306 
·ges_wr™‹n
++;

1307 
edge_d©a_t
 
pkg¡r
;

1308 
vic_·ge
.
add»ss
=
viùim_·ge_’c
;

1309 
	`memıy
((*)
vic_·ge
.
d©a
,(*)
viùim_·ge_Üg
,
RISCV_PAGE_SIZE
 );

1311 
v”siÚ_numb”s
[
	`v²
(
viùim_·ge_’c
)]++;

1313 
vic_·ge
.
v”_num
=
v”siÚ_numb”s
[
	`v²
(
viùim_·ge_’c
)];

1314 if(
cÚfid’tŸl™y
)

1316 
	`’üy±_·ge
((
ušt8_t
*)
vic_·ge
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
key_«s
,(ušt8_t*)
iv_«s
);

1317 
	`’üy±_·ge
((
ušt8_t
*)&
vic_·ge
.
v”_num
,2*(
ušŒ_t
),(ušt8_t*)
key_«s
,(ušt8_t*)
iv_«s
);

1319 if(
auth’tiÿtiÚ
)

1321 
	`ÿlcuÏ‹_hmac
(&
vic_·ge
,vic_·ge.
hmac
,
HASH_SIZE
);

1323 
	`oÿÎ_¡Üe_·ge_cÚ‹Ás_to_utm
((*)&
pkg¡r
,(
ušŒ_t
)&
vic_·ge
);

1324 
	`hªdË_cİy_äom_sh¬ed
((*)&
¡Üed_viùim_·ge_addr
,
pkg¡r
.
off£t
,pkg¡r.
size
);

1327 if(
’abË_Üam
==
ENC_PFH
)

1329 
·ges_wr™‹n
++;

1330 
edge_d©a_t
 
pkg¡r
;

1331 
	`memıy
((*)
vic_·ge_©
.
d©a
,(*)
viùim_·ge_Üg
,
RISCV_PAGE_SIZE
 );

1332 
vic_·ge_©
.
add»ss
=
	`v²
(
viùim_·ge_’c
)<<
RISCV_PAGE_BITS
;

1333 
vic_·ge_©
.
dummy
=0;

1334 
v”siÚ_numb”s
[
	`v²
(
viùim_·ge_’c
)]++;

1335 
	`¹_ut_g‘¿ndom
((*è
p_ivs
[
	`v²
(
viùim_·ge_’c
)].
iv
, 
AES_KEYLEN
);

1336 if(
cÚfid’tŸl™y
)

1338 
	`’üy±_·ge
((
ušt8_t
*)
vic_·ge_©
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
key_«s
,(ušt8_t*è
p_ivs
[
	`v²
(
viùim_·ge_’c
)].
iv
);

1340 
	`’üy±_·ge
((
ušt8_t
*)&
vic_·ge_©
.
add»ss
,2*(
ušŒ_t
),(ušt8_t*)
key_«s
,(ušt8_t*)
p_ivs
[
	`v²
(
viùim_·ge_’c
)].
iv
);

1341 
	`ÿlcuÏ‹_hmac_fÜ_’c_pfh
(&
vic_·ge_©
,vic_·ge_©.
hmac
,
HASH_SIZE
);

1342 
	`oÿÎ_¡Üe_·ge_cÚ‹Ás_to_utm_’c_pfh
((*)&
pkg¡r
,(
ušŒ_t
)&
vic_·ge_©
);

1343 if(
Œacšg
 && (
·ges_wr™‹n
+
·ges_»ad
)>
THRESHOLD_OPS
)

1345 
	`sbi_ex™_’şave
(-1);

1349 if(
’abË_Üam
==
PATH_ORAM
)

1351 
	`acûss
('w',
	`v²
(
viùim_·ge_’c
),(*)
	`__va
ĞĞ(*
¡©us_fšd_±e_viùim
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
),
NULL
,0);

1353 if(
’abË_Üam
==
OPAM
)

1355 
sucûss
=0;

1356 
ušŒ_t
 
ç_út
=0;

1357 
ff
: 
sucûss
=
	`acûss_İam
('w',
	`v²
(
viùim_·ge_’c
),(*)
	`__va
ĞĞ(*
¡©us_fšd_±e_viùim
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
),
NULL
,0);

1360 if(!
sucûss
)

1362 
	`¶aû_Ãw_·ge
Ğ
viùim_·ge_Üg
,
viùim_·ge_’c
);

1363 
ç_út
++;

1364 if(
ç_út
>=(
	`g‘_queue_size
()-3))

1366 
	`»m­_®l
();

1367 
ç_út
=0;

1369 
viùim
 = 
	`»move_viùim_·ge
();

1371 
viùim_·ge_’c
=
pİ_™em
[1];

1372 
¡©us_fšd_±e_viùim
 = 
	`__w®k
(
roÙ_·ge_bË_addr
,
viùim_·ge_’c
);

1373 
viùim_·ge_Üg
=
	`__va
ĞĞ(*
¡©us_fšd_±e_viùim
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
);

1374 
ff
;

1376 if(
Œacšg
 && ( (
»®_·ges_wr™‹n
+
»®_·ges_»ad
)>
THRESHOLD_OPS
 ) )

1378 
	`sbi_ex™_’şave
(-1);

1383 if(
’abË_Üam
==
RORAM
)

1385 
	`acûss_rÜam
('w',
	`v²
(
viùim_·ge_’c
),(*)
	`__va
ĞĞ(*
¡©us_fšd_±e_viùim
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
),
NULL
,0);

1386 if(
Œacšg
 && (
·ges_wr™‹n
+
·ges_»ad
)>
THRESHOLD_OPS
)

1388 
	`sbi_ex™_’şave
(-1);

1392 if(
’abË_Üam
==
WORAM
)

1409 if(
v_ÿche
)

1411 
is_fuÎ
 = 
	`is_viùim_ÿche_fuÎ
();

1412 
	`´štf
("[ruÁime] CachfuÎ? %d\n", 
is_fuÎ
);

1414 if(
is_fuÎ
)

1415 
	`wr™e_to_viùim_ÿche_hªdË_fuÎ
(
viùim_·ge_’c
, 
addr
);

1417 
	`move_·ge_to_ÿche_äom_’şave
(
viùim_·ge_’c
);

1418 
	`´štf
("[ruÁime] Inv®id©šg„•Ïûd…ag0x%zx -> 0x%zx", 
viùim_·ge_’c
, *
¡©us_fšd_±e_viùim
);

1419 *
¡©us_fšd_±e_viùim
 = *¡©us_fšd_±e_viùim & ~
PTE_V
;

1420 
	`´štf
("[ruÁime] Aá” inv®id©iÚ„•Ïûd…ag0x%zx -> 0x%zx", 
viùim_·ge_’c
, *
¡©us_fšd_±e_viùim
);

1425 
	`¡Üe_viùim_·ge_to_wÜam
(
viùim_·ge_’c
, 
viùim_·ge_Üg
, 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
);

1426 
·ges_wr™‹n
++;

1433 
viùim_·ge_dœty
 = 0;

1435 if(
debug
)

1437 
	`´štf
("[ruÁime]‡dd¸ğ0x%lx(0x%lxèNOT dœty\n",
viùim_·ge_’c
 ,
viùim_·ge_Üg
);

1438 
	`´štf
("[ruÁime] didn'ˆknock‡dd¸0x%lx(0x%lx)\n", 
viùim_·ge_’c
,
viùim_·ge_Üg
);

1442 iàĞ
’abË_Üam
 =ğ
WORAM
 && (!
v_ÿche
 || !
viùim_·ge_dœty
))

1455 
	`ä“_·ge
(
	`v²
(
viùim_·ge_’c
));

1456 
®loc
--;

1459 ifĞ
’abË_Üam
 !ğ
WORAM
)

1461 
	`ä“_·ge
(
	`v²
(
viùim_·ge_’c
));

1462 
®loc
--;

1463 *
¡©us_fšd_±e_viùim
 = (
¡Üed_viùim_·ge_addr
 << 
PTE_PPN_SHIFT
è| (
PTE_D
| 
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_L
);

1467 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1472 
	`´štf
("[runtime] Page„eplacement queueƒmpty. Can't handle. \n" );

1473 
	`sbi_ex™_’şave
(-1);

1489 if(
v_ÿche
 && !
fœ¡_·ge_»¶aûm’t
)

1491 
ÿche_h™
 = 
	`is_š_viùim_ÿche
(
addr
);

1492 
	`´štf
("[ruÁime] Add¸0x%zx i š viùim cache? %d\n", 
addr
, 
ÿche_h™
);

1493 if(
ÿche_h™
 && 
’abË_Üam
 =ğ
WORAM
)

1495 
	`move_·ge_to_’şave_äom_ÿche
(
addr
);

1496 
	`´štf
("[ruÁime] BefÜv®id©šg…‹ƒÁry oà0x%zx -> 0x%zx", 
addr
, *
¡©us_fšd_add»ss
);

1497 *
¡©us_fšd_add»ss
 = *¡©us_fšd_add»s | 
PTE_V
 | 
PTE_E
;

1498 
	`´štf
("[ruÁime] Aá” v®id©šg…‹ƒÁry oà0x%zx -> 0x%zx", 
addr
, *
¡©us_fšd_add»ss
);

1499 
ušŒ_t
 
va_ruÁime
 = 
	`__va
(((*
¡©us_fšd_add»ss
)>>
PTE_PPN_SHIFT
)<<
RISCV_PAGE_BITS
);

1500 if(
	`¶aû_Ãw_·ge
(
va_ruÁime
, 
	`v²
(
addr
)<<
RISCV_PAGE_BITS
)!=
ENQUE_SUCCESS
)

1502 
	`´štf
("[runtime] Page„eplacement queue full. Can't handle. \n" );

1503 
	`sbi_ex™_’şave
(-1);

1510 
ušŒ_t
 
Ãw_®loc_·ge
 = 0;

1511 
Ãw_®loc_·ge
 = 
	`¥a_g‘
();

1512 
®loc
++;

1520 if(
	`¶aû_Ãw_·ge
Ğ
Ãw_®loc_·ge
,
	`v²
(
addr
)<<
RISCV_PAGE_BITS
 )!=
ENQUE_SUCCESS
)

1522 
	`´štf
("[runtime] Page„eplacement queue full. Can't handle. \n" );

1523 
	`sbi_ex™_’şave
(-1);

1530 
ex‹nsiÚ
=0;

1531 if(
sourû_·ge_VA
!=0)

1532 
ex‹nsiÚ
=0;

1535 
ex‹nsiÚ
=1;

1536 
couÁ_ext
++;

1538 if(
’abË_Üam
==
NO_ORAM
)

1540 if(
ex‹nsiÚ
==1)

1542 
	`®loÿ‹_äesh_·ge
(
Ãw_®loc_·ge
, 
¡©us_fšd_add»ss
);

1546 
·ges_»ad
++;

1547 
edge_d©a_t
 
pkg¡r
;

1548 
	`oÿÎ_g‘_·ge_cÚ‹Ás_äom_utm
((*)&
pkg¡r
,(
	`v²
(
addr
))<<
RISCV_PAGE_BITS
);

1549 
	`hªdË_cİy_äom_sh¬ed
((*)&
brought_·ge
,
pkg¡r
.
off£t
,pkg¡r.
size
);

1550 if(
auth’tiÿtiÚ
)

1552 
ÿlc_hmac
[
HASH_SIZE
];

1553 
	`ÿlcuÏ‹_hmac
(&
brought_·ge
,
ÿlc_hmac
,
HASH_SIZE
);

1554 if(!
	`check_hashes
((*)
ÿlc_hmac
 ,
HASH_SIZE
, (*)
brought_·ge
.
hmac
 ,HASH_SIZE ))

1556 
	`´štf
("[ruÁime] PagcÜru±ed. HMAC iÁegr™y check faed. F©®ƒ¼Ü fÜ‡dd»s 0x%lx\n",
brought_·ge
.
add»ss
);

1557 
	`sbi_ex™_’şave
(-1);

1560 if(
cÚfid’tŸl™y
)

1562 
	`deüy±_·ge
((
ušt8_t
*)
brought_·ge
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
key_«s
,(ušt8_t*)
iv_«s
);

1563 
	`deüy±_·ge
((
ušt8_t
*)&
brought_·ge
.
v”_num
,2*(
ušŒ_t
),(ušt8_t*)
key_«s
,(ušt8_t*)
iv_«s
);

1565 if(
auth’tiÿtiÚ
 && 
v”siÚ_numb”s
[
	`v²
(
addr
)] !ğ
brought_·ge
.
v”_num
)

1567 
	`´štf
("[ruÁime] PagcÜru±ed(Possibly‡„•Ïy‡‰ack). F©®ƒ¼Ü fÜ‡dd»s 0x%lx‡nd brought_·ge.v”_numğ0x%lx‡nd v”siÚ_num[]=0x%lx\n",
brought_·ge
.
add»ss
,brought_·ge.
v”_num
,
v”siÚ_numb”s
[
	`v²
(
addr
)]);

1568 
	`sbi_ex™_’şave
(-1);

1571 
	`memıy
((*)
Ãw_®loc_·ge
,(*)
brought_·ge
.
d©a
,
RISCV_PAGE_SIZE
);

1572 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_D
|
PTE_A
 | 
PTE_V
|
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_L
 );

1574 *
¡©us_fšd_add»ss
 =(*¡©us_fšd_add»ss)|
PTE_V
|
PTE_E
;

1575 
´ev_addr_¡©us
=
¡©us_fšd_add»ss
;

1576 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1582 if(
’abË_Üam
==
ENC_PFH
)

1584 if(
ex‹nsiÚ
==1)

1586 
	`mem£t
((*)
Ãw_®loc_·ge
, 0, 
RISCV_PAGE_SIZE
);

1587 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_D
|
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1588 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1592 
·ges_»ad
++;

1593 
edge_d©a_t
 
pkg¡r
;

1594 
ušŒ_t
 
adr
[2];

1595 
adr
[0]=
	`v²
(
addr
)<<
RISCV_PAGE_BITS
;

1596 
adr
[1]=0;

1597 
	`’üy±_·ge
((
ušt8_t
*)
adr
,2*(
ušŒ_t
),(ušt8_t*)
key_«s
,(ušt8_t*)
p_ivs
[
	`v²
(
addr
)].
iv
);

1598 
	`oÿÎ_g‘_·ge_cÚ‹Ás_äom_utm_’c_pfh
((*)&
pkg¡r
,
adr
[0]);

1601 
	`hªdË_cİy_äom_sh¬ed
((*)&
brought_·ge_©
,
pkg¡r
.
off£t
,pkg¡r.
size
);

1604 
ÿlc_hmac
[
HASH_SIZE
];

1605 
	`ÿlcuÏ‹_hmac_fÜ_’c_pfh
(&
brought_·ge_©
,
ÿlc_hmac
,
HASH_SIZE
);

1606 if(!
	`check_hashes
((*)
ÿlc_hmac
 ,
HASH_SIZE
, (*)
brought_·ge_©
.
hmac
 ,HASH_SIZE ))

1608 
	`´štf
("[runtime] Page corrupted. HMAC integrity check failed. Fatalƒrror\n");

1609 
	`sbi_ex™_’şave
(-1);

1612 if(
cÚfid’tŸl™y
)

1615 
	`deüy±_·ge
((
ušt8_t
*)
brought_·ge_©
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
key_«s
,(ušt8_t*)
p_ivs
[
	`v²
(
addr
)].
iv
);

1619 
	`deüy±_·ge
((
ušt8_t
*)&
brought_·ge_©
.
add»ss
,2*(
ušŒ_t
),(ušt8_t*)
key_«s
,(ušt8_t*)
p_ivs
[
	`v²
(
addr
)].
iv
);

1620 
	`memıy
((*)
Ãw_®loc_·ge
,(*)
brought_·ge_©
.
d©a
,
RISCV_PAGE_SIZE
);

1621 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_A
| 
PTE_D
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1622 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1623 if(
Œacšg
 && ( (
·ges_wr™‹n
+
·ges_»ad
)>
THRESHOLD_OPS
 || (
»®_·ges_wr™‹n
+
»®_·ges_»ad
)>THRESHOLD_OPS ) )

1625 
	`sbi_ex™_’şave
(-1);

1632 if(
’abË_Üam
==
PATH_ORAM
)

1634 if(
ex‹nsiÚ
==0)

1636 
	`acûss
('r',
	`v²
(
addr
),
NULL
,(*)
Ãw_®loc_·ge
,
ex‹nsiÚ
);

1637 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_A
 |
PTE_D
| 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1638 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1643 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_D
| 
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1644 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1649 if(
’abË_Üam
==
OPAM
)

1651 if(
ex‹nsiÚ
==0)

1653 
	`acûss_İam
('r',
	`v²
(
addr
),
NULL
,(*)
Ãw_®loc_·ge
,
ex‹nsiÚ
);

1654 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_A
 | 
PTE_D
| 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1655 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1658 if(
Œacšg
 && ( (
»®_·ges_wr™‹n
+
»®_·ges_»ad
)>
THRESHOLD_OPS
 ) )

1660 
	`sbi_ex™_’şave
(-1);

1668 
	`mem£t
((*)
Ãw_®loc_·ge
,0,
RISCV_PAGE_SIZE
);

1669 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_D
| 
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1670 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1673 if(
’abË_Üam
==
RORAM
)

1675 if(
ex‹nsiÚ
==0)

1677 
	`acûss_rÜam
('r',
	`v²
(
addr
),
NULL
,(*)
Ãw_®loc_·ge
,
ex‹nsiÚ
);

1678 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_A
 | 
PTE_D
| 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1679 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1680 if(
Œacšg
 && (
·ges_wr™‹n
+
·ges_»ad
)>
THRESHOLD_OPS
)

1682 
	`sbi_ex™_’şave
(-1);

1687 
	`mem£t
((*)
Ãw_®loc_·ge
,0,
RISCV_PAGE_SIZE
);

1688 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_D
| 
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_V
 | 
PTE_L
|
PTE_E
 );

1689 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1690 if(
Œacšg
 && (
·ges_wr™‹n
+
·ges_»ad
)>
THRESHOLD_OPS
)

1692 
	`sbi_ex™_’şave
(-1);

1696 if(
’abË_Üam
==
WORAM
)

1708 if(
ex‹nsiÚ
==1)

1710 
	`®loÿ‹_äesh_·ge
(
Ãw_®loc_·ge
, 
¡©us_fšd_add»ss
);

1711 
´ev_addr_¡©us
=
¡©us_fšd_add»ss
;

1715 
	`g‘_·ge_äom_wÜam
(
addr
, 
Ãw_®loc_·ge
, 
¡©us_fšd_add»ss
, 
çuÉ_mode
, 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
);

1716 
´ev_addr_¡©us
=
¡©us_fšd_add»ss
;

1717 
·ges_»ad
++;

1722 if(
debug
)

1724 
	`´št_d‘as
();

1729 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1731 if(
çuÉ_lim
!=0 )

1733 if(
couÁpf
>=
çuÉ_lim
)

1735 
	`´št_d‘as
();

1736 
	`sbi_ex™_’şave
(-1);

1747 if(
debug
)

1749 
	`´št_d‘as
();

1751 
	`´št_d‘as
();

1752 
	`sbi_ex™_’şave
(-1);

1755 
	`´štf
("PAGE FAULT\n");

1756 
	`sbi_ex™_’şave
(-1);

1757 
	}
}

1760 
ušŒ_t
 
	$¹_hªdË_sbrk
(
size_t
 
by‹s
)

1762 
is_¹
=1;

1763 
ušŒ_t
 
Şd_pbrk
 = 
	`g‘_´og¿m_b»ak
();

1764 
ušŒ_t
 
Ãw_pbrk
 = 
	`PAGE_UP
(
Şd_pbrk
 + 
by‹s
);

1765 if(
debug
 && 
Şd_pbrk
!=
Ãw_pbrk
)

1767 
	`´štf
("[SBREAK] OLD P_BRK = 0x%lx‡nd NEW P_BREAK = 0x%lx(APPè\n",
Şd_pbrk
, 
Ãw_pbrk
);

1769 
ušŒ_t
 *
roÙ_·ge_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

1770 
ušŒ_t
 
ex‹nd_addr
 = 
Şd_pbrk
;ƒx‹nd_addr<
Ãw_pbrk
;ƒx‹nd_add¸+ğ
RISCV_PAGE_SIZE
)

1772 
ušŒ_t
 *
¡©us_fšd_add»ss
 = 
	`__w®k_ü—‹
(
roÙ_·ge_bË_addr
,
ex‹nd_addr
);

1774 if(
¡©us_fšd_add»ss
==0)

1776 
	`´štf
("[runtime] Unmapped‡ddress. Fatalƒrror during sbreak. Exiting.\n");

1777 
	`sbi_ex™_’şave
(-1);

1779 *
¡©us_fšd_add»ss
 = 0| 
PTE_D
|
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_L
 ;

1783 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1784 if(
debug
)

1786 
ušŒ_t
 *
¡©us_fšd_add»ss_d
 = 
	`__w®k
(
roÙ_·ge_bË_addr
,
ex‹nd_addr
);

1787 if(
¡©us_fšd_add»ss_d
==0)

1789 
	`´štf
("[RUNTIME] sbreak failed\n" );

1798 
	`£t_´og¿m_b»ak
(
Ãw_pbrk
);

1799 if(
debug
)

1803 
is_¹
=0;

1805 
	`c¤_£t
(
s›
, 
SIE_STIE
 | 
SIE_SSIE
);

1806  
Şd_pbrk
;

1807 
	}
}

1809 
ušŒ_t
 
	$¹_hªdË_sbrk_¹
(
size_t
 
by‹s
)

1811 
ušŒ_t
 
Şd_pbrk
 = 
	`g‘_´og¿m_b»ak_¹
();

1812 
ušŒ_t
 
Ãw_pbrk
 = 
	`PAGE_UP
(
Şd_pbrk
 + 
by‹s
);

1813 if(
debug
 && 
Şd_pbrk
!=
Ãw_pbrk
)

1817 if(
debug
 && 
Şd_pbrk
!=
Ãw_pbrk
)

1821 
ušŒ_t
 *
roÙ_·ge_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

1822 
ušŒ_t
 
ex‹nd_addr
 = 
Şd_pbrk
;ƒx‹nd_addr<
Ãw_pbrk
;ƒx‹nd_add¸+ğ
RISCV_PAGE_SIZE
)

1824 
ušŒ_t
 *
¡©us_fšd_add»ss
 = 
	`__w®k_ü—‹
(
roÙ_·ge_bË_addr
,
ex‹nd_addr
);

1825 if(
¡©us_fšd_add»ss
==0)

1827 
	`´štf
("[runtime] Unmapped‡ddress. Fatalƒrror during sbreak. Exiting.\n");

1828 
	`sbi_ex™_’şave
(-1);

1831 
ušŒ_t
 
Ãw_®loc_·ge
 = 0;

1832 
Ãw_®loc_·ge
 = 
	`¥a_g‘
();

1833 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
PTE_D
|
PTE_A
 | 
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_V
 | 
PTE_L
 );

1834 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

1836 
	`£t_´og¿m_b»ak_¹
(
Ãw_pbrk
);

1837 if(
debug
)

1841  
Şd_pbrk
;

1842 
	}
}

1844 
	$¹_·ge_çuÉ
(
’ş_ùx_t
* 
ùx
)

1847 #ifdeà
FATAL_DEBUG


1848 
addr
, 
ÿu£
, 
pc
;

1849 
pc
 = 
ùx
->
»gs
.
£pc
;pc=pc;

1850 
addr
 = 
ùx
->
sbadaddr
;

1851 
ÿu£
 = 
ùx
->
sÿu£
;

1852 if(
ÿu£
==0xf)

1853 
çuÉ_mode
=1;

1855 
çuÉ_mode
=0;

1856 if(
addr
>0xfffffffffffff)

1861 
	`sbi_ex™_’şave
(-1);

1864 if(
fœ¡_çuÉ
)

1866 
’şave_İtiÚs
 
¬gs_u£r
;

1867 
edge_d©a_t
 
pkg¡r
;

1868 
	`di¥©ch_edgeÿÎ_oÿÎ
(
OCALL_GET_TESTING_PARAMS
,
NULL
,0,&
pkg¡r
,(
edge_d©a_t
),(
ušŒ_t
)&
¬gs_u£r
);

1870 
’abË_Üam
=
¬gs_u£r
.
·ge_çuÉ_hªdËr
;

1871 
auth’tiÿtiÚ
=
¬gs_u£r
.
š‹gr™y_´ÙeùiÚ
;

1872 
cÚfid’tŸl™y
=
¬gs_u£r
.confidentiality;

1873 
ä“_·ges_ä
=
¬gs_u£r
.
num_ä“_·ges
;

1874 
Œacšg
=
¬gs_u£r
.
·ge_addr_Œacšg
;

1875 
debug
=
¬gs_u£r
.
debug_mode
;

1886 
is_¹
=1;

1887 
	`hªdË_·ge_çuÉ
((
ušŒ_t
è
addr
,0);

1888 
is_¹
=0;

1891 
	}
}

	@rt_util.h

1 #iâdeà
_RT_UTIL_H_


2 
	#_RT_UTIL_H_


	)

4 
	~"»gs.h
"

5 
	~<¡ddef.h
>

7 
	#FATAL_DEBUG


	)

10 
size_t
 
¹_ut_g‘¿ndom
(* 
vaddr
, size_ˆ
buæ’
);

12 
fl_·ge_w™h_z”Ûs
(* 
·ge_addrs
);

13 
chacha20
(
ušt8_t
 *
out
, cÚ¡ ušt8_ˆ*
š
, 
size_t
 
šËn
, cÚ¡ ušt8_ˆ*
key
, cÚ¡ ušt8_ˆ*
nÚû
, 
ušt32_t
 
ùr
);

15 
nÙ_im¶em’‹d_çl
(
’ş_ùx_t
* 
ùx
);

16 
¹_ut_misc_çl
();

17 
hªdË_·ge_çuÉ
(
ušŒ_t
 
addr
, ušŒ_ˆ*
¡©us_fšd_add»ss
);

18 
®loÿ‹_äesh_·ge
(
ušŒ_t
 
Ãw_®loc_·ge
, ušŒ_ˆ*
¡©us_fšd_add»ss
);

19 
£tup_keys_ªd_bufãr
();

20 
‹tsšg
();

21 
ušt8_t
 
z_1
[16];

22 
ušt8_t
 
z_2
[16];

23 
ušt8_t
 
Key_hmac
[16];

24 
ušŒ_t
 
·ges_»ad
;

25 
ušŒ_t
 
»®_·ges_»ad
;

26 
ušŒ_t
 
·ges_wr™‹n
;

27 
ušŒ_t
 
»®_·ges_wr™‹n
;

28 
ušŒ_t
 
max_¡ash_occ
;

29 
ušŒ_t
 
sum_¡ash_occ
;

30 
ušŒ_t
 
Üam_acc
;

31 
Œacšg
;

32 
debug
;

33 
exc
;

34 
couÁpf
;

35 
çuÉ_lim
;

36 
ušŒ_t
 
´ev_addr
;

37 
ušŒ_t
 *
´ev_addr_¡©us
;

40 
ušŒ_t
 
¹_hªdË_sbrk
(
size_t
 
by‹s
);

41 
ušŒ_t
 
¹_hªdË_sbrk_¹
(
size_t
 
by‹s
);

43 
	#DUMMY_BLOCK_ADDR
 0

	)

44 
	#STASH_SIZE
 35

	)

45 
	#ARRAY_SIZE
 500

	)

46 
	#BLOCK_SIZE
 4096

	)

47 
	#NO_ORAM
 0

	)

48 
	#PATH_ORAM
 1

	)

49 
	#OPAM
 2

	)

50 
	#ENC_PFH
 3

	)

51 
	#RORAM
 4

	)

52 
	#NO_OF_COUNTERS
 16

	)

53 
	#WORAM
 5

	)

55 
g‘_Œ“_šdex
(
x
);

56 
log2
(
x
);

57 
û
(
x
);

58 
UnifÜmRªdom
();

59 
pxg‘
(
Ëafšdex
 , 
Px
[
ARRAY_SIZE
]);

61 *
fœ¡im—cûss
;

62 *
buff
;

63 *
backup_sh¬ed_memÜy
;

67 ’um { 
	mPAGE_FAULT_HANDLER_SIMPLE
=0, 
	mPAGE_FAULT_HANDLER_ORAM
=1,

68 
	mPAGE_FAULT_HANDLER_OPAM
=2, 
	mPAGE_FAULT_HANDLER_ENC_ADDR
=3 }
	t·ge_çuÉ_ty³
;

69 
	s’şave_İtiÚs_t
 {

70 
·ge_çuÉ_ty³
 
	m·ge_çuÉ_hªdËr
;

71 
ušt8_t
 
	mš‹gr™y_´ÙeùiÚ
;

72 
ušt8_t
 
	mcÚfid’tŸl™y
;

73 
	mnum_ä“_·ges
;

74 
ušt8_t
 
	mviùim_ÿche
;

75 
ušt8_t
 
	m·ge_addr_Œacšg
;

76 
ušt8_t
 
	mdebug_mode
;

77 
ušt8_t
 
	mŒ“_exc
;

78 
	mçuÉ_lim™
;

79 } 
	t’şave_İtiÚs
;

82 
	scouÁ”_t


84 
ušŒ_t
 
	mcouÁ
;

85 
	mÇme
[50];

86 } 
	tcouÁ”
;

88 
couÁ”
 
couÁ”s
[
NO_OF_COUNTERS
];

89 
	#PAGES_READ
 0

	)

90 
	#PAGES_WRITTEN
 1

	)

91 
	#INIT_NUM_PAGES
 2

	)

92 
	#PAGE_FAULT_COUNT
 3

	)

93 
	#FREE_PAGES_FR
 4

	)

94 
	#EXTENSIONS
 5

	)

95 
	#TOTAL_PAGES
 6

	)

96 
	#REAL_PAGES_READ
 7

	)

97 
	#REAL_PAGES_WRITTEN
 8

	)

98 
	#DUMMY_PAGES_READ
 9

	)

99 
	#DUMMY_PAGES_WRITTEN
 10

	)

100 
	#MAX_STASH_OCC
 11

	)

101 
	#SUM_STASH_OCC
 12

	)

102 
	#ORAM_ACC
 13

	)

103 
	#ORAM_INIT
 14

	)

104 
	#COPY_WASTE
 15

	)

105 
pow
(
ušŒ_t
 
a
, ušŒ_ˆ
b
);

106 
	#ARITY
 16.0

107 

	)

108 
cÚfid’tŸl™y
;

109 
ušŒ_t
 
çuÉ_mode
;

110 
ušŒ_t
 
cİy_wa¡e
;

112 
ušŒ_t
 
buff_size
;

114 
ušŒ_t
 
time_rblocks_´oûss_r
;

115 
ušŒ_t
 
time_rblocks_´oûss_w
;

116 
ušŒ_t
 
time_dblocks_´oûss_r
;

117 
ušŒ_t
 
time_dblocks_´oûss_w
;

118 
ušŒ_t
 
time_block_cİy_r
;

119 
ušŒ_t
 
time_block_cİy_w
;

121 
	#BLOCKS_FOR_TIME_COUNTING
 8192

	)

	@sbi.h

5 #iâdeà
__SBI_H_


6 
	#__SBI_H_


	)

8 
	~<¡dšt.h
>

10 
	#SBI_SET_TIMER
 0

	)

11 
	#SBI_CONSOLE_PUTCHAR
 1

	)

12 
	#SBI_CONSOLE_GETCHAR
 2

	)

14 
	#SBI_SM_CREATE_ENCLAVE
 101

	)

15 
	#SBI_SM_DESTROY_ENCLAVE
 102

	)

16 
	#SBI_SM_ATTEST_ENCLAVE
 103

	)

17 
	#SBI_SM_RUN_ENCLAVE
 105

	)

18 
	#SBI_SM_STOP_ENCLAVE
 106

	)

19 
	#SBI_SM_RESUME_ENCLAVE
 107

	)

20 
	#SBI_SM_ENCLAVE_GETRANDOM
 108

	)

21 
	#SBI_SM_EXIT_ENCLAVE
 1101

	)

22 
	#SBI_SM_NOT_IMPLEMENTED
 1111

	)

23 
	#SBI_SM_RANDOM
 108

	)

24 
	#SBI_SM_PRINT_HELLO_WORLD
 77777

25 

	)

26 
	#SBI_CALL
(
___which
, 
___¬g0
, 
___¬g1
, 
___¬g2
) ({ \

27 
ušŒ_t
 
a0
 
	`asm
 ("a0"èğ(ušŒ_t)(
___¬g0
); \

28 
ušŒ_t
 
a1
 
	`asm
 ("a1"èğ(ušŒ_t)(
___¬g1
); \

29 
ušŒ_t
 
a2
 
	`asm
 ("a2"èğ(ušŒ_t)(
___¬g2
); \

30 
ušŒ_t
 
a7
 
	`asm
 ("a7"èğ(ušŒ_t)(
___which
); \

31 
asm
 volatile ("ecall" \

32 : "+r" (
a0
) \

33 : "r" (
a1
), "r" (
a2
), "r" (
a7
) \

35 
a0
; \

36 })

	)

39 
	#SBI_CALL_0
(
___which
è
	`SBI_CALL
(___which, 0, 0, 0)

	)

40 
	#SBI_CALL_1
(
___which
, 
___¬g0
è
	`SBI_CALL
(___which, ___¬g0, 0, 0)

	)

41 
	#SBI_CALL_2
(
___which
, 
___¬g0
, 
___¬g1
è
	`SBI_CALL
(___which, ___¬g0, ___¬g1, 0)

	)

42 
	#SBI_CALL_3
(
___which
, 
___¬g0
, 
___¬g1
, 
___¬g2
è
	`SBI_CALL
(___which, ___¬g0, ___¬g1, ___¬g2)

	)

44 
šlše
 
	$sbi_£t_tim”
(
ušt64_t
 
¡ime_v®ue
){

45 #ià
__riscv_xËn
 == 32

46 
	`SBI_CALL_2
(
SBI_SET_TIMER
, 
¡ime_v®ue
, stime_value >> 32);

48 
	`SBI_CALL_1
(
SBI_SET_TIMER
, 
¡ime_v®ue
);

50 
	}
}

52 
šlše
 
	$sbi_¡İ_’şave
(
ušt64_t
 
»que¡
)

54 
	`SBI_CALL_1
(
SBI_SM_STOP_ENCLAVE
, 
»que¡
);

55 
	}
}

57 
šlše
 
	$sbi_ex™_’şave
(
ušt64_t
 
»tv®
)

59 
	`SBI_CALL_1
(
SBI_SM_EXIT_ENCLAVE
, 
»tv®
);

60 
	}
}

62 
šlše
 
	$sbi_´št_h–lo_wÜld
()

64 
	`SBI_CALL_0
(
SBI_SM_PRINT_HELLO_WORLD
);

65 
	}
}

67 
šlše
 
ušŒ_t
 
	$sbi_¿ndom
()

69  
	`SBI_CALL_0
(
SBI_SM_RANDOM
);

70 
	}
}

	@ssha3.c

7 
	~"ssha3.h
"

11 
	$sha3_kecÿkf
(
ušt64_t
 
¡
[25])

14 cÚ¡ 
ušt64_t
 
kecÿkf_ºdc
[24] = {

24 cÚ¡ 
kecÿkf_rÙc
[24] = {

28 cÚ¡ 
kecÿkf_pn
[24] = {

34 
i
, 
j
, 
r
;

35 
ušt64_t
 
t
, 
bc
[5];

37 #ià
__BYTE_ORDER__
 !ğ
__ORDER_LITTLE_ENDIAN__


38 
ušt8_t
 *
v
;

41 
i
 = 0; i < 25; i++) {

42 
v
 = (
ušt8_t
 *è&
¡
[
i
];

43 
¡
[
i
] = ((
ušt64_t
è
v
[0]) | (((uint64_t) v[1]) << 8) |

44 (((
ušt64_t
è
v
[2]) << 16) | (((uint64_t) v[3]) << 24) |

45 (((
ušt64_t
è
v
[4]) << 32) | (((uint64_t) v[5]) << 40) |

46 (((
ušt64_t
è
v
[6]) << 48) | (((uint64_t) v[7]) << 56);

51 
r
 = 0;„ < 
KECCAKF_ROUNDS
;„++) {

54 
i
 = 0; i < 5; i++)

55 
bc
[
i
] = 
¡
[i] ^ st[i + 5] ^ st[i + 10] ^ st[i + 15] ^ st[i + 20];

57 
i
 = 0; i < 5; i++) {

58 
t
 = 
bc
[(
i
 + 4è% 5] ^ 
	`ROTL64
(bc[(i + 1) % 5], 1);

59 
j
 = 0; j < 25; j += 5)

60 
¡
[
j
 + 
i
] ^ğ
t
;

64 
t
 = 
¡
[1];

65 
i
 = 0; i < 24; i++) {

66 
j
 = 
kecÿkf_pn
[
i
];

67 
bc
[0] = 
¡
[
j
];

68 
¡
[
j
] = 
	`ROTL64
(
t
, 
kecÿkf_rÙc
[
i
]);

69 
t
 = 
bc
[0];

73 
j
 = 0; j < 25; j += 5) {

74 
i
 = 0; i < 5; i++)

75 
bc
[
i
] = 
¡
[
j
 + i];

76 
i
 = 0; i < 5; i++)

77 
¡
[
j
 + 
i
] ^ğ(~
bc
[(i + 1) % 5]) & bc[(i + 2) % 5];

81 
¡
[0] ^ğ
kecÿkf_ºdc
[
r
];

84 #ià
__BYTE_ORDER__
 !ğ
__ORDER_LITTLE_ENDIAN__


86 
i
 = 0; i < 25; i++) {

87 
v
 = (
ušt8_t
 *è&
¡
[
i
];

88 
t
 = 
¡
[
i
];

89 
v
[0] = 
t
 & 0xFF;

90 
v
[1] = (
t
 >> 8) & 0xFF;

91 
v
[2] = (
t
 >> 16) & 0xFF;

92 
v
[3] = (
t
 >> 24) & 0xFF;

93 
v
[4] = (
t
 >> 32) & 0xFF;

94 
v
[5] = (
t
 >> 40) & 0xFF;

95 
v
[6] = (
t
 >> 48) & 0xFF;

96 
v
[7] = (
t
 >> 56) & 0xFF;

99 
	}
}

103 
	$sha3_š™
(
sha3_ùx_t
 *
c
, 
mdËn
)

105 
i
;

107 
i
 = 0; i < 25; i++)

108 
c
->
¡
.
q
[
i
] = 0;

109 
c
->
mdËn
 = mdlen;

110 
c
->
rsiz
 = 200 - 2 * 
mdËn
;

111 
c
->
±
 = 0;

114 
	}
}

118 
	$sha3_upd©e
(
sha3_ùx_t
 *
c
, cÚ¡ *
d©a
, 
size_t
 
Ën
)

120 
size_t
 
i
;

121 
j
;

123 
j
 = 
c
->
±
;

124 
i
 = 0; i < 
Ën
; i++) {

125 
c
->
¡
.
b
[
j
++] ^ğ((cÚ¡ 
ušt8_t
 *è
d©a
)[
i
];

126 ià(
j
 >ğ
c
->
rsiz
) {

127 
	`sha3_kecÿkf
(
c
->
¡
.
q
);

128 
j
 = 0;

131 
c
->
±
 = 
j
;

134 
	}
}

138 
	$sha3_fš®
(*
md
, 
sha3_ùx_t
 *
c
)

140 
i
;

142 
c
->
¡
.
b
[c->
±
] ^= 0x06;

143 
c
->
¡
.
b
[c->
rsiz
 - 1] ^= 0x80;

144 
	`sha3_kecÿkf
(
c
->
¡
.
q
);

146 
i
 = 0; i < 
c
->
mdËn
; i++) {

147 ((
ušt8_t
 *è
md
)[
i
] = 
c
->
¡
.
b
[i];

151 
	}
}

155 *
	$sha3
(cÚ¡ *
š
, 
size_t
 
šËn
, *
md
, 
mdËn
)

157 
sha3_ùx_t
 
sha3
;

159 
	`sha3_š™
(&
sha3
, 
mdËn
);

160 
	`sha3_upd©e
(&
sha3
, 
š
, 
šËn
);

161 
	`sha3_fš®
(
md
, &
sha3
);

163  
md
;

164 
	}
}

167 
	$check_hashes
(* 
hash1
, 
size_t
 
Ën1
, * 
hash2
, size_ˆ
Ën2
)

169 if(
Ën1
!=
Ën2
)

171 
i
=0;i<
Ën1
;i++)

173 ifĞ*((*)(
hash1
+
i
))!=*Ğ(*)(
hash2
+i) ))

177 
	}
}

179 
	$xÜ_İ
(*
a
, *
b
, *
c
, 
size_t
 
Ën
)

181 
i
=0;i<
Ën
;i++)

182 
c
[
i
]=
a
[i]^
b
[i];

183 
	}
}

	@ssha3.h

4 #iâdeà
SHA3_H


5 
	#SHA3_H


	)

7 
	~<¡ddef.h
>

8 
	~<¡dšt.h
>

9 
	#HASH_SIZE
 32

	)

10 #iâdeà
KECCAKF_ROUNDS


11 
	#KECCAKF_ROUNDS
 24

	)

14 #iâdeà
ROTL64


15 
	#ROTL64
(
x
, 
y
è(((xè<< (y)è| ((xè>> (64 - (y))))

	)

21 
ušt8_t
 
	mb
[200];

22 
ušt64_t
 
	mq
[25];

23 } 
	m¡
;

24 
	m±
, 
	mrsiz
, 
	mmdËn
;

25 } 
	tsha3_ùx_t
;

28 
sha3_kecÿkf
(
ušt64_t
 
¡
[25]);

31 
sha3_š™
(
sha3_ùx_t
 *
c
, 
mdËn
);

32 
sha3_upd©e
(
sha3_ùx_t
 *
c
, cÚ¡ *
d©a
, 
size_t
 
Ën
);

33 
sha3_fš®
(*
md
, 
sha3_ùx_t
 *
c
);

36 *
sha3
(cÚ¡ *
š
, 
size_t
 
šËn
, *
md
, 
mdËn
);

38 
check_hashes
(* 
hash1
, 
size_t
 
Ën1
, * 
hash2
, size_ˆ
Ën2
);

39 
xÜ_İ
(*
a
, *
b
, *
c
, 
size_t
 
Ën
);

42 
ušŒ_t
 *
	gv”siÚ_numb”s
;

43 
ušt8_t
 
key_hmac
[16];

44 
ušt8_t
 
z1
[16];

45 
ušt8_t
 
z2
[16];

	@string.c

1 
	~"¡ršg.h
"

6 
	~<¡dšt.h
>

7 
	~<ùy³.h
>

9 * 
	$memıy
(* 
de¡
, cÚ¡ * 
¤c
, 
size_t
 
Ën
)

11 cÚ¡ * 
s
 = 
¤c
;

12 *
d
 = 
de¡
;

14 ià((((
ušŒ_t
)
de¡
 | (ušŒ_t)
¤c
) & ((uintptr_t)-1)) == 0) {

15 (*)
d
 < (
de¡
 + 
Ën
 - ((
ušŒ_t
)-1))) {

16 *(
ušŒ_t
*)
d
 = *(cÚ¡ ušŒ_t*)
s
;

17 
d
 +ğ(
ušŒ_t
);

18 
s
 +ğ(
ušŒ_t
);

22 
d
 < (*)(
de¡
 + 
Ën
))

23 *
d
++ = *
s
++;

25  
de¡
;

26 
	}
}

29 * 
	$mem£t
(* 
de¡
, 
by‹
, 
size_t
 
Ën
)

31 ià((((
ušŒ_t
)
de¡
 | 
Ën
) & ((uintptr_t)-1)) == 0) {

32 
ušŒ_t
 
wÜd
 = 
by‹
 & 0xFF;

33 
wÜd
 |= word << 8;

34 
wÜd
 |= word << 16;

35 
wÜd
 |= word << 16 << 16;

37 
ušŒ_t
 *
d
 = 
de¡
;

38 
d
 < (
ušŒ_t
*)(
de¡
 + 
Ën
))

39 *
d
++ = 
wÜd
;

41 *
d
 = 
de¡
;

42 
d
 < (*)(
de¡
 + 
Ën
))

43 *
d
++ = 
by‹
;

45  
de¡
;

46 
	}
}

48 
	$memcmp
(cÚ¡ * 
s1
, cÚ¡ * 
s2
, 
size_t
 
n
)

50 
u1
, 
u2
;

52  ; 
n
-- ; 
s1
++, 
s2
++) {

53 
u1
 = * (*è
s1
;

54 
u2
 = * (*è
s2
;

55 iàĞ
u1
 !ğ
u2
) {

56  (
u1
-
u2
);

60 
	}
}

65 
	$¡¾’
(*
s
)

67 
couÁ
=0;

69 *
s
!=0)

71 
couÁ
++;

72 
s
++;

74  
couÁ
;

75 
	}
}

78 
	$¡rcmp
(*
s1
, *
s2
)

80 
Ën
ğ
	`¡¾’
(
s1
);

81 if(
Ën
!=
	`¡¾’
(
s2
))

84 
i
=0;i<
Ën
;i++)

86 if(
s1
[
i
]!=
s2
[i])

90 
	}
}

94 
	$¡rÿt
(*
s1
, *
s2
)

96 
Ën
ğ
	`¡¾’
(
s1
);

97 
Ën2
ğ
	`¡¾’
(
s2
);

103 
i
=0;i<
Ën2
;i++)

105 
s1
[
Ën
+
i
]=
s2
[i];

108 
	}
}

111 
	$¡rıy
(*
s1
, *
s2
)

114 
Ën2
ğ
	`¡¾’
(
s2
);

120 
i
=0;i<
Ën2
;i++)

122 
s1
[
i
]=
s2
[i];

125 
	}
}

	@string.h

1 #iâdeà
__STRING_H__


2 
	#__STRING_H__


	)

3 
	~<¡ddef.h
>

4 
	~<¡dšt.h
>

5 * 
memıy
(* 
de¡
, cÚ¡ * 
¤c
, 
size_t
 
Ën
);

6 * 
mem£t
(* 
de¡
, 
by‹
, 
size_t
 
Ën
);

7 
memcmp
(cÚ¡ * 
±r1
, cÚ¡ * 
±r2
, 
size_t
 
Ën
);

8 
¡¾’
(*
s
);

9 
¡rcmp
(*
s1
, *
s2
);

10 
¡rÿt
(*
s1
, *
s2
);

11 
¡rıy
(*
s1
, *
s2
);

	@syscall.c

5 
	~<¡dšt.h
>

6 
	~<¡ddef.h
>

7 
	~"sysÿÎ.h
"

8 
	~"¡ršg.h
"

9 
	~"edge_ÿÎ.h
"

10 
	~"uacûss.h
"

11 
	~"mm.h
"

12 
	~"vm.h
"

13 
	~"·ge_»¶aûm’t.h
"

14 
	~"Üam.h
"

15 
	~"sysÿÎ_nums.h
"

16 
	~"š‹¼u±.h
"

17 #ifdeà
IO_SYSCALL_WRAPPING


18 
	~"io_w¿p.h
"

21 #ifdeà
LINUX_SYSCALL_WRAPPING


22 
	~"lšux_w¿p.h
"

24 
	~"¹_ut.h
"

25 
ex™_’şave
(
ušŒ_t
 
¬g0
);

27 
	#COPY_TO_USER
 1

	)

28 
	#COPY_FROM_USER
 2

	)

31 
ušŒ_t
 
	$di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ_t
* 
sysÿÎ_d©a_±r
, 
size_t
 
d©a_Ën
){

32 
is_¹
=1;

33 
»t
;

39 
edge_ÿÎ_t
* 
edge_ÿÎ
 = ((edge_ÿÎ_t*)
sh¬ed_bufãr
);

41 
edge_ÿÎ
->
ÿÎ_id
 = 
EDGECALL_SYSCALL
;

44 if(
	`edge_ÿÎ_£tup_ÿÎ
(
edge_ÿÎ
, (*)
sysÿÎ_d©a_±r
, 
d©a_Ën
) != 0){

49 
»t
 = 
	`SBI_CALL_1
(
SBI_SM_STOP_ENCLAVE
, 1);

50 
	`c¤_wr™e
(
s¡©us
, 
	`c¤_»ad
(sstatus) | 0x6000);

51 
	`š™_tim”
();

52 ià(
»t
 != 0) {

57 if(
edge_ÿÎ
->
»tuº_d©a
.
ÿÎ_¡©us
 !ğ
CALL_STATUS_OK
){

62 
ušŒ_t
 
»tuº_±r
;

63 if(
	`edge_ÿÎ_»t_±r
(
edge_ÿÎ
, &
»tuº_±r
) != 0){

67 
is_¹
=0;

68  *(
ušŒ_t
*)
»tuº_±r
;

69 
	}
}

72 
ušŒ_t
 
	$cİy_äom_u£r_·ge_wi£
(* 
bufãr_d©a_¡¬t
, * 
d©a
, 
size_t
 
d©a_Ën
)

80 
is_¹
=1;

81 
çuÉ_mode
=0;

83 ifĞ
d©a
==0)

87 
ušŒ_t
 *
roÙ_·ge_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

88 
ušŒ_t
 
no_of_by‹s_com¶‘ed
 = 0;

89 
ušŒ_t
 
¡¬tšg_addr_utm
=(ušŒ_t)
bufãr_d©a_¡¬t
;

90 
ušŒ_t
 
¡¬tšg_addr_d©a
=(ušŒ_t)
d©a
;

91 
size_t
 
Ëngth
 = 
	`PAGE_UP
(
¡¬tšg_addr_d©a
) - starting_addr_data;

92 
Ëngth
ğ
d©a_Ën
>length?length:data_len;

94 
ušŒ_t
 *
¡©us_fšd_add»ss
=0;

95 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
¡¬tšg_addr_d©a
);

96 if(
¡©us_fšd_add»ss
==0)

98 
	`´štf
("[runtime] Unmapped‡ddress in dispatch_edgecall_ocall. Fatalƒrror. Exiting.\n");

99 
	`sbi_ex™_’şave
(-1);

103 ifĞ!Ğ(*
¡©us_fšd_add»ss
è& 
PTE_V
 ) )

105 
	`cİy_to_u£r
Ğ(*)
backup_sh¬ed_memÜy
,(*)
sh¬ed_bufãr
,
buff_size
);

106 
	`hªdË_·ge_çuÉ
(
¡¬tšg_addr_d©a
,
¡©us_fšd_add»ss
);

107 if(
debug
)

108 
	`´štf
("[ruÁime]…agçuÉ duršg cİy_äom_u£r_·ge_wi£ oÀ0x%lx\n",
	`PAGE_DOWN
(
¡¬tšg_addr_d©a
) );

110 
	`cİy_äom_u£r
((*)
sh¬ed_bufãr
,(*)
backup_sh¬ed_memÜy
,
buff_size
);

113 
	`cİy_äom_u£r
((*)
¡¬tšg_addr_utm
,(*)
¡¬tšg_addr_d©a
,
Ëngth
);

115 
no_of_by‹s_com¶‘ed
+=
Ëngth
;

116 
¡¬tšg_addr_utm
+=
Ëngth
;

117 
¡¬tšg_addr_d©a
+=
Ëngth
;

119  (
d©a_Ën
-
no_of_by‹s_com¶‘ed
)>=
RISCV_PAGE_SIZE
)

122 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
¡¬tšg_addr_d©a
);

123 if(
¡©us_fšd_add»ss
==0)

125 
	`´štf
("[runtime] Unmapped‡ddress in dispatch_edgecall_ocall. Fatalƒrror. Exiting.\n");

126 
	`sbi_ex™_’şave
(-1);

129 ifĞ!Ğ(*
¡©us_fšd_add»ss
è& 
PTE_V
 ) )

131 
	`cİy_to_u£r
Ğ(*)
backup_sh¬ed_memÜy
,(*)
sh¬ed_bufãr
,
buff_size
);

132 
	`hªdË_·ge_çuÉ
(
¡¬tšg_addr_d©a
,
¡©us_fšd_add»ss
);

133 if(
debug
)

134 
	`´štf
("[ruÁime]…agçuÉ duršg cİy_äom_u£r_·ge_wi£ oÀ0x%lx\n",
	`PAGE_DOWN
(
¡¬tšg_addr_d©a
) );

135 
	`cİy_äom_u£r
((*)
sh¬ed_bufãr
,(*)
backup_sh¬ed_memÜy
,
buff_size
);

138 
	`cİy_äom_u£r
((*)
¡¬tšg_addr_utm
,(*)
¡¬tšg_addr_d©a
,
RISCV_PAGE_SIZE
);

139 
no_of_by‹s_com¶‘ed
+=
RISCV_PAGE_SIZE
;

140 
¡¬tšg_addr_utm
+=
RISCV_PAGE_SIZE
;

141 
¡¬tšg_addr_d©a
+=
RISCV_PAGE_SIZE
;

143 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
¡¬tšg_addr_d©a
);

144 if(
¡©us_fšd_add»ss
==0)

146 
	`´štf
("[runtime] Unmapped‡ddress in dispatch_edgecall_ocall. Fatalƒrror. Exiting.\n");

147 
	`sbi_ex™_’şave
(-1);

150 ifĞ!Ğ(*
¡©us_fšd_add»ss
è& 
PTE_V
 ) )

152 
	`cİy_to_u£r
Ğ(*)
backup_sh¬ed_memÜy
,(*)
sh¬ed_bufãr
,
buff_size
);

153 
	`hªdË_·ge_çuÉ
(
¡¬tšg_addr_d©a
,
¡©us_fšd_add»ss
);

154 if(
debug
)

155 
	`´štf
("[ruÁime]…agçuÉ duršg cİy_äom_u£r_·ge_wi£ oÀ0x%lx\n",
	`PAGE_DOWN
(
¡¬tšg_addr_d©a
) );

157 
	`cİy_äom_u£r
((*)
sh¬ed_bufãr
,(*)
backup_sh¬ed_memÜy
,
buff_size
);

159 
Ëngth
 = 
d©a_Ën
-
no_of_by‹s_com¶‘ed
;

160 
is_¹
=0;

162  
	`cİy_äom_u£r
((*)
¡¬tšg_addr_utm
,(*)
¡¬tšg_addr_d©a
,
Ëngth
);

164 
	}
}

166 
ušŒ_t
 
	$cİy_to_u£r_·ge_wi£
(* 
d©a
,* 
bufãr_d©a_¡¬t
, 
size_t
 
d©a_Ën
)

168 
is_¹
=1;

169 
çuÉ_mode
=1;

170 ifĞ
d©a_Ën
==0)

173 
ušŒ_t
 *
roÙ_·ge_bË_addr
=
	`g‘_roÙ_·ge_bË_addr
();

174 
ušŒ_t
 
no_of_by‹s_com¶‘ed
 = 0;

175 
ušŒ_t
 
¡¬tšg_addr_utm
=(ušŒ_t)
bufãr_d©a_¡¬t
;

176 
ušŒ_t
 
¡¬tšg_addr_d©a
=(ušŒ_t)
d©a
;

177 
size_t
 
Ëngth
 = 
	`PAGE_UP
(
¡¬tšg_addr_d©a
) - starting_addr_data;

178 
Ëngth
ğ
d©a_Ën
>length?length:data_len;

180 
ušŒ_t
 *
¡©us_fšd_add»ss
=0;

181 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
¡¬tšg_addr_d©a
);

182 if(
¡©us_fšd_add»ss
==0)

184 
	`´štf
("[runtime] Unmapped‡ddress in dispatch_edgecall_ocall. Fatalƒrror. Exiting.\n");

185 
	`sbi_ex™_’şave
(-1);

188 ifĞ!Ğ(*
¡©us_fšd_add»ss
è& 
PTE_V
 ) )

190 
	`cİy_to_u£r
Ğ(*)
backup_sh¬ed_memÜy
,(*)
sh¬ed_bufãr
,
buff_size
);

191 
	`hªdË_·ge_çuÉ
(
¡¬tšg_addr_d©a
,
¡©us_fšd_add»ss
);

192 if(
debug
)

193 
	`´štf
("[ruÁime]…agçuÉ duršg cİy_to_u£r_·ge_wi£ oÀ0x%lx\n",
	`PAGE_DOWN
(
¡¬tšg_addr_d©a
) );

194 
	`cİy_äom_u£r
((*)
sh¬ed_bufãr
,(*)
backup_sh¬ed_memÜy
,
buff_size
);

197 
	`cİy_to_u£r
((*)
¡¬tšg_addr_d©a
,(*)
¡¬tšg_addr_utm
,
Ëngth
);

198 
no_of_by‹s_com¶‘ed
+=
Ëngth
;

199 
¡¬tšg_addr_utm
+=
Ëngth
;

200 
¡¬tšg_addr_d©a
+=
Ëngth
;

202  (
d©a_Ën
-
no_of_by‹s_com¶‘ed
)>=
RISCV_PAGE_SIZE
)

205 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
¡¬tšg_addr_d©a
);

206 if(
¡©us_fšd_add»ss
==0)

208 
	`´štf
("[runtime] Unmapped‡ddress in dispatch_edgecall_ocall. Fatalƒrror. Exiting.\n");

209 
	`sbi_ex™_’şave
(-1);

213 ifĞ!Ğ(*
¡©us_fšd_add»ss
è& 
PTE_V
 ) )

215 
	`cİy_to_u£r
Ğ(*)
backup_sh¬ed_memÜy
,(*)
sh¬ed_bufãr
,
buff_size
);

216 
	`hªdË_·ge_çuÉ
(
¡¬tšg_addr_d©a
,
¡©us_fšd_add»ss
);

217 if(
debug
)

218 
	`´štf
("[ruÁime]…agçuÉ duršg cİy_to_u£r_·ge_wi£ oÀ0x%lx\n",
	`PAGE_DOWN
(
¡¬tšg_addr_d©a
) );

219 
	`cİy_äom_u£r
((*)
sh¬ed_bufãr
,(*)
backup_sh¬ed_memÜy
,
buff_size
);

222 
	`cİy_to_u£r
((*)
¡¬tšg_addr_d©a
,(*)
¡¬tšg_addr_utm
,
RISCV_PAGE_SIZE
);

223 
no_of_by‹s_com¶‘ed
+=
RISCV_PAGE_SIZE
;

224 
¡¬tšg_addr_utm
+=
RISCV_PAGE_SIZE
;

225 
¡¬tšg_addr_d©a
+=
RISCV_PAGE_SIZE
;

229 
¡©us_fšd_add»ss
=
	`__w®k
(
roÙ_·ge_bË_addr
,
¡¬tšg_addr_d©a
);

230 if(
¡©us_fšd_add»ss
==0)

232 
	`´štf
("[runtime] Unmapped‡ddress in dispatch_edgecall_ocall. Fatalƒrror. Exiting.\n");

233 
	`sbi_ex™_’şave
(-1);

236 ifĞ!Ğ(*
¡©us_fšd_add»ss
è& 
PTE_V
 ) )

238 
	`cİy_to_u£r
Ğ(*)
backup_sh¬ed_memÜy
,(*)
sh¬ed_bufãr
,
buff_size
);

239 
	`hªdË_·ge_çuÉ
(
¡¬tšg_addr_d©a
,
¡©us_fšd_add»ss
);

240 if(
debug
)

241 
	`´štf
("[ruÁime]…agçuÉ duršg cİy_to_u£r_·ge_wi£ oÀ0x%lx\n",
	`PAGE_DOWN
(
¡¬tšg_addr_d©a
) );

242 
	`cİy_to_u£r
((*)
sh¬ed_bufãr
,(*)
backup_sh¬ed_memÜy
,
buff_size
);

245 
Ëngth
 = 
d©a_Ën
-
no_of_by‹s_com¶‘ed
;

246 
is_¹
=0;

248  
	`cİy_to_u£r
((*)
¡¬tšg_addr_d©a
,(*)
¡¬tšg_addr_utm
,
Ëngth
);

250 
	}
}

253 
	$z”o_out_sh¬ed_bufãr
()

255 
i
=0;i<
buff_size
;i++è*((*)
sh¬ed_bufãr
+i)=0;

256 
	}
}

258 
ušŒ_t
 
	$di¥©ch_edgeÿÎ_oÿÎ
Ğ
ÿÎ_id
,

259 * 
d©a
, 
size_t
 
d©a_Ën
,

260 * 
»tuº_bufãr
, 
size_t
 
»tuº_Ën
,
ušŒ_t
 
¬g6
){

262 
ušŒ_t
 
»t
;

275 
edge_ÿÎ_t
* 
edge_ÿÎ
 = ((edge_ÿÎ_t*)
sh¬ed_bufãr
);

281 
edge_ÿÎ
->
ÿÎ_id
 = call_id;

282 
ušŒ_t
 
bufãr_d©a_¡¬t
 = 
	`edge_ÿÎ_d©a_±r
();

283 if(
d©a_Ën
 > (
sh¬ed_bufãr_size
 - (
bufãr_d©a_¡¬t
 - 
sh¬ed_bufãr
))){

285 
oÿÎ_”rÜ
;

289 
	`cİy_äom_u£r_·ge_wi£
((*)
bufãr_d©a_¡¬t
, (*)
d©a
, 
d©a_Ën
);

291 if(
	`edge_ÿÎ_£tup_ÿÎ
(
edge_ÿÎ
, (*)
bufãr_d©a_¡¬t
, 
d©a_Ën
) != 0){

293 
oÿÎ_”rÜ
;

297 
»t
 = 
	`SBI_CALL_1
(
SBI_SM_STOP_ENCLAVE
, 1);

298 
	`c¤_wr™e
(
s¡©us
, 
	`c¤_»ad
(sstatus) | 0x6000);

300 
	`š™_tim”
();

302 ià(
»t
 != 0) {

304 
oÿÎ_”rÜ
;

307 if(
edge_ÿÎ
->
»tuº_d©a
.
ÿÎ_¡©us
 !ğ
CALL_STATUS_OK
){

309 
oÿÎ_”rÜ
;

312 ifĞ
»tuº_Ën
 == 0 ){

315  (
ušŒ_t
)
NULL
;

318 
ušŒ_t
 
»tuº_±r
;

319 if(
	`edge_ÿÎ_»t_±r
(
edge_ÿÎ
, &
»tuº_±r
) != 0){

321 
oÿÎ_”rÜ
;

330 
	`cİy_to_u£r_·ge_wi£
(
»tuº_bufãr
, (*)
»tuº_±r
, 
»tuº_Ën
);

332 if(
¬g6
!=0)

334 
edge_d©a_t
 
pkg¡r
;

335 
	`memıy
Ğ(*)&
pkg¡r
, (*)
»tuº_±r
,
»tuº_Ën
 );

336 
	`hªdË_cİy_äom_sh¬ed
Ğ(*)
¬g6
, 
pkg¡r
.
off£t
,pkg¡r.
size
);

341 
oÿÎ_”rÜ
:

344 
	}
}

347 
ušŒ_t
 
	$hªdË_cİy_äom_sh¬ed
(* 
d¡
, 
ušŒ_t
 
off£t
, 
size_t
 
size
){

354 
ušŒ_t
 
¤c_±r
=
off£t
;

356 if(
	`edge_ÿÎ_g‘_±r_äom_off£t
(
off£t
, 
size
,

357 &
¤c_±r
) != 0){

360  
	`cİy_to_u£r_·ge_wi£
(
d¡
, (*)
¤c_±r
, 
size
);

361 
	}
}

363 
	$š™_edge_š‹º®s
(){

364 
	`edge_ÿÎ_š™_š‹º®s
(
sh¬ed_bufãr
, 
sh¬ed_bufãr_size
);

365 
	}
}

369 
ušŒ_t
 
	$hªdË_sbrk
(
size_t
 
by‹s
)

371  
	`¹_hªdË_sbrk
(
by‹s
);

372 
	}
}

373 
ušŒ_t
 
	$hªdË_¤ªd
(
size_t
 
loc
,size_ˆ
sz
)

397 
	`¹_ut_g‘¿ndom
((*è
loc
, 
sz
);

403 
	}
}

405 
	$hªdË_sysÿÎ
(
’ş_ùx_t
* 
ùx
)

407 
ušŒ_t
 
n
 = 
ùx
->
»gs
.
a7
;

408 
ušŒ_t
 
¬g0
 = 
ùx
->
»gs
.
a0
;

409 
ušŒ_t
 
¬g1
 = 
ùx
->
»gs
.
a1
;

410 
ušŒ_t
 
¬g2
 = 
ùx
->
»gs
.
a2
;

411 
ušŒ_t
 
¬g3
 = 
ùx
->
»gs
.
a3
;

412 
ušŒ_t
 
¬g4
 = 
ùx
->
»gs
.
a4
;

414 
ušŒ_t
 
¬g6
 = 
ùx
->
»gs
.
a6
;

418 #ifdeà
IO_SYSCALL_WRAPPING


419 
ušŒ_t
 
¬g5
 = 
ùx
->
»gs
.
a5
;

421 
ušŒ_t
 
»t
 = 0;

423 
ùx
->
»gs
.
£pc
 += 4;

425 
n
) {

426 (
RUNTIME_SYSCALL_EXIT
):

427 
	`SBI_CALL_1
(
SBI_SM_EXIT_ENCLAVE
, 
¬g0
);

429 (
RUNTIME_SYSCALL_OCALL
):

430 
»t
 = 
	`di¥©ch_edgeÿÎ_oÿÎ
(
¬g0
, (*)
¬g1
, 
¬g2
, (*)
¬g3
, 
¬g4
,
¬g6
);

432 (
RUNTIME_SYSCALL_SHAREDCOPY
):

433 
»t
 = 
	`hªdË_cİy_äom_sh¬ed
((*)
¬g0
, 
¬g1
, 
¬g2
);

435 (
RUNTIME_SYSCALL_ATTEST_ENCLAVE
):;

436 
ušŒ_t
 
¬g0_Œªs
 = 
	`Œª¦©e
(
¬g0
);

437 
ušŒ_t
 
¬g1_Œªs
 = 
	`Œª¦©e
(
¬g1
);

438 
»t
 = 
	`SBI_CALL_3
(
SBI_SM_ATTEST_ENCLAVE
, 
¬g0_Œªs
, 
¬g1_Œªs
, 
¬g2
);

443 (
RUNTIME_SYSCALL_SBRK
):;

445 
»t
 = 
	`hªdË_sbrk
(
¬g0
);

448 (
RUNTIME_SYSCALL_RAND
):;

449 
»t
 = 
	`hªdË_¤ªd
(
¬g0
,
¬g1
);

454 #ifdeà
LINUX_SYSCALL_WRAPPING


455 (
SYS_şock_g‘time
):

456 
»t
 = 
	`lšux_şock_g‘time
((
__şockid_t
)
¬g0
, (
time¥ec
*)
¬g1
);

459 (
SYS_g‘¿ndom
):

460 
»t
 = 
	`lšux_g‘¿ndom
((*)
¬g0
, (
size_t
)
¬g1
, ()
¬g2
);

463 (
SYS_¹_sig´ocmask
):

464 
»t
 = 
	`lšux_¹_sig´ocmask
(()
¬g0
, (cÚ¡ 
sig£t_t
*)
¬g1
, (sig£t_t*)
¬g2
);

467 (
SYS_g‘pid
):

468 
»t
 = 
	`lšux_g‘pid
();

471 (
SYS_uÇme
):

472 
»t
 = 
	`lšux_uÇme
((*è
¬g0
);

475 (
SYS_¹_sigaùiÚ
):

476 
»t
 = 
	`lšux_RET_ZERO_w¿p
(
n
);

479 (
SYS_£t_tid_add»ss
):

480 
»t
 = 
	`lšux_£t_tid_add»ss
((*è
¬g0
);

483 (
SYS_brk
):

484 
»t
 = 
	`sysÿÎ_brk
((*è
¬g0
);

487 (
SYS_mm­
):

488 
»t
 = 
	`sysÿÎ_mm­
((*è
¬g0
, (
size_t
)
¬g1
, ()
¬g2
,

489 ()
¬g3
, ()
¬g4
, (
__off_t
)
¬g5
);

492 (
SYS_munm­
):

493 
»t
 = 
	`sysÿÎ_munm­
((*è
¬g0
, (
size_t
)
¬g1
);

496 (
SYS_ex™
):

497 (
SYS_ex™_group
):

498 
	`´št_¡¿û
("[ruÁime]ƒx™ o¸ex™_grou°(%lu)\r\n",
n
);

499 
	`SBI_CALL_1
(
SBI_SM_EXIT_ENCLAVE
, 
¬g0
);

503 #ifdeà
IO_SYSCALL_WRAPPING


504 (
SYS_»ad
):

505 
»t
 = 
	`io_sysÿÎ_»ad
(()
¬g0
, (*)
¬g1
, (
size_t
)
¬g2
);

507 (
SYS_wr™e
):

508 
»t
 = 
	`io_sysÿÎ_wr™e
(()
¬g0
, (*)
¬g1
, (
size_t
)
¬g2
);

510 (
SYS_wr™ev
):

511 
»t
 = 
	`io_sysÿÎ_wr™ev
(()
¬g0
, (cÚ¡ 
iovec
*)
¬g1
, ()
¬g2
);

513 (
SYS_»adv
):

514 
»t
 = 
	`io_sysÿÎ_»adv
(()
¬g0
, (cÚ¡ 
iovec
*)
¬g1
, ()
¬g2
);

516 (
SYS_İ’©
):

517 
»t
 = 
	`io_sysÿÎ_İ’©
(()
¬g0
, (*)
¬g1
, ()
¬g2
, (
mode_t
)
¬g3
);

519 (
SYS_uÆšk©
):

520 
»t
 = 
	`io_sysÿÎ_uÆšk©
(()
¬g0
, (*)
¬g1
, ()
¬g2
);

522 (
SYS_f¡©©
):

523 
»t
 = 
	`io_sysÿÎ_f¡©©
(()
¬g0
, (*)
¬g1
, (
¡©
*)
¬g2
, ()
¬g3
);

525 (
SYS_l£ek
):

526 
»t
 = 
	`io_sysÿÎ_l£ek
(()
¬g0
, (
off_t
)
¬g1
, ()
¬g2
);

528 (
SYS_árunÿ‹
):

529 
»t
 = 
	`io_sysÿÎ_árunÿ‹
(()
¬g0
, (
off_t
)
¬g1
);

531 (
SYS_sync
):

532 
»t
 = 
	`io_sysÿÎ_sync
();

534 (
SYS_fsync
):

535 
»t
 = 
	`io_sysÿÎ_fsync
(()
¬g0
);

537 (
SYS_şo£
):

538 
»t
 = 
	`io_sysÿÎ_şo£
(()
¬g0
);

543 (
RUNTIME_SYSCALL_UNKNOWN
):

545 
	`´št_¡¿û
("[ruÁime] sysÿÎ %ld‚Ù im¶em’‹d\r\n", (è
n
);

546 
»t
 = -1;

551 
ùx
->
»gs
.
a0
 = 
»t
;

552 
	`c¤_wr™e
(
s¡©us
, 
	`c¤_»ad
(sstatus) | 0x6000);

555 
	}
}

	@syscall.h

5 #iâdeà
__SYSCALL_H__


6 
	#__SYSCALL_H__


	)

8 
	~"´štf.h
"

9 
	~"»gs.h
"

10 
	~"edge_sysÿÎ.h
"

11 
	~"vm.h
"

13 
	#RUNTIME_SYSCALL_UNKNOWN
 1000

	)

14 
	#RUNTIME_SYSCALL_OCALL
 1001

	)

15 
	#RUNTIME_SYSCALL_SHAREDCOPY
 1002

	)

16 
	#RUNTIME_SYSCALL_ATTEST_ENCLAVE
 1003

	)

17 
	#RUNTIME_SYSCALL_EXIT
 1101

	)

18 
	#RUNTIME_SYSCALL_SBRK
 2000

	)

19 
	#RUNTIME_SYSCALL_RAND
 3000

	)

21 
hªdË_sysÿÎ
(
’ş_ùx_t
* 
ùx
);

22 
š™_edge_š‹º®s
();

23 
ušŒ_t
 
di¥©ch_edgeÿÎ_sysÿÎ
(
edge_sysÿÎ_t
* 
sysÿÎ_d©a_±r
,

24 
size_t
 
d©a_Ën
);

26 
ušŒ_t
 
di¥©ch_edgeÿÎ_oÿÎ
Ğ
ÿÎ_id
,

27 * 
d©a
, 
size_t
 
d©a_Ën
,

28 * 
»tuº_bufãr
, 
size_t
 
»tuº_Ën
,
ušŒ_t
 
¬g6
);

32 
ušŒ_t
 
hªdË_cİy_äom_sh¬ed
(* 
d¡
, ušŒ_ˆ
off£t
, 
size_t
 
size
);

38 #ifdeà
INTERNAL_STRACE


39 
	#´št_¡¿û
 
´štf


	)

41 
	#´št_¡¿û
(...)

	)

	@syscall_nums.h

3 
	#__NR_io_£tup
 0

	)

4 
	#__NR_io_de¡roy
 1

	)

5 
	#__NR_io_subm™
 2

	)

6 
	#__NR_io_ÿnûl
 3

	)

7 
	#__NR_io_g‘ev’ts
 4

	)

8 
	#__NR_£tx©Œ
 5

	)

9 
	#__NR_l£tx©Œ
 6

	)

10 
	#__NR_f£tx©Œ
 7

	)

11 
	#__NR_g‘x©Œ
 8

	)

12 
	#__NR_lg‘x©Œ
 9

	)

13 
	#__NR_fg‘x©Œ
 10

	)

14 
	#__NR_li¡x©Œ
 11

	)

15 
	#__NR_Îi¡x©Œ
 12

	)

16 
	#__NR_æi¡x©Œ
 13

	)

17 
	#__NR_»movex©Œ
 14

	)

18 
	#__NR_Ìemovex©Œ
 15

	)

19 
	#__NR_äemovex©Œ
 16

	)

20 
	#__NR_g‘cwd
 17

	)

21 
	#__NR_lookup_dcook›
 18

	)

22 
	#__NR_ev’tfd2
 19

	)

23 
	#__NR_•Şl_ü—‹1
 20

	)

24 
	#__NR_•Şl_ùl
 21

	)

25 
	#__NR_•Şl_pwa™
 22

	)

26 
	#__NR_dup
 23

	)

27 
	#__NR_dup3
 24

	)

28 
	#__NR_fú
 25

	)

29 
	#__NR_šÙify_š™1
 26

	)

30 
	#__NR_šÙify_add_w©ch
 27

	)

31 
	#__NR_šÙify_rm_w©ch
 28

	)

32 
	#__NR_ioùl
 29

	)

33 
	#__NR_iİrio_£t
 30

	)

34 
	#__NR_iİrio_g‘
 31

	)

35 
	#__NR_æock
 32

	)

36 
	#__NR_mknod©
 33

	)

37 
	#__NR_mkdœ©
 34

	)

38 
	#__NR_uÆšk©
 35

	)

39 
	#__NR_symlšk©
 36

	)

40 
	#__NR_lšk©
 37

	)

41 
	#__NR_umouÁ2
 39

	)

42 
	#__NR_mouÁ
 40

	)

43 
	#__NR_pivÙ_roÙ
 41

	)

44 
	#__NR_nfs£rvùl
 42

	)

45 
	#__NR_¡©fs
 43

	)

46 
	#__NR_f¡©fs
 44

	)

47 
	#__NR_Œunÿ‹
 45

	)

48 
	#__NR_árunÿ‹
 46

	)

49 
	#__NR_çÎoÿ‹
 47

	)

50 
	#__NR_çcûs§t
 48

	)

51 
	#__NR_chdœ
 49

	)

52 
	#__NR_fchdœ
 50

	)

53 
	#__NR_chroÙ
 51

	)

54 
	#__NR_fchmod
 52

	)

55 
	#__NR_fchmod©
 53

	)

56 
	#__NR_fchowÇt
 54

	)

57 
	#__NR_fchown
 55

	)

58 
	#__NR_İ’©
 56

	)

59 
	#__NR_şo£
 57

	)

60 
	#__NR_vhªgup
 58

	)

61 
	#__NR_pe2
 59

	)

62 
	#__NR_quÙaùl
 60

	)

63 
	#__NR_g‘d’ts64
 61

	)

64 
	#__NR_l£ek
 62

	)

65 
	#__NR_»ad
 63

	)

66 
	#__NR_wr™e
 64

	)

67 
	#__NR_»adv
 65

	)

68 
	#__NR_wr™ev
 66

	)

69 
	#__NR_´—d64
 67

	)

70 
	#__NR_pwr™e64
 68

	)

71 
	#__NR_´—dv
 69

	)

72 
	#__NR_pwr™ev
 70

	)

73 
	#__NR_£ndfe
 71

	)

74 
	#__NR_p£Ëù6
 72

	)

75 
	#__NR_µŞl
 73

	)

76 
	#__NR_sigÇlfd4
 74

	)

77 
	#__NR_vm¥liû
 75

	)

78 
	#__NR_¥liû
 76

	)

79 
	#__NR_‹e
 77

	)

80 
	#__NR_»adlšk©
 78

	)

81 
	#__NR_f¡©©
 79

	)

82 
	#__NR_f¡©
 80

	)

83 
	#__NR_sync
 81

	)

84 
	#__NR_fsync
 82

	)

85 
	#__NR_fd©async
 83

	)

86 
	#__NR_sync_fe_¿nge
 84

	)

87 
	#__NR_tim”fd_ü—‹
 85

	)

88 
	#__NR_tim”fd_£‰ime
 86

	)

89 
	#__NR_tim”fd_g‘time
 87

	)

90 
	#__NR_utim’§t
 88

	)

91 
	#__NR_acù
 89

	)

92 
	#__NR_ÿpg‘
 90

	)

93 
	#__NR_ÿp£t
 91

	)

94 
	#__NR_³rsÚ®™y
 92

	)

95 
	#__NR_ex™
 93

	)

96 
	#__NR_ex™_group
 94

	)

97 
	#__NR_wa™id
 95

	)

98 
	#__NR_£t_tid_add»ss
 96

	)

99 
	#__NR_unsh¬e
 97

	)

100 
	#__NR_fu‹x
 98

	)

101 
	#__NR_£t_robu¡_li¡
 99

	)

102 
	#__NR_g‘_robu¡_li¡
 100

	)

103 
	#__NR_Çno¦“p
 101

	)

104 
	#__NR_g‘™im”
 102

	)

105 
	#__NR_£t™im”
 103

	)

106 
	#__NR_kexec_lßd
 104

	)

107 
	#__NR_š™_moduË
 105

	)

108 
	#__NR_d–‘e_moduË
 106

	)

109 
	#__NR_tim”_ü—‹
 107

	)

110 
	#__NR_tim”_g‘time
 108

	)

111 
	#__NR_tim”_g‘ov”run
 109

	)

112 
	#__NR_tim”_£‰ime
 110

	)

113 
	#__NR_tim”_d–‘e
 111

	)

114 
	#__NR_şock_£‰ime
 112

	)

115 
	#__NR_şock_g‘time
 113

	)

116 
	#__NR_şock_g‘»s
 114

	)

117 
	#__NR_şock_Çno¦“p
 115

	)

118 
	#__NR_sy¦og
 116

	)

119 
	#__NR_±¿û
 117

	)

120 
	#__NR_sched_£¬am
 118

	)

121 
	#__NR_sched_£tscheduËr
 119

	)

122 
	#__NR_sched_g‘scheduËr
 120

	)

123 
	#__NR_sched_g‘·¿m
 121

	)

124 
	#__NR_sched_£ffš™y
 122

	)

125 
	#__NR_sched_g‘affš™y
 123

	)

126 
	#__NR_sched_y›ld
 124

	)

127 
	#__NR_sched_g‘_´iÜ™y_max
 125

	)

128 
	#__NR_sched_g‘_´iÜ™y_mš
 126

	)

129 
	#__NR_sched_¼_g‘_š‹rv®
 127

	)

130 
	#__NR_»¡¬t_sysÿÎ
 128

	)

131 
	#__NR_kl
 129

	)

132 
	#__NR_tkl
 130

	)

133 
	#__NR_tgkl
 131

	)

134 
	#__NR_sig®t¡ack
 132

	)

135 
	#__NR_¹_sigsu¥’d
 133

	)

136 
	#__NR_¹_sigaùiÚ
 134

	)

137 
	#__NR_¹_sig´ocmask
 135

	)

138 
	#__NR_¹_sig³ndšg
 136

	)

139 
	#__NR_¹_sigtimedwa™
 137

	)

140 
	#__NR_¹_sigqueuešfo
 138

	)

141 
	#__NR_¹_sig»tuº
 139

	)

142 
	#__NR_£riÜ™y
 140

	)

143 
	#__NR_g‘´iÜ™y
 141

	)

144 
	#__NR_»boÙ
 142

	)

145 
	#__NR_£Œegid
 143

	)

146 
	#__NR_£tgid
 144

	)

147 
	#__NR_£Œeuid
 145

	)

148 
	#__NR_£tuid
 146

	)

149 
	#__NR_£Œesuid
 147

	)

150 
	#__NR_g‘»suid
 148

	)

151 
	#__NR_£Œesgid
 149

	)

152 
	#__NR_g‘»sgid
 150

	)

153 
	#__NR_£tfsuid
 151

	)

154 
	#__NR_£tfsgid
 152

	)

155 
	#__NR_times
 153

	)

156 
	#__NR_£gid
 154

	)

157 
	#__NR_g‘pgid
 155

	)

158 
	#__NR_g‘sid
 156

	)

159 
	#__NR_£tsid
 157

	)

160 
	#__NR_g‘groups
 158

	)

161 
	#__NR_£tgroups
 159

	)

162 
	#__NR_uÇme
 160

	)

163 
	#__NR_£tho¡Çme
 161

	)

164 
	#__NR_£tdomašÇme
 162

	)

165 
	#__NR_g‘¾im™
 163

	)

166 
	#__NR_£Œlim™
 164

	)

167 
	#__NR_g‘ru§ge
 165

	)

168 
	#__NR_umask
 166

	)

169 
	#__NR_´ùl
 167

	)

170 
	#__NR_g‘ıu
 168

	)

171 
	#__NR_g‘timeofday
 169

	)

172 
	#__NR_£‰imeofday
 170

	)

173 
	#__NR_adjtimex
 171

	)

174 
	#__NR_g‘pid
 172

	)

175 
	#__NR_g‘µid
 173

	)

176 
	#__NR_g‘uid
 174

	)

177 
	#__NR_g‘euid
 175

	)

178 
	#__NR_g‘gid
 176

	)

179 
	#__NR_g‘egid
 177

	)

180 
	#__NR_g‘tid
 178

	)

181 
	#__NR_sysšfo
 179

	)

182 
	#__NR_mq_İ’
 180

	)

183 
	#__NR_mq_uÆšk
 181

	)

184 
	#__NR_mq_timed£nd
 182

	)

185 
	#__NR_mq_timed»ûive
 183

	)

186 
	#__NR_mq_nÙify
 184

	)

187 
	#__NR_mq_g‘£‰r
 185

	)

188 
	#__NR_msgg‘
 186

	)

189 
	#__NR_msgùl
 187

	)

190 
	#__NR_msgrcv
 188

	)

191 
	#__NR_msg¢d
 189

	)

192 
	#__NR_£mg‘
 190

	)

193 
	#__NR_£mùl
 191

	)

194 
	#__NR_£mtimedİ
 192

	)

195 
	#__NR_£mİ
 193

	)

196 
	#__NR_shmg‘
 194

	)

197 
	#__NR_shmùl
 195

	)

198 
	#__NR_shm©
 196

	)

199 
	#__NR_shmdt
 197

	)

200 
	#__NR_sock‘
 198

	)

201 
	#__NR_sock‘·œ
 199

	)

202 
	#__NR_bšd
 200

	)

203 
	#__NR_li¡’
 201

	)

204 
	#__NR_acû±
 202

	)

205 
	#__NR_cÚÃù
 203

	)

206 
	#__NR_g‘sockÇme
 204

	)

207 
	#__NR_g‘³”Çme
 205

	)

208 
	#__NR_£ndto
 206

	)

209 
	#__NR_»cväom
 207

	)

210 
	#__NR_£tsockİt
 208

	)

211 
	#__NR_g‘sockİt
 209

	)

212 
	#__NR_shutdown
 210

	)

213 
	#__NR_£ndmsg
 211

	)

214 
	#__NR_»cvmsg
 212

	)

215 
	#__NR_»adah—d
 213

	)

216 
	#__NR_brk
 214

	)

217 
	#__NR_munm­
 215

	)

218 
	#__NR_m»m­
 216

	)

219 
	#__NR_add_key
 217

	)

220 
	#__NR_»que¡_key
 218

	)

221 
	#__NR_keyùl
 219

	)

222 
	#__NR_şÚe
 220

	)

223 
	#__NR_execve
 221

	)

224 
	#__NR_mm­
 222

	)

225 
	#__NR_çdvi£64
 223

	)

226 
	#__NR_sw­Ú
 224

	)

227 
	#__NR_sw­off
 225

	)

228 
	#__NR_m´Ùeù
 226

	)

229 
	#__NR_msync
 227

	)

230 
	#__NR_mlock
 228

	)

231 
	#__NR_muÆock
 229

	)

232 
	#__NR_mlock®l
 230

	)

233 
	#__NR_muÆock®l
 231

	)

234 
	#__NR_mšcÜe
 232

	)

235 
	#__NR_madvi£
 233

	)

236 
	#__NR_»m­_fe_·ges
 234

	)

237 
	#__NR_mbšd
 235

	)

238 
	#__NR_g‘_mempŞicy
 236

	)

239 
	#__NR_£t_mempŞicy
 237

	)

240 
	#__NR_mig¿‹_·ges
 238

	)

241 
	#__NR_move_·ges
 239

	)

242 
	#__NR_¹_tgsigqueuešfo
 240

	)

243 
	#__NR_³rf_ev’t_İ’
 241

	)

244 
	#__NR_acû±4
 242

	)

245 
	#__NR_»cvmmsg
 243

	)

246 
	#__NR_¬ch_¥ecific_sysÿÎ
 244

	)

247 
	#__NR_wa™4
 260

	)

248 
	#__NR_´lim™64
 261

	)

249 
	#__NR_çnÙify_š™
 262

	)

250 
	#__NR_çnÙify_m¬k
 263

	)

251 
	#__NR_Çme_to_hªdË_©
 264

	)

252 
	#__NR_İ’_by_hªdË_©
 265

	)

253 
	#__NR_şock_adjtime
 266

	)

254 
	#__NR_syncfs
 267

	)

255 
	#__NR_£Šs
 268

	)

256 
	#__NR_£ndmmsg
 269

	)

257 
	#__NR_´oûss_vm_»adv
 270

	)

258 
	#__NR_´oûss_vm_wr™ev
 271

	)

259 
	#__NR_kcmp
 272

	)

260 
	#__NR_fš™_moduË
 273

	)

261 
	#__NR_sched_£‰r
 274

	)

262 
	#__NR_sched_g‘©Œ
 275

	)

263 
	#__NR_»Çm—t2
 276

	)

264 
	#__NR_£ccomp
 277

	)

265 
	#__NR_g‘¿ndom
 278

	)

266 
	#__NR_memfd_ü—‹
 279

	)

267 
	#__NR_bpf
 280

	)

268 
	#__NR_execv—t
 281

	)

269 
	#__NR_u£rçuÉfd
 282

	)

270 
	#__NR_memb¬r›r
 283

	)

271 
	#__NR_mlock2
 284

	)

272 
	#__NR_cİy_fe_¿nge
 285

	)

273 
	#__NR_´—dv2
 286

	)

274 
	#__NR_pwr™ev2
 287

	)

275 
	#__NR_pkey_m´Ùeù
 288

	)

276 
	#__NR_pkey_®loc
 289

	)

277 
	#__NR_pkey_ä“
 290

	)

278 
	#__NR_sy¤iscv
 
__NR_¬ch_¥ecific_sysÿÎ


	)

279 
	#__NR_riscv_æush_iÿche
 (
__NR_sy¤iscv
 + 15)

	)

281 
	#SYS_io_£tup
 0

	)

282 
	#SYS_io_de¡roy
 1

	)

283 
	#SYS_io_subm™
 2

	)

284 
	#SYS_io_ÿnûl
 3

	)

285 
	#SYS_io_g‘ev’ts
 4

	)

286 
	#SYS_£tx©Œ
 5

	)

287 
	#SYS_l£tx©Œ
 6

	)

288 
	#SYS_f£tx©Œ
 7

	)

289 
	#SYS_g‘x©Œ
 8

	)

290 
	#SYS_lg‘x©Œ
 9

	)

291 
	#SYS_fg‘x©Œ
 10

	)

292 
	#SYS_li¡x©Œ
 11

	)

293 
	#SYS_Îi¡x©Œ
 12

	)

294 
	#SYS_æi¡x©Œ
 13

	)

295 
	#SYS_»movex©Œ
 14

	)

296 
	#SYS_Ìemovex©Œ
 15

	)

297 
	#SYS_äemovex©Œ
 16

	)

298 
	#SYS_g‘cwd
 17

	)

299 
	#SYS_lookup_dcook›
 18

	)

300 
	#SYS_ev’tfd2
 19

	)

301 
	#SYS_•Şl_ü—‹1
 20

	)

302 
	#SYS_•Şl_ùl
 21

	)

303 
	#SYS_•Şl_pwa™
 22

	)

304 
	#SYS_dup
 23

	)

305 
	#SYS_dup3
 24

	)

306 
	#SYS_fú
 25

	)

307 
	#SYS_šÙify_š™1
 26

	)

308 
	#SYS_šÙify_add_w©ch
 27

	)

309 
	#SYS_šÙify_rm_w©ch
 28

	)

310 
	#SYS_ioùl
 29

	)

311 
	#SYS_iİrio_£t
 30

	)

312 
	#SYS_iİrio_g‘
 31

	)

313 
	#SYS_æock
 32

	)

314 
	#SYS_mknod©
 33

	)

315 
	#SYS_mkdœ©
 34

	)

316 
	#SYS_uÆšk©
 35

	)

317 
	#SYS_symlšk©
 36

	)

318 
	#SYS_lšk©
 37

	)

319 
	#SYS_umouÁ2
 39

	)

320 
	#SYS_mouÁ
 40

	)

321 
	#SYS_pivÙ_roÙ
 41

	)

322 
	#SYS_nfs£rvùl
 42

	)

323 
	#SYS_¡©fs
 43

	)

324 
	#SYS_f¡©fs
 44

	)

325 
	#SYS_Œunÿ‹
 45

	)

326 
	#SYS_árunÿ‹
 46

	)

327 
	#SYS_çÎoÿ‹
 47

	)

328 
	#SYS_çcûs§t
 48

	)

329 
	#SYS_chdœ
 49

	)

330 
	#SYS_fchdœ
 50

	)

331 
	#SYS_chroÙ
 51

	)

332 
	#SYS_fchmod
 52

	)

333 
	#SYS_fchmod©
 53

	)

334 
	#SYS_fchowÇt
 54

	)

335 
	#SYS_fchown
 55

	)

336 
	#SYS_İ’©
 56

	)

337 
	#SYS_şo£
 57

	)

338 
	#SYS_vhªgup
 58

	)

339 
	#SYS_pe2
 59

	)

340 
	#SYS_quÙaùl
 60

	)

341 
	#SYS_g‘d’ts64
 61

	)

342 
	#SYS_l£ek
 62

	)

343 
	#SYS_»ad
 63

	)

344 
	#SYS_wr™e
 64

	)

345 
	#SYS_»adv
 65

	)

346 
	#SYS_wr™ev
 66

	)

347 
	#SYS_´—d64
 67

	)

348 
	#SYS_pwr™e64
 68

	)

349 
	#SYS_´—dv
 69

	)

350 
	#SYS_pwr™ev
 70

	)

351 
	#SYS_£ndfe
 71

	)

352 
	#SYS_p£Ëù6
 72

	)

353 
	#SYS_µŞl
 73

	)

354 
	#SYS_sigÇlfd4
 74

	)

355 
	#SYS_vm¥liû
 75

	)

356 
	#SYS_¥liû
 76

	)

357 
	#SYS_‹e
 77

	)

358 
	#SYS_»adlšk©
 78

	)

359 
	#SYS_f¡©©
 79

	)

360 
	#SYS_f¡©
 80

	)

361 
	#SYS_sync
 81

	)

362 
	#SYS_fsync
 82

	)

363 
	#SYS_fd©async
 83

	)

364 
	#SYS_sync_fe_¿nge
 84

	)

365 
	#SYS_tim”fd_ü—‹
 85

	)

366 
	#SYS_tim”fd_£‰ime
 86

	)

367 
	#SYS_tim”fd_g‘time
 87

	)

368 
	#SYS_utim’§t
 88

	)

369 
	#SYS_acù
 89

	)

370 
	#SYS_ÿpg‘
 90

	)

371 
	#SYS_ÿp£t
 91

	)

372 
	#SYS_³rsÚ®™y
 92

	)

373 
	#SYS_ex™
 93

	)

374 
	#SYS_ex™_group
 94

	)

375 
	#SYS_wa™id
 95

	)

376 
	#SYS_£t_tid_add»ss
 96

	)

377 
	#SYS_unsh¬e
 97

	)

378 
	#SYS_fu‹x
 98

	)

379 
	#SYS_£t_robu¡_li¡
 99

	)

380 
	#SYS_g‘_robu¡_li¡
 100

	)

381 
	#SYS_Çno¦“p
 101

	)

382 
	#SYS_g‘™im”
 102

	)

383 
	#SYS_£t™im”
 103

	)

384 
	#SYS_kexec_lßd
 104

	)

385 
	#SYS_š™_moduË
 105

	)

386 
	#SYS_d–‘e_moduË
 106

	)

387 
	#SYS_tim”_ü—‹
 107

	)

388 
	#SYS_tim”_g‘time
 108

	)

389 
	#SYS_tim”_g‘ov”run
 109

	)

390 
	#SYS_tim”_£‰ime
 110

	)

391 
	#SYS_tim”_d–‘e
 111

	)

392 
	#SYS_şock_£‰ime
 112

	)

393 
	#SYS_şock_g‘time
 113

	)

394 
	#SYS_şock_g‘»s
 114

	)

395 
	#SYS_şock_Çno¦“p
 115

	)

396 
	#SYS_sy¦og
 116

	)

397 
	#SYS_±¿û
 117

	)

398 
	#SYS_sched_£¬am
 118

	)

399 
	#SYS_sched_£tscheduËr
 119

	)

400 
	#SYS_sched_g‘scheduËr
 120

	)

401 
	#SYS_sched_g‘·¿m
 121

	)

402 
	#SYS_sched_£ffš™y
 122

	)

403 
	#SYS_sched_g‘affš™y
 123

	)

404 
	#SYS_sched_y›ld
 124

	)

405 
	#SYS_sched_g‘_´iÜ™y_max
 125

	)

406 
	#SYS_sched_g‘_´iÜ™y_mš
 126

	)

407 
	#SYS_sched_¼_g‘_š‹rv®
 127

	)

408 
	#SYS_»¡¬t_sysÿÎ
 128

	)

409 
	#SYS_kl
 129

	)

410 
	#SYS_tkl
 130

	)

411 
	#SYS_tgkl
 131

	)

412 
	#SYS_sig®t¡ack
 132

	)

413 
	#SYS_¹_sigsu¥’d
 133

	)

414 
	#SYS_¹_sigaùiÚ
 134

	)

415 
	#SYS_¹_sig´ocmask
 135

	)

416 
	#SYS_¹_sig³ndšg
 136

	)

417 
	#SYS_¹_sigtimedwa™
 137

	)

418 
	#SYS_¹_sigqueuešfo
 138

	)

419 
	#SYS_¹_sig»tuº
 139

	)

420 
	#SYS_£riÜ™y
 140

	)

421 
	#SYS_g‘´iÜ™y
 141

	)

422 
	#SYS_»boÙ
 142

	)

423 
	#SYS_£Œegid
 143

	)

424 
	#SYS_£tgid
 144

	)

425 
	#SYS_£Œeuid
 145

	)

426 
	#SYS_£tuid
 146

	)

427 
	#SYS_£Œesuid
 147

	)

428 
	#SYS_g‘»suid
 148

	)

429 
	#SYS_£Œesgid
 149

	)

430 
	#SYS_g‘»sgid
 150

	)

431 
	#SYS_£tfsuid
 151

	)

432 
	#SYS_£tfsgid
 152

	)

433 
	#SYS_times
 153

	)

434 
	#SYS_£gid
 154

	)

435 
	#SYS_g‘pgid
 155

	)

436 
	#SYS_g‘sid
 156

	)

437 
	#SYS_£tsid
 157

	)

438 
	#SYS_g‘groups
 158

	)

439 
	#SYS_£tgroups
 159

	)

440 
	#SYS_uÇme
 160

	)

441 
	#SYS_£tho¡Çme
 161

	)

442 
	#SYS_£tdomašÇme
 162

	)

443 
	#SYS_g‘¾im™
 163

	)

444 
	#SYS_£Œlim™
 164

	)

445 
	#SYS_g‘ru§ge
 165

	)

446 
	#SYS_umask
 166

	)

447 
	#SYS_´ùl
 167

	)

448 
	#SYS_g‘ıu
 168

	)

449 
	#SYS_g‘timeofday
 169

	)

450 
	#SYS_£‰imeofday
 170

	)

451 
	#SYS_adjtimex
 171

	)

452 
	#SYS_g‘pid
 172

	)

453 
	#SYS_g‘µid
 173

	)

454 
	#SYS_g‘uid
 174

	)

455 
	#SYS_g‘euid
 175

	)

456 
	#SYS_g‘gid
 176

	)

457 
	#SYS_g‘egid
 177

	)

458 
	#SYS_g‘tid
 178

	)

459 
	#SYS_sysšfo
 179

	)

460 
	#SYS_mq_İ’
 180

	)

461 
	#SYS_mq_uÆšk
 181

	)

462 
	#SYS_mq_timed£nd
 182

	)

463 
	#SYS_mq_timed»ûive
 183

	)

464 
	#SYS_mq_nÙify
 184

	)

465 
	#SYS_mq_g‘£‰r
 185

	)

466 
	#SYS_msgg‘
 186

	)

467 
	#SYS_msgùl
 187

	)

468 
	#SYS_msgrcv
 188

	)

469 
	#SYS_msg¢d
 189

	)

470 
	#SYS_£mg‘
 190

	)

471 
	#SYS_£mùl
 191

	)

472 
	#SYS_£mtimedİ
 192

	)

473 
	#SYS_£mİ
 193

	)

474 
	#SYS_shmg‘
 194

	)

475 
	#SYS_shmùl
 195

	)

476 
	#SYS_shm©
 196

	)

477 
	#SYS_shmdt
 197

	)

478 
	#SYS_sock‘
 198

	)

479 
	#SYS_sock‘·œ
 199

	)

480 
	#SYS_bšd
 200

	)

481 
	#SYS_li¡’
 201

	)

482 
	#SYS_acû±
 202

	)

483 
	#SYS_cÚÃù
 203

	)

484 
	#SYS_g‘sockÇme
 204

	)

485 
	#SYS_g‘³”Çme
 205

	)

486 
	#SYS_£ndto
 206

	)

487 
	#SYS_»cväom
 207

	)

488 
	#SYS_£tsockİt
 208

	)

489 
	#SYS_g‘sockİt
 209

	)

490 
	#SYS_shutdown
 210

	)

491 
	#SYS_£ndmsg
 211

	)

492 
	#SYS_»cvmsg
 212

	)

493 
	#SYS_»adah—d
 213

	)

494 
	#SYS_brk
 214

	)

495 
	#SYS_munm­
 215

	)

496 
	#SYS_m»m­
 216

	)

497 
	#SYS_add_key
 217

	)

498 
	#SYS_»que¡_key
 218

	)

499 
	#SYS_keyùl
 219

	)

500 
	#SYS_şÚe
 220

	)

501 
	#SYS_execve
 221

	)

502 
	#SYS_mm­
 222

	)

503 
	#SYS_çdvi£64
 223

	)

504 
	#SYS_sw­Ú
 224

	)

505 
	#SYS_sw­off
 225

	)

506 
	#SYS_m´Ùeù
 226

	)

507 
	#SYS_msync
 227

	)

508 
	#SYS_mlock
 228

	)

509 
	#SYS_muÆock
 229

	)

510 
	#SYS_mlock®l
 230

	)

511 
	#SYS_muÆock®l
 231

	)

512 
	#SYS_mšcÜe
 232

	)

513 
	#SYS_madvi£
 233

	)

514 
	#SYS_»m­_fe_·ges
 234

	)

515 
	#SYS_mbšd
 235

	)

516 
	#SYS_g‘_mempŞicy
 236

	)

517 
	#SYS_£t_mempŞicy
 237

	)

518 
	#SYS_mig¿‹_·ges
 238

	)

519 
	#SYS_move_·ges
 239

	)

520 
	#SYS_¹_tgsigqueuešfo
 240

	)

521 
	#SYS_³rf_ev’t_İ’
 241

	)

522 
	#SYS_acû±4
 242

	)

523 
	#SYS_»cvmmsg
 243

	)

524 
	#SYS_¬ch_¥ecific_sysÿÎ
 244

	)

525 
	#SYS_wa™4
 260

	)

526 
	#SYS_´lim™64
 261

	)

527 
	#SYS_çnÙify_š™
 262

	)

528 
	#SYS_çnÙify_m¬k
 263

	)

529 
	#SYS_Çme_to_hªdË_©
 264

	)

530 
	#SYS_İ’_by_hªdË_©
 265

	)

531 
	#SYS_şock_adjtime
 266

	)

532 
	#SYS_syncfs
 267

	)

533 
	#SYS_£Šs
 268

	)

534 
	#SYS_£ndmmsg
 269

	)

535 
	#SYS_´oûss_vm_»adv
 270

	)

536 
	#SYS_´oûss_vm_wr™ev
 271

	)

537 
	#SYS_kcmp
 272

	)

538 
	#SYS_fš™_moduË
 273

	)

539 
	#SYS_sched_£‰r
 274

	)

540 
	#SYS_sched_g‘©Œ
 275

	)

541 
	#SYS_»Çm—t2
 276

	)

542 
	#SYS_£ccomp
 277

	)

543 
	#SYS_g‘¿ndom
 278

	)

544 
	#SYS_memfd_ü—‹
 279

	)

545 
	#SYS_bpf
 280

	)

546 
	#SYS_execv—t
 281

	)

547 
	#SYS_u£rçuÉfd
 282

	)

548 
	#SYS_memb¬r›r
 283

	)

549 
	#SYS_mlock2
 284

	)

550 
	#SYS_cİy_fe_¿nge
 285

	)

551 
	#SYS_´—dv2
 286

	)

552 
	#SYS_pwr™ev2
 287

	)

553 
	#SYS_pkey_m´Ùeù
 288

	)

554 
	#SYS_pkey_®loc
 289

	)

555 
	#SYS_pkey_ä“
 290

	)

556 
	#SYS_sy¤iscv
 
__NR_¬ch_¥ecific_sysÿÎ


	)

557 
	#SYS_riscv_æush_iÿche
 (
__NR_sy¤iscv
 + 15)

	)

	@timex.h

1 #iâdeà
_TIME_X_


2 
	#_TIME_X_


	)

3 
	tcyşes_t
;

5 
šlše
 
cyşes_t
 
	$g‘_cyşes_šlše
()

7 
cyşes_t
 
n
;

9 
__asm__
 
	`__vŞ©e__
 (

11 : "ô" (
n
));

12  
n
;

13 
	}
}

14 
	#g‘_cyşes
 
g‘_cyşes_šlše


	)

16 
šlše
 
ušt64_t
 
	$g‘_cyşes64
()

18  
	`g‘_cyşes
();

19 
	}
}

21 
	#ARCH_HAS_READ_CURRENT_TIMER


	)

23 
šlše
 
	$»ad_cu¼’t_tim”
(*
tim”_v®
)

25 *
tim”_v®
 = 
	`g‘_cyşes
();

27 
	}
}

	@tiny-malloc.c

55 #iâdeà
MALLOC_DIRECTION


56 
	#MALLOC_DIRECTION
 1

	)

58 
	#OCALL_PRINT_BUFFER
 1

	)

59 
	#OCALL_PRINT_VALUE
 2

	)

60 
	#OCALL_GET_STRING
 4

	)

62 
	~<¡ddef.h
>

63 
	~"¡ršg.h
"

64 
	~<sysÿÎ.h
>

65 
	~"m®loc.h
"

66 
	~"¹_ut.h
"

68 
	~"´štf.h
"

69 * 
m®loc
(
size_t
);

70 
ä“
(*);

71 * 
»®loc
(*, 
size_t
);

72 * 
mem®ign
(
size_t
, size_t);

73 * 
v®loc
(
size_t
);

74 * 
pv®loc
(
size_t
);

75 * 
ÿÎoc
(
size_t
, size_t);

76 
cä“
(*);

77 
m®loc_Œim
(
size_t
);

78 
size_t
 
m®loc_u§bË_size
(*);

79 
m®loc_¡©s
();

80 
m®lİt
(, );

81 
m®lšfo
 mallinfo();

89 
æe
 
	g__m®loc_ä“li¡
 = 0;

90 * 
	g__m®loc_’d_¹
 = 0;

96 
	#M_ALIGN
(
x
, 
®ign
è(-(
size_t
)(xè& (×lignè- 1))

	)

100 
	#M_ALIGN_SUB
(
x
, 
®ign
è((
size_t
)(xè& (×lignè- 1))

	)

102 *
__m®loc_¡¬t_¹
;

103 *
__k”Ãl_¡ack_¡¬t
;

110 
	#MALLOC_MINIMUM_GAP
 32

	)

112 #ifdeà
__x¡Ümy16__


113 * 
¡ack_poš‹r
 
asm
 ("r15");

114 
	#MALLOC_LIMIT
 
¡ack_poš‹r


	)

116 
	#MALLOC_LIMIT
 
	`__butš_äame_add»ss
(0)

	)

119 #ià
MALLOC_DIRECTION
 < 0

120 
	#CAN_ALLOC_P
(
»quœed
) \

121 (((
size_t
è
__m®loc_’d_¹
 - (size_t)
MALLOC_LIMIT
 \

122 - 
MALLOC_MINIMUM_GAP
è>ğ(
»quœed
))

	)

124 
	#CAN_ALLOC_P
(
»quœed
) \

125 (((
size_t
)
MALLOC_LIMIT
 - (size_tè
__m®loc_’d_¹
 \

126 - 
MALLOC_MINIMUM_GAP
è>ğ(
»quœed
))

	)

131 
	#REAL_SIZE
(
sz
) \

132 ((
sz
è<  (
ä“li¡_’Œy
è-  (
size_t
) \

133 ?  (
ä“li¡_’Œy
) \

134 : 
sz
 +  (
size_t
è+ 
	`M_ALIGN
(sz,  (size_t)))

	)

138 
	$check_¿nge_ªd_ÿÎ_sbrk
(*
addr
, 
size_t
 
sz
)

142 
cur_sbrk
ğ
	`¹_hªdË_sbrk_¹
(0);cur_sbrk=cur_sbrk;

145 ifĞĞ()
addr
 + ()
sz
è>
cur_sbrk
 )

147 
	`¹_hªdË_sbrk_¹
ĞĞ()
addr
 + ()
sz
è- 
cur_sbrk
 );

153 
	}
}

161 
	$m®loc
 (
size_t
 
sz
)

166 
æe
 *
Ãxtä“
;

167 
æe
 
block
;

171 if(
__m®loc_’d_¹
 =ğ
NULL
){

172 
__m®loc_’d_¹
 = &
__m®loc_¡¬t_¹
;

177 
size_t
 
»®_size
 = 
	`REAL_SIZE
 (
sz
);

180 
Ãxtä“
 = &
__m®loc_ä“li¡
;

181 *
Ãxtä“
;

182 
Ãxtä“
 = &(*Ãxtä“)->
Ãxt
)

184 
block
 = *
Ãxtä“
;

186 ià(
block
->
size
 >ğ
»®_size
)

190 ià(
block
->
size
 < 
»®_size
 +  (
ä“li¡_’Œy
))

192 *
Ãxtä“
 = 
block
->
Ãxt
;

194 * 
m®loc_»tuº_addr
 = (*)&
block
->
Ãxt
;

199 
	`check_¿nge_ªd_ÿÎ_sbrk
(
m®loc_»tuº_addr
,
»®_size
);

200  
m®loc_»tuº_addr
;

204 
size_t
 
Ãwsize
 = 
block
->
size
 - 
»®_size
;

205 
æe
 
ÃwÃxt
 = 
block
->
Ãxt
;

206 *
Ãxtä“
 = (
æe
)((
size_t
)
block
 + 
»®_size
);

207 (*
Ãxtä“
)->
size
 = 
Ãwsize
;

208 (*
Ãxtä“
)->
Ãxt
 = 
ÃwÃxt
;

209 
dÚe
;

215 ià(! 
block
->
Ãxt


216 && 
__m®loc_’d_¹
 =ğ(*)((
size_t
)
block
 + block->
size
))

218 
size_t
 
mÜesize
 = 
»®_size
 - 
block
->
size
;

219 ià(! 
	`CAN_ALLOC_P
 (
mÜesize
))

220  
NULL
;

222 *
Ãxtä“
 = 
NULL
;

223 ià(
MALLOC_DIRECTION
 < 0)

225 
block
 = 
__m®loc_’d_¹
 = (*)((
size_t
)block - 
mÜesize
);

229 
__m®loc_’d_¹
 = (*)((
size_t
)
block
 + 
»®_size
);

232 
dÚe
;

239 ià(! 
	`CAN_ALLOC_P
 (
»®_size
))

240  
NULL
;

242 ià(
MALLOC_DIRECTION
 > 0)

244 
block
 = 
__m®loc_’d_¹
;

245 
__m®loc_’d_¹
 = (*)((
size_t
)__m®loc_’d_¹ + 
»®_size
);

249 
block
 = 
__m®loc_’d_¹
 = (*)((
size_t
)__m®loc_’d_¹ - 
»®_size
);

251 
dÚe
:

252 
block
->
size
 = 
»®_size
;

255 * 
m®loc_»tuº_addr
 = (*)&
block
->
Ãxt
;

260 
	`check_¿nge_ªd_ÿÎ_sbrk
(
m®loc_»tuº_addr
,
»®_size
);

263  
m®loc_»tuº_addr
;

265 
	}
}

269 
	$ä“
 (*
block_p
)

271 
æe
 *
Ãxtä“
;

272 
æe
 
block
 = (æe)((
size_t
è
block_p
 - 
	`off£tof
 (
ä“li¡_’Œy
, 
Ãxt
));

274 ià(
block_p
 =ğ
NULL
)

279 
Ãxtä“
 = &
__m®loc_ä“li¡
;

280 *
Ãxtä“
;

281 
Ãxtä“
 = &(*Ãxtä“)->
Ãxt
)

283 
æe
 
thisblock
 = *
Ãxtä“
;

284 ià((
size_t
)
thisblock
 +hisblock->
size
 =ğ(size_tè
block
)

286 
thisblock
->
size
 +ğ
block
->size;

287 ià(
MALLOC_DIRECTION
 > 0

288 && 
thisblock
->
Ãxt


289 && (
size_t
è
block
 + block->
size
 =ğ(size_tè
thisblock
->
Ãxt
)

291 
thisblock
->
size
 +ğthisblock->
Ãxt
->size;

292 
thisblock
->
Ãxt
 =hisblock->next->next;

296 ià((
size_t
è
thisblock
 =ğ(size_tè
block
 + block->
size
)

298 ià(
MALLOC_DIRECTION
 < 0

299 && 
thisblock
->
Ãxt


300 && (
size_t
è
block
 =ğ((size_tè
thisblock
->
Ãxt


301 + 
thisblock
->
Ãxt
->
size
))

303 *
Ãxtä“
 = 
thisblock
->
Ãxt
;

304 
thisblock
->
Ãxt
->
size
 +ğ
block
->size +hisblock->size;

308 
block
->
size
 +ğ
thisblock
->size;

309 
block
->
Ãxt
 = 
thisblock
->next;

310 *
Ãxtä“
 = 
block
;

314 ià((
MALLOC_DIRECTION
 > 0

315 && (
size_t
è
thisblock
 > (size_tè
block
)

316 || (
MALLOC_DIRECTION
 < 0

317 && (
size_t
è
thisblock
 < (size_tè
block
))

321 
block
->
Ãxt
 = *
Ãxtä“
;

322 *
Ãxtä“
 = 
block
;

324 
	}
}

327 
	$»®loc
 (*
block_p
, 
size_t
 
sz
)

329 
æe
 
block
 = (æe)((
size_t
è
block_p
 - 
	`off£tof
 (
ä“li¡_’Œy
, 
Ãxt
));

330 
size_t
 
»®_size
 = 
	`REAL_SIZE
 (
sz
);

331 
size_t
 
Şd_»®_size
;

333 ià(
block_p
 =ğ
NULL
)

334  
	`m®loc
 (
sz
);

336 
Şd_»®_size
 = 
block
->
size
;

339 ià(
Şd_»®_size
 < 
»®_size
)

341 *
»suÉ
;

342 
size_t
 
Şd_size
 = 
Şd_»®_size
 -  (size_t);

345 
»suÉ
 = 
	`m®loc
 (
sz
);

346 ià(
»suÉ
 =ğ
NULL
)

347  
NULL
;

348 
	`memıy
 (
»suÉ
, 
block_p
, 
Şd_size
 < 
sz
 ? old_size : sz);

349 
	`ä“
 (
block_p
);

350  
»suÉ
;

353 ià(
Şd_»®_size
 - 
»®_size
 >ğ (
ä“li¡_’Œy
))

355 
æe
 
Ãwblock
 = (æe)((
size_t
)
block
 + 
»®_size
);

356 
block
->
size
 = 
»®_size
;

357 
Ãwblock
->
size
 = 
Şd_»®_size
 - 
»®_size
;

358 
	`ä“
 (&
Ãwblock
->
Ãxt
);

360  
block_p
;

361 
	}
}

364 
	$ÿÎoc
 (
size_t
 
n
, size_ˆ
–em_size
)

366 *
»suÉ
;

367 
size_t
 
sz
 = 
n
 * 
–em_size
;

368 
»suÉ
 = 
	`m®loc
 (
sz
);

369 ià(
»suÉ
 !ğ
NULL
)

370 
	`mem£t
 (
»suÉ
, 0, 
sz
);

371  
»suÉ
;

372 
	}
}

375 
	$cä“
 (*
p
)

377 
	`ä“
 (
p
);

378 
	}
}

381 
	$mem®ign
 (
size_t
 
®ign
, size_ˆ
sz
)

383 
æe
 *
Ãxtä“
;

384 
æe
 
block
;

388 
size_t
 
»®_size
 = 
	`REAL_SIZE
 (
sz
);

391 ià((
®ign
 & (align - 1)) != 0

392 || 
®ign
 <= 0)

393  
NULL
;

402 
Ãxtä“
 = &
__m®loc_ä“li¡
;

404 
Ãxtä“
 = &(*Ãxtä“)->
Ãxt
)

406 
size_t
 
befÜe_size
;

407 
size_t
 
Şd_size
;

410 ià(! *
Ãxtä“
)

412 
Şd_size
 = 
»®_size
;

413 ià(
MALLOC_DIRECTION
 < 0)

415 
Şd_size
 +ğ
	`M_ALIGN_SUB
 (((
size_t
)
__m®loc_’d_¹


416 - 
Şd_size
 +  (
size_t
)),

417 
®ign
);

418 ià(! 
	`CAN_ALLOC_P
 (
Şd_size
))

419  
NULL
;

420 
block
 = 
__m®loc_’d_¹
 = (*)((
size_t
)__m®loc_’d_¹ - 
Şd_size
);

424 
block
 = 
__m®loc_’d_¹
;

425 
Şd_size
 +ğ
	`M_ALIGN
 ((
size_t
)
__m®loc_’d_¹
 +  (size_t),

426 
®ign
);

427 ià(! 
	`CAN_ALLOC_P
 (
Şd_size
))

428  
NULL
;

429 
__m®loc_’d_¹
 = (*)((
size_t
)__m®loc_’d_¹ + 
Şd_size
);

431 *
Ãxtä“
 = 
block
;

432 
block
->
size
 = 
Şd_size
;

433 
block
->
Ãxt
 = 
NULL
;

437 
block
 = *
Ãxtä“
;

438 
Şd_size
 = 
block
->
size
;

442 
befÜe_size
 = 
	`M_ALIGN
 (&
block
->
Ãxt
, 
®ign
);

443 ià(
befÜe_size
 != 0)

444 
befÜe_size
 =  (*
block
è+ 
	`M_ALIGN
 (&(block+1)->
Ãxt
, 
®ign
);

448 ià(! 
block
->
Ãxt


449 && 
Şd_size
 < 
»®_size
 + 
befÜe_size


450 && 
__m®loc_’d_¹
 =ğ(*)((
size_t
)
block
 + block->
size
))

452 ià(
MALLOC_DIRECTION
 < 0)

454 
size_t
 
mÜesize
 = 
»®_size
 - 
block
->
size
;

455 
mÜesize
 +ğ
	`M_ALIGN_SUB
 ((
size_t
)&
block
->
Ãxt
 - mÜesize, 
®ign
);

456 ià(! 
	`CAN_ALLOC_P
 (
mÜesize
))

457  
NULL
;

458 
block
 = 
__m®loc_’d_¹
 = (*)((
size_t
)block - 
mÜesize
);

459 
block
->
Ãxt
 = 
NULL
;

460 
block
->
size
 = 
Şd_size
 = old_siz+ 
mÜesize
;

461 
befÜe_size
 = 0;

465 ià(! 
	`CAN_ALLOC_P
 (
befÜe_size
 + 
»®_size
 - 
block
->
size
))

466  
NULL
;

467 
__m®loc_’d_¹
 = (*)((
size_t
)
block
 + 
befÜe_size
 + 
»®_size
);

468 
block
->
size
 = 
Şd_size
 = 
befÜe_size
 + 
»®_size
;

475 ià(
Şd_size
 >ğ
»®_size
 + 
befÜe_size
)

479 ià(
befÜe_size
 != 0)

481 
æe
 
Şd_block
 = 
block
;

483 
Şd_block
->
size
 = 
befÜe_size
;

484 
block
 = (
æe
)((
size_t
)block + 
befÜe_size
);

489 ià(
Şd_size
 - 
befÜe_size


490 <ğ
»®_size
 +  (
ä“li¡_’Œy
))

492 
block
->
size
 = 
Şd_size
 - 
befÜe_size
;

493  (*)&
block
->
Ãxt
;

497 
æe
 
Ãw_block
;

498 
Ãw_block
 = (
æe
)((
size_t
)
block
 + 
»®_size
);

499 
Ãw_block
->
size
 = 
Şd_size
 - 
befÜe_size
 - 
»®_size
;

500 ià(
MALLOC_DIRECTION
 > 0)

502 
Ãw_block
->
Ãxt
 = 
Şd_block
->next;

503 
Şd_block
->
Ãxt
 = 
Ãw_block
;

507 
Ãw_block
->
Ãxt
 = 
Şd_block
;

508 *
Ãxtä“
 = 
Ãw_block
;

510 
dÚe
;

517 ià(
Şd_size
 <ğ
»®_size
 +  (
ä“li¡_’Œy
))

519 *
Ãxtä“
 = 
block
->
Ãxt
;

520  (*)&
block
->
Ãxt
;

524 
size_t
 
Ãwsize
 = 
Şd_size
 - 
»®_size
;

525 
æe
 
ÃwÃxt
 = 
block
->
Ãxt
;

526 *
Ãxtä“
 = (
æe
)((
size_t
)
block
 + 
»®_size
);

527 (*
Ãxtä“
)->
size
 = 
Ãwsize
;

528 (*
Ãxtä“
)->
Ãxt
 = 
ÃwÃxt
;

529 
dÚe
;

535 
dÚe
:

536 
block
->
size
 = 
»®_size
;

537  (*)&
block
->
Ãxt
;

538 
	}
}

541 
	$v®loc
 (
size_t
 
sz
)

543  
	`mem®ign
 (128, 
sz
);

544 
	}
}

546 
	$pv®loc
 (
size_t
 
sz
)

548  
	`mem®ign
 (128, 
sz
 + 
	`M_ALIGN
 (sz, 128));

549 
	}
}

551 #ifdeà
DEFINE_MALLINFO


552 
	~"m®loc.h
"

554 
m®lšfo


555 
	$m®lšfo
 ()

557 
m®lšfo
 
r
;

558 
æe
 
ä
;

559 
size_t
 
ä“_size
;

560 
size_t
 
tÙ®_size
;

561 
size_t
 
ä“_blocks
;

563 
	`mem£t
 (&
r
, 0,  (r));

565 
ä“_size
 = 0;

566 
ä“_blocks
 = 0;

567 
ä
 = 
__m®loc_ä“li¡
; fr; f¸ğä->
Ãxt
)

569 
ä“_size
 +ğ
ä
->
size
;

570 
ä“_blocks
++;

571 ià(! 
ä
->
Ãxt
)

573 
©’d
;

574 ià(
MALLOC_DIRECTION
 > 0)

575 
©’d
 = (*)((
size_t
)
ä
 + fr->
size
è=ğ
__m®loc_’d_¹
;

577 
©’d
 = (*)
ä
 =ğ
__m®loc_’d_¹
;

578 ià(
©’d
)

579 
r
.
k“pco¡
 = 
ä
->
size
;

583 ià(
MALLOC_DIRECTION
 > 0)

584 
tÙ®_size
 = (*)
__m®loc_’d_¹
 - (*)&
__m®loc_¡¬t_¹
;

586 
tÙ®_size
 = (*)&
__m®loc_¡¬t_¹
 - (*)
__m®loc_’d_¹
;

588 #ifdeà
DEBUG


593 
r
.
¬’a
 = 
tÙ®_size
;

594 
r
.
fÜdblks
 = 
ä“_size
;

595 
r
.
uÜdblks
 = 
tÙ®_size
 - 
ä“_size
;

596 
r
.
Üdblks
 = 
ä“_blocks
;

597  
r
;

598 
	}
}

642 #ifdeà
DEFINE_MALLOC_STATS


643 
	~"m®loc.h
"

644 
	~<¡dio.h
>

647 
	$m®loc_¡©s
()

649 
m®lšfo
 
i
;

650 
FILE
 *
å
;

653 
å
 = 
¡dout
 ;

655 
i
 = 
	`m®lšfo
();

656 
	`årštf
 (
å
, "malloc has„eserved %u bytes between %p‡nd %p\n",

657 
i
.
¬’a
, &
__m®loc_¡¬t_¹
, 
__m®loc_’d_¹
);

658 
	`årštf
 (
å
, "there‡re %u bytes free in %u chunks\n",

659 
i
.
fÜdblks
, i.
Üdblks
);

660 
	`årštf
 (
å
, "of which %u bytes‡re‡theƒnd ofhe„eserved space\n",

661 
i
.
k“pco¡
);

662 
	`årštf
 (
å
, "ªd %u by‹ ¬š u£.\n", 
i
.
uÜdblks
);

663 
	}
}

666 #ifdeà
DEFINE_MALLOC_USABLE_SIZE


667 
size_t


668 
	$m®loc_u§bË_size
 (*
block_p
)

670 
æe
 
block
 = (æe)((
size_t
è
block_p
 - 
	`off£tof
 (
ä“li¡_’Œy
, 
Ãxt
));

671  
block
->
size
 -  (
size_t
);

672 
	}
}

675 #ifdeà
DEFINE_MALLOPT


677 
	$m®lİt
 (
n
, 
v
)

679 ()
n
; ()
v
;

681 
	}
}

	@tmplib (copy)/asm/asm.h

14 #iâdeà
_ASM_RISCV_ASM_H


15 
	#_ASM_RISCV_ASM_H


	)

17 #ifdeà
__ASSEMBLY__


18 
	#__ASM_STR
(
x
è
	)
x

20 
	#__ASM_STR
(
x
è#x

	)

23 #ià
__riscv_xËn
 == 64

24 
	#__REG_SEL
(
a
, 
b
è
	`__ASM_STR
×)

	)

25 #–ià
__riscv_xËn
 == 32

26 
	#__REG_SEL
(
a
, 
b
è
	`__ASM_STR
(b)

	)

31 
	#REG_L
 
	`__REG_SEL
(
ld
, 
lw
)

	)

32 
	#REG_S
 
	`__REG_SEL
(
sd
, 
sw
)

	)

33 
	#SZREG
 
	`__REG_SEL
(8, 4)

	)

34 
	#LGREG
 
	`__REG_SEL
(3, 2)

	)

36 #ià
__SIZEOF_POINTER__
 == 8

37 #ifdeà
__ASSEMBLY__


38 
	#RISCV_PTR
 .
dwÜd


	)

39 
	#RISCV_SZPTR
 8

	)

40 
	#RISCV_LGPTR
 3

	)

42 
	#RISCV_PTR
 ".dwÜd"

	)

43 
	#RISCV_SZPTR
 "8"

	)

44 
	#RISCV_LGPTR
 "3"

	)

46 #–ià
__SIZEOF_POINTER__
 == 4

47 #ifdeà
__ASSEMBLY__


48 
	#RISCV_PTR
 .
wÜd


	)

49 
	#RISCV_SZPTR
 4

	)

50 
	#RISCV_LGPTR
 2

	)

52 
	#RISCV_PTR
 ".wÜd"

	)

53 
	#RISCV_SZPTR
 "4"

	)

54 
	#RISCV_LGPTR
 "2"

	)

60 #ià(
__SIZEOF_INT__
 == 4)

61 
	#RISCV_INT
 
	`__ASM_STR
(.
wÜd
)

	)

62 
	#RISCV_SZINT
 
	`__ASM_STR
(4)

	)

63 
	#RISCV_LGINT
 
	`__ASM_STR
(2)

	)

68 #ià(
__SIZEOF_SHORT__
 == 2)

69 
	#RISCV_SHORT
 
	`__ASM_STR
(.
h®f
)

	)

70 
	#RISCV_SZSHORT
 
	`__ASM_STR
(2)

	)

71 
	#RISCV_LGSHORT
 
	`__ASM_STR
(1)

	)

	@tmplib (copy)/asm/csr.h

14 #iâdeà
_ASM_RISCV_CSR_H


15 
	#_ASM_RISCV_CSR_H


	)

17 
	~<lšux/cÚ¡.h
>

20 
	#SR_SIE
 
	`_AC
(0x00000002, 
UL
è

	)

21 
	#SR_SPIE
 
	`_AC
(0x00000020, 
UL
è

	)

22 
	#SR_SPP
 
	`_AC
(0x00000100, 
UL
è

	)

23 
	#SR_SUM
 
	`_AC
(0x00040000, 
UL
è

	)

25 
	#SR_FS
 
	`_AC
(0x00006000, 
UL
è

	)

26 
	#SR_FS_OFF
 
	`_AC
(0x00000000, 
UL
)

	)

27 
	#SR_FS_INITIAL
 
	`_AC
(0x00002000, 
UL
)

	)

28 
	#SR_FS_CLEAN
 
	`_AC
(0x00004000, 
UL
)

	)

29 
	#SR_FS_DIRTY
 
	`_AC
(0x00006000, 
UL
)

	)

31 
	#SR_XS
 
	`_AC
(0x00018000, 
UL
è

	)

32 
	#SR_XS_OFF
 
	`_AC
(0x00000000, 
UL
)

	)

33 
	#SR_XS_INITIAL
 
	`_AC
(0x00008000, 
UL
)

	)

34 
	#SR_XS_CLEAN
 
	`_AC
(0x00010000, 
UL
)

	)

35 
	#SR_XS_DIRTY
 
	`_AC
(0x00018000, 
UL
)

	)

37 #iâdeà
CONFIG_64BIT


38 
	#SR_SD
 
	`_AC
(0x80000000, 
UL
è

	)

40 
	#SR_SD
 
	`_AC
(0x8000000000000000, 
UL
è

	)

44 #ià
__riscv_xËn
 == 32

45 
	#SATP_PPN
 
	`_AC
(0x003FFFFF, 
UL
)

	)

46 
	#SATP_MODE_32
 
	`_AC
(0x80000000, 
UL
)

	)

47 
	#SATP_MODE
 
SATP_MODE_32


	)

49 
	#SATP_PPN
 
	`_AC
(0x00000FFFFFFFFFFF, 
UL
)

	)

50 
	#SATP_MODE_39
 
	`_AC
(0x8000000000000000, 
UL
)

	)

51 
	#SATP_MODE
 
SATP_MODE_39


	)

55 
	#SIE_SSIE
 
	`_AC
(0x00000002, 
UL
è

	)

56 
	#SIE_STIE
 
	`_AC
(0x00000020, 
UL
è

	)

58 
	#EXC_INST_MISALIGNED
 0

	)

59 
	#EXC_INST_ACCESS
 1

	)

60 
	#EXC_BREAKPOINT
 3

	)

61 
	#EXC_LOAD_ACCESS
 5

	)

62 
	#EXC_STORE_ACCESS
 7

	)

63 
	#EXC_SYSCALL
 8

	)

64 
	#EXC_INST_PAGE_FAULT
 12

	)

65 
	#EXC_LOAD_PAGE_FAULT
 13

	)

66 
	#EXC_STORE_PAGE_FAULT
 15

	)

68 #iâdeà
__ASSEMBLY__


70 
	#c¤_sw­
(
c¤
, 
v®
) \

72 
__v
 = ()(
v®
); \

73 
__asm__
 
	`__vŞ©e__
 ("csrrw %0, " #csr ", %1" \

74 : "ô" (
__v
) : "rK" (__v) \

76 
__v
; \

77 })

	)

79 
	#c¤_»ad
(
c¤
) \

81 
__v
; \

82 
__asm__
 
	`__vŞ©e__
 ("csrr %0, " #csr \

83 : "ô" (
__v
) : \

85 
__v
; \

86 })

	)

88 
	#c¤_wr™e
(
c¤
, 
v®
) \

90 
__v
 = ()(
v®
); \

91 
__asm__
 
	`__vŞ©e__
 ("csrw " #csr ", %0" \

92 : : "rK" (
__v
) \

94 })

	)

96 
	#c¤_»ad_£t
(
c¤
, 
v®
) \

98 
__v
 = ()(
v®
); \

99 
__asm__
 
	`__vŞ©e__
 ("csrrs %0, " #csr ", %1" \

100 : "ô" (
__v
) : "rK" (__v) \

102 
__v
; \

103 })

	)

105 
	#c¤_£t
(
c¤
, 
v®
) \

107 
__v
 = ()(
v®
); \

108 
__asm__
 
	`__vŞ©e__
 ("csrs " #csr ", %0" \

109 : : "rK" (
__v
) \

111 })

	)

113 
	#c¤_»ad_ş—r
(
c¤
, 
v®
) \

115 
__v
 = ()(
v®
); \

116 
__asm__
 
	`__vŞ©e__
 ("csrrc %0, " #csr ", %1" \

117 : "ô" (
__v
) : "rK" (__v) \

119 
__v
; \

120 })

	)

122 
	#c¤_ş—r
(
c¤
, 
v®
) \

124 
__v
 = ()(
v®
); \

125 
__asm__
 
	`__vŞ©e__
 ("csrc " #csr ", %0" \

126 : : "rK" (
__v
) \

128 })

	)

	@tmplib (copy)/asm/linkage.h

14 #iâdeà
_ASM_RISCV_LINKAGE_H


15 
	#_ASM_RISCV_LINKAGE_H


	)

17 
	#__ALIGN
 .
b®ign
 4

	)

18 
	#__ALIGN_STR
 ".b®igÀ4"

	)

	@tmplib (copy)/linux/const.h

4 #iâdeà
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifdeà
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
è
	)
X

18 
	#_AT
(
T
,
X
è
	)
X

20 
	#__AC
(
X
,
Y
è(X##Y)

	)

21 
	#_AC
(
X
,
Y
è
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
è((T)(X))

	)

25 
	#_BITUL
(
x
è(
	`_AC
(1,
UL
è<< (x))

	)

26 
	#_BITULL
(
x
è(
	`_AC
(1,
ULL
è<< (x))

	)

	@tmplib (copy)/linux/linkage.h

14 #iâdeà
_ASM_RISCV_LINKAGE_H


15 
	#_ASM_RISCV_LINKAGE_H


	)

17 
	#__ALIGN
 .
b®ign
 4

	)

18 
	#__ALIGN_STR
 ".b®igÀ4"

	)

	@tmplib (copy)/partial_linkage.h

1 
	~<asm/lškage.h
>

3 
	#ASM_NL
 ;

	)

4 
	#ALIGN
 
__ALIGN


	)

5 
	#ALIGN_STR
 
__ALIGN_STR


	)

7 #iâdeà
ENTRY


8 
	#ENTRY
(
Çme
) \

9 .
globl
 
Çme
 
ASM_NL
 \

10 
ALIGN
 
ASM_NL
 \

11 
Çme
:

	)

14 #iâdeà
END


15 
	#END
(
Çme
) \

16 .
size
 
Çme
, .-
	)
name

23 #iâdeà
ENDPROC


24 
	#ENDPROC
(
Çme
) \

25 .
ty³
 
Çme
, @
funùiÚ
 
ASM_NL
 \

26 
	`END
(
Çme
)

	)

	@tmplib (copy)/uaccess.h

1 #iâdeà
_UACCESS_H_


2 
	#_UACCESS_H_


	)

3 
	~<asm/asm.h
>

4 
	~<asm/c¤.h
>

9 
__asm_cİy_to_u£r
(*
to
,

10 cÚ¡ *
äom
, 
n
);

11 
__asm_cİy_äom_u£r
(*
to
,

12 cÚ¡ *
äom
, 
n
);

14 
šlše
 

15 
	$cİy_to_u£r
(*
to
, cÚ¡ *
äom
, 
n
)

17  
	`__asm_cİy_to_u£r
(
to
, 
äom
, 
n
);

18 
	}
}

20 
šlše
 

21 
	$cİy_äom_u£r
(*
to
, cÚ¡ *
äom
, 
n
)

24  
	`__asm_cİy_äom_u£r
(
to
, 
äom
, 
n
);

25 
	}
}

28 
	#ALLOW_USER_ACCESS
(
x
) { \

29 
tmp_¡Üage
; \

30 
asm
 vŞ©("l˜%0, %1" : "ô" (
tmp_¡Üage
è: "i" (
SR_SUM
)); \

31 
asm
 vŞ©("c¤ s¡©us, %0" : "ô" (
tmp_¡Üage
)); \

32 (
x
); \

33 
asm
 vŞ©("c¤øs¡©us, %0" : "ô" (
tmp_¡Üage
)); \

34 }

	)

	@tmplib (copy)/uio.h

1 #iâdeà
_UIO_H_


2 
	#_UIO_H_


	)

5 
	siovec
{

6 * 
	mbufãr_¡¬t
;

7 
size_t
 
	mËn
;

	@tmplib/asm/asm.h

14 #iâdeà
_ASM_RISCV_ASM_H


15 
	#_ASM_RISCV_ASM_H


	)

17 #ifdeà
__ASSEMBLY__


18 
	#__ASM_STR
(
x
è
	)
x

20 
	#__ASM_STR
(
x
è#x

	)

23 #ià
__riscv_xËn
 == 64

24 
	#__REG_SEL
(
a
, 
b
è
	`__ASM_STR
×)

	)

25 #–ià
__riscv_xËn
 == 32

26 
	#__REG_SEL
(
a
, 
b
è
	`__ASM_STR
(b)

	)

31 
	#REG_L
 
	`__REG_SEL
(
ld
, 
lw
)

	)

32 
	#REG_S
 
	`__REG_SEL
(
sd
, 
sw
)

	)

33 
	#SZREG
 
	`__REG_SEL
(8, 4)

	)

34 
	#LGREG
 
	`__REG_SEL
(3, 2)

	)

36 #ià
__SIZEOF_POINTER__
 == 8

37 #ifdeà
__ASSEMBLY__


38 
	#RISCV_PTR
 .
dwÜd


	)

39 
	#RISCV_SZPTR
 8

	)

40 
	#RISCV_LGPTR
 3

	)

42 
	#RISCV_PTR
 ".dwÜd"

	)

43 
	#RISCV_SZPTR
 "8"

	)

44 
	#RISCV_LGPTR
 "3"

	)

46 #–ià
__SIZEOF_POINTER__
 == 4

47 #ifdeà
__ASSEMBLY__


48 
	#RISCV_PTR
 .
wÜd


	)

49 
	#RISCV_SZPTR
 4

	)

50 
	#RISCV_LGPTR
 2

	)

52 
	#RISCV_PTR
 ".wÜd"

	)

53 
	#RISCV_SZPTR
 "4"

	)

54 
	#RISCV_LGPTR
 "2"

	)

60 #ià(
__SIZEOF_INT__
 == 4)

61 
	#RISCV_INT
 
	`__ASM_STR
(.
wÜd
)

	)

62 
	#RISCV_SZINT
 
	`__ASM_STR
(4)

	)

63 
	#RISCV_LGINT
 
	`__ASM_STR
(2)

	)

68 #ià(
__SIZEOF_SHORT__
 == 2)

69 
	#RISCV_SHORT
 
	`__ASM_STR
(.
h®f
)

	)

70 
	#RISCV_SZSHORT
 
	`__ASM_STR
(2)

	)

71 
	#RISCV_LGSHORT
 
	`__ASM_STR
(1)

	)

	@tmplib/asm/csr.h

14 #iâdeà
_ASM_RISCV_CSR_H


15 
	#_ASM_RISCV_CSR_H


	)

17 
	~<lšux/cÚ¡.h
>

20 
	#SR_SIE
 
	`_AC
(0x00000002, 
UL
è

	)

21 
	#SR_SPIE
 
	`_AC
(0x00000020, 
UL
è

	)

22 
	#SR_SPP
 
	`_AC
(0x00000100, 
UL
è

	)

23 
	#SR_SUM
 
	`_AC
(0x00040000, 
UL
è

	)

25 
	#SR_FS
 
	`_AC
(0x00006000, 
UL
è

	)

26 
	#SR_FS_OFF
 
	`_AC
(0x00000000, 
UL
)

	)

27 
	#SR_FS_INITIAL
 
	`_AC
(0x00002000, 
UL
)

	)

28 
	#SR_FS_CLEAN
 
	`_AC
(0x00004000, 
UL
)

	)

29 
	#SR_FS_DIRTY
 
	`_AC
(0x00006000, 
UL
)

	)

31 
	#SR_XS
 
	`_AC
(0x00018000, 
UL
è

	)

32 
	#SR_XS_OFF
 
	`_AC
(0x00000000, 
UL
)

	)

33 
	#SR_XS_INITIAL
 
	`_AC
(0x00008000, 
UL
)

	)

34 
	#SR_XS_CLEAN
 
	`_AC
(0x00010000, 
UL
)

	)

35 
	#SR_XS_DIRTY
 
	`_AC
(0x00018000, 
UL
)

	)

37 #iâdeà
CONFIG_64BIT


38 
	#SR_SD
 
	`_AC
(0x80000000, 
UL
è

	)

40 
	#SR_SD
 
	`_AC
(0x8000000000000000, 
UL
è

	)

44 #ià
__riscv_xËn
 == 32

45 
	#SATP_PPN
 
	`_AC
(0x003FFFFF, 
UL
)

	)

46 
	#SATP_MODE_32
 
	`_AC
(0x80000000, 
UL
)

	)

47 
	#SATP_MODE
 
SATP_MODE_32


	)

49 
	#SATP_PPN
 
	`_AC
(0x00000FFFFFFFFFFF, 
UL
)

	)

50 
	#SATP_MODE_39
 
	`_AC
(0x8000000000000000, 
UL
)

	)

51 
	#SATP_MODE
 
SATP_MODE_39


	)

55 
	#SIE_SSIE
 
	`_AC
(0x00000002, 
UL
è

	)

56 
	#SIE_STIE
 
	`_AC
(0x00000020, 
UL
è

	)

58 
	#EXC_INST_MISALIGNED
 0

	)

59 
	#EXC_INST_ACCESS
 1

	)

60 
	#EXC_BREAKPOINT
 3

	)

61 
	#EXC_LOAD_ACCESS
 5

	)

62 
	#EXC_STORE_ACCESS
 7

	)

63 
	#EXC_SYSCALL
 8

	)

64 
	#EXC_INST_PAGE_FAULT
 12

	)

65 
	#EXC_LOAD_PAGE_FAULT
 13

	)

66 
	#EXC_STORE_PAGE_FAULT
 15

	)

68 #iâdeà
__ASSEMBLY__


70 
	#c¤_sw­
(
c¤
, 
v®
) \

72 
__v
 = ()(
v®
); \

73 
__asm__
 
	`__vŞ©e__
 ("csrrw %0, " #csr ", %1" \

74 : "ô" (
__v
) : "rK" (__v) \

76 
__v
; \

77 })

	)

79 
	#c¤_»ad
(
c¤
) \

81 
__v
; \

82 
__asm__
 
	`__vŞ©e__
 ("csrr %0, " #csr \

83 : "ô" (
__v
) : \

85 
__v
; \

86 })

	)

88 
	#c¤_wr™e
(
c¤
, 
v®
) \

90 
__v
 = ()(
v®
); \

91 
__asm__
 
	`__vŞ©e__
 ("csrw " #csr ", %0" \

92 : : "rK" (
__v
) \

94 })

	)

96 
	#c¤_»ad_£t
(
c¤
, 
v®
) \

98 
__v
 = ()(
v®
); \

99 
__asm__
 
	`__vŞ©e__
 ("csrrs %0, " #csr ", %1" \

100 : "ô" (
__v
) : "rK" (__v) \

102 
__v
; \

103 })

	)

105 
	#c¤_£t
(
c¤
, 
v®
) \

107 
__v
 = ()(
v®
); \

108 
__asm__
 
	`__vŞ©e__
 ("csrs " #csr ", %0" \

109 : : "rK" (
__v
) \

111 })

	)

113 
	#c¤_»ad_ş—r
(
c¤
, 
v®
) \

115 
__v
 = ()(
v®
); \

116 
__asm__
 
	`__vŞ©e__
 ("csrrc %0, " #csr ", %1" \

117 : "ô" (
__v
) : "rK" (__v) \

119 
__v
; \

120 })

	)

122 
	#c¤_ş—r
(
c¤
, 
v®
) \

124 
__v
 = ()(
v®
); \

125 
__asm__
 
	`__vŞ©e__
 ("csrc " #csr ", %0" \

126 : : "rK" (
__v
) \

128 })

	)

	@tmplib/asm/linkage.h

14 #iâdeà
_ASM_RISCV_LINKAGE_H


15 
	#_ASM_RISCV_LINKAGE_H


	)

17 
	#__ALIGN
 .
b®ign
 4

	)

18 
	#__ALIGN_STR
 ".b®igÀ4"

	)

	@tmplib/linux/const.h

4 #iâdeà
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifdeà
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
è
	)
X

18 
	#_AT
(
T
,
X
è
	)
X

20 
	#__AC
(
X
,
Y
è(X##Y)

	)

21 
	#_AC
(
X
,
Y
è
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
è((T)(X))

	)

25 
	#_BITUL
(
x
è(
	`_AC
(1,
UL
è<< (x))

	)

26 
	#_BITULL
(
x
è(
	`_AC
(1,
ULL
è<< (x))

	)

	@tmplib/linux/linkage.h

14 #iâdeà
_ASM_RISCV_LINKAGE_H


15 
	#_ASM_RISCV_LINKAGE_H


	)

17 
	#__ALIGN
 .
b®ign
 4

	)

18 
	#__ALIGN_STR
 ".b®igÀ4"

	)

	@tmplib/partial_linkage.h

1 
	~<asm/lškage.h
>

3 
	#ASM_NL
 ;

	)

4 
	#ALIGN
 
__ALIGN


	)

5 
	#ALIGN_STR
 
__ALIGN_STR


	)

7 #iâdeà
ENTRY


8 
	#ENTRY
(
Çme
) \

9 .
globl
 
Çme
 
ASM_NL
 \

10 
ALIGN
 
ASM_NL
 \

11 
Çme
:

	)

14 #iâdeà
END


15 
	#END
(
Çme
) \

16 .
size
 
Çme
, .-
	)
name

23 #iâdeà
ENDPROC


24 
	#ENDPROC
(
Çme
) \

25 .
ty³
 
Çme
, @
funùiÚ
 
ASM_NL
 \

26 
	`END
(
Çme
)

	)

	@tmplib/uaccess.h

1 #iâdeà
_UACCESS_H_


2 
	#_UACCESS_H_


	)

3 
	~<asm/asm.h
>

4 
	~<asm/c¤.h
>

9 
__asm_cİy_to_u£r
(*
to
,

10 cÚ¡ *
äom
, 
n
);

11 
__asm_cİy_äom_u£r
(*
to
,

12 cÚ¡ *
äom
, 
n
);

14 
šlše
 

15 
	$cİy_to_u£r
(*
to
, cÚ¡ *
äom
, 
n
)

17  
	`__asm_cİy_to_u£r
(
to
, 
äom
, 
n
);

18 
	}
}

20 
šlše
 

21 
	$cİy_äom_u£r
(*
to
, cÚ¡ *
äom
, 
n
)

24  
	`__asm_cİy_äom_u£r
(
to
, 
äom
, 
n
);

25 
	}
}

28 
	#ALLOW_USER_ACCESS
(
x
) { \

29 
tmp_¡Üage
; \

30 
asm
 vŞ©("l˜%0, %1" : "ô" (
tmp_¡Üage
è: "i" (
SR_SUM
)); \

31 
asm
 vŞ©("c¤ s¡©us, %0" : "ô" (
tmp_¡Üage
)); \

32 (
x
); \

33 
asm
 vŞ©("c¤øs¡©us, %0" : "ô" (
tmp_¡Üage
)); \

34 }

	)

	@tmplib/uio.h

1 #iâdeà
_UIO_H_


2 
	#_UIO_H_


	)

5 
	siovec
{

6 * 
	mbufãr_¡¬t
;

7 
size_t
 
	mËn
;

	@victim_cache.c

1 
	~"viùim_ÿche.h
"

2 
	~"m®loc.h
"

4 
	$š™Ÿlize_viùim_ÿche
()

6 
	`´štf
("[cache] Entered initialization of victim cache\n");

7 
viùim_ÿche
.
u£d_ÿche_·ges
 = 0;

8 
viùim_ÿche
.
ä“_ÿche_·ges
 = 
MAX_VICTIM_CACHE_PAGES
;

9 
	`š™Ÿlize_hashm­
();

10 
	`š™Ÿlize_queue
();

12 
	}
}

14 
	$š™Ÿlize_queue
()

16 
viùim_ÿche
.
Ìu_queue
 = (
Queue
*è
	`m®loc
((Queue));

17 
viùim_ÿche
.
Ìu_queue
->
äÚt
 = 0;

18 
viùim_ÿche
.
Ìu_queue
->
»¬
 = 0;

19 
	}
}

21 
	$š™Ÿlize_hashm­
()

23 
viùim_ÿche
.
hashm­
 = (
QNode
**è
	`m®loc
((QNode*è* 
MAX_VIRTUAL_PAGES
);

24 
i
 = 0;

25 
i
=0; i<
MAX_VIRTUAL_PAGES
; i++)

26 
viùim_ÿche
.
hashm­
[
i
] = 0;

27 
	}
}

29 
	$is_queue_em±y
(
Queue
 *
q
)

31 if(
q
->
äÚt
 == 0)

34 
	}
}

36 
	$upd©e_hashm­
(
ušŒ_t
 
addr
, 
QNode
 *
pos™iÚ
)

39 
šdex
 = 
addr
 >> 
RISCV_PAGE_BITS
;

40 
viùim_ÿche
.
hashm­
[
šdex
] = 
pos™iÚ
;

42 
	}
}

44 
QNode
* 
	$g‘_node_pos™iÚ
(
ušŒ_t
 
addr
)

46 
šdex
 = 
addr
 >> 
RISCV_PAGE_BITS
;

48  
viùim_ÿche
.
hashm­
[
šdex
];

49 
	}
}

51 
QNode
* 
	$ü—‹_Ãw_node
(
ušŒ_t
 
addr
)

53 
QNode
 *
Ãw_node
 = (QNode*è
	`m®loc
((QNode));

54 
Ãw_node
->
Ãxt
 =‚ew_node->
´ev
 = 0;

55 
Ãw_node
->
·geNumb”
 = 
addr
 >> 
RISCV_PAGE_BITS
;

56  
Ãw_node
;

57 
	}
}

59 
QNode
* 
	$add_to_queue
(
ušŒ_t
 
addr
, 
Queue
 *
q
)

61 
QNode
 *
Ãw_node
 = 
	`ü—‹_Ãw_node
(
addr
);

63 if(
	`is_queue_em±y
(
q
))

64 
q
->
äÚt
 = q->
»¬
 = 
Ãw_node
;

67 
q
->
»¬
->
Ãxt
 = 
Ãw_node
;

68 
Ãw_node
->
´ev
 = 
q
->
»¬
;

69 
q
->
»¬
 = 
Ãw_node
;

71  
Ãw_node
;

72 
	}
}

74 
ušŒ_t
 
	$»move_Ìu_äom_queue
(
Queue
 *
q
)

76 if(
	`is_queue_em±y
(
q
))

78 
	`´štf
("[ERROR] Queueƒmpty. can't„emove†ru\n");

81 
ušŒ_t
 
addr
 = 
q
->
äÚt
->
·geNumb”
 << 
RISCV_PAGE_BITS
;

82 
QNode
 *
node_to_»move
 = 
q
->
äÚt
;

83 if(
q
->
äÚt
 =ğq->
»¬
)

84 
q
->
äÚt
 = q->
»¬
 = 0;

87 
q
->
äÚt
 = q->äÚt->
Ãxt
;

88 
q
->
äÚt
->
´ev
 = 0;

90 
	`ä“
(
node_to_»move
);

91  
addr
;

92 
	}
}

94 
ušŒ_t
 
	$»move_mru_äom_queue
(
Queue
 *
q
)

96 if(
	`is_queue_em±y
(
q
))

98 
	`´štf
("[ERROR] Queueƒmpty. can't„emove†ru\n");

101 
ušŒ_t
 
addr
 = 
q
->
»¬
->
·geNumb”
 << 
RISCV_PAGE_BITS
;

102 
QNode
 *
node_to_»move
 = 
q
->
»¬
;

103 if(
q
->
äÚt
 =ğq->
»¬
)

104 
q
->
äÚt
 = q->
»¬
 = 0;

107 
q
->
»¬
 = q->»¬->
´ev
;

108 
q
->
»¬
->
Ãxt
 = 0;

110 
	`ä“
(
node_to_»move
);

111  
addr
;

112 
	}
}

114 
	$»move_node_äom_queue
(
QNode
 *
node_to_»move
, 
Queue
 *
q
)

116 if(!
node_to_»move
)

118 
QNode
 *
befÜe
 = 
node_to_»move
->
´ev
;

119 
QNode
 *
aá”
 = 
node_to_»move
->
Ãxt
;

120 if(!
befÜe
)

121 
	`»move_Ìu_äom_queue
(
q
);

122 if(!
aá”
)

123 
	`»move_mru_äom_queue
(
q
);

126 
befÜe
->
Ãxt
 = 
aá”
;

127 
aá”
->
´ev
 = 
befÜe
;

128 
	`ä“
(
node_to_»move
);

130 
	}
}

132 
	$is_viùim_ÿche_fuÎ
()

134 if(
viùim_ÿche
.
ä“_ÿche_·ges
 == 0)

137 
	}
}

139 
	$is_viùim_ÿche_em±y
()

141 if(
viùim_ÿche
.
Ìu_queue
->
äÚt
 == 0)

144 
	}
}

146 
	$is_š_viùim_ÿche
(
ušŒ_t
 
addr
)

148 
QNode
* 
±r
 = 
	`g‘_node_pos™iÚ
(
addr
);

149  (
±r
 != 0);

150 
	}
}

152 
	$move_·ge_to_ÿche_äom_’şave
(
ušŒ_t
 
addr
)

156 if(
	`is_viùim_ÿche_fuÎ
())

161 
Queue
 *
q
 = 
viùim_ÿche
.
Ìu_queue
;

162 
QNode
 *
node_±r
 = 
	`add_to_queue
(
addr
, 
q
);

163 
	`upd©e_hashm­
(
addr
, 
node_±r
);

164 
	`di¥Ïy_hashm­
();

165 
	`di¥Ïy_queue
(
q
);

166 
viùim_ÿche
.
ä“_ÿche_·ges
--;

167 
viùim_ÿche
.
u£d_ÿche_·ges
++;

168 
	}
}

170 
	$move_·ge_to_’şave_äom_ÿche
(
ušŒ_t
 
addr
)

173 
QNode
 *
node_±r
 = 
	`g‘_node_pos™iÚ
(
addr
);

174 
	`upd©e_hashm­
(
addr
, 0);

175 
	`di¥Ïy_hashm­
();

176 
	`»move_node_äom_queue
(
node_±r
, 
viùim_ÿche
.
Ìu_queue
);

177 
	`di¥Ïy_queue
(
viùim_ÿche
.
Ìu_queue
);

178 
viùim_ÿche
.
ä“_ÿche_·ges
++;

179 
viùim_ÿche
.
u£d_ÿche_·ges
--;

180 
	}
}

182 
ušŒ_t
 
	$g‘_Ìu_viùim_äom_ÿche
()

184 if(
	`is_viùim_ÿche_em±y
())

189  (((
viùim_ÿche
.
Ìu_queue
)->
äÚt
)->
·geNumb”
è<< 
RISCV_PAGE_BITS
;

190 
	}
}

192 
	$»move_Ìu_·ge_äom_ÿche
()

194 
ušŒ_t
 
addr
 = 
	`»move_Ìu_äom_queue
(
viùim_ÿche
.
Ìu_queue
);

195 
	`upd©e_hashm­
(
addr
, 0);

196 
	`di¥Ïy_hashm­
();

197 
	`di¥Ïy_queue
(
viùim_ÿche
.
Ìu_queue
);

198 
viùim_ÿche
.
ä“_ÿche_·ges
++;

199 
viùim_ÿche
.
u£d_ÿche_·ges
--;

200 
	}
}

202 
	$move_Ìu_to_mru_š_ÿche
()

205 
Queue
 *
q
 = 
viùim_ÿche
.
Ìu_queue
;

206 
QNode
 *
Ìu_node
 = 
q
->
äÚt
;

208 
q
->
äÚt
 = q->äÚt->
Ãxt
;

209 
q
->
äÚt
->
´ev
 = 0;

212 
q
->
»¬
->
Ãxt
 = 
Ìu_node
;

213 
Ìu_node
->
´ev
 = 
q
->
»¬
;

214 
Ìu_node
->
Ãxt
 = 0;

215 
q
->
»¬
 = 
Ìu_node
;

216 
	`di¥Ïy_queue
(
q
);

217 
	}
}

219 
	$di¥Ïy_queue
(
Queue
 *
q
)

221 
QNode
 *
node
 = 
q
->
äÚt
;

222 
node
)

224 
	`´štf
(" [%zd] ", 
node
->
·geNumb”
);

225 
node
 =‚ode->
Ãxt
;

227 
	`´štf
("\n");

228 
	}
}

230 
	$di¥Ïy_hashm­
()

236 
	}
}

238 
	$‹¡šg_ÿche
()

241 
Queue
 *
q
 = 
viùim_ÿche
.
Ìu_queue
;

242 
	`move_·ge_to_ÿche_äom_’şave
(0x1000);

243 
	`move_·ge_to_ÿche_äom_’şave
(0x2000);

244 
	`move_·ge_to_ÿche_äom_’şave
(0x3000);

245 
	`move_·ge_to_ÿche_äom_’şave
(0x4000);

246 
	`move_·ge_to_ÿche_äom_’şave
(0x5000);

247 
	`move_·ge_to_ÿche_äom_’şave
(0x6000);

248 
	`di¥Ïy_queue
(
q
);

249 
	`»move_Ìu_·ge_äom_ÿche
();

251 
	`di¥Ïy_queue
(
q
);

252 
	`move_·ge_to_’şave_äom_ÿche
(0x3000);

254 
	`di¥Ïy_queue
(
q
);

255 
	`move_·ge_to_’şave_äom_ÿche
(0x2000);

257 
	`di¥Ïy_queue
(
q
);

258 
	`move_·ge_to_’şave_äom_ÿche
(0x5000);

260 
	`di¥Ïy_queue
(
q
);

269 
	}
}

	@victim_cache.h

1 #iâdeà
VICTIM_CACHE_H


2 
	#VICTIM_CACHE_H


	)

4 
	~"vm.h
"

5 
	#CACHE_SIZE
 5*
RISCV_PAGE_SIZE


6 
	#MAX_VICTIM_CACHE_PAGES
 5

	)

7 
	#MAX_VIRTUAL_PAGES
 2000

	)

9 
	sQNode
 {

10 
ušŒ_t
 
	m·geNumb”
;

11 
QNode
 *
	m´ev
, *
	mÃxt
;

13 } 
	tQNode
;

16 
	sQueue
 {

19 
QNode
 *
	mäÚt
, *
	m»¬
;

20 } 
	tQueue
;

22 
	sviùim_ÿche


24 
QNode
 **
	mhashm­
;

25 
Queue
 *
	mÌu_queue
;

26 
	mu£d_ÿche_·ges
;

27 
	mä“_ÿche_·ges
;

28 } 
	gviùim_ÿche
;

31 
š™Ÿlize_queue
();

32 
š™Ÿlize_hashm­
();

33 
QNode
* 
ü—‹_Ãw_node
(
ušŒ_t
 
addr
);

34 
is_queue_em±y
(
Queue
 *
q
);

35 
upd©e_hashm­
(
ušŒ_t
 
addr
, 
QNode
 *
pos™iÚ
);

36 
QNode
* 
g‘_node_pos™iÚ
(
ušŒ_t
 
addr
);

37 
QNode
* 
add_to_queue
(
ušŒ_t
 
–e
, 
Queue
 *
q
);

38 
ušŒ_t
 
»move_Ìu_äom_queue
(
Queue
 *
q
);

39 
ušŒ_t
 
»move_mru_äom_queue
(
Queue
 *
q
);

40 
»move_node_äom_queue
(
QNode
 *
node_to_»move
, 
Queue
 *
q
);

41 
‹¡šg_ÿche
();

44 
move_·ge_to_ÿche_äom_’şave
(
ušŒ_t
 
addr
);

45 
move_·ge_to_’şave_äom_ÿche
(
ušŒ_t
 
addr
);

46 
ušŒ_t
 
g‘_Ìu_viùim_äom_ÿche
();

47 
»move_Ìu_·ge_äom_ÿche
();

48 
is_viùim_ÿche_fuÎ
();

49 
is_viùim_ÿche_em±y
();

50 
š™Ÿlize_viùim_ÿche
();

51 
is_š_viùim_ÿche
(
ušŒ_t
 
addr
);

52 
move_Ìu_to_mru_š_ÿche
();

55 
di¥Ïy_queue
(
Queue
 *
q
);

56 
di¥Ïy_hashm­
();

	@vm.h

1 #iâdeà
__VM_H__


2 
	#__VM_H__


	)

5 
	~<asm/c¤.h
>

6 
	~"´štf.h
"

7 
	~"commÚ.h
"

10 
	#BIT
(
n
è(1uÈ<< (n))

	)

11 
	#MASK
(
n
è(
	`BIT
Ò)-1ul)

	)

12 
	#IS_ALIGNED
(
n
, 
b
è(!(Òè& 
	`MASK
(b)))

	)

14 
	#QUEUE_SIZE
 500

	)

16 
	#RISCV_PT_INDEX_BITS
 9

	)

17 
	#RISCV_PT_LEVELS
 3

	)

18 
	#RISCV_PAGE_BITS
 12

	)

19 
	#RISCV_PAGE_SIZE
 (1<<
RISCV_PAGE_BITS
)

	)

20 
	#PTE_PPN_SHIFT
 10

	)

21 
	#RISCV_PAGE_OFFSET
(
addr
è×dd¸% 
RISCV_PAGE_SIZE
)

	)

22 
	#RISCV_GET_PT_INDEX
(
addr
, 
n
) \

23 (((
addr
è>> (((
RISCV_PT_INDEX_BITS
è* ((
RISCV_PT_LEVELS
è- (
n
))è+ 
RISCV_PAGE_BITS
)) \

24 & 
	`MASK
(
RISCV_PT_INDEX_BITS
))

	)

25 
	#RISCV_GET_LVL_PGSIZE_BITS
(
n
è(((
RISCV_PT_INDEX_BITS
è* (
RISCV_PT_LEVELS
 - (n))è+ 
RISCV_PAGE_BITS
)

	)

26 
	#RISCV_GET_LVL_PGSIZE
(
n
è
	`BIT
(
	`RISCV_GET_LVL_PGSIZE_BITS
(Ò)))

	)

28 
	#ROUND_UP
(
n
, 
b
è((((Òè- 1ulè>> (b)è+ 1ulè<< (b))

	)

29 
	#ROUND_DOWN
(
n
, 
b
èÒ & ~((2 << (b-1)è- 1))

	)

30 
	#PAGE_DOWN
(
n
è
	`ROUND_DOWN
Ò, 
RISCV_PAGE_BITS
)

	)

31 
	#PAGE_UP
(
n
è
	`ROUND_UP
Ò, 
RISCV_PAGE_BITS
)

	)

34 
	#EYRIE_LOAD_START
 0xffffffff00000000

	)

35 
	#EYRIE_UNTRUSTED_START
 0xffffffff80000000

	)

36 
	#EYRIE_USER_STACK_START
 0x0000000400000000

37 
	#EYRIE_ANON_REGION_START
 0x0000002000000000

38 
	#EYRIE_ANON_REGION_END
 
EYRIE_LOAD_START


	)

39 
	#EYRIE_USER_STACK_SIZE
 0x20000

	)

40 
	#MIN_ENCLAVE_VADDR
 0X1000

	)

43 
	#EYRIE_USER_STACK_END
 (
EYRIE_USER_STACK_START
 - 
EYRIE_USER_STACK_SIZE
)

	)

45 
	#PTE_V
 0x001

46 
	#PTE_R
 0x002

47 
	#PTE_W
 0x004

48 
	#PTE_X
 0x008

49 
	#PTE_U
 0x010

50 
	#PTE_G
 0x020

51 
	#PTE_A
 0x040

52 
	#PTE_D
 0x080

53 
	#PTE_L
 1<<8

54 
	#PTE_E
 1<<9

55 

	)

57 
	#In¡ruùiÚ_add»ss_mi§ligÃd
 0

	)

58 
	#In¡ruùiÚ_acûss_çuÉ
 1

	)

59 
	#IÎeg®_š¡ruùiÚ
 2

	)

60 
	#B»akpošt
 3

	)

61 
	#Re£rved
 4

	)

62 
	#Lßd_acûss_çuÉ
 5

	)

63 
	#AMO_add»ss_mi§ligÃd
 6

	)

64 
	#StÜe_AMO_acûss_çuÉ
 7

	)

65 
	#EnvœÚm’t_ÿÎ
 8

	)

66 
	#In¡ruùiÚ_·ge_çuÉ
 12

	)

67 
	#Lßd_·ge_çuÉ
 13

	)

68 
	#StÜe_AMO_·ge_çuÉ
 15

	)

79 * 
¹_ba£
;

81 
ušŒ_t
 
	gruÁime_va_¡¬t
;

83 
šlše
 
ušŒ_t
 
	$§_Ãw
(
ušŒ_t
 
·
)

85  (
SATP_MODE
 | (
·
 >> 
RISCV_PAGE_BITS
));

86 
	}
}

88 
ušŒ_t
 
	gk”Ãl_off£t
;

89 
šlše
 
ušŒ_t
 
	$k”Ãl_va_to_·
(* 
±r
)

91  (
ušŒ_t
è
±r
 - 
k”Ãl_off£t
;

92 
	}
}

94 
ušŒ_t
 
	glßd_·_¡¬t
;

95 
šlše
 
ušŒ_t
 
	$__va
(
ušŒ_t
 
·
)

97  (
·
 - 
lßd_·_¡¬t
è+ 
EYRIE_LOAD_START
;

98 
	}
}

100 
šlše
 
ušŒ_t
 
	$__·
(
ušŒ_t
 
va
)

102  (
va
 - 
EYRIE_LOAD_START
è+ 
lßd_·_¡¬t
;

103 
	}
}

105 
ušŒ_t
 
	t±e_t
;

106 
šlše
 
±e_t
 
	$±e_ü—‹
(
ušŒ_t
 
µn
, 
ty³
)

108  (
±e_t
)((
µn
 << 
PTE_PPN_SHIFT
è| 
PTE_V
 | 
ty³
 );

109 
	}
}

111 
šlše
 
±e_t
 
	$±d_ü—‹
(
ušŒ_t
 
µn
)

113  
	`±e_ü—‹
(
µn
, 
PTE_V
);

114 
	}
}

116 
šlše
 
ušŒ_t
 
	$µn
(
ušŒ_t
 
·
)

118  
·
 >> 
RISCV_PAGE_BITS
;

119 
	}
}

122 
šlše
 
ušŒ_t
 
	$v²
(
ušŒ_t
 
va
)

124  
va
 >> 
RISCV_PAGE_BITS
;

125 
	}
}

127 
šlše
 
ušŒ_t
 
	$±e_µn
(
±e_t
 
±e
)

129  
±e
 >> 
PTE_PPN_SHIFT
;

130 
	}
}

132 #ifdeà
USE_FREEMEM


135 
±e_t
 
	groÙ_·ge_bË
[
BIT
(
RISCV_PT_INDEX_BITS
)] 
__©Œibu‹__
((
®igÃd
(
RISCV_PAGE_SIZE
)));

137 
±e_t
 
	gk”Ãl_l2_·ge_bË
[
BIT
(
RISCV_PT_INDEX_BITS
)] 
__©Œibu‹__
((
®igÃd
(
RISCV_PAGE_SIZE
)));

138 
±e_t
 
	gk”Ãl_l3_·ge_bË
[
BIT
(
RISCV_PT_INDEX_BITS
)] 
__©Œibu‹__
((
®igÃd
(
RISCV_PAGE_SIZE
)));

140 
±e_t
 
	glßd_l2_·ge_bË
[
BIT
(
RISCV_PT_INDEX_BITS
)] 
__©Œibu‹__
((
®igÃd
(
RISCV_PAGE_SIZE
)));

141 
±e_t
 
	glßd_l3_·ge_bË
[
BIT
(
RISCV_PT_INDEX_BITS
)] 
__©Œibu‹__
((
®igÃd
(
RISCV_PAGE_SIZE
)));

144 
ušŒ_t
 
	g´og¿m_b»ak
;

145 
ušŒ_t
 
	g´og¿m_b»ak_¹
;

149 
ušŒ_t
 
	gä“mem_va_¡¬t
;

150 
size_t
 
	gä“mem_size
;

155 
ušŒ_t
 
	gsh¬ed_bufãr
;

156 
ušŒ_t
 
	gsh¬ed_bufãr_size
;

157 
ušŒ_t
 
	gno_of_edge_ÿÎs
;

161 
ušŒ_t
 *
	g»¶aûm’t_®go_queue
;

162 
ušŒ_t
 *
	g»¶aûm’t_®go_queue_m­
;

163 
ušŒ_t
 *
	gä“_šdiûs
;

164 *
	gblock_m­
;

165 *
	g¡ash_loc
;

167 
ušŒ_t
 
	gäame_size
;

168 
ušŒ_t
 
	gpoš‹r
;

169 
ušŒ_t
 
	gşock_couÁ”
;

179 
ušŒ_t
 
	gis_¹
;

183 
ušŒ_t
 
	gpİ_™em
[2];

184 
	gq_äÚt
;

185 
	gq_»¬
;

187 
	s·ges


189 
ušŒ_t
 
	madd»ss
;

190 
	md©a
[
RISCV_PAGE_SIZE
];

191 
	mhmac
[32];

192 
ušŒ_t
 
	mv”_num
;

193 
ušŒ_t
 
	mdummy
;

194 }
	t·ges
;

196 
	s·ges_©


198 
ušŒ_t
 
	madd»ss
;

199 
ušŒ_t
 
	mdummy
;

200 
	md©a
[
RISCV_PAGE_SIZE
];

201 
	mhmac
[32];

202 }
	t·ges_©
;

205 
	siv_·ge


207 
	miv
[16];

208 }
	tiv_·ge
;

219 
ušŒ_t
 *
	gpos™iÚ
;

222 
ušŒ_t
 *
	gknocked_·ge_addr
;

223 
	gN
;

224 
	gL
;

225 
	gZ
;

227 
iv_·ge
 *
	gp_ivs
;

232 
	#BACKUP_BUFFER_SIZE
 275000

	)

233 
	#BACKUP_BUFFER_SIZE_RORAM
 275000

	)

234 
	#BACKUP_BUFFER_SIZE_ORAM
 35000

	)

235 
	#BACKUP_BUFFER_SIZE_OTHERS
 6000

236 

	)

241 
	#MALLOC_SIZE
 140000

242 
	#MALLOC_SIZE2
 128000

243 

	)

	@woram.c

1 
	~"wÜam.h
"

2 
	~"ssha3.h
"

3 
	~"«ss.h
"

4 
	~"¡ršg.h
"

5 
	~"m®loc.h
"

7 
	$š™Ÿlize_wÜam_¬¿y
()

9 
ušŒ_t
 
utm_¡¬t
 = 
sh¬ed_bufãr
;

10 
wÜam
.
wÜam_¬¿y
 = 
utm_¡¬t
 + 
UTM_ARRAY_STARTING_OFFSET
;

11 
wÜam
.
maš_¬—_size
 = 
SCALING_FACTOR
 * 
WORAM_SIZE
;

12 
wÜam
.
hŞdšg_¬—_size
 = 
WORAM_SIZE
 - wÜam.
maš_¬—_size
;

15 
	`š™Ÿlize_pos™iÚ_m­
();

16 
wÜam
.
wr™e_acûss_couÁ”
 = 0;

17 
	`§n™y_check
();

20 
	}
}

22 
	$š™Ÿlize_pos™iÚ_m­
()

24 
wÜam
.
pos™iÚ_m­
 = (
ušŒ_t
*è
	`m®loc
Ğ(ušŒ_tè* wÜam.
maš_¬—_size
);

25 
ušŒ_t
 
addr
 = 0;‡dd¸< 
wÜam
.
maš_¬—_size
;‡ddr ++ )

26 
wÜam
.
pos™iÚ_m­
[
addr
] =‡ddr;

28 
	}
}

30 
	$di¥Ïy_pos™iÚ_m­
()

32 
	`´štf
("[wÜam] Di¥Ïyšg Pos™iÚ M­ CÚ‹Á oàWORAM w™h siz%zd\n", 
wÜam
.
maš_¬—_size
);

33 
ušŒ_t
 
addr
 = 0;‡dd¸< 
wÜam
.
maš_¬—_size
;‡ddr ++ )

34 
	`´štf
("[wÜam] LogiÿÈAdd»s : 0x%zx , PhysiÿÈAdd»s : 0x%zx\n", 
addr
, 
wÜam
.
pos™iÚ_m­
[addr]);

36 
	}
}

39 
	$§n™y_check
()

42 *
±r
 = (*è
wÜam
.
wÜam_¬¿y
;

43  
i
=0; i<1024*1024; i++)

44 
±r
[
i
] = i;

47 
·ges
 *
·ges_±r
 = (·ges*è
wÜam
.
wÜam_¬¿y
;

48 
i
=0; i<1000; i++)

49 
·ges_±r
[
i
].
add»ss
 = 
wÜam
.
wÜam_¬¿y
;

51 ià(
·ges_±r
[9].
add»ss
 !ğ
wÜam
.
wÜam_¬¿y
)

54 
	`sbi_ex™_’şave
(-1);

56 
	}
}

61 
	$‹¡šg
()

63 
ušŒ_t
 
N
 = 20;

64 
ušŒ_t
 
M
 = 10;

66 
i
 = 0; i <30; i++)

68 
¡¬t
 = (()(
i
*(
N
/()
M
)))%N;

69 
’d
 = (()((
i
+1)*(
N
/()
M
)))%N;

70 ià(
’d
 < 
¡¬t
è’d = 
N
;

73 
	}
}

75 
	$v®id©e_acûss
(
ušŒ_t
 
šdex
)

77 if(
šdex
 >ğ
wÜam
.
maš_¬—_size
)

79 
	`´štf
("[wÜam f©®ƒ¼Ü] Inv®id index‡cûs 0x%zdØpos™iÚ m­ oàsiz0x%zd\n",
šdex
, 
wÜam
.
maš_¬—_size
);

80 
	`´štf
("[woram fatalƒrror] Possible Error dueo Small Woram Size comparedo‡pp's VAS\n");

81 
	`sbi_ex™_’şave
(-1);

84 
	}
}

87 
	$£t_pos
(
ušŒ_t
 
addr
, ušŒ_ˆ
Ãw_addr_šdex
)

89 
ušŒ_t
 
addr_šdex
 = 
addr
 >> 
RISCV_PAGE_BITS
;

90 
wÜam
.
pos™iÚ_m­
[
addr_šdex
] = 
Ãw_addr_šdex
;

91 
	}
}

94 
ušŒ_t
 
	$g‘_pos
(
ušŒ_t
 
addr
)

96  
wÜam
.
pos™iÚ_m­
[
addr
];

97 
	}
}

100 
ušŒ_t
 
	$wr™e_to_hŞdšg_¬—
(
·ges
 
d©a
)

102 
i
 = 
wÜam
.
wr™e_acûss_couÁ”
;

103 
ušŒ_t
 
N
 = 
wÜam
.
maš_¬—_size
;

104 
ušŒ_t
 
M
 = 
wÜam
.
hŞdšg_¬—_size
;

105 
ušŒ_t
 
hŞdšg_¬—_šdex
 = 
N
 + 
i
%
M
;

106 
·ges
 *
¬¿y_±r
 = (·ges*è
wÜam
.
wÜam_¬¿y
;

107 
¬¿y_±r
[
hŞdšg_¬—_šdex
] = 
d©a
;

108  
hŞdšg_¬—_šdex
;

109 
	}
}

112 
	$»äesh_maš_¬—
()

114 
ušŒ_t
 
N
 = 
wÜam
.
maš_¬—_size
;

115 
ušŒ_t
 
M
 = 
wÜam
.
hŞdšg_¬—_size
;

116 
i
 = 
wÜam
.
wr™e_acûss_couÁ”
;

117 
·ges
 *
¬¿y_±r
 = (·ges*è
wÜam
.
wÜam_¬¿y
;

118 
¡¬t
 = (()(
i
*(
N
/()
M
)))%N;

119 
’d
 = (()((
i
+1)*(
N
/()
M
)))%N;

120 ià(
’d
 < 
¡¬t
è’d = 
N
;

122 
ušŒ_t
 
addr
 = 
¡¬t
;‡dd¸< 
’d
;‡ddr++)

124 
ušŒ_t
 
upd©ed_pos™iÚ
 = 
	`g‘_pos
(
addr
);

125 
·ges
 
upd©ed_·ge
 = 
¬¿y_±r
[
upd©ed_pos™iÚ
];

131 
	`deüy±_·ge
((
ušt8_t
*)
upd©ed_·ge
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

132 
	`deüy±_·ge
((
ušt8_t
*)&
upd©ed_·ge
.
v”_num
,2*(
ušŒ_t
),(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

133 
	`’üy±_·ge
((
ušt8_t
*)
upd©ed_·ge
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

134 
	`’üy±_·ge
((
ušt8_t
*)&
upd©ed_·ge
.
v”_num
,2*(
ušŒ_t
),(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

135 
¬¿y_±r
[
addr
] = 
upd©ed_·ge
;

136 
	`£t_pos
(
addr
 << 
RISCV_PAGE_BITS
,‡ddr);

138 
	}
}

140 
	$wÜam_wr™e_acûss
(
·ges
 
viùim_·ge
)

142 
ušŒ_t
 
·ge_va
 = 
viùim_·ge
.
add»ss
;

143 
	`v®id©e_acûss
(
·ge_va
 >> 
RISCV_PAGE_BITS
);

144 
ušŒ_t
 
pos™iÚ
 = 
	`wr™e_to_hŞdšg_¬—
(
viùim_·ge
);

145 
	`£t_pos
(
·ge_va
, 
pos™iÚ
);

146 
	`»äesh_maš_¬—
();

147 
wÜam
.
wr™e_acûss_couÁ”
++;

148 
	}
}

150 
	$wÜam_»ad_acûss
(
ušŒ_t
 
·ge_va
, 
·ges
* 
»tuºed_·ge
)

152 
·ges
 *
¬¿y_±r
 = (·ges*è
wÜam
.
wÜam_¬¿y
;

153 
ušŒ_t
 
·ge_v²
 = 
·ge_va
 >> 
RISCV_PAGE_BITS
;

154 
	`v®id©e_acûss
(
·ge_v²
);

155 
ušŒ_t
 
aùu®_šdex
 = 
	`g‘_pos
(
·ge_v²
);

157 
·ges
 
·ge_»ad
 = 
¬¿y_±r
[
aùu®_šdex
];

158 
	`memıy
(
»tuºed_·ge
, &
·ge_»ad
, (
·ges
));

159 
	}
}

161 
	$¡Üe_viùim_·ge_to_wÜam
(
ušŒ_t
 
viùim_·ge_’şave_va
, ušŒ_ˆ
viùim_·ge_ruÁime_va
,

162 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
)

164 
·ges
 
viùim_·ge
;

165 
viùim_·ge
.
add»ss
 = 
viùim_·ge_’şave_va
;

166 
	`memıy
((*)
viùim_·ge
.
d©a
,(*)
viùim_·ge_ruÁime_va
, 
RISCV_PAGE_SIZE
);

168 
v”siÚ_numb”s
[
	`v²
(
viùim_·ge_’şave_va
)]++;

169 
viùim_·ge
.
v”_num
=
v”siÚ_numb”s
[
	`v²
(
viùim_·ge_’şave_va
)];

171 if(
cÚfid’tŸl™y
)

173 
	`’üy±_·ge
((
ušt8_t
*)
viùim_·ge
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

174 
	`’üy±_·ge
((
ušt8_t
*)&
viùim_·ge
.
v”_num
,2*(
ušŒ_t
),(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

176 if(
auth’tiÿtiÚ
)

177 
	`ÿlcuÏ‹_hmac_wÜam
(&
viùim_·ge
,viùim_·ge.
hmac
,
HASH_SIZE
);

179 
	`wÜam_wr™e_acûss
(
viùim_·ge
);

180 
	}
}

182 
	$g‘_·ge_äom_wÜam
(
ušŒ_t
 
addr
, ušŒ_ˆ
Ãw_®loc_·ge
, ušŒ_ˆ*
¡©us_fšd_add»ss
,

183 
acûss_mode
, 
cÚfid’tŸl™y
, 
auth’tiÿtiÚ
)

186 
·ges
 *
»tuºed_·ge
 = (·ges*)
	`m®loc
((pages));

187 
	`wÜam_»ad_acûss
(
addr
, 
»tuºed_·ge
);

188 
·ges
 
brought_·ge
 = *
»tuºed_·ge
;

189 if(
auth’tiÿtiÚ
)

191 
ÿlc_hmac
[
HASH_SIZE
];

192 
	`ÿlcuÏ‹_hmac_wÜam
(&
brought_·ge
,
ÿlc_hmac
,
HASH_SIZE
);

193 if(!
	`check_hashes
((*)
ÿlc_hmac
 ,
HASH_SIZE
, (*)
brought_·ge
.
hmac
 ,HASH_SIZE ))

195 
	`´štf
("[ruÁime] PagcÜru±ed. HMAC iÁegr™y check faed. F©®ƒ¼Ü fÜ‡dd»s 0x%lx\n",
brought_·ge
.
add»ss
);

196 
	`sbi_ex™_’şave
(-1);

199 if(
cÚfid’tŸl™y
)

201 
	`deüy±_·ge
((
ušt8_t
*)
brought_·ge
.
d©a
,
RISCV_PAGE_SIZE
,(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

202 
	`deüy±_·ge
((
ušt8_t
*)&
brought_·ge
.
v”_num
,2*(
ušŒ_t
),(ušt8_t*)
keys
.
key_«s
,(ušt8_t*)keys.
iv_«s
);

205 if(
auth’tiÿtiÚ
 && 
v”siÚ_numb”s
[
	`v²
(
addr
)] !ğ
brought_·ge
.
v”_num
)

207 
	`´štf
("[ruÁime] PagcÜru±ed(Possibly‡„•Ïy‡‰ack). F©®ƒ¼Ü fÜ‡dd»s 0x%lx‡nd brought_·ge.v”_numğ0x%lx‡nd v”siÚ_num[]=0x%lx\n",
brought_·ge
.
add»ss
,brought_·ge.
v”_num
,
v”siÚ_numb”s
[
	`v²
(
addr
)]);

208 
	`sbi_ex™_’şave
(-1);

211 
	`memıy
((*)
Ãw_®loc_·ge
,(*)
brought_·ge
.
d©a
,
RISCV_PAGE_SIZE
);

212 
æags
 = 
PTE_A
 | 
PTE_V
|
PTE_R
 | 
PTE_X
 | 
PTE_W
 | 
PTE_U
 | 
PTE_L
;

213 ià(
acûss_mode
 == 1)

214 
æags
 = fÏg | 
PTE_D
;

216 *
¡©us_fšd_add»ss
 = 
	`±e_ü—‹
Ğ
	`µn
(
	`__·
(
Ãw_®loc_·ge
è), 
æags
);

218 *
¡©us_fšd_add»ss
 =(*¡©us_fšd_add»ss)|
PTE_V
|
PTE_E
;

219 
asm
 volatile ("fence.i\t\nsfence.vma\t\n");

220 
	`ä“
(
»tuºed_·ge
);

223 
	}
}

225 
	$ÿlcuÏ‹_hmac_wÜam
(
·ges
* 
p
, * 
hm
, 
ušŒ_t
 
hm_Ën
)

227 
hash_ÿlc
[
HASH_SIZE
];

228 
sha3_ùx_t
 
sha3
;

229 
	`sha3_š™
(&
sha3
, 
HASH_SIZE
);

230 
c
[16];

231 
	`xÜ_İ
((*)
keys
.
Key_hmac
,(*)keys.
z_2
,
c
,
AES_KEYLEN
);

232 
	`sha3_upd©e
(&
sha3
, (*)
c
, 
AES_KEYLEN
);

233 
	`sha3_upd©e
(&
sha3
, (*)(*
p
).
d©a
, 
RISCV_PAGE_SIZE
);

234 
	`sha3_upd©e
(&
sha3
, (*)&((*
p
).
v”_num
), 2*(
ušŒ_t
));

236 
	`sha3_fš®
((*)
hash_ÿlc
, &
sha3
);

237 
c2
[16];

238 
	`xÜ_İ
((*)
keys
.
Key_hmac
,(*)keys.
z_1
,
c2
,
AES_KEYLEN
);

239 
sha3_ùx_t
 
sha32
;

240 
	`sha3_š™
(&
sha32
, 
HASH_SIZE
);

241 
	`sha3_upd©e
(&
sha32
, (*)
c2
, 
AES_KEYLEN
);

242 
	`sha3_upd©e
(&
sha32
, (*)
hash_ÿlc
, 
HASH_SIZE
);

243 
	`sha3_fš®
((*)
hm
, &
sha32
);

244 
	}
}

246 
	$£tup_key_ut™›s
(
ušt8_t
 *
key_chacha_
, ušt8_ˆ*
key_«s_
, ušt8_ˆ*
iv_«s_
, ušt8_ˆ*
Key_hmac_
,

247 
ušt8_t
 *
z_1_
, ušt8_ˆ*
z_2_
, ušt8_ˆ*
key_
, ušt8_ˆ*
key_hmac_
, ušt8_ˆ*
z1_
, ušt8_ˆ*
z2_
)

249 
keys
.
key_chacha
 = 
key_chacha_
;

250 
keys
.
key_«s
 = 
key_«s_
;

251 
keys
.
iv_«s
 = 
iv_«s_
;

252 
keys
.
Key_hmac
 = 
Key_hmac_
;

253 
keys
.
z_1
 = 
z_1_
;

254 
keys
.
z_2
 = 
z_2_
;

255 
keys
.
key
 = 
key_
;

256 
keys
.
key_hmac
 = 
key_hmac_
;

257 
keys
.
z1
 = 
z1_
;

258 
keys
.
z2
 = 
z2_
;

259 
	}
}

	@woram.h

1 #iâdeà
WORAM_H


2 
	#WORAM_H


	)

4 
	~"vm.h
"

6 
	#UTM_ARRAY_STARTING_OFFSET
 1048*1048

7 
	#WORAM_SIZE
 3000

	)

8 
	#SCALING_FACTOR
 2/3.0

9 

	)

10 
	swÜam
 {

11 
ušŒ_t
 
	mwÜam_¬¿y
;

12 
ušŒ_t
 
	mwÜam_¬¿y_size
;

13 
ušŒ_t
 *
	mpos™iÚ_m­
;

14 
	mmaš_¬—_size
;

15 
	mhŞdšg_¬—_size
;

16 
	mwr™e_acûss_couÁ”
;

17 } 
	gwÜam
;

21 
	skey_ut™›s


23 
ušt8_t
 *
	mkey_chacha
;

24 
ušt8_t
 *
	mkey_«s
;

25 
ušt8_t
 *
	miv_«s
;

26 
ušt8_t
 *
	mKey_hmac
;

27 
ušt8_t
 *
	mz_1
;

28 
ušt8_t
 *
	mz_2
;

29 
ušt8_t
 *
	mkey
;

30 
ušt8_t
 *
	mkey_hmac
;

31 
ušt8_t
 *
	mz1
;

32 
ušt8_t
 *
	mz2
;

34 
key_ut™›s
 
	gkeys
;

36 
š™Ÿlize_wÜam_¬¿y
();

37 
š™Ÿlize_pos™iÚ_m­
();

38 
§n™y_check
();

39 
v®id©e_acûss
(
ušŒ_t
 
šdex
);

40 
wÜam_wr™e_acûss
(
·ges
);

41 
wÜam_»ad_acûss
(
ušŒ_t
, 
·ges
*);

42 
£t_pos
(
ušŒ_t
 
addr
, ušŒ_ˆ
Ãw_addr
);

43 
ušŒ_t
 
g‘_pos
(ušŒ_ˆ
addr
);

44 
»äesh_maš_¬—
();

45 
ušŒ_t
 
wr™e_to_hŞdšg_¬—
(
·ges
 
d©a
);

47 
¡Üe_viùim_·ge_to_wÜam
(
ušŒ_t
 
viùim_·ge_’şave_va
, ušŒ_ˆ
viùim_·ge_ruÁime_va
, , );

48 
g‘_·ge_äom_wÜam
(
ušŒ_t
 
addr
, ušŒ_ˆ
Ãw_®loc_·ge
, ušŒ_ˆ*
¡©us_fšd_add»ss
,

49 
acûss_mode
, , );

50 
ÿlcuÏ‹_hmac_wÜam
(
·ges
* 
p
, * 
hm
, 
ušŒ_t
 
hm_Ën
);

52 
£tup_key_ut™›s
(
ušt8_t
 *
key_chacha_
, ušt8_ˆ*
key_«s_
, ušt8_ˆ*
iv_«s_
, ušt8_ˆ*
Key_hmac_
,

53 
ušt8_t
 *
z_1_
, ušt8_ˆ*
z_2_
, ušt8_ˆ*
key_
, ušt8_ˆ*
key_hmac_
, ušt8_ˆ*
z1_
, ušt8_ˆ*
z2_
);

56 
di¥Ïy_pos™iÚ_m­
();

57 
‹¡šg
();

	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

108 
__exùy³
 (
i§Êum
);

109 
__exùy³
 (
i§Íha
);

110 
__exùy³
 (
isúŒl
);

111 
__exùy³
 (
isdig™
);

112 
__exùy³
 (
i¦ow”
);

113 
__exùy³
 (
isg¿ph
);

114 
__exùy³
 (
i¥ršt
);

115 
__exùy³
 (
i¥unù
);

116 
__exùy³
 (
is¥aû
);

117 
__exùy³
 (
isuµ”
);

118 
__exùy³
 (
isxdig™
);

122 
	$tŞow”
 (
__c
è
__THROW
;

125 
	$touµ”
 (
__c
è
__THROW
;

129 #ifdef 
__USE_ISOC99


130 
	`__exùy³
 (
isbÏnk
);

133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE


173 #ifdeà
__isùy³_f


174 
	$__isùy³_f
 (
®num
)

175 
	$__isùy³_f
 (
®pha
)

176 
	$__isùy³_f
 (
úŒl
)

177 
	$__isùy³_f
 (
dig™
)

178 
	$__isùy³_f
 (
low”
)

179 
	$__isùy³_f
 (
g¿ph
)

180 
	$__isùy³_f
 (
´št
)

181 
	$__isùy³_f
 (
punù
)

182 
	$__isùy³_f
 (
¥aû
)

183 
	$__isùy³_f
 (
uµ”
)

184 
	$__isùy³_f
 (
xdig™
)

185 #ifdeà
__USE_ISOC99


186 
	$__isùy³_f
 (
bÏnk
)

188 #–ià
defšed
 
__isùy³


189 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

190 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

191 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

192 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

193 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

194 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

195 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

196 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

197 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

198 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

199 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

200 #ifdeà
__USE_ISOC99


201 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

205 #ifdeà
__USE_EXTERN_INLINES


206 
__ex‹º_šlše
 

207 
	`__NTH
 (
	$tŞow”
 (
__c
))

209  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

210 
	}
}

212 
__ex‹º_šlše
 

213 
__NTH
 (
	$touµ”
 (
__c
))

215  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

216 
	}
}

219 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


220 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

221 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

224 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


225 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

226 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

228 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

229 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

235 #ifdeà
__USE_XOPEN2K8


237 
	~<b™s/ty³s/loÿË_t.h
>

241 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

242 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

244 
	#__exùy³_l
(
Çme
) \

245 
	`Çme
 (, 
loÿË_t
è
__THROW


	)

251 
__exùy³_l
 (
i§Êum_l
);

252 
__exùy³_l
 (
i§Íha_l
);

253 
__exùy³_l
 (
isúŒl_l
);

254 
__exùy³_l
 (
isdig™_l
);

255 
__exùy³_l
 (
i¦ow”_l
);

256 
__exùy³_l
 (
isg¿ph_l
);

257 
__exùy³_l
 (
i¥ršt_l
);

258 
__exùy³_l
 (
i¥unù_l
);

259 
__exùy³_l
 (
is¥aû_l
);

260 
__exùy³_l
 (
isuµ”_l
);

261 
__exùy³_l
 (
isxdig™_l
);

263 
__exùy³_l
 (
isbÏnk_l
);

267 
	$__tŞow”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

268 
	$tŞow”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

271 
	$__touµ”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

272 
	$touµ”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

274 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


275 
	#__tŞow”_l
(
c
, 
loÿË
) \

276 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

277 
	#__touµ”_l
(
c
, 
loÿË
) \

278 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

279 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

280 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

284 #iâdeà
__NO_CTYPE


285 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

286 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

287 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

288 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

289 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

290 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

291 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

292 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

293 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

294 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

295 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

297 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

299 #ifdeà
__USE_MISC


300 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

301 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

304 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

305 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

306 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

307 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

308 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

309 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

310 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

311 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

312 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

313 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

314 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

316 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

318 #ifdeà
__USE_MISC


319 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

320 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

327 
__END_DECLS


	@/usr/include/linux/const.h

4 #iâdeà
_LINUX_CONST_H


5 
	#_LINUX_CONST_H


	)

16 #ifdeà
__ASSEMBLY__


17 
	#_AC
(
X
,
Y
è
	)
X

18 
	#_AT
(
T
,
X
è
	)
X

20 
	#__AC
(
X
,
Y
è(X##Y)

	)

21 
	#_AC
(
X
,
Y
è
	`__AC
(X,Y)

	)

22 
	#_AT
(
T
,
X
è((T)(X))

	)

25 
	#_BITUL
(
x
è(
	`_AC
(1,
UL
è<< (x))

	)

26 
	#_BITULL
(
x
è(
	`_AC
(1,
ULL
è<< (x))

	)

	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wch¬.h
>

29 
	~<b™s/wÜdsize.h
>

34 
	~<b™s/¡dšt-šŠ.h
>

37 
	~<b™s/¡dšt-ušŠ.h
>

43 sigÃd 
	tšt_Ëa¡8_t
;

44 
	tšt_Ëa¡16_t
;

45 
	tšt_Ëa¡32_t
;

46 #ià
__WORDSIZE
 == 64

47 
	tšt_Ëa¡64_t
;

49 
__ex‹nsiÚ__


50 
	tšt_Ëa¡64_t
;

54 
	tušt_Ëa¡8_t
;

55 
	tušt_Ëa¡16_t
;

56 
	tušt_Ëa¡32_t
;

57 #ià
__WORDSIZE
 == 64

58 
	tušt_Ëa¡64_t
;

60 
__ex‹nsiÚ__


61 
	tušt_Ëa¡64_t
;

68 sigÃd 
	tšt_ç¡8_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_ç¡16_t
;

71 
	tšt_ç¡32_t
;

72 
	tšt_ç¡64_t
;

74 
	tšt_ç¡16_t
;

75 
	tšt_ç¡32_t
;

76 
__ex‹nsiÚ__


77 
	tšt_ç¡64_t
;

81 
	tušt_ç¡8_t
;

82 #ià
__WORDSIZE
 == 64

83 
	tušt_ç¡16_t
;

84 
	tušt_ç¡32_t
;

85 
	tušt_ç¡64_t
;

87 
	tušt_ç¡16_t
;

88 
	tušt_ç¡32_t
;

89 
__ex‹nsiÚ__


90 
	tušt_ç¡64_t
;

95 #ià
__WORDSIZE
 == 64

96 #iâdeà
__šŒ_t_defšed


97 
	tšŒ_t
;

98 
	#__šŒ_t_defšed


	)

100 
	tušŒ_t
;

102 #iâdeà
__šŒ_t_defšed


103 
	tšŒ_t
;

104 
	#__šŒ_t_defšed


	)

106 
	tušŒ_t
;

111 
__štmax_t
 
	tštmax_t
;

112 
__uštmax_t
 
	tuštmax_t
;

115 #ià
__WORDSIZE
 == 64

116 
	#__INT64_C
(
c
èø## 
L


	)

117 
	#__UINT64_C
(
c
èø## 
UL


	)

119 
	#__INT64_C
(
c
èø## 
LL


	)

120 
	#__UINT64_C
(
c
èø## 
ULL


	)

126 
	#INT8_MIN
 (-128)

	)

127 
	#INT16_MIN
 (-32767-1)

	)

128 
	#INT32_MIN
 (-2147483647-1)

	)

129 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

131 
	#INT8_MAX
 (127)

	)

132 
	#INT16_MAX
 (32767)

	)

133 
	#INT32_MAX
 (2147483647)

	)

134 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

137 
	#UINT8_MAX
 (255)

	)

138 
	#UINT16_MAX
 (65535)

	)

139 
	#UINT32_MAX
 (4294967295U)

	)

140 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

144 
	#INT_LEAST8_MIN
 (-128)

	)

145 
	#INT_LEAST16_MIN
 (-32767-1)

	)

146 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

147 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

149 
	#INT_LEAST8_MAX
 (127)

	)

150 
	#INT_LEAST16_MAX
 (32767)

	)

151 
	#INT_LEAST32_MAX
 (2147483647)

	)

152 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

155 
	#UINT_LEAST8_MAX
 (255)

	)

156 
	#UINT_LEAST16_MAX
 (65535)

	)

157 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

158 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

162 
	#INT_FAST8_MIN
 (-128)

	)

163 #ià
__WORDSIZE
 == 64

164 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

165 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

167 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

168 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

170 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

172 
	#INT_FAST8_MAX
 (127)

	)

173 #ià
__WORDSIZE
 == 64

174 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

175 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

177 
	#INT_FAST16_MAX
 (2147483647)

	)

178 
	#INT_FAST32_MAX
 (2147483647)

	)

180 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

183 
	#UINT_FAST8_MAX
 (255)

	)

184 #ià
__WORDSIZE
 == 64

185 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

186 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

188 
	#UINT_FAST16_MAX
 (4294967295U)

	)

189 
	#UINT_FAST32_MAX
 (4294967295U)

	)

191 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

195 #ià
__WORDSIZE
 == 64

196 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

197 
	#INTPTR_MAX
 (9223372036854775807L)

	)

198 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

200 
	#INTPTR_MIN
 (-2147483647-1)

	)

201 
	#INTPTR_MAX
 (2147483647)

	)

202 
	#UINTPTR_MAX
 (4294967295U)

	)

207 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

209 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

218 #ià
__WORDSIZE
 == 64

219 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

220 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

222 #ià
__WORDSIZE32_PTRDIFF_LONG


223 
	#PTRDIFF_MIN
 (-2147483647L-1)

	)

224 
	#PTRDIFF_MAX
 (2147483647L)

	)

226 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

227 
	#PTRDIFF_MAX
 (2147483647)

	)

232 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

233 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

236 #ià
__WORDSIZE
 == 64

237 
	#SIZE_MAX
 (18446744073709551615UL)

	)

239 #ià
__WORDSIZE32_SIZE_ULONG


240 
	#SIZE_MAX
 (4294967295UL)

	)

242 
	#SIZE_MAX
 (4294967295U)

	)

247 #iâdeà
WCHAR_MIN


249 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

250 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

254 
	#WINT_MIN
 (0u)

	)

255 
	#WINT_MAX
 (4294967295u)

	)

258 
	#INT8_C
(
c
è
	)
c

259 
	#INT16_C
(
c
è
	)
c

260 
	#INT32_C
(
c
è
	)
c

261 #ià
__WORDSIZE
 == 64

262 
	#INT64_C
(
c
èø## 
L


	)

264 
	#INT64_C
(
c
èø## 
LL


	)

268 
	#UINT8_C
(
c
è
	)
c

269 
	#UINT16_C
(
c
è
	)
c

270 
	#UINT32_C
(
c
èø## 
U


	)

271 #ià
__WORDSIZE
 == 64

272 
	#UINT64_C
(
c
èø## 
UL


	)

274 
	#UINT64_C
(
c
èø## 
ULL


	)

278 #ià
__WORDSIZE
 == 64

279 
	#INTMAX_C
(
c
èø## 
L


	)

280 
	#UINTMAX_C
(
c
èø## 
UL


	)

282 
	#INTMAX_C
(
c
èø## 
LL


	)

283 
	#UINTMAX_C
(
c
èø## 
ULL


	)

286 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

288 
	#INT8_WIDTH
 8

	)

289 
	#UINT8_WIDTH
 8

	)

290 
	#INT16_WIDTH
 16

	)

291 
	#UINT16_WIDTH
 16

	)

292 
	#INT32_WIDTH
 32

	)

293 
	#UINT32_WIDTH
 32

	)

294 
	#INT64_WIDTH
 64

	)

295 
	#UINT64_WIDTH
 64

	)

297 
	#INT_LEAST8_WIDTH
 8

	)

298 
	#UINT_LEAST8_WIDTH
 8

	)

299 
	#INT_LEAST16_WIDTH
 16

	)

300 
	#UINT_LEAST16_WIDTH
 16

	)

301 
	#INT_LEAST32_WIDTH
 32

	)

302 
	#UINT_LEAST32_WIDTH
 32

	)

303 
	#INT_LEAST64_WIDTH
 64

	)

304 
	#UINT_LEAST64_WIDTH
 64

	)

306 
	#INT_FAST8_WIDTH
 8

	)

307 
	#UINT_FAST8_WIDTH
 8

	)

308 
	#INT_FAST16_WIDTH
 
__WORDSIZE


	)

309 
	#UINT_FAST16_WIDTH
 
__WORDSIZE


	)

310 
	#INT_FAST32_WIDTH
 
__WORDSIZE


	)

311 
	#UINT_FAST32_WIDTH
 
__WORDSIZE


	)

312 
	#INT_FAST64_WIDTH
 64

	)

313 
	#UINT_FAST64_WIDTH
 64

	)

315 
	#INTPTR_WIDTH
 
__WORDSIZE


	)

316 
	#UINTPTR_WIDTH
 
__WORDSIZE


	)

318 
	#INTMAX_WIDTH
 64

	)

319 
	#UINTMAX_WIDTH
 64

	)

321 
	#PTRDIFF_WIDTH
 
__WORDSIZE


	)

322 
	#SIG_ATOMIC_WIDTH
 32

	)

323 
	#SIZE_WIDTH
 
__WORDSIZE


	)

324 
	#WCHAR_WIDTH
 32

	)

325 
	#WINT_WIDTH
 32

	)

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


24 
	#_STDIO_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<b™s/libc-h—d”-¡¬t.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	~<b™s/ty³s/__FILE.h
>

37 
	~<b™s/ty³s/FILE.h
>

39 
	#_STDIO_USES_IOSTREAM


	)

41 
	~<b™s/libio.h
>

43 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


44 #ifdeà
__GNUC__


45 #iâdeà
_VA_LIST_DEFINED


46 
_G_va_li¡
 
	tva_li¡
;

47 
	#_VA_LIST_DEFINED


	)

50 
	~<¡d¬g.h
>

54 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


55 #iâdeà
__off_t_defšed


56 #iâdeà
__USE_FILE_OFFSET64


57 
__off_t
 
	toff_t
;

59 
__off64_t
 
	toff_t
;

61 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

69 #ifdeà
__USE_XOPEN2K8


70 #iâdeà
__ssize_t_defšed


71 
__ssize_t
 
	tssize_t
;

72 
	#__ssize_t_defšed


	)

77 #iâdeà
__USE_FILE_OFFSET64


78 
_G_åos_t
 
	tåos_t
;

80 
_G_åos64_t
 
	tåos_t
;

82 #ifdeà
__USE_LARGEFILE64


83 
_G_åos64_t
 
	tåos64_t
;

87 
	#_IOFBF
 0

	)

88 
	#_IOLBF
 1

	)

89 
	#_IONBF
 2

	)

93 #iâdeà
BUFSIZ


94 
	#BUFSIZ
 
_IO_BUFSIZ


	)

100 #iâdeà
EOF


101 
	#EOF
 (-1)

	)

107 
	#SEEK_SET
 0

	)

108 
	#SEEK_CUR
 1

	)

109 
	#SEEK_END
 2

	)

110 #ifdeà
__USE_GNU


111 
	#SEEK_DATA
 3

	)

112 
	#SEEK_HOLE
 4

	)

116 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


118 
	#P_tmpdœ
 "/tmp"

	)

131 
	~<b™s/¡dio_lim.h
>

135 
_IO_FILE
 *
¡dš
;

136 
_IO_FILE
 *
¡dout
;

137 
_IO_FILE
 *
¡d”r
;

139 
	#¡dš
 
¡dš


	)

140 
	#¡dout
 
¡dout


	)

141 
	#¡d”r
 
¡d”r


	)

144 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

146 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

148 #ifdeà
__USE_ATFILE


150 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

151 cÚ¡ *
__Ãw
è
__THROW
;

158 #iâdeà
__USE_FILE_OFFSET64


159 
FILE
 *
	$tmpfe
 (è
__wur
;

161 #ifdeà
__REDIRECT


162 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

164 
	#tmpfe
 
tmpfe64


	)

168 #ifdeà
__USE_LARGEFILE64


169 
FILE
 *
	$tmpfe64
 (è
__wur
;

173 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

175 #ifdeà
__USE_MISC


178 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

182 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


190 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

191 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

199 
	`fşo£
 (
FILE
 *
__¡»am
);

204 
	`fæush
 (
FILE
 *
__¡»am
);

206 #ifdeà
__USE_MISC


213 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

216 #ifdeà
__USE_GNU


223 
	`fşo£®l
 ();

227 #iâdeà
__USE_FILE_OFFSET64


232 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

233 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

238 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

239 cÚ¡ *
__»¡riù
 
__modes
,

240 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

242 #ifdeà
__REDIRECT


243 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

244 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

245 
__wur
;

246 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

247 cÚ¡ *
__»¡riù
 
__modes
,

248 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

249 
__wur
;

251 
	#fİ’
 
fİ’64


	)

252 
	#äeİ’
 
äeİ’64


	)

255 #ifdeà
__USE_LARGEFILE64


256 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

257 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

258 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

259 cÚ¡ *
__»¡riù
 
__modes
,

260 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

263 #ifdef 
__USE_POSIX


265 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

268 #ifdef 
__USE_GNU


271 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

272 cÚ¡ *
__»¡riù
 
__modes
,

273 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

276 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

278 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

279 
__THROW
 
__wur
;

284 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

290 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

294 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

295 
__modes
, 
size_t
 
__n
è
__THROW
;

297 #ifdef 
__USE_MISC


300 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

301 
size_t
 
__size
è
__THROW
;

304 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

312 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

313 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

318 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

320 
	$¥rštf
 (*
__»¡riù
 
__s
,

321 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

327 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

328 
_G_va_li¡
 
__¬g
);

333 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

335 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

336 
_G_va_li¡
 
__¬g
è
__THROWNL
;

338 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


340 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

341 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

342 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

344 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

345 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

346 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

349 #ià
	`__GLIBC_USE
 (
LIB_EXT2
)

352 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

353 
_G_va_li¡
 
__¬g
)

354 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

355 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

356 cÚ¡ *
__»¡riù
 
__fmt
, ...)

357 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

358 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

359 cÚ¡ *
__»¡riù
 
__fmt
, ...)

360 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

363 #ifdeà
__USE_XOPEN2K8


365 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

366 
_G_va_li¡
 
__¬g
)

367 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

368 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

369 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

377 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

378 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

383 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

385 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

386 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

388 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

389 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

390 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

391 #ifdeà
__REDIRECT


395 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

396 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

397 
__isoc99_fsÿnf
è
__wur
;

398 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

399 
__isoc99_sÿnf
è
__wur
;

400 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

401 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

402 
__isoc99_ssÿnf
);

404 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

405 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

406 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

407 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

408 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

409 
	#fsÿnf
 
__isoc99_fsÿnf


	)

410 
	#sÿnf
 
__isoc99_sÿnf


	)

411 
	#ssÿnf
 
__isoc99_ssÿnf


	)

415 #ifdef 
__USE_ISOC99


420 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

421 
_G_va_li¡
 
__¬g
)

422 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

428 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

429 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

432 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

433 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

434 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

436 #ià!
defšed
 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
vfsÿnf
,

444 (
FILE
 *
__»¡riù
 
__s
,

445 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

446 
__isoc99_vfsÿnf
)

447 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

448 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

449 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

450 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

451 
	`__REDIRECT_NTH
 (
vssÿnf
,

452 (cÚ¡ *
__»¡riù
 
__s
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
,

454 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

455 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

457 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

458 cÚ¡ *
__»¡riù
 
__fÜm©
,

459 
_G_va_li¡
 
__¬g
è
__wur
;

460 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

461 
_G_va_li¡
 
__¬g
è
__wur
;

462 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

463 cÚ¡ *
__»¡riù
 
__fÜm©
,

464 
_G_va_li¡
 
__¬g
è
__THROW
;

465 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

466 
	#vsÿnf
 
__isoc99_vsÿnf


	)

467 
	#vssÿnf
 
__isoc99_vssÿnf


	)

477 
	`fg‘c
 (
FILE
 *
__¡»am
);

478 
	`g‘c
 (
FILE
 *
__¡»am
);

484 
	`g‘ch¬
 ();

488 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

490 #ifdeà
__USE_POSIX199506


495 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

496 
	`g‘ch¬_uÆocked
 ();

499 #ifdeà
__USE_MISC


506 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

517 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

518 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

524 
	`putch¬
 (
__c
);

528 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

530 #ifdeà
__USE_MISC


537 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

540 #ifdeà
__USE_POSIX199506


545 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

546 
	`putch¬_uÆocked
 (
__c
);

550 #ià
defšed
 
__USE_MISC
 \

551 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

553 
	`g‘w
 (
FILE
 *
__¡»am
);

556 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

564 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

565 
__wur
;

567 #ià
	`__GLIBC_USE
 (
DEPRECATED_GETS
)

577 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

580 #ifdeà
__USE_GNU


587 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

588 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

592 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

603 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

604 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

605 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

606 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

607 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

608 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

616 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

617 
size_t
 *
__»¡riù
 
__n
,

618 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

626 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

632 
	`puts
 (cÚ¡ *
__s
);

639 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

646 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

647 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

652 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

653 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

655 #ifdeà
__USE_GNU


662 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

663 
FILE
 *
__»¡riù
 
__¡»am
);

666 #ifdeà
__USE_MISC


673 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

674 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

675 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

676 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

684 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

689 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

694 
	`»wšd
 (
FILE
 *
__¡»am
);

701 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


702 #iâdeà
__USE_FILE_OFFSET64


707 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

712 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

714 #ifdeà
__REDIRECT


715 
	`__REDIRECT
 (
f£eko
,

716 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

717 
f£eko64
);

718 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

720 
	#f£eko
 
f£eko64


	)

721 
	#á–lo
 
á–lo64


	)

726 #iâdeà
__USE_FILE_OFFSET64


731 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

736 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

738 #ifdeà
__REDIRECT


739 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

740 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

741 
	`__REDIRECT
 (
f£os
,

742 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

744 
	#fg‘pos
 
fg‘pos64


	)

745 
	#f£os
 
f£os64


	)

749 #ifdeà
__USE_LARGEFILE64


750 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

751 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

752 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

753 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

757 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

759 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

761 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

763 #ifdeà
__USE_MISC


765 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

766 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

767 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

775 
	`³¼Ü
 (cÚ¡ *
__s
);

781 
	~<b™s/sys_”¾i¡.h
>

784 #ifdef 
__USE_POSIX


786 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

789 #ifdeà
__USE_MISC


791 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

795 #ifdeà
__USE_POSIX2


800 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

806 
	`pşo£
 (
FILE
 *
__¡»am
);

810 #ifdef 
__USE_POSIX


812 *
	$ù”mid
 (*
__s
è
__THROW
;

816 #ià(
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
è|| defšed 
__USE_GNU


818 *
	`cu£rid
 (*
__s
);

822 #ifdef 
__USE_GNU


823 
ob¡ack
;

826 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

827 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

828 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

829 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

830 cÚ¡ *
__»¡riù
 
__fÜm©
,

831 
_G_va_li¡
 
__¬gs
)

832 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

836 #ifdeà
__USE_POSIX199506


840 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

844 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

847 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

850 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


853 
	~<b™s/g‘İt_posix.h
>

858 #ifdeà
__USE_EXTERN_INLINES


859 
	~<b™s/¡dio.h
>

861 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


862 
	~<b™s/¡dio2.h
>

864 #ifdeà
__LDBL_COMPAT


865 
	~<b™s/¡dio-ldbl.h
>

868 
__END_DECLS


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_MISC
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

61 
	~<b™s/ušŠ-id’t™y.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

80 
	#htobe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

81 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

82 
	#be16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

83 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

85 
	#htobe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

86 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

87 
	#be32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

88 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

90 
	#htobe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

91 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

92 
	#be64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

93 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

119 #undeà
__USE_ISOC11


120 #undeà
__USE_ISOC99


121 #undeà
__USE_ISOC95


122 #undeà
__USE_ISOCXX11


123 #undeà
__USE_POSIX


124 #undeà
__USE_POSIX2


125 #undeà
__USE_POSIX199309


126 #undeà
__USE_POSIX199506


127 #undeà
__USE_XOPEN


128 #undeà
__USE_XOPEN_EXTENDED


129 #undeà
__USE_UNIX98


130 #undeà
__USE_XOPEN2K


131 #undeà
__USE_XOPEN2KXSI


132 #undeà
__USE_XOPEN2K8


133 #undeà
__USE_XOPEN2K8XSI


134 #undeà
__USE_LARGEFILE


135 #undeà
__USE_LARGEFILE64


136 #undeà
__USE_FILE_OFFSET64


137 #undeà
__USE_MISC


138 #undeà
__USE_ATFILE


139 #undeà
__USE_GNU


140 #undeà
__USE_FORTIFY_LEVEL


141 #undeà
__KERNEL_STRICT_NAMES


142 #undeà
__GLIBC_USE_DEPRECATED_GETS


146 #iâdeà
_LOOSE_KERNEL_NAMES


147 
	#__KERNEL_STRICT_NAMES


	)

157 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


158 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

159 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

161 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

168 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


169 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

170 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

172 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

176 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

182 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

183 && !
defšed
 
	g_DEFAULT_SOURCE


185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

190 #ifdeà
_GNU_SOURCE


191 #undeà
_ISOC95_SOURCE


192 
	#_ISOC95_SOURCE
 1

	)

193 #undeà
_ISOC99_SOURCE


194 
	#_ISOC99_SOURCE
 1

	)

195 #undeà
_ISOC11_SOURCE


196 
	#_ISOC11_SOURCE
 1

	)

197 #undeà
_POSIX_SOURCE


198 
	#_POSIX_SOURCE
 1

	)

199 #undeà
_POSIX_C_SOURCE


200 
	#_POSIX_C_SOURCE
 200809L

	)

201 #undeà
_XOPEN_SOURCE


202 
	#_XOPEN_SOURCE
 700

	)

203 #undeà
_XOPEN_SOURCE_EXTENDED


204 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

205 #undeà
_LARGEFILE64_SOURCE


206 
	#_LARGEFILE64_SOURCE
 1

	)

207 #undeà
_DEFAULT_SOURCE


208 
	#_DEFAULT_SOURCE
 1

	)

209 #undeà
_ATFILE_SOURCE


210 
	#_ATFILE_SOURCE
 1

	)

215 #ià(
defšed
 
_DEFAULT_SOURCE
 \

216 || (!
defšed
 
	g__STRICT_ANSI__
 \

217 && !
defšed
 
	g_ISOC99_SOURCE
 \

218 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

219 && !
defšed
 
	g_XOPEN_SOURCE
))

220 #undeà
_DEFAULT_SOURCE


221 
	#_DEFAULT_SOURCE
 1

	)

225 #ià(
defšed
 
_ISOC11_SOURCE
 \

226 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

227 
	#__USE_ISOC11
 1

	)

231 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

232 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

233 
	#__USE_ISOC99
 1

	)

237 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

238 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

239 
	#__USE_ISOC95
 1

	)

242 #ifdeà
__ılu¥lus


244 #ià
__ılu¥lus
 >= 201703L

245 
	#__USE_ISOC11
 1

	)

249 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


250 
	#__USE_ISOCXX11
 1

	)

251 
	#__USE_ISOC99
 1

	)

258 #ifdeà
_DEFAULT_SOURCE


259 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


260 
	#__USE_POSIX_IMPLICITLY
 1

	)

262 #undeà
_POSIX_SOURCE


263 
	#_POSIX_SOURCE
 1

	)

264 #undeà
_POSIX_C_SOURCE


265 
	#_POSIX_C_SOURCE
 200809L

	)

268 #ià((!
defšed
 
__STRICT_ANSI__
 \

269 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

270 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

271 
	#_POSIX_SOURCE
 1

	)

272 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

273 
	#_POSIX_C_SOURCE
 2

	)

274 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

275 
	#_POSIX_C_SOURCE
 199506L

	)

276 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

277 
	#_POSIX_C_SOURCE
 200112L

	)

279 
	#_POSIX_C_SOURCE
 200809L

	)

281 
	#__USE_POSIX_IMPLICITLY
 1

	)

290 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

291 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

292 
	#_POSIX_SOURCE
 1

	)

293 #undeà
_POSIX_C_SOURCE


294 
	#_POSIX_C_SOURCE
 199506L

	)

297 #ià(
defšed
 
_POSIX_SOURCE
 \

298 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

299 || 
defšed
 
_XOPEN_SOURCE
)

300 
	#__USE_POSIX
 1

	)

303 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


304 
	#__USE_POSIX2
 1

	)

307 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

308 
	#__USE_POSIX199309
 1

	)

311 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

312 
	#__USE_POSIX199506
 1

	)

315 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

316 
	#__USE_XOPEN2K
 1

	)

317 #undeà
__USE_ISOC95


318 
	#__USE_ISOC95
 1

	)

319 #undeà
__USE_ISOC99


320 
	#__USE_ISOC99
 1

	)

323 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

324 
	#__USE_XOPEN2K8
 1

	)

325 #undeà
_ATFILE_SOURCE


326 
	#_ATFILE_SOURCE
 1

	)

329 #ifdef 
_XOPEN_SOURCE


330 
	#__USE_XOPEN
 1

	)

331 #ià(
_XOPEN_SOURCE
 - 0) >= 500

332 
	#__USE_XOPEN_EXTENDED
 1

	)

333 
	#__USE_UNIX98
 1

	)

334 #undeà
_LARGEFILE_SOURCE


335 
	#_LARGEFILE_SOURCE
 1

	)

336 #ià(
_XOPEN_SOURCE
 - 0) >= 600

337 #ià(
_XOPEN_SOURCE
 - 0) >= 700

338 
	#__USE_XOPEN2K8
 1

	)

339 
	#__USE_XOPEN2K8XSI
 1

	)

341 
	#__USE_XOPEN2K
 1

	)

342 
	#__USE_XOPEN2KXSI
 1

	)

343 #undeà
__USE_ISOC95


344 
	#__USE_ISOC95
 1

	)

345 #undeà
__USE_ISOC99


346 
	#__USE_ISOC99
 1

	)

349 #ifdeà
_XOPEN_SOURCE_EXTENDED


350 
	#__USE_XOPEN_EXTENDED
 1

	)

355 #ifdeà
_LARGEFILE_SOURCE


356 
	#__USE_LARGEFILE
 1

	)

359 #ifdeà
_LARGEFILE64_SOURCE


360 
	#__USE_LARGEFILE64
 1

	)

363 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

364 
	#__USE_FILE_OFFSET64
 1

	)

367 #ià
defšed
 
_DEFAULT_SOURCE


368 
	#__USE_MISC
 1

	)

371 #ifdef 
_ATFILE_SOURCE


372 
	#__USE_ATFILE
 1

	)

375 #ifdef 
_GNU_SOURCE


376 
	#__USE_GNU
 1

	)

379 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

380 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

381 #ià
_FORTIFY_SOURCE
 > 1

382 
	#__USE_FORTIFY_LEVEL
 2

	)

384 
	#__USE_FORTIFY_LEVEL
 1

	)

387 
	#__USE_FORTIFY_LEVEL
 0

	)

394 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


395 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

397 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

402 
	~<¡dc-´edef.h
>

410 #undeà
__GNU_LIBRARY__


411 
	#__GNU_LIBRARY__
 6

	)

415 
	#__GLIBC__
 2

	)

416 
	#__GLIBC_MINOR__
 27

	)

418 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

419 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

422 #iâdeà
__ASSEMBLER__


423 #iâdeà
_SYS_CDEFS_H


424 
	~<sys/cdefs.h
>

429 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


430 
	#__USE_LARGEFILE
 1

	)

431 
	#__USE_LARGEFILE64
 1

	)

437 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

438 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

439 && 
defšed
 
	g__ex‹º_šlše


440 
	#__USE_EXTERN_INLINES
 1

	)

448 
	~<gnu/¡ubs.h
>

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

61 
	#__STDC_NO_THREADS__
 1

	)

	@
1
.
1
/usr/include
73
1015
aess.c
aess.h
boot.c
common.h
elf.h
env.c
env.h
freemem.c
freemem.h
index_q.c
index_q.h
interrupt.c
interrupt.h
io_wrap.c
io_wrap.h
linux_wrap.c
linux_wrap.h
malloc.h
mm.c
mm.h
opam.c
opam.h
oram.c
oram.h
page_fault.c
page_replacement.c
page_replacement.h
printf.c
printf.h
regs.h
roram.c
roram.h
rt_util.c
rt_util.h
sbi.h
ssha3.c
ssha3.h
string.c
string.h
syscall.c
syscall.h
syscall_nums.h
timex.h
tiny-malloc.c
tmplib (copy)/asm/asm.h
tmplib (copy)/asm/csr.h
tmplib (copy)/asm/linkage.h
tmplib (copy)/linux/const.h
tmplib (copy)/linux/linkage.h
tmplib (copy)/partial_linkage.h
tmplib (copy)/uaccess.h
tmplib (copy)/uio.h
tmplib/asm/asm.h
tmplib/asm/csr.h
tmplib/asm/linkage.h
tmplib/linux/const.h
tmplib/linux/linkage.h
tmplib/partial_linkage.h
tmplib/uaccess.h
tmplib/uio.h
victim_cache.c
victim_cache.h
vm.h
woram.c
woram.h
/usr/include/alloca.h
/usr/include/ctype.h
/usr/include/linux/const.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/stdc-predef.h
